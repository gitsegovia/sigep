<?php
class Reporte2Controller extends AppController{

    var $uses = array('cimd06_acta_firmantes','cugd02_institucion','cugd02_dependencia','arrd05','ccfd04_cierre_mes','v_balance_ejecucion','v_balance_ejecucion2','v_balance_ejecucion_inst','v_balance_ejecucion2_inst','v_cfpd05_denominaciones', 'v_cfpd05_tipo_gasto',
                      'cfpd10_reformulacion_texto','cfpd05','v_analisis_presupuesto','cfpd10_reformulacion_partidas','cfpd10_reformulacion_texto','cscd04_ordencompra_encabezado','cscd04_ordencompra_partidas','cobd01_contratoobras_partidas','cobd01_contratoobras_cuerpo','cepd02_contratoservicio_partidas','cepd02_contratoservicio_cuerpo','cepd01_compromiso_partidas','cepd01_compromiso_cuerpo','cepd03_ordenpago_partidas','cepd03_ordenpago_cuerpo','cstd03_cheque_partidas','cstd03_cheque_cuerpo',
                       'cepd03_ordenpago_cuerpo','cscd04_ordencompra_encabezado','cscd04_ordencompra_autorizacion_cuerpo','v_cscd04_ordencompra_completa','cscd04_ordencompra_anticipo_cuerpo','cpcd02','cugd03_acta_anulacion_cuerpo','cstd03_cheque_cuerpo','cstd03_movimientos_manuales','cepd01_compromiso_cuerpo','cepd03_ordenpago_tipopago','cepd01_tipo_compromiso','cstd04_movimientos_generales','v_cstd_mov_gral','v_proyeccion_gasto_inst','v_proyeccion_gasto_dep','v_credito_agrupado','v_credito_agrupado_inst','v_credito_agrupado_dep','v_credito_agrupado_inst2','v_credito_agrupado_dep2','cobd01_contratoobras_anticipo_cuerpo','cobd01_contratoobras_valuacion_cuerpo','cepd02_contratoservicio_anticipo_cuerpo','cepd02_contratoservicio_valuacion_cuerpo','cstd01_entidades_bancarias','v_credito_presupuestario_dependencia',
                       'cugd07_firmas_oficio_anulacion','cobd01_contratoobras_cuerpo','cobd01_contratoobras_valuacion_cuerpo','cobd01_contratoobras_retencion_cuerpo','cepd02_contratoservicio_valuacion_partidas','cepd02_contratoservicio_retencion_cuerpo','cfpd07_obras_cuerpo',
                       'ccfd01_tipo','ccfd01_cuenta','ccfd01_subcuenta','ccfd01_division','ccfd01_subdivision', 'v_cscd04_ordencompra', 'v_cfpd05_tipo_gasto2','v_ejecucion_dep','v_ejecucion_inst','v_cfpd20','v_cfpd21','v_cfpd22','v_cfpd23','v_cfpd20_cfpd21','v_librodiario_2','v_cfpd10_reformulacion_partidas_tipopresupuesto',
                       'balance_mes2','balance_mes22_inst','v_proyeccion_gastos_nomina_final','v_proyeccion_gastos_nomina_final_i','v_proyeccion_gastos_nomina_final2','v_proyeccion_gastos_nomina_final2_i','cfpd10_reformulacion_tipo','cugd90_municipio_defecto','cugd01_estados','cugd01_municipios','cfpd02_activ_obra_ordinario');

    var $helpers = array('Html','Ajax','Javascript', 'Sisap', 'Fpdf');

function checkSession(){
                if (!$this->Session->check('Usuario')){
                        $this->redirect('/salir/');
                        exit();
                }else{
                    //$this->set('userTable', $this->requestAction('/cnmp03partidas/', array('return')));
                    //echo "H".$this->requestAction('/usuarios/actualizar_user',array('return'));
                    $this->requestAction('/usuarios/actualizar_user');
                }
}//fin checksession


function beforeFilter(){
            if(defined('SERVIDOR_REPORTE')){
                   if(SERVIDOR_REPORTE=="localhost"){
                        $this->checkSession();
                   }else{
                            if(defined('SERVIDOR_HOST')){
                                  $longitud              =  strlen(SERVIDOR_HOST);
                                  $direccion_referencial =  substr($_SERVER["HTTP_REFERER"], 0, $longitud);
                                  if(SERVIDOR_HOST==$direccion_referencial && isset($_SERVER["HTTP_REFERER"])){
                                     $_SESSION = recibe_input_array($this->params["form"]["REPORTE"]);
                                     if($_SESSION==null){
                                          $this->redirect($_SERVER["HTTP_REFERER"]);
                                     }else{
                                          $cod_presi       =   $_SESSION["SScodpresi"];
                                          $cod_entidad     =   $_SESSION["SScodentidad"];
                                          $cod_tipo_inst   =   $_SESSION["SScodtipoinst"];
                                          $cod_inst        =   $_SESSION["SScodinst"];
                                          $cod_dep         =   $_SESSION["SScoddep"];
                                          $username        =   $_SESSION["nom_usuario"];
                                          $rsp =$this->v_cfpd05_denominaciones->execute("select * from cugd04_entrada_modulo where cod_presi='".$cod_presi."' and  cod_entidad='".$cod_entidad."' and  cod_tipo_inst='".$cod_tipo_inst."' and  cod_inst='".$cod_inst."' and  cod_dep='".$cod_dep."' and  username='".$username."' ");
                                       if(!isset($rsp[0][0]["username"])){$this->redirect($_SERVER["HTTP_REFERER"]);}
                                     }//else
                                  }else{
                                     $this->redirect($_SERVER["HTTP_REFERER"]);
                                  }
                            }else{
                                  $this->checkSession();
                            }//fin else
                   }//fin else
                }else{
                    $this->checkSession();
                }//fin else
 }//fin function

function SQLCA_consolidado_por_fecha($pre=null){
         $sql_re = "a.cod_presi=".$this->verifica_SS(1)."  and    ";
         $sql_re .= "a.cod_entidad=".$this->verifica_SS(2)."  and  ";
         $sql_re .= "a.cod_tipo_inst=".$this->verifica_SS(3)."  and ";
         if($pre!=null && $pre==1 && $this->verifica_SS(5)==1){
            $sql_re .= "a.cod_inst=".$this->verifica_SS(4)." ";
         }else{
          $sql_re .= "a.cod_inst=".$this->verifica_SS(4)."  and  ";
            $sql_re .= "a.cod_dep=".$_SESSION['cod_dep_reporte_consolidado']." ";
         }
         return $sql_re;
  }//fin funcion SQLCA


function add_c_c($var){
        if($var<=9 && strlen($var)==1){
                $codigo = '0'.$var;
            }else{$codigo = ''.$var;}
        return $codigo;
}//fin AddCero


function verifica_SS($i){
        switch ($i){
            case 1:return $this->Session->read('SScodpresi');break;
            case 2:return $this->Session->read('SScodentidad');break;
            case 3:return $this->Session->read('SScodtipoinst');break;
            case 4:return $this->Session->read('SScodinst');break;
            case 5:return $this->Session->read('SScoddep');break;
            case 6:return $this->Session->read('entidad_federal');break;
            default:
               return "NULO";


        }//fin switch
    }//fin verifica_SS

    function SQLCA($ano=null){//sql para busqueda de codigos de arranque con y sin aÃ±o
         $sql_re = "cod_presi=".$this->verifica_SS(1)."  and    ";
         $sql_re .= "cod_entidad=".$this->verifica_SS(2)."  and  ";
         $sql_re .= "cod_tipo_inst=".$this->verifica_SS(3)."  and ";
         $sql_re .= "cod_inst=".$this->verifica_SS(4)."  and  ";
         if($ano!=null){
            $sql_re .= "cod_dep=".$this->verifica_SS(5)."  and  ";
            $sql_re .= "ano=".$ano."  ";
         }else{
            $sql_re .= "cod_dep=".$this->verifica_SS(5)." ";
         }
         return $sql_re;
    }//fin funcion SQLCA
    function SQLCA_report($pre=null){
         $sql_re = "cod_presi=".$this->verifica_SS(1)."  and    ";
         $sql_re .= "cod_entidad=".$this->verifica_SS(2)."  and  ";
         $sql_re .= "cod_tipo_inst=".$this->verifica_SS(3)."  and ";
         if($pre!=null && $pre==1){
         $sql_re .= "cod_inst=".$this->verifica_SS(4)." ";
         //$sql_re .= "cod_dep=0";
         }else{
            $sql_re .= "cod_inst=".$this->verifica_SS(4)."  and  ";
            $sql_re .= "cod_dep=".$this->verifica_SS(5)." ";
         }

         return $sql_re;
    }//fin funcion SQLCA
    function SQLCA_report_a($pre=null){
         $sql_re = "a.cod_presi=".$this->verifica_SS(1)."  and    ";
         $sql_re .= "a.cod_entidad=".$this->verifica_SS(2)."  and  ";
         $sql_re .= "a.cod_tipo_inst=".$this->verifica_SS(3)."  and ";
         if($pre!=null && $pre==1){
         $sql_re .= "a.cod_inst=".$this->verifica_SS(4)." ";
         //$sql_re .= "cod_dep=0";
         }else{
            $sql_re .= "a.cod_inst=".$this->verifica_SS(4)."  and  ";
            $sql_re .= "a.cod_dep=".$this->verifica_SS(5)." ";
         }

         return $sql_re;
    }//fin funcion SQLCA
    function SQLCA_report_in($pre=null){
         $sql_re = $this->verifica_SS(1).",";
         $sql_re .= $this->verifica_SS(2).",";
         $sql_re .= $this->verifica_SS(3).",";
         if($pre!=null && $pre==1){
         $sql_re .= $this->verifica_SS(4).",";
         $sql_re .= 0;
         }else{
            $sql_re .= $this->verifica_SS(4).",";
            $sql_re .= $this->verifica_SS(5)." ";
         }

         return $sql_re;
    }//fin funcion SQLCA
    function AddCero($nomVar,$vector=object,$extra=null){
      if($vector!=null){
          if($extra==null){
        foreach($vector as $x){
            if($x<10){
               $Var[$x]="0".$x;
            }else{
               $Var[$x]=$x;
            }
        }//fin each
      }else{
          foreach($vector as $x){
            if($x<10){
               $Var[$x]=$extra.".0".$x;
            }else{
               $Var[$x]=$extra.".".$x;
            }
        }//fin each
      }
      $this->set($nomVar,$Var);
      }else{
          $this->set($nomVar,'');
      }



   }//fin AddCero
    function AddCeroR($n,$extra=null){
      if($n!=null){
          if($extra==null){
            if($n<10){
               $Var="0".$n;
            }else{
               $Var=$n;
            }
      }else{
            if($n<10){
               $Var=$extra.".0".$n;
            }else{
               $Var=$extra.".".$n;
            }
      }
    return $Var;
      }else{
          //return $Var;
      }

    }


function limpia_menu(){

         echo'<script>
                             document.getElementById("valida_codigo").innerHTML = "";
                             document.getElementById("valida_codigo").style.display = "none";
                             if(document.getElementById("registro")){document.getElementById("registro").style.visibility = "hidden";}
                             if(document.getElementById("nomina")){document.getElementById("nomina").style.visibility = "hidden";}
                             if(document.getElementById("dependencia")){document.getElementById("dependencia").style.visibility = "hidden";}
                             if(document.getElementById("sistema_general")){document.getElementById("sistema_general").style.visibility = "hidden";}
               </script>';


    }

function exclusion_presupuesto($consolidado = false, $tipo_consolidado = 0, $year='')
{
	if($this->verifica_SS(5)==1)
	{
        
    $asql_proveeduria="";
    $sql_proveeduria="";

    $asql_busguarico="";
    $sql_busguarico="";

    $asql_construvialga="";
    $sql_construvialga="";

    $asql_construguarico="";
    $sql_construguarico="";

    $asql_fondoeficiencia="";
    $sql_fondoeficiencia="";

    $asql_dist_gas="";
    $sql_dist_gas="";

    $asql_aguastermales="";
    $sql_aguastermales="";

    $asql_alguarisa="";
    $sql_alguarisa="";

    $asql_corpoguarico="";
    $sql_corpoguarico="";

    $asql_turismo="";
    $sql_turismo="";

    $asql_agro_potencia="";
    $sql_agro_potencia="";

    $asql_fps="";
    $sql_fps="";

    $asql_policia="";
    $sql_policia="";

    $asql_sisoprogua="";
    $sql_sisoprogua="";

    $asql_iapebg="";
    $sql_iapebg="";

    $asql_construsalud="";
    $sql_construsalud="";

    if($year==2020){
      $asql_proveeduria= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,7) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,7,407,1,3,7,1)))";
      $sql_proveeduria= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,7) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,7,407,1,3,7,1)))";


      $asql_busguarico= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,402)  and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,8,51,411)";
      $sql_busguarico= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,8,51,411)";

      //SECTOR 7
      $asql_construvialga= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (7,1,1,52,411)";
      $sql_construvialga= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (7,1,1,52,411)";
      //END SECTOR 11

      //SECTOR 11
      $asql_construguarico= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,405) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (11,2,1,53,411)";
      $sql_construguarico= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,405) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (11,2,1,53,411)";        
      //END SECTOR 11

      $asql_fondoeficiencia= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (1,2,1,66,411)";
      $sql_fondoeficiencia= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (1,2,1,66,411)";

      //SECOTR 05
      $asql_dist_gas= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,9,51,411)";
      $sql_dist_gas= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,9,51,411)";

      $asql_aguastermales= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,402)  and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,6,51,411)";
      $sql_aguastermales= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,402)  and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,6,51,411)";

      $asql_alguarisa= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,12) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,12,407,1,3,7,1)))";
      $sql_alguarisa= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,12) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,12,407,1,3,7,1)))";   

      $asql_corpoguarico= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,10,51,411)";
      $sql_corpoguarico= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,10,51,411)";

      //END SECTOR 05

      
      $asql_turismo= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,11,51,411)";
      $sql_turismo= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,11,51,411)";


      $asql_agro_potencia= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,402) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (5,1,5,51,411)";
      $sql_agro_potencia= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,402) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (5,1,5,51,411)";

      //SECTOR 13
      $asql_fps= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,402)  and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,51,411) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_auxiliar) != (13,1,2,51,407,0) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,402)  and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,407)and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (13,1,2,52,411) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_auxiliar) != (13,1,2,52,407,0)";
      $sql_fps= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,402)  and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,51,411) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_auxiliar) != (13,1,2,51,407,0) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,402)  and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,407) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (13,1,2,52,411) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_auxiliar) != (13,1,2,52,407,0)";
      //END SECTOR 13

      //SECTOR 02
      $asql_policia= " and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,401) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,402)  and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,403) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,404) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,408) and (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida) != (2,2,1,51,411)";
      $sql_policia= " and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,401) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,402)  and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,403) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,404) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,408) and (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida) != (2,2,1,51,411)";
      //END SECTOR 02
      
      
    }

    if($year==2021){
       $asql_fps= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (13,1,2) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica) = (13,1,2,407,1,3)))";
       $sql_fps= " and ( (cod_sector,cod_programa,cod_sub_prog) != (13,1,2) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica) = (13,1,2,407,1,3)))";

       $asql_construguarico= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (11,2,4) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica) = (11,2,4,407,1,3)))";
       $sql_construguarico= " and ( (cod_sector,cod_programa,cod_sub_prog) != (11,2,4) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica) = (11,2,4,407,1,3)))";

       $asql_construvialga= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (7,1,2) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica) = (7,1,2,407,1,3)))";
       $sql_construvialga= " and ( (cod_sector,cod_programa,cod_sub_prog) != (7,1,2) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica) = (7,1,2,407,1,3)))";

       $asql_dist_gas= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,9) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,9,407,1,3,7,1)))";
       $sql_dist_gas= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,9) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,9,407,1,3,7,1)))";

       $asql_policia= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (2,2,4) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (2,2,4,407,1,3,7,1) or (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (2,2,4,407,1,3,7,2)))";
       $sql_policia= " and ( (cod_sector,cod_programa,cod_sub_prog) != (2,2,4) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (2,2,4,407,1,3,7,1) or (cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (2,2,4,407,1,3,7,2)))";
       $asql_policia.= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (2,2,1) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (2,2,1,407,1,3,7,1)))";
       $sql_policia.= " and ( (cod_sector,cod_programa,cod_sub_prog) != (2,2,1) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (2,2,1,407,1,3,7,1)))";

       $asql_aguastermales= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,6) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,6,407,1,3,7,1)))";
       $sql_aguastermales= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,6) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,6,407,1,3,7,1)))";

       $asql_alguarisa= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,10) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,10,407,1,3,7,1)))";
       $sql_alguarisa= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,10) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,10,407,1,3,7,1)))";

       $asql_sisoprogua= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,7) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,7,407,1,3,7,1)))";
       $sql_sisoprogua= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,7) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,7,407,1,3,7,1)))";

       $asql_busguarico= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,8) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,8,407,1,3,7,1)))";
       $sql_busguarico= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,8) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,8,407,1,3,7,1)))";

       $asql_fondoeficiencia= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (1,2,1,66) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (1,2,1,407,1,3,7,1)))";
       $sql_fondoeficiencia= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (1,2,1,66) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (1,2,1,407,1,3,7,1)))";

      }

    if($year==2022){

       $asql_fondoeficiencia= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (1,2,1,66) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (1,2,1,407,1,3,7,1)))";
       $sql_fondoeficiencia= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (1,2,1,66) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (1,2,1,407,1,3,7,1)))";


       $asql_iapebg= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (2,2,4,51) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (2,2,4,407,1,3,7,1)))";
       $sql_iapebg= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (2,2,4,51) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (2,2,4,407,1,3,7,1)))";


       $asql_agro_potencia= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (5,1,5,51) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,5,407,1,3,7,1)))";
       $sql_agro_potencia= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (5,1,5,51) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,5,407,1,3,7,1)))";


       $asql_aguastermales= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,6) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,6,407,1,3,7,1)))";
       $sql_aguastermales= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,6) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,6,407,1,3,7,1)))";


       $asql_sisoprogua= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,7) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,7,407,1,3,7,1)))";
       $sql_sisoprogua= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,7) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,7,407,1,3,7,1)))";


       $asql_busguarico= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,8) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,8,407,1,3,7,1)))";
       $sql_busguarico= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,8) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,8,407,1,3,7,1)))";


       $asql_dist_gas= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,9) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,9,407,1,3,7,1)))";
       $sql_dist_gas= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,9) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,9,407,1,3,7,1)))";


       $asql_alguarisa= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (5,1,10) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,10,407,1,3,7,1)))";
       $sql_alguarisa= " and ( (cod_sector,cod_programa,cod_sub_prog) != (5,1,10) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,10,407,1,3,7,1)))";


       $asql_construvialga= " and (
        (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (7,1,2) OR 
        (
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (7,1,2,407,1,3,7,1) OR 
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (7,1,2,407,1,3,7,2)
        )
      )";
       $sql_construvialga= " and (
        (cod_sector,cod_programa,cod_sub_prog) != (7,1,2) OR 
        (
          (cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (7,1,2,407,1,3,7,1) or
          (cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (7,1,2,407,1,3,7,2)
        )
      )";


       $asql_construguarico= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog) != (11,2,4) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec) = (11,2,4,407,1,3,7)))";
       $sql_construguarico= " and ( (cod_sector,cod_programa,cod_sub_prog) != (11,2,4) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec) = (11,2,4,407,1,3,7)))";


       $asql_fps= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (13,1,2,51) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (13,1,2,51,407,1,3,7,1)))";
       $sql_fps= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (13,1,2,51) OR ((cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (13,1,2,51,407,1,3,7,1)))";       

       $asql_fps.= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (13,1,2,52) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (13,1,2,52,401,1,12,0,0)))";
       $sql_fps.= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (13,1,2,52) OR ((cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (13,1,2,52,401,1,12,0,0)))";

       $asql_fps.= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (13,1,2,53) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec) = (13,1,2,53,407,1,3,7)))";
       $sql_fps.= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (13,1,2,53) OR ((cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec) = (13,1,2,53,407,1,3,7)))";   

       $asql_fps.= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (13,1,2,54) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (13,1,2,54,407,1,3,7,1)))";
       $sql_fps.= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (13,1,2,54) OR ((cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (13,1,2,54,407,1,3,7,1)))";
 
       $asql_construsalud.= " and (
        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (11,1,4,51) OR 
        (
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,1) or
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,2) or
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,3) or
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,4) or 
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,5)
        )
      )";
       $sql_construsalud.= " and (
        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (11,1,4,51) OR 
        (
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,1) or 
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,2) or 
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,3) or 
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,4) or 
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,5)
        )
      )";

    }

    if($year>=2023){
       $asql_construguarico= " and (a.cod_activ_obra) != (70) and (a.cod_activ_obra) != (71) and (a.cod_activ_obra) != (72) and (a.cod_activ_obra) != (73)";
       $sql_construguarico= " and (cod_activ_obra) != (70) and (cod_activ_obra) != (71) and (cod_activ_obra) != (72) and (cod_activ_obra) != (73)";

       $asql_construsalud.= " and (
        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (11,1,4,51) OR 
        (
          (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (11,1,4,51,407,1,3,7,1)
        )
      )";
       $sql_construsalud.= " and (
        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (11,1,4,51) OR 
        (
          (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (11,1,4,51,407,1,3,7,1)
        )
      )";

       $asql_fps= " and (a.cod_activ_obra!=70 AND a.cod_activ_obra!=71 AND a.cod_activ_obra!=72 AND a.cod_activ_obra!=73 AND a.cod_activ_obra!=74 AND a.cod_activ_obra!=75 AND a.cod_activ_obra!=76 AND a.cod_activ_obra!=77 AND a.cod_activ_obra!=78 AND a.cod_activ_obra!=79)";
       $sql_fps= " and (cod_activ_obra!=70 AND cod_activ_obra!=71 AND cod_activ_obra!=72 AND cod_activ_obra!=73 AND cod_activ_obra!=74 AND cod_activ_obra!=75 AND cod_activ_obra!=76 AND cod_activ_obra!=77 AND cod_activ_obra!=78 AND cod_activ_obra!=79)";  

      //CORPOTURISMO
      $asql_construguarico= " and ( (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra) != (5,1,11,51) OR ((a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar) = (5,1,11,407,1,3,7,1)))";
       $sql_construguarico= " and ( (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra) != (5,1,11,51) OR ((cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) = (5,1,11,407,1,3,7,1)))";
    }

    if($consolidado){
        $sql=" and (
            (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
             a.cod_generica, a.cod_especifica, a.cod_sub_espec, a.cod_auxiliar) != (5,1,6,51,401,1,18,1,0) and
            (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
             a.cod_generica, a.cod_especifica, a.cod_sub_espec, a.cod_auxiliar) != (5,1,6,51,402,7,4,0,0) and 
            (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
             a.cod_generica, a.cod_especifica, a.cod_sub_espec, a.cod_auxiliar) != (5,1,6,51,402,10,11,0,0) and
            (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
             a.cod_generica, a.cod_especifica, a.cod_sub_espec, a.cod_auxiliar) != (5,1,6,51,403,18,1,0,0) ".$asql_proveeduria.$asql_busguarico.$asql_construvialga.$asql_construguarico.$asql_fondoeficiencia.$asql_dist_gas.$asql_aguastermales.$asql_alguarisa.$asql_corpoguarico.$asql_turismo.$asql_agro_potencia.$asql_fps.$asql_policia.$asql_sisoprogua.$asql_iapebg.$asql_construsalud."
        )";
        
        if($tipo_consolidado!=3)
        {
           /* $sql .= " and (
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,401,1,18,1) and
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,402,7,4,0) and 
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,402,10,11,0) and 
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec,a.cod_auxiliar,a.deno_auxiliar) != (11,2,1,51,403,18,1,0,0,'IMPUESTO AL VALOR AGREGADO')
                    )";*/
                     $sql .= " and (
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,401,1,18,1) and
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,402,7,4,0) and 
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (11,2,1,51,402,10,11,0) and 
                        (a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec,a.cod_auxiliar,a.asignacion_anual) != (11,2,1,51,403,18,1,0,0,29934733.16)
                    )";
        }
        else
        {
            /*$sql .= " and (
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,401,1,18,1) and
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,402,7,4,0) and 
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,402,10,11,0) and 
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec,a.cod_auxiliar,a.deno_auxiliar) != (1036,11,2,1,51,403,18,1,0,0,'IMPUESTO AL VALOR AGREGADO')
                    )"; */
                    $sql .= " and (
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,401,1,18,1) and
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,402,7,4,0) and 
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec) != (1036,11,2,1,51,402,10,11,0) and 
                        (a.cod_dep, a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_activ_obra,a.cod_partida,
                        a.cod_generica, a.cod_especifica, a.cod_sub_espec,a.cod_auxiliar,a.asignacion_anual) != (1036,11,2,1,51,403,18,1,0,0,29934733.16)
                    )";  
        }
    }else{
        $sql=" and (
            (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
             cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar) != (5,1,6,51,401,1,18,1,0) and
            (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
             cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar) != (5,1,6,51,402,7,4,0,0) and 
            (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
             cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar) != (5,1,6,51,402,10,11,0,0) and
            (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
             cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar) != (5,1,6,51,403,18,1,0,0) ".$sql_proveeduria.$sql_busguarico.$sql_construvialga.$sql_construguarico.$sql_fondoeficiencia.$sql_dist_gas.$sql_aguastermales.$sql_alguarisa.$sql_corpoguarico.$sql_turismo.$sql_agro_potencia.$sql_fps.$sql_policia.$sql_sisoprogua.$sql_iapebg.$sql_construsalud."
        )";
        
        if($tipo_consolidado!=3)
        {
            /*$sql .= " and (
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,401,1,18,1) and
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,402,7,4,0) and 
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,402,10,11,0) and 
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, deno_auxiliar) != (11,2,1,51,403,18,1,0,0,'IMPUESTO AL VALOR AGREGADO')
                    )";*/
                    $sql .= " and (
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,401,1,18,1) and
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,402,7,4,0) and 
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (11,2,1,51,402,10,11,0) and 
                        (cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, asignacion_anual) != (11,2,1,51,403,18,1,0,0,29934733.16)
                    )";
        }
        else
        {
            /*$sql .= " and (
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,401,1,18,1) and
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,402,7,4,0) and 
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,402,10,11,0) and 
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar,deno_auxiliar) != (1036,11,2,1,51,403,18,1,0,0,'IMPUESTO AL VALOR AGREGADO')
                    )";   */
                    $sql .= " and (
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,401,1,18,1) and
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,402,7,4,0) and 
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec) != (1036,11,2,1,51,402,10,11,0) and 
                        (cod_dep, cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,
                        cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar,asignacion_anual) != (1036,11,2,1,51,403,18,1,0,0,29934733.16)
                    )"; 
        }
    }
    //$sql = "";

    return $sql;

  } else {
    return "";
  }
}


function reporte_form_balance_ejecucion($var=null) { 
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    $this->Session->write('tipo_reporte', $var);

    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');

    if(isset($var)){
        $this->set('tipo_reporte',$var);
    }else{
        $this->set('tipo_reporte',"reporte_balance_ejecucion");
    }


}


function reporte_form_balance_ejecucion2($var=null) {
    $this->layout="ajax";
    $SScoddep                 =       $this->Session->read('SScoddep');
        $Modulo                   =       $this->Session->read('Modulo');

    $this->Session->write('tipo_reporte', $var);
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');
    if(isset($var)){
        $this->set('tipo_reporte',$var);
    }else{
        $this->set('tipo_reporte',"reporte_balance_ejecucion");
    }

        $this->layout="ajax";

    $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA()." and tipo_documento='1984'");
    if($cont == 0){
        if($SScoddep==1 && $Modulo==0){

        }else{
            $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
        }
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','N/A');
        $this->set('cargo_tercera_firma','N/A');
        $this->set('tipo_doc_anul', 1984);
        $firma_existe = 'no';
    }else{
        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=1984");
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
        $this->set('tipo_doc_anul',1984);
        $firma_existe = 'si';
    }
        $this->set('firma_existe',$firma_existe);


}

//funcion para el programa del reporte en hoja de calculo

function reporte_form_balance_ejecucion_ods() {
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    $this->Session->write('tipo_reporte', '');
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');

}

function reporte_form_balance_ejecucion_ods_horizontal() {
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    $this->Session->write('tipo_reporte', '');
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');

}


function reporte_form_balance_ejecucion2_ods() {
    $this->layout="ajax";
    $SScoddep                 =       $this->Session->read('SScoddep');
    $Modulo                   =       $this->Session->read('Modulo');

    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    $this->Session->write('tipo_reporte', '');
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');

    $this->layout="ajax";
}

//
function escribir_ano($var){
    $this->layout="ajax";

    if(isset($var) && $var!=null){
        $this->Session->write('ano_reporte',$var);
        $this->Session->write('ano',$var);
        $ano=$var;
    }else{
        $this->Session->write('ano_reporte',$this->ano_ejecucion());
        $ano=$this->ano_ejecucion();

    }
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $lista=  $this->v_cfpd05_denominaciones->generateList($cond." and ano=".$var, 'cod_sector ASC', null, '{n}.v_cfpd05_denominaciones.cod_sector', '{n}.v_cfpd05_denominaciones.deno_sector');
    $this->concatena($lista, 'sector');
}

function reporte_balance_ejecucion() {
    $this->layout="pdf";
    //$this->layout="ajax";print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }

        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
             $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
             $modelo=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion_inst":"v_balance_ejecucion";
              $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_balance_ejecucion";
            $this->set("modelo",$modelo);
        }

        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_sector=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
            }else{
            	$cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
            }
        }
        else{
            $cod_sector=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_programa=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        	}else{
            	$cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        	}
        }
        else{
            $cod_programa=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_sub_prog=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        	}else{
            	$cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        	}
        }
        else{
            $cod_sub_prog=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_proyecto=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        	}else{
            	$cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        	}
        }
        else{
            $cod_proyecto=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_activ_obra=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        	}else{
            	$cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        	}
        }
        else{
            $cod_activ_obra=" 1=1 ";
        }

        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_partida=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        	}else{
            	$cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        	}
        }
        else{
            $cod_partida=" 1=1 ";
        }

        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
            	$cod_generica=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        	}else{
            	$cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        	}
        }
        else{
            $cod_generica=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
	            $cod_especifica=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        	}else{
	            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        	}
        }
        else{
            $cod_especifica=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
	            $cod_sub_espec=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        	}else{
	            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        	}
        }
        else{
            $cod_sub_espec=" 1=1 and ";
        }

        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!=""){
        	if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
	            $cod_auxiliar=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        	}else{
	            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        	}
        }
        else{
            $cod_auxiliar=" 1=1 ";
        }

        $modo= (int) $this->data["reporte"]["modo"];
       // echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch
        //echo $condicion;

        if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
        	$exclusion_presupuesto = $this->exclusion_presupuesto(true, $this->data['cfpp05']['consolidacion'],$Ano);
        }
        else
        {
        	$exclusion_presupuesto = $this->exclusion_presupuesto(false,$this->data['cfpp05']['consolidacion'],$Ano);
        }

        $condicion.=$exclusion_presupuesto;
  
        if(isset($this->data['cfpp05']['consolidacion']) && $this->data['cfpp05']['consolidacion'] == 3){
         
            $vector = $this->$modelo->execute("select * from v_balance_ejecucion
                                                where
                                                cod_presi=".$this->verifica_SS(1)." and 
                                                cod_entidad=".$this->verifica_SS(2)." and 
                                                cod_tipo_inst=".$this->verifica_SS(3)." and 
                                                cod_dep =".$_SESSION['cod_dep_reporte_consolidado']." and
                                                ano=".$Ano.$exclusion_presupuesto."
                                                order by cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC;");


            $total_spsppa = $this->$modelo->execute("SELECT a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra 
                            FROM ".$modelo." AS a 
                            INNER JOIN cfpd02_activ_obra_ordinario AS b 
                            ON a.cod_activ_obra = b.cod_activ_obra and b.cod_dep = ".$_SESSION['cod_dep_reporte_consolidado']."
                            WHERE a.ano=".$Ano." and ".$condicion."
                            GROUP BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra  
                            ORDER BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra ASC");
            $this->set('tipo_reporte',2);
            
        }else{

            $vector = $this->$modelo->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
            $total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra 
                FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");
            $this->set('tipo_reporte',1);

            //$distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
        }
        
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);

}//fin reporte_balance_ejecucion


function reporte_balance_ejecucion_hasta_mes() {
    $this->layout="pdf";
    //$this->layout="ajax";
    //print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion2_inst":"v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        //echo $this->data['cfpp05']['consolidacion'].$modelo;
        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch

        $condicion.=$this->exclusion_presupuesto(false, $this->data['cfpp05']['consolidacion'],$Ano);

         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
         }
    $vector = $this->$modelo->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
 //pr($vector);
        $total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");
        $distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);

}//fin reporte_balance_ejecucion_hasta_mes

function reporte_balance_ejecucion_por_fecha() {
    $this->layout="pdf";
    //$this->layout="ajax";
    //print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado_por_fecha($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion2_inst":"v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado_por_fecha();
            $modelo="v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        //echo $this->data['cfpp05']['consolidacion'].$modelo;
        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch

        $condicion.=$this->exclusion_presupuesto(true, $this->data['cfpp05']['consolidacion'],$Ano);

         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
         }
         
         $dato = str_split($this->data['reporte']['fecha_acumulado'], 3);
         $fecha = $dato[2] . $dato[3] . '/' . $dato[1] . str_replace('/', '', $dato[0]);
         $fecha = str_replace('/', '-', $fecha); 
         $dato2 = str_split($this->data['reporte']['fecha_acumulado2'], 3);
         $fecha2 = $dato2[2] . $dato2[3] . '/' . $dato2[1] . str_replace('/', '', $dato2[0]);
         $fecha2 = str_replace('/', '-', $fecha2);


    $vector = $this->$modelo->execute("SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, upper(( SELECT a1.denominacion
           FROM cfpd02_sector a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector, a.cod_programa, upper(( SELECT a1.denominacion
           FROM cfpd02_programa a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa, a.cod_sub_prog, upper(( SELECT a1.denominacion
           FROM cfpd02_sub_prog a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog, a.cod_proyecto, upper(( SELECT a1.denominacion
           FROM cfpd02_proyecto a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto, a.cod_activ_obra, upper(( SELECT a1.denominacion
           FROM cfpd02_activ_obra a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
           FROM cfpd01_ano_5_sub_espec a1
          WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec, a.cod_auxiliar, upper(( SELECT a1.denominacion
           FROM cfpd05_auxiliar a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar, a.asignacion_anual, 
          (SELECT SUM(monto_aumento) FROM v_cfpd10_reformulacion_partidas_tipopresupuesto as b1 WHERE b1.cod_presi = a.cod_presi AND b1.cod_entidad = a.cod_entidad AND b1.cod_tipo_inst = a.cod_tipo_inst AND b1.cod_inst = a.cod_inst AND b1.cod_dep = a.cod_dep AND b1.ano = a.ano AND b1.cod_sector = a.cod_sector AND b1.cod_programa = a.cod_programa AND b1.cod_sub_prog = a.cod_sub_prog AND b1.cod_proyecto = a.cod_proyecto AND b1.cod_activ_obra = a.cod_activ_obra AND b1.cod_partida = a.cod_partida AND b1.cod_generica = a.cod_generica AND b1.cod_especifica = a.cod_especifica AND b1.cod_sub_espec = a.cod_sub_espec AND b1.cod_auxiliar = a.cod_auxiliar AND b1.fecha_aprobacion>='".$fecha."' AND b1.fecha_aprobacion<='".$fecha2."') as aumento,
          (SELECT SUM(monto_disminucion) FROM v_cfpd10_reformulacion_partidas_tipopresupuesto as b2 WHERE b2.cod_presi = a.cod_presi AND b2.cod_entidad = a.cod_entidad AND b2.cod_tipo_inst = a.cod_tipo_inst AND b2.cod_inst = a.cod_inst AND b2.cod_dep = a.cod_dep AND b2.ano = a.ano AND b2.cod_sector = a.cod_sector AND b2.cod_programa = a.cod_programa AND b2.cod_sub_prog = a.cod_sub_prog AND b2.cod_proyecto = a.cod_proyecto AND b2.cod_activ_obra = a.cod_activ_obra AND b2.cod_partida = a.cod_partida AND b2.cod_generica = a.cod_generica AND b2.cod_especifica = a.cod_especifica AND b2.cod_sub_espec = a.cod_sub_espec AND b2.cod_auxiliar = a.cod_auxiliar AND b2.fecha_aprobacion>='".$fecha."' AND b2.fecha_aprobacion<='".$fecha2."') as disminucion,
          (SELECT sum(monto) as monto FROM cfpd21 a1 where 
              a1.cod_presi = a.cod_presi AND 
              a1.cod_entidad = a.cod_entidad AND 
              a1.cod_tipo_inst = a.cod_tipo_inst AND 
              a1.cod_inst = a.cod_inst AND 
              a1.cod_dep = a.cod_dep AND 
              a1.ano = a.ano AND 
              a1.cod_sector = a.cod_sector AND 
              a1.cod_programa = a.cod_programa AND 
              a1.cod_sub_prog = a.cod_sub_prog AND 
              a1.cod_proyecto = a.cod_proyecto AND 
              a1.cod_activ_obra = a.cod_activ_obra AND 
              a1.cod_partida = a.cod_partida AND 
              a1.cod_generica = a.cod_generica AND 
              a1.cod_especifica = a.cod_especifica AND 
              a1.cod_sub_espec = a.cod_sub_espec AND 
              a1.cod_auxiliar = a.cod_auxiliar and 
              a1.fecha >= '".$fecha."'and 
              a1.fecha <= '".$fecha2."') AS compromiso, 
          (SELECT sum(monto) as monto FROM cfpd22 a1 where 
            a1.cod_presi = a.cod_presi AND 
            a1.cod_entidad = a.cod_entidad AND 
            a1.cod_tipo_inst = a.cod_tipo_inst AND 
            a1.cod_inst = a.cod_inst AND 
            a1.cod_dep = a.cod_dep AND 
            a1.ano = a.ano AND 
            a1.cod_sector = a.cod_sector AND 
            a1.cod_programa = a.cod_programa AND 
            a1.cod_sub_prog = a.cod_sub_prog AND 
            a1.cod_proyecto = a.cod_proyecto AND 
            a1.cod_activ_obra = a.cod_activ_obra AND 
            a1.cod_partida = a.cod_partida AND 
            a1.cod_generica = a.cod_generica AND 
            a1.cod_especifica = a.cod_especifica AND 
            a1.cod_sub_espec = a.cod_sub_espec AND 
            a1.cod_auxiliar = a.cod_auxiliar and 
            a1.fecha >= '".$fecha."' and 
            a1.fecha <= '".$fecha2."') AS causado,
        (SELECT sum(monto) as monto FROM cfpd23 a1 where 
          a1.cod_presi = a.cod_presi AND 
          a1.cod_entidad = a.cod_entidad AND 
          a1.cod_tipo_inst = a.cod_tipo_inst AND 
          a1.cod_inst = a.cod_inst AND 
          a1.cod_dep = a.cod_dep AND 
          a1.ano = a.ano AND 
          a1.cod_sector = a.cod_sector AND 
          a1.cod_programa = a.cod_programa AND 
          a1.cod_sub_prog = a.cod_sub_prog AND 
          a1.cod_proyecto = a.cod_proyecto AND 
          a1.cod_activ_obra = a.cod_activ_obra AND 
          a1.cod_partida = a.cod_partida AND 
          a1.cod_generica = a.cod_generica AND 
          a1.cod_especifica = a.cod_especifica AND 
          a1.cod_sub_espec = a.cod_sub_espec AND 
          a1.cod_auxiliar = a.cod_auxiliar and 
          a1.fecha >= '".$fecha."' and 
          a1.fecha <= '".$fecha2."') AS pagado,
        a.tipo_presupuesto
   FROM cfpd05 a
   where ".$con." and a.ano=".$Ano." and ".$condicion."
   ORDER BY a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar ASC;");

    
        /*$total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");*/
        $total_spsppa = $this->$modelo->execute("SELECT a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_proyecto, a.cod_activ_obra FROM cfpd05 a
            WHERE ".$con." and a.ano=".$Ano." and ".$condicion." 
            GROUP BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra  ORDER BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra ASC;");

        //$distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
       $this->Session->write('fecha_acumulado', $this->data['reporte']['fecha_acumulado']);
      
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);

}//fin reporte_balance_ejecucion_hasta_mes

function reporte_balance_ejecucion_hasta_fecha() {
    $this->layout="pdf";
    //$this->layout="ajax";
    //print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion2_inst":"v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_balance_ejecucion2";
            $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        //echo $this->data['cfpp05']['consolidacion'].$modelo;
        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch

        $condicion.=$this->exclusion_presupuesto(true, $this->data['cfpp05']['consolidacion'],$Ano);

         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
         }
         
         $dato = str_split($this->data['reporte']['fecha_acumulado'], 3);
         $fecha = $dato[2] . $dato[3] . '/' . $dato[1] . str_replace('/', '', $dato[0]);
         $fecha = str_replace('/', '-', $fecha);

    $vector = $this->$modelo->execute("SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, upper(( SELECT a1.denominacion
           FROM cfpd02_sector a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector, a.cod_programa, upper(( SELECT a1.denominacion
           FROM cfpd02_programa a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa, a.cod_sub_prog, upper(( SELECT a1.denominacion
           FROM cfpd02_sub_prog a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog, a.cod_proyecto, upper(( SELECT a1.denominacion
           FROM cfpd02_proyecto a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto, a.cod_activ_obra, upper(( SELECT a1.denominacion
           FROM cfpd02_activ_obra a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
           FROM cfpd01_ano_5_sub_espec a1
          WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec, a.cod_auxiliar, upper(( SELECT a1.denominacion
           FROM cfpd05_auxiliar a1
          WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar, a.asignacion_anual, 
          (SELECT SUM(monto_aumento) FROM v_cfpd10_reformulacion_partidas_tipopresupuesto as b1 WHERE b1.cod_presi = a.cod_presi AND b1.cod_entidad = a.cod_entidad AND b1.cod_tipo_inst = a.cod_tipo_inst AND b1.cod_inst = a.cod_inst AND b1.cod_dep = a.cod_dep AND b1.ano = a.ano AND b1.cod_sector = a.cod_sector AND b1.cod_programa = a.cod_programa AND b1.cod_sub_prog = a.cod_sub_prog AND b1.cod_proyecto = a.cod_proyecto AND b1.cod_activ_obra = a.cod_activ_obra AND b1.cod_partida = a.cod_partida AND b1.cod_generica = a.cod_generica AND b1.cod_especifica = a.cod_especifica AND b1.cod_sub_espec = a.cod_sub_espec AND b1.cod_auxiliar = a.cod_auxiliar AND b1.fecha_aprobacion<='".$fecha."') as aumento,
          (SELECT SUM(monto_disminucion) FROM v_cfpd10_reformulacion_partidas_tipopresupuesto as b2 WHERE b2.cod_presi = a.cod_presi AND b2.cod_entidad = a.cod_entidad AND b2.cod_tipo_inst = a.cod_tipo_inst AND b2.cod_inst = a.cod_inst AND b2.cod_dep = a.cod_dep AND b2.ano = a.ano AND b2.cod_sector = a.cod_sector AND b2.cod_programa = a.cod_programa AND b2.cod_sub_prog = a.cod_sub_prog AND b2.cod_proyecto = a.cod_proyecto AND b2.cod_activ_obra = a.cod_activ_obra AND b2.cod_partida = a.cod_partida AND b2.cod_generica = a.cod_generica AND b2.cod_especifica = a.cod_especifica AND b2.cod_sub_espec = a.cod_sub_espec AND b2.cod_auxiliar = a.cod_auxiliar AND b2.fecha_aprobacion<='".$fecha."') as disminucion,
          (SELECT sum(monto) as monto FROM cfpd21 a1 where 
              a1.cod_presi = a.cod_presi AND 
              a1.cod_entidad = a.cod_entidad AND 
              a1.cod_tipo_inst = a.cod_tipo_inst AND 
              a1.cod_inst = a.cod_inst AND 
              a1.cod_dep = a.cod_dep AND 
              a1.ano = a.ano AND 
              a1.cod_sector = a.cod_sector AND 
              a1.cod_programa = a.cod_programa AND 
              a1.cod_sub_prog = a.cod_sub_prog AND 
              a1.cod_proyecto = a.cod_proyecto AND 
              a1.cod_activ_obra = a.cod_activ_obra AND 
              a1.cod_partida = a.cod_partida AND 
              a1.cod_generica = a.cod_generica AND 
              a1.cod_especifica = a.cod_especifica AND 
              a1.cod_sub_espec = a.cod_sub_espec AND 
              a1.cod_auxiliar = a.cod_auxiliar and 
              a1.fecha <= '".$fecha."') AS compromiso, 
          (SELECT sum(monto) as monto FROM cfpd22 a1 where 
            a1.cod_presi = a.cod_presi AND 
            a1.cod_entidad = a.cod_entidad AND 
            a1.cod_tipo_inst = a.cod_tipo_inst AND 
            a1.cod_inst = a.cod_inst AND 
            a1.cod_dep = a.cod_dep AND 
            a1.ano = a.ano AND 
            a1.cod_sector = a.cod_sector AND 
            a1.cod_programa = a.cod_programa AND 
            a1.cod_sub_prog = a.cod_sub_prog AND 
            a1.cod_proyecto = a.cod_proyecto AND 
            a1.cod_activ_obra = a.cod_activ_obra AND 
            a1.cod_partida = a.cod_partida AND 
            a1.cod_generica = a.cod_generica AND 
            a1.cod_especifica = a.cod_especifica AND 
            a1.cod_sub_espec = a.cod_sub_espec AND 
            a1.cod_auxiliar = a.cod_auxiliar and 
            a1.fecha <= '".$fecha."') AS causado,
        (SELECT sum(monto) as monto FROM cfpd23 a1 where 
          a1.cod_presi = a.cod_presi AND 
          a1.cod_entidad = a.cod_entidad AND 
          a1.cod_tipo_inst = a.cod_tipo_inst AND 
          a1.cod_inst = a.cod_inst AND 
          a1.cod_dep = a.cod_dep AND 
          a1.ano = a.ano AND 
          a1.cod_sector = a.cod_sector AND 
          a1.cod_programa = a.cod_programa AND 
          a1.cod_sub_prog = a.cod_sub_prog AND 
          a1.cod_proyecto = a.cod_proyecto AND 
          a1.cod_activ_obra = a.cod_activ_obra AND 
          a1.cod_partida = a.cod_partida AND 
          a1.cod_generica = a.cod_generica AND 
          a1.cod_especifica = a.cod_especifica AND 
          a1.cod_sub_espec = a.cod_sub_espec AND 
          a1.cod_auxiliar = a.cod_auxiliar and 
          a1.fecha <= '".$fecha."') AS pagado,
        a.tipo_presupuesto
   FROM cfpd05 a
   where a.cod_presi=".$this->Session->read('SScodpresi')." and a.cod_entidad=".$this->Session->read('SScodentidad')." and a.cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and a.cod_inst=".$this->Session->read('SScodinst')." and a.cod_dep=".$this->Session->read('SScoddep')." and a.ano=".$Ano." and ".$condicion." 
   ORDER BY a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar ASC;");

    //pr($vector);
        /*$total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");*/
        $total_spsppa = $this->$modelo->execute("SELECT a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_proyecto, a.cod_activ_obra FROM cfpd05 a
            WHERE a.cod_presi=".$this->Session->read('SScodpresi')." and a.cod_entidad=".$this->Session->read('SScodentidad')." and a.cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and a.cod_inst=".$this->Session->read('SScodinst')." and a.cod_dep=".$this->Session->read('SScoddep')." and a.ano=".$Ano." and ".$condicion." 
            GROUP BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra  ORDER BY a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra ASC;");

        //$distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
       $this->Session->write('fecha_acumulado', $this->data['reporte']['fecha_acumulado']);
      
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);

}//fin reporte_balance_ejecucion_hasta_mes

function reporte_balance_ejecucion_mes2() {


        $this->layout="pdf";
        $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA()." and tipo_documento='1984'");
        $firma_existe="si";
        if($cont==0){
            $this->set('nombre_primera_firma','');
            $this->set('cargo_primera_firma','');
            $this->set('nombre_segunda_firma','');
            $this->set('cargo_segunda_firma','');
            $this->set('nombre_tercera_firma','');
            $this->set('cargo_tercera_firma','');
            $this->set('tipo_doc_anul',1984);

        }else{
            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=1984");
            $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
            $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
            $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
            $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
            $this->set('tipo_doc_anul',1984);
        }


    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"balance_mes22_inst":"balance_mes2";
            $tabla=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion22_inst":"v_balance_ejecucion2_2";
            $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="balance_mes2";
            $tabla="v_balance_ejecucion2_2";
            $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch
         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
         }
        $vector = $this->$modelo->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');

//var_dump($modelo); exit();

        $total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$tabla." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");
        $distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$tabla." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);
        $this->set('firma_existe',$firma_existe);


    //}

}//fin reporte_balance_ejecucion_mes

function reporte_balance_ejecucion_mes() {
    $this->layout="pdf";
    //$this->layout="ajax";
    //print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"v_balance_ejecucion2_inst":"v_balance_ejecucion2";
              $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_balance_ejecucion2";
              $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch
         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
         }
        $vector = $this->$modelo->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion."  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");
        $distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);
}//fin reporte_balance_ejecucion_mes




/**
 * funcion select3 para el reporte de balance de ejecucion
 */
function select3($select=null,$var=null) { //select codigos presupuestarios
    $this->layout = "ajax";

if($select!=null && $var!=null){
        if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    switch($select){
        case 'sector':
            $this->set('SELECT','programa');
            $this->set('codigo','sector');
            $this->set('seleccion','');
            $this->set('n',1);
            $ano=$this->Session->read('ano_reporte');
            $this->Session->write('ano',$ano);
            $cond .=" and ano=".$ano;
            //$lista=  $this->v_cfpd05_denominaciones->generateList($cond, 'cod_sector ASC', null, '{n}.v_cfpd05_denominaciones.cod_sector', '{n}.v_cfpd05_denominaciones.deno_sector');
            //$this->concatena($lista, 'vector');
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." ORDER BY cod_sector ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_sector"];
                $d[]=$l[0]["deno_sector"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'programa':

            $this->set('SELECT','subprograma');
            $this->set('codigo','programa');
            $this->set('seleccion','');
            $this->set('n',2);
            $ano=$this->Session->read('ano_reporte');
            $this->Session->write('ano',$ano);
            $this->Session->write('sec',$var);
            $cond .=" and ano=".$ano." and cod_sector=".$var;
            //$lista=  $this->v_cfpd05_denominaciones->generateList($cond, 'cod_programa ASC', null, '{n}.v_cfpd05_denominaciones.cod_programa', '{n}.v_cfpd05_denominaciones.deno_programa');
            //$this->concatena($lista, 'vector');
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_programa,deno_programa FROM v_cfpd05_denominaciones WHERE ". $cond." ORDER BY cod_programa ASC");
           foreach($rs as $l){
                $v[]=$l[0]["cod_programa"];
                $d[]=$l[0]["deno_programa"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'subprograma':
            $this->set('SELECT','proyecto');
            $this->set('codigo','subprograma');
            $this->set('seleccion','');
            $this->set('n',3);
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $this->Session->write('prog',$var);
            $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$var;
            //$lista=  $this->v_cfpd05_denominaciones->generateList($cond, 'cod_sub_prog ASC', null, '{n}.v_cfpd05_denominaciones.cod_sub_prog', '{n}.v_cfpd05_denominaciones.deno_sub_prog');
            //$this->concatena($lista, 'vector');
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sub_prog,deno_sub_prog FROM v_cfpd05_denominaciones WHERE ". $cond." ORDER BY cod_sub_prog ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_sub_prog"];
                $d[]=$l[0]["deno_sub_prog"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'proyecto':
            $this->set('SELECT','actividad');
            $this->set('codigo','proyecto');
            $this->set('seleccion','');
             $this->set('n',4);
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $this->Session->write('subp',$var);
            $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$var;
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_proyecto,deno_proyecto FROM v_cfpd05_denominaciones WHERE ". $cond." ORDER BY cod_proyecto ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_proyecto"];
                $d[]=$l[0]["deno_proyecto"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'actividad':
            $this->set('SELECT','partida');
            $this->set('codigo','actividad');
            $this->set('seleccion','');
            $this->set('n',5);
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $this->Session->write('proy',$var);
            $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$var;
            //$lista=  $this->v_cfpd05_denominaciones->generateList($cond, 'cod_activ_obra ASC', null, '{n}.v_cfpd05_denominaciones.cod_activ_obra', '{n}.v_cfpd05_denominaciones.deno_activ_obra');
            //$this->concatena($lista, 'vector');
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_activ_obra,deno_activ_obra FROM v_cfpd05_denominaciones WHERE ". $cond." ORDER BY cod_activ_obra ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_activ_obra"];
                $d[]=$l[0]["deno_activ_obra"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'partida':
            $this->set('SELECT','generica');
            $this->set('codigo','partida');
            $this->set('seleccion','');
            $this->set('n',6);
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            $this->Session->write('actividad',$var);
            if(isset($_SESSION["proy"])){
                 $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$var;
            }else{
                $cond2 =$cond." and ano=".$ano;
            }
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones WHERE ". $cond2." ORDER BY cod_partida ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_partida"];
                $d[]=$l[0]["deno_partida"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'generica':
            $this->set('SELECT','especifica');
            $this->set('codigo','generica');
            $this->set('seleccion','');
            $this->set('n',7);
            if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
            //$ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            $activ=$this->Session->read('actividad');
            $this->Session->write('cpar',$var);
            if(!isset($_SESSION["proy"])){
                $cond2 =$cond." and ano=".$ano." and cod_partida=".$var;
            }else{
                $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$activ." and cod_partida=".$var;
            }
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_generica,deno_generica FROM v_cfpd05_denominaciones WHERE ". $cond2." ORDER BY cod_generica ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_generica"];
                $d[]=$l[0]["deno_generica"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'especifica':
            $this->set('SELECT','subespecifica');
            $this->set('codigo','especifica');
            $this->set('seleccion','');
            $this->set('n',8);
            if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            $activ=$this->Session->read('actividad');
            $cpar =  $this->Session->read('cpar');
            $this->Session->write('cgen',$var);
            if($activ==""){
                $cond2 =$cond." and ano=".$ano." and cod_partida=".$cpar." and cod_generica=".$var;
            }else{
                $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$activ." and cod_partida=".$cpar." and cod_generica=".$var;
            }
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_especifica,deno_especifica FROM v_cfpd05_denominaciones WHERE ". $cond2." ORDER BY cod_especifica ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_especifica"];
                $d[]=$l[0]["deno_especifica"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'subespecifica':
            $this->set('SELECT','auxiliar');
            $this->set('codigo','subespecifica');
            $this->set('seleccion','');
            $this->set('n',9);
            if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            $activ=$this->Session->read('actividad');
            $cpar =  $this->Session->read('cpar');
            $cgen =  $this->Session->read('cgen');
            $this->Session->write('cesp',$var);
            if($activ==""){
                $cond2 =$cond." and ano=".$ano." and cod_partida=".$cpar." and cod_generica=".$cgen." and cod_especifica=".$var;
            }else{
                $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$activ." and cod_partida=".$cpar." and cod_generica=".$cgen." and cod_especifica=".$var;
            }
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sub_espec,deno_sub_espec FROM v_cfpd05_denominaciones WHERE ". $cond2." ORDER BY cod_sub_espec ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_sub_espec"];
                $d[]=$l[0]["deno_sub_espec"];
            }
            $lista = array_combine($v, $d);
            $this->concatena($lista, 'vector');
        break;
        case 'auxiliar':

            $this->set('SELECT','escribir_aux');
            $this->set('codigo','auxiliar');
            $this->set('seleccion','');
            $this->set('n',10);
            //$this->set('no','no');
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            $activ=$this->Session->read('actividad');
            $cpar =  $this->Session->read('cpar');
            $cgen =  $this->Session->read('cgen');
            $cesp =  $this->Session->read('cesp');
            $this->Session->write('csesp',$var);
            $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$activ." and cod_partida=".$cpar." and cod_generica=".$cgen." and cod_especifica=".$cesp." and cod_sub_espec=".$var;
            $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_auxiliar,deno_auxiliar FROM v_cfpd05_denominaciones WHERE ". $cond2." ORDER BY cod_auxiliar ASC");
            foreach($rs as $l){
                $v[]=$l[0]["cod_auxiliar"];
                $d[]=$l[0]["deno_auxiliar"];
            }
            $lista = array_combine($v, $d);
            if($lista!=null){
                $this->concatena_auxiliar($lista, 'vector');
            }else{
                $this->set('vector',array('0'=>'00'));
            }
         //echo "muestra";
        break;
        case 'auxiliar2':
         //echo "hola auxiliar 2";
            $this->set('SELECT','auxiliar');
            $this->set('codigo','auxiliar');
            $this->set('seleccion','');
            $this->set('n',10);
            //$this->set('no','no');
            $ano =  $this->Session->read('ano');
            $sec =  $this->Session->read('sec');
            $prog =  $this->Session->read('prog');
            $subp =  $this->Session->read('subp');
            $proy =  $this->Session->read('proy');
            //$activ=$this->Session->read('actividad');
            $cpar =  $this->Session->read('cpar');
            $cgen =  $this->Session->read('cgen');
            $cesp =  $this->Session->read('cesp');
            $this->Session->write('actividad',$var);
            $f=$this->Session->read('CodigosDireccion');
            $p=$this->Session->read('partidas');
             //print_r($p);
            /*$part= $p[0]['cscd01_catalogo']['cod_partida']<9 ? "40".$p[0]['cscd01_catalogo']['cod_partida']:$p[0]['cscd01_catalogo']['cod_partida'];
                    $part= $part <400 ? "4".$part : $part;
                    if($this->Session->read("year_pago")>date("Y")){
                                $ano= 1+date("Y");
            }else{
                            $ano=date("Y");
            }
            $cond2 =" cod_sector=".$f[0]["cugd02_direccion"]["cod_sector"]." and cod_programa=".$f[0]["cugd02_direccion"]["cod_programa"]." and cod_sub_prog=".$f[0]["cugd02_direccion"]["cod_sub_prog"]." and cod_proyecto=".$f[0]["cugd02_direccion"]["cod_proyecto"]." and cod_activ_obra=".$var." and ano=".$ano." and cod_partida=".$part." and cod_generica=".$p[0]["cscd01_catalogo"]["cod_generica"]." and cod_especifica=".$p[0]["cscd01_catalogo"]["cod_especifica"]." and cod_sub_espec=".$p[0]["cscd01_catalogo"]["cod_sub_espec"];
            //echo "AUX2".$cond2;*/
            $cond2 =$cond." and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subp." and cod_proyecto=".$proy." and cod_activ_obra=".$var." and cod_partida=".$cpar." and cod_generica=".$cgen." and cod_especifica=".$cesp." and cod_sub_espec=".$p[0]["cscd01_catalogo"]["cod_sub_espec"];
            //echo $cond2;
            $lista=  $this->v_cfpd05_denominaciones->generateList($cond2, 'cod_auxiliar ASC', null, '{n}.v_cfpd05_denominaciones.cod_auxiliar', '{n}.v_cfpd05_denominaciones.deno_auxiliar');
            /**         if($lista!=null){
                            $this->AddCero('vector',$lista);
                        }else{
                            $this->set('vector',array('0'=>'00'));
                        }*/
                        if($lista!=null){
                            $this->concatena_auxiliar($lista, 'vector');
                            //echo count($lista);
                        }else{
                            $this->set('vector',array('0'=>'00'));
                            //echo "cero";
                            $disponibilidad = $this->disponibilidad($_SESSION["ano"], $_SESSION["sec"], $_SESSION["prog"], $_SESSION["subp"], $_SESSION["proy"], $_SESSION["actividad"], $_SESSION["cpar"], $_SESSION["cgen"], $_SESSION["cesp"], $_SESSION["csesp"], 0);

                       echo "<script>" .
                        "document.getElementById('td_disponibilidad').innerHTML='".$this->Formato2($disponibilidad)."'; " .
                        "</script>";
                        }
        break;
        case 'escribir_aux':
       /// echo "saaaaaaaaaaa";
                 $this->Session->write('auxiliar',$var);
                 $disponibilidad = $this->disponibilidad($_SESSION["ano"], $_SESSION["sec"], $_SESSION["prog"], $_SESSION["subp"], $_SESSION["proy"], $_SESSION["actividad"], $_SESSION["cpar"], $_SESSION["cgen"], $_SESSION["cesp"], $_SESSION["csesp"], $_SESSION["auxiliar"]);

                 echo "<script>" .
                        "document.getElementById('td_disponibilidad').innerHTML='".$this->Formato2($disponibilidad)."';" .
                        "</script>";
                 $this->set("ocultar",true);
        break;
    }//fin wsitch
    }else{
            $this->set('SELECT','');
            $this->set('codigo','');
            $this->set('seleccion','');
            $this->set('n',12);
            $this->set('no','no');
            $this->set('vector',array('0'=>'00'));
    }
}//fin select codigos presupuestarios

function mostrar3($select=null,$var=null) { //mostrar3 codigos presupuestarios
    $this->layout = "ajax";
    //echo "mostrar3";
if( $var!=null){
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    switch($select){
        case 'sector':
          $ano=$this->Session->read('ano_reporte');
          $this->Session->write('ano',$ano);

          $this->Session->write('dsec',$var);
          $cond .=" and ano=".$ano." and cod_sector=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond,array('deno_sector'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_sector'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'programa':
          $ano =  $this->Session->read('ano');
          $sec =  $this->Session->read('dsec');
          $this->Session->write('dprog',$var);
          $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond,array('deno_programa'));
          $xdeno=$a[0]['v_cfpd05_denominaciones']['deno_programa'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'subprograma':
          $ano =  $this->Session->read('ano');
          $sec =  $this->Session->read('dsec');
          $prog =  $this->Session->read('dprog');
          $this->Session->write('dsubprog',$var);
          $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond,array('deno_sub_prog'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_sub_prog'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'proyecto':
          $ano =  $this->Session->read('ano');
          $sec =  $this->Session->read('dsec');
          $prog =  $this->Session->read('dprog');
          $subprog =  $this->Session->read('dsubprog');
          $this->Session->write('dproy',$var);
          $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subprog." and cod_proyecto=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond,array('deno_proyecto'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_proyecto'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'actividad':
          $ano =  $this->Session->read('ano');
          $sec =  $this->Session->read('dsec');
          $prog =  $this->Session->read('dprog');
          $subprog =  $this->Session->read('dsubprog');
          $proy =  $this->Session->read('dproy');
          $this->Session->write('activ',$var);
          $cond .=" and ano=".$ano." and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subprog." and cod_proyecto=".$proy." and cod_activ_obra=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond,array('deno_activ_obra'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_activ_obra'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'partida':
          if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
          $this->Session->write('dpar',$var);
          $cond2 ="and ano=".$ano." and cod_partida=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond.$cond2,array('deno_partida'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_partida'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'generica':
          if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
          $dpar=  $this->Session->read('dpar');
          $this->Session->write('dgen',$var);
          $cond2 =" and ano=".$ano." and cod_partida=".$dpar." and cod_generica=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond.$cond2,array('deno_generica'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_generica'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'especifica':
           if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
          $dpar=  $this->Session->read('dpar');
          $dgen =  $this->Session->read('dgen');
          $this->Session->write('desp',$var);
          $cond2 =" and ano=".$ano." and cod_partida=".$dpar." and cod_generica=".$dgen." and cod_especifica=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond.$cond2,array('deno_especifica'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_especifica'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'subespecifica':
          if(isset($_SESSION["ano"])){
                $ano=$this->Session->read('ano');
            }else if(isset($_SESSION["ano_reporte"])){
                $ano=$this->Session->read('ano_reporte');
            }else{
                $ano=$this->ano_ejecucion();
            }
          $dpar=  $this->Session->read('dpar');
          $dgen =  $this->Session->read('dgen');
          $desp =  $this->Session->read('desp');
          $this->Session->write('dsubesp',$var);
          $cond2 =" and ano=".$ano." and cod_partida=".$dpar." and cod_generica=".$dgen." and cod_especifica=".$desp." and cod_sub_espec=".$var;
          $a=  $this->v_cfpd05_denominaciones->findAll($cond.$cond2,array('deno_sub_espec'));
          $xdeno= $a[0]['v_cfpd05_denominaciones']['deno_sub_espec'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }
        break;
        case 'auxiliar':
          $sec =  $this->Session->read('dsec');
          $prog =  $this->Session->read('dprog');
          $subprog =  $this->Session->read('dsubprog');
          $proy =  $this->Session->read('dproy');
          $activ = $this->Session->read('activ');
          $ano =  $this->Session->read('ano');
          $dpar=  $this->Session->read('dpar');
          $dpar = $dpar; //< 10 ? CE."0".$dpar : CE.$dpar;
          $dgen =  $this->Session->read('dgen');
          $desp =  $this->Session->read('desp');
          $dsubesp =  $this->Session->read('dsubesp');
          $con3=" and cod_sector=".$sec." and cod_programa=".$prog." and cod_sub_prog=".$subprog." and cod_proyecto=".$proy." and cod_activ_obra=".$activ;
          $cond2 =$con3." and ano=".$ano." and cod_partida=".$dpar." and cod_generica=".$dgen." and cod_especifica=".$desp." and cod_sub_espec=".$dsubesp." and cod_auxiliar=".$var;

          $a=  $this->v_cfpd05_denominaciones->findAll($cond.$cond2,array('deno_auxiliar'));
          //print_r($a);
          $xdeno=$a[0]['v_cfpd05_denominaciones']['deno_auxiliar'];
          if($xdeno==''){
            echo "N/A";
          }else{
            echo $xdeno." &nbsp;";
          }


        break;
    }//fin wsitch
    }else{
        echo " &nbsp;";
    }
}//fin mostrar3 codigos presupuestarios















function tipo_gasto($var=null){
    $this->layout="ajax";
    $cod_dep = $this->Session->read('SScoddep');
    $username = $this->Session->read('nom_usuario');
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');



$ver="si";
$dato_ano = $this->ano_ejecucion();
if(isset($this->data["tipo_presupuestoPDF"]["year"])){$year=$this->data["tipo_presupuestoPDF"]["year"];   }else{$year=$dato_ano;}
if(isset($this->data["tipo_presupuestoPDF"]["opcion"])){$var=$this->data["tipo_presupuestoPDF"]["opcion"]; $ver = "no"; }else{$var=1;}
$this->set("year",$year);
$this->set("ver",$ver);


    $fields=null;
    $this->set('cod_dep', $cod_dep);
    if($var==1 && $cod_dep==1){
        $this->set('var', $var);
         $condicion = $this->SQLCA_consolidado($var);
         $condicion .= " and ano=".$year." GROUP BY cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano";
        $fields = "SUM(gasto_inversion) as gasto_inversion, SUM(gasto_corriente) as gasto_corriente, SUM(total) as total";
    }else{
        $var = 2;
        $condicion = $this->SQLCA_consolidado($var);
        $this->set('var', $var);
        $condicion.= " and ano=".$year."";
        $fields = "SUM(gasto_inversion) as gasto_inversion, SUM(gasto_corriente) as gasto_corriente, SUM(total) as total";
    }


    $datos = $this->v_cfpd05_tipo_gasto2->findAll($condicion, $fields, $order = null, $limit = null, $page = null, $recursive = null);
    $this->set('datos', $datos);

}//fin foreach



function tipo_gasto2($rdm=null, $var=null){
    $this->layout="ajax";
    $cod_dep = $this->Session->read('SScoddep');
    $this->set('cod_dep', $cod_dep);
    $this->set('var', $var);
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');
    $condicion = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst." and cod_dep=".$cod_dep;


$ver="si";
$dato_ano = $this->ano_ejecucion();
if(isset($this->data["tipo_presupuestoPDF"]["year"])){$year=$this->data["tipo_presupuestoPDF"]["year"];   }else{$year=$dato_ano;}
if(isset($this->data["tipo_presupuestoPDF"]["opcion"])){$var=$this->data["tipo_presupuestoPDF"]["opcion"]; $ver = "no"; }else{$var=1;}
$this->set("year",$year);
$this->set("ver",$ver);

    $username = $this->Session->read('nom_usuario');
    if(file_exists('/tmp/pastel_tipo_gasto_'.$username.'_'.$rdm.".png")){
        unlink('/tmp/pastel_tipo_gasto_'.$username.'_'.$rdm.".png");
    }
    if(file_exists('/tmp/barra_tipo_gasto_'.$username.'_'.$rdm.".png")){
        unlink('/tmp/barra_tipo_gasto_'.$username.'_'.$rdm.".png");
    }
    if($var!=null && $cod_dep==1){
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, SUM(a.gasto_inversion) as gasto_inversion, SUM(a.gasto_corriente) as gasto_corriente, SUM(a.total) as total FROM v_cfpd05_tipo_gasto2 a  where a.ano=".$year." GROUP BY cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano;";
        $datos = $this->v_cfpd05_tipo_gasto2->execute($sql);
        $this->set('datos', $datos);
    }else{
        $this->tipo_gasto();
        $this->render('tipo_gasto');
    }
}//fin foreach











function tipo_gasto_pdf(){
    $this->layout="pdf";
    $username = $this->Session->read('nom_usuario');
    $this->set('user', $username);
    $gasto_inversion = $this->data['tipo_gastoPDF']['gasto_inversion'];
    $por_gasto_inversion = $this->data['tipo_gastoPDF']['por_gasto_inversion'];
    $gasto_corriente = $this->data['tipo_gastoPDF']['gasto_corriente'];
    $por_gasto_corriente = $this->data['tipo_gastoPDF']['por_gasto_corriente'];
    $total = $this->data['tipo_gastoPDF']['total'];
    $rdm = $this->data['tipo_gastoPDF']['rdm'];
    $year = $this->data["tipo_gastoPDF"]["year"];
    $this->set('gasto_inversion', $gasto_inversion);
    $this->set('gasto_corriente', $gasto_corriente);
    $this->set('por_gasto_inversion', $por_gasto_inversion);
    $this->set('por_gasto_corriente', $por_gasto_corriente);
    $this->set('total', $total);
    $this->set('rdm', $rdm);
    $this->set('year', $year);

}


function tipo_presupuesto_pdf(){
    $this->layout="pdf";
    $username = $this->Session->read('nom_usuario');
    $this->set('user', $username);
    $ordinario         = $this->data["tipo_presupuetoPDF"]["ordinario"];
    $coordinado        = $this->data["tipo_presupuetoPDF"]["coordinado"];
    $fci              = $this->data["tipo_presupuetoPDF"]["fci"];
    $mpps             = $this->data["tipo_presupuetoPDF"]["mpps"];
    $ingresos_extra    = $this->data["tipo_presupuetoPDF"]["ingresos_extra"];
    $total_presupuesto =  $this->data["tipo_presupuetoPDF"]["total_presupuesto"];
    $por_ordinario         = $this->data["tipo_presupuetoPDF"]["por_ordinario"];
    $por_coordinado        = $this->data["tipo_presupuetoPDF"]["por_coordinado"];
    $por_fci              = $this->data["tipo_presupuetoPDF"]["por_fci"];
    $por_mpps             = $this->data["tipo_presupuetoPDF"]["por_mpps"];
    $por_ingresos_extra    = $this->data["tipo_presupuetoPDF"]["por_ingresos_extra"];
    $rdm = $this->data["tipo_presupuetoPDF"]["rdm"];
    $year = $this->data["tipo_presupuetoPDF"]["year"];
    $this->set('ordinario', $ordinario);
    $this->set('coordinado', $coordinado);
    $this->set('fci', $fci);
    $this->set('mpps', $mpps);
    $this->set('ingresos_extra', $ingresos_extra);
    $this->set('por_ordinario', $por_ordinario);
    $this->set('por_coordinado', $por_coordinado);
    $this->set('por_fci', $por_fci);
    $this->set('por_mpps', $por_mpps);
    $this->set('por_ingresos_extra', $por_ingresos_extra);
    $this->set('total_presupuesto', $total_presupuesto);
    $this->set('rdm', $rdm);
    $this->set('year', $year);

}

function tipo_sector_pdf(){
    $this->layout="pdf";
    $username = $this->Session->read('nom_usuario');
    $this->set('user', $username);
    $kk=$_SESSION["vector_sectores"];
    $this->set("KK",$kk);
    $year = $this->data["tipo_presupuetoPDF"]["year"];
    for($i=0;$i<count($kk);$i++){
        $sector[$kk[$i]]         = $this->data["tipo_presupuetoPDF"]["sector_".$kk[$i]];
        $por_sector[$kk[$i]]=$this->data["tipo_presupuetoPDF"]["por_sector_".$kk[$i]];
    }
    $total_presupuesto =  $this->data["tipo_presupuetoPDF"]["total_presupuesto_sector"];
    $rdm = $this->data["tipo_presupuetoPDF"]["rdm"];
    $con=$_SESSION["CONDICIONPDF"]." and a.ano='".$year."'  ";
    $rs=$this->v_balance_ejecucion->execute("SELECT DISTINCT a.cod_sector,a.deno_sector FROM v_balance_ejecucion a WHERE ". $con);
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    if(isset($v)){$SECTOR = array_combine($v, $d); }else{ $SECTOR = array();}
    if(!isset($sector)){$sector = array();}
    if(!isset($por_sector)){$por_sector = array();}
    $this->set("SECTOR", $SECTOR);
    $this->set('sector', $sector);
    $this->set('por_sector', $por_sector);
    $this->set('total_presupuesto', $total_presupuesto);
    $this->set('rdm', $rdm);
    $this->set('year', $year);

}


function tipo_partida_pdf(){
    $this->layout="pdf";
    $username = $this->Session->read('nom_usuario');
    $this->set('user', $username);
    $kk=$_SESSION["vector_partidas"];
    $year = $this->data["tipo_presupuetoPDF"]["year"];
    $this->set("KK",$kk);
    for($i=0;$i<count($kk);$i++){
        $partida[$kk[$i]]         = $this->data["tipo_presupuetoPDF"]["partida_".$kk[$i]];
        $por_partida[$kk[$i]]=$this->data["tipo_presupuetoPDF"]["por_partida_".$kk[$i]];
    }
    $total_presupuesto =  $this->data["tipo_presupuetoPDF"]["total_presupuesto_partida"];
    $rdm = $this->data["tipo_presupuetoPDF"]["rdm"];
    $con=$_SESSION["CONDICIONPDF"]." and a.ano='".$year."'  ";
    $rs=$this->v_balance_ejecucion->execute("SELECT DISTINCT a.cod_partida,a.deno_partida FROM v_cfpd05_denominaciones a WHERE ". $con);
    foreach($rs as $l){
        $v[]=$l[0]["cod_partida"];
        $d[]=$l[0]["deno_partida"];
    }
    if(isset($v)){$PARTIDA = array_combine($v, $d); }else{ $PARTIDA = array();}
    if(!isset($partida)){$partida = array();}
    if(!isset($por_partida)){$por_partida = array();}
    $this->set("PARTIDA", $PARTIDA);
    $this->set('partida', $partida);
    $this->set('por_partida', $por_partida);
    $this->set('total_presupuesto', $total_presupuesto);
    $this->set('rdm', $rdm);
    $this->set('year', $year);

}


function eliminar_img($rdm){
    $this->layout="ajax";
    $username = $this->Session->read('nom_usuario');
    if(file_exists('/tmp/pastel_tipo_gasto_'.$username.'_'.$rdm.".png")){
        unlink('/tmp/pastel_tipo_gasto_'.$username.'_'.$rdm.".png");
    }
    if(file_exists('/tmp/barra_tipo_gasto_'.$username.'_'.$rdm.".png")){
        unlink('/tmp/barra_tipo_gasto_'.$username.'_'.$rdm.".png");
    }


}




function reporte_form_decretos_reformulacion(){
    $this->layout="ajax";
    $ano=$this->ano_ejecucion();
    $this->set('ano',$ano);
}

function reporte_pdf_decretos_reformulacion(){
    $this->layout="ajax";
    $ano=$this->data['cfpp10_decretos_reformulacion']['ano'];
    $estilo_reporte=$this->data['cfpp10_decretos_reformulacion']['estilo_reporte'];
    $ordenamiento_reporte=$this->data['cfpp10_decretos_reformulacion']['ordenamiento_reporte'];
    $tipo_presupuesto=$this->data['cfpp10_decretos_reformulacion']['tipo_presupuesto'];

    $this->Session->write('tipo_reporte', '');

    switch($ordenamiento_reporte){
        case '1': $orden="fecha_decreto, numero_oficio ASC"; break;
        case '2': $orden="numero_oficio ASC"; break;
        case '3': $orden="numero_decreto, numero_oficio ASC"; break;
    }

    $presupuesto="";
    switch($tipo_presupuesto){
        case '0': $cond_presupuesto=" "; $presupuesto="TIPO DE RECURSO: TODO"; break;
        case '1': $cond_presupuesto=" and tipo_presupuesto=1 "; $presupuesto="TIPO DE RECURSO: ORDINARIO"; break;
        case '2': $cond_presupuesto=" and tipo_presupuesto=2 "; $presupuesto="TIPO DE RECURSO: COORDINADO"; break;
        case '3': $cond_presupuesto=" and tipo_presupuesto=3 "; $presupuesto="TIPO DE RECURSO: F.C.I."; break;
        case '4': $cond_presupuesto=" and tipo_presupuesto=4 "; $presupuesto="TIPO DE RECURSO: MPPS"; break;
        case '5': $cond_presupuesto=" and tipo_presupuesto=5 "; $presupuesto="TIPO DE RECURSO: INGRESOS EXTRAORDINARIO"; break;
        case '6': $cond_presupuesto=" and tipo_presupuesto=6 "; $presupuesto="TIPO DE RECURSO: INGRESOS PROPIOS"; break;
        case '7': $cond_presupuesto=" and tipo_presupuesto=7 "; $presupuesto="TIPO DE RECURSO: LAEE"; break;
        case '8': $cond_presupuesto=" and tipo_presupuesto=8 "; $presupuesto="TIPO DE RECURSO: FIDES"; break;
    }

    switch($estilo_reporte){

        case '1':
                $sql_aprob=$this->SQLCA()." and ano_reformulacion='$ano'";

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_6=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $pase1=1;
                $pase2=1;
                $pase3=1;
                $pase4=1;
                $pase5=1;
                $pase6=1;

                if(count($datos_1)==0) {$pase1=0;}
                if(count($datos_2)==0) {$pase2=0;}
                if(count($datos_3)==0) {$pase3=0;}
                if(count($datos_4)==0) {$pase4=0;}
                if(count($datos_5)==0) {$pase5=0;}
                if(count($datos_6)==0) {$pase6=0;}

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6==0) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
                $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
                $this->set('datos_6',$datos_6);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS REGISTRADOS');
                break;

        case '2':
                $sql=$this->SQLCA()." and ano_reformulacion='$ano' and aprobado='2'";

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_6=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $pase1=1;
                $pase2=1;
                $pase3=1;
                $pase4=1;
                $pase5=1;
                $pase6=1;

                if(count($datos_1)==0) {$pase1=0;}
                if(count($datos_2)==0) {$pase2=0;}
                if(count($datos_3)==0) {$pase3=0;}
                if(count($datos_4)==0) {$pase4=0;}
                if(count($datos_5)==0) {$pase5=0;}
                if(count($datos_6)==0) {$pase6=0;}

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
                $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
                $this->set('datos_6',$datos_6);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS APROBADOS');
                break;

        case '3':
                $sql=$this->SQLCA()." and ano_reformulacion='$ano' and aprobado='0'";

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
                 $datos_5=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $pase1=1;
                $pase2=1;
                $pase3=1;
                $pase4=1;
                $pase5=1;
                $pase6=1;

                if(count($datos_1)==0) {$pase1=0;}
                if(count($datos_2)==0) {$pase2=0;}
                if(count($datos_3)==0) {$pase3=0;}
                if(count($datos_4)==0) {$pase4=0;}
                if(count($datos_5)==0) {$pase5=0;}
                if(count($datos_6)==0) {$pase6=0;}

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6==0) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
                $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
                $this->set('datos_6',$datos_6);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS POR APROBAR');
                break;

    }

    $this->set('ano_reporte', $ano);
    $this->set('presupuesto', $presupuesto);
    $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    $this->set('titulo_a',$this->Session->read('dependencia'));
}// Reporte_pdf_decretos_reformulacion

/**
 * PROYECCION DE GASTO FORM
 */


function proyeccion_gasto_form () {
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }

    $this->Session->write('tipo_reporte', '');
    if(isset($var)){
        $this->set('tipo_reporte',$var);
    }else{
        $this->set('tipo_reporte',"reporte_balance_ejecucion");
    }
    //print_r($_SESSION);

}//fin proyeccion de gasto formulario

function seleccion_proyeccion_gasto () {
         $this->layout="ajax";
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])) $Ano=$this->data["reporte"]["ano"];
         else $Ano=$this->ano_ejecucion();

         if(isset($this->data['cfpp05']['consolidacion']))$consolidado=$this->data['cfpp05']['consolidacion'];
         else$consolidado="NO";
         if(isset($this->data["reporte"]["modo"])){
            $modo=(int) $this->data["reporte"]["modo"];
         }else{
            $modo=1;
         }
         $tipo_recurso=$this->data["reporte"]["tipo_recurso"];
         $this->set('tipo_recurso',$this->data["reporte"]["tipo_recurso"]);

         switch($modo){
            case 1:
                 $this->proyeccion_gasto_modelo1($Ano,$consolidado,$tipo_recurso);
                 $this->render("proyeccion_gasto_modelo1");
            break;
            case 2:
                 $this->proyeccion_gasto_modelo2($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo2");
            break;
            case 3:
                $this->proyeccion_gasto_modelo3($Ano,$consolidado,$tipo_recurso);
                 $this->render("proyeccion_gasto_modelo3");
            break;
            case 4:
                $this->proyeccion_gasto_modelo4($Ano,$consolidado,$tipo_recurso);
                 $this->render("proyeccion_gasto_modelo4");
            break;
            case 5:
                 $this->proyeccion_gasto_modelo5($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo5");
            break;
            case 6:
                 $this->proyeccion_gasto_modelo6($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo6");
            break;
            case 7:
                 $this->proyeccion_gasto_modelo7($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo7");
            break;
            case 8:
                 $this->proyeccion_gasto_modelo8($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo8");
            break;
            case 9:
                 $this->proyeccion_gasto_modelo9($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo9");
            break;
            case 10:
                 $this->proyeccion_gasto_modelo10($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo10");
            break;
            case 11:
                 $this->proyeccion_gasto_modelo11($Ano,$consolidado,$tipo_recurso);
                  $this->render("proyeccion_gasto_modelo11");
            break;
            default:
              $this->proyeccion_gasto_modelo1($Ano,$consolidado,$tipo_recurso);
              $this->render("proyeccion_gasto_modelo1");
              break;
        }//fin switch



}








/**
 * PROYECCION DE GASTO
 */
function proyeccion_gasto () {
    $this->layout="pdf";

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_report($this->data['cfpp05']['consolidacion']);
            if($this->data['cfpp05']['consolidacion']==1){
             $dependicia = "ano,";
         }else{
             $dependicia = "cod_dep,ano,";
         }
        }else{
            $con=$this->SQLCA_report();
            $dependicia = "cod_dep,ano,";
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= 1;//(int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch

        $resultado2=$this->v_balance_ejecucion2->execute("SELECT
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,
cod_programa,
cod_sub_prog,
cod_partida,sum(asignacion_anual) as asignacion_anual,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12))::numeric(22,2)) AS dm_ene,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11))::numeric(22,2)) AS dm_feb,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10))::numeric(22,2)) AS dm_mar,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9))::numeric(22,2)) AS dm_abr,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8))::numeric(22,2)) AS dm_may,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7))::numeric(22,2)) AS dm_jun,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6))::numeric(22,2)) AS dm_jul,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6)+((aumento_ago-disminucion_ago)/5))::numeric(22,2)) AS dm_ago,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6)+((aumento_ago-disminucion_ago)/5)+((aumento_sep-disminucion_sep)/4))::numeric(22,2)) AS dm_sep,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6)+((aumento_ago-disminucion_ago)/5)+((aumento_sep-disminucion_sep)/4)+((aumento_oct-disminucion_oct)/3))::numeric(22,2)) AS dm_oct,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6)+((aumento_ago-disminucion_ago)/5)+((aumento_sep-disminucion_sep)/4)+((aumento_oct-disminucion_oct)/3)+((aumento_nov-disminucion_nov)/2))::numeric(22,2)) AS dm_nov,
sum(((asignacion_anual/12)+((aumento_ene-disminucion_ene)/12)+((aumento_feb-disminucion_feb)/11)+((aumento_mar-disminucion_mar)/10)+((aumento_abr-disminucion_abr)/9)+((aumento_may-disminucion_may)/8)+((aumento_jun-disminucion_jun)/7)+((aumento_jul-disminucion_jul)/6)+((aumento_ago-disminucion_ago)/5)+((aumento_sep-disminucion_sep)/4)+((aumento_oct-disminucion_oct)/3)+((aumento_nov-disminucion_nov)/2)+((aumento_dic-disminucion_dic)/1))::numeric(22,2)) AS dm_dic,
sum(compromiso_ene) as compromiso_ene,
sum(compromiso_feb) as compromiso_feb,
sum(compromiso_mar) as compromiso_mar,
sum(compromiso_abr) as compromiso_abr,
sum(compromiso_may) as compromiso_may,
sum(compromiso_jun) as compromiso_jun,
sum(compromiso_jul) as compromiso_jul,
sum(compromiso_ago) as compromiso_ago,
sum(compromiso_sep) as compromiso_sep,
sum(compromiso_oct) as compromiso_oct,
sum(compromiso_nov) as compromiso_nov,
sum(compromiso_dic) as compromiso_dic
 FROM v_balance_ejecucion2
  WHERE ".$con." and ano=".$Ano."
group by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,
cod_programa,
cod_sub_prog,
cod_partida

order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,
cod_programa,
cod_sub_prog,
cod_partida ASC");

$denominaciones=$this->cfpd05->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer) AND a1.cod_generica=a.cod_generica) AS deno_generica
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer) AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica) AS deno_especifica
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer) AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec) AS deno_sub_espec
   FROM cfpd05 a
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec
");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);


}//fin proyeccion de gasto

function proyeccion_gasto_modelo1($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    $this->set('titulo_a',$this->Session->read('dependencia'));
    $this->set('titulo_reporte','PROYECCION DE GASTO POR SECTORES');
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=1 ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo1

function proyeccion_gasto_modelo2($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=2  ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_programa
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo2

function proyeccion_gasto_modelo3($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,cod_sub_prog,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=3 ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_programa,cod_sub_prog
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa,cod_sub_prog ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo3

function proyeccion_gasto_modelo4($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,cod_sub_prog,cod_partida,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=4 ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_programa,cod_sub_prog,cod_partida
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa,cod_sub_prog,cod_partida ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");
$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo4

function proyeccion_gasto_modelo5($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=5  ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa,cod_sub_prog,cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo5

function proyeccion_gasto_modelo6($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,cod_partida,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=6   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_programa,cod_partida
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa,cod_partida ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo6

function proyeccion_gasto_modelo7($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_programa,cod_partida,cod_generica,cod_especifica,cod_sub_espec,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=7   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst,".$dependicia." cod_sector,cod_programa,cod_partida,cod_generica,cod_especifica,cod_sub_espec
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_programa,cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo7

function proyeccion_gasto_modelo8($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_partida,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=8   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst,".$dependicia." cod_sector,cod_partida
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_partida ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo8

function proyeccion_gasto_modelo9($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=9   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo9

function proyeccion_gasto_modelo10($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ano, cod_partida,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=10   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_partida
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_partida ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec

");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo10

function proyeccion_gasto_modelo11($Ano,$consolidado,$tipo_recurso) {
    $this->layout="pdf";
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $this->set('ANO',$Ano);
    if($consolidado!="NO"){
            $con=$this->SQLCA_consolidado($consolidado);
            if($consolidado==1){
                $modelo="v_proyeccion_gasto_inst";
                $dependicia = "ano,";
            }else{
               $modelo="v_proyeccion_gasto_dep";
               $dependicia = "cod_dep,ano,";
            }
    }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gasto_dep";
            $dependicia = "cod_dep,ano,";
    }
    if($tipo_recurso!=7){
        $tipo_presupuesto=" and tipo_presupuesto=".$tipo_recurso;
    }else{
        $tipo_presupuesto="";
    }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
$resultado2=$this->$modelo->execute("SELECT cod_presi, cod_entidad, cod_tipo_inst, cod_inst,".$dependicia.",cod_partida,cod_generica,cod_especifica,cod_sub_espec,
       SUM(asignacion_anual) AS  asignacion_anual,
       SUM(dm_ene) AS  dm_ene,
       SUM(dm_feb) AS  dm_feb,
       SUM(dm_mar) AS  dm_mar,
       SUM(dm_abr) AS  dm_abr,
       SUM(dm_may) AS  dm_may,
       SUM(dm_jun) AS  dm_jun,
       SUM(dm_jul) AS  dm_jul,
       SUM(dm_ago) AS  dm_ago,
       SUM(dm_sep) AS  dm_sep,
       SUM(dm_oct) AS  dm_oct,
       SUM(dm_nov) AS  dm_nov,
       SUM(dm_dic) AS  dm_dic,
       SUM(compromiso_ene) AS  compromiso_ene,
       SUM(compromiso_feb) AS  compromiso_feb,
       SUM(compromiso_mar) AS  compromiso_mar,
       SUM(compromiso_abr) AS  compromiso_abr,
       SUM(compromiso_may) AS  compromiso_may,
       SUM(compromiso_jun) AS  compromiso_jun,
       SUM(compromiso_jul) AS  compromiso_jul,
       SUM(compromiso_ago) AS  compromiso_ago,
       SUM(compromiso_sep) AS  compromiso_sep,
       SUM(compromiso_oct) AS  compromiso_oct,
       SUM(compromiso_nov) AS  compromiso_nov,
       SUM(compromiso_dic) AS  compromiso_dic FROM ".$modelo."
  WHERE ".$con." and ano=".$Ano." and modelo_reporte=11   ".$tipo_presupuesto." group by cod_presi, cod_entidad, cod_tipo_inst, cod_inst, ".$dependicia." cod_partida,cod_generica,cod_especifica,cod_sub_espec
order by
cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
".$dependicia."
cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");

$denominaciones=$this->cfpd05->execute("SELECT a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,
a.cod_sector,
upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
a.cod_programa,
upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
a.cod_sub_prog,
upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa and a1.cod_sub_prog=a.cod_sub_prog)) AS deno_sub_prog,
a.cod_partida,
upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
a.cod_generica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica)) AS deno_generica,
a.cod_especifica,
upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica)) AS deno_especifica,
a.cod_sub_espec,
upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica=a.cod_generica AND a1.cod_especifica=a.cod_especifica AND a1.cod_sub_espec=a.cod_sub_espec)) AS deno_sub_espec
   FROM cfpd05 a WHERE ".$con." and ano=".$Ano."
group by
a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.ano,a.cod_sector,a.cod_programa,a.cod_sub_prog,
a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec
");

$this->set("denominaciones",$denominaciones);
$this->set("proyeccion_gasto",$resultado2);

}//fin proyeccion_gasto_modelo11


function analisis_presupuesto_actividades_form() {
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');

}//fin

function analisis_presupuesto_actividades() {
    set_time_limit(0);
    ini_set("memory_limit","2536M");

         $this->layout="pdf";
         $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
             $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
             $con_a=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
             if($this->data['cfpp05']['consolidacion']==1){
                $xcod_dep_ref = " and 1=1";
             }else{
                $xcod_dep_ref = " and a.codi_dep=".$_SESSION['cod_dep_reporte_consolidado'];
             }
             $xfr =" a.cod_presi=".$this->verifica_SS(1)." and a.cod_entidad=".$this->verifica_SS(2)." and a.cod_tipo_inst=".$this->verifica_SS(3)." and a.cod_inst=".$this->verifica_SS(4)." ".$xcod_dep_ref;
             $condicion_dep_ref = " (($con_a) OR ($xfr and tipo_documento_reporte=1)) ";
        }else{
            $con=$this->SQLCA_consolidado();
            $con_a=$this->SQLCA_consolidado_opcion(null, "a");
            $xcod_dep_ref = " and a.codi_dep=".$_SESSION['cod_dep_reporte_consolidado'];
            $xfr =" a.cod_presi=".$this->verifica_SS(1)." and a.cod_entidad=".$this->verifica_SS(2)." and a.cod_tipo_inst=".$this->verifica_SS(3)." and a.cod_inst=".$this->verifica_SS(4)." ".$xcod_dep_ref;
            $condicion_dep_ref = " (($con_a) OR ($xfr and tipo_documento_reporte=1)) ";

        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!=""){
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
            $cod_sector_a=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        }else{
            $cod_sector=" 1=1 and ";
            $cod_sector_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!=""){
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
            $cod_programa_a=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        }else{
            $cod_programa=" 1=1 and ";
            $cod_programa_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!=""){
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
            $cod_sub_prog_a=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        }else{
            $cod_sub_prog=" 1=1 and ";
            $cod_sub_prog_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!=""){
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
            $cod_proyecto_a=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        }else{
            $cod_proyecto=" 1=1 and ";
            $cod_proyecto_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!=""){
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
            $cod_activ_obra_a=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        }else{
            $cod_activ_obra=" 1=1 ";
            $cod_activ_obra_a=" 1=1 ";
        }
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!=""){
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
            $cod_partida_a=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        }else{
            $cod_partida=" 1=1 ";
            $cod_partida_a=" 1=1 ";
        }
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!=""){
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
            $cod_generica_a=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        }else{
            $cod_generica=" 1=1 and ";
            $cod_generica_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!=""){
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
            $cod_especifica_a=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        }else{
            $cod_especifica=" 1=1 and ";
            $cod_especifica_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!=""){
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
            $cod_sub_espec_a=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        }else{
            $cod_sub_espec=" 1=1 and ";
            $cod_sub_espec_a=" 1=1 and ";
        }
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!=""){
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
            $cod_auxiliar_a=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        }else{
            $cod_auxiliar=" 1=1 ";
            $cod_auxiliar_a=" 1=1 ";
        }
        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
                  $condicion_a=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
                  $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
                $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a." and ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
                 $condicion_a=" ".$cod_partida_a;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
                 $condicion_a=" ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
            break;
            default: $condicion=" 1=1";
                     $condicion_a=" 1=1";
                     break;
        }//fin switch

  if(isset($this->data["reporte"]["cronologico"]) && $this->data["reporte"]["cronologico"]=='1'){

        $this->analisis_presupuesto_actividades_cronologico($Ano,$condicion,$condicion_a,$con,$con_a,$condicion_dep_ref);
        $this->render('analisis_presupuesto_actividades_cronologico');

  }else{

        $sin_afectadas=" and (aumento!=0 or disminucion!=0 or compromiso_anual!=0 or causado_anual!=0 or pagado_anual!=0)";
        $vector = $this->v_analisis_presupuesto->findAll($con." and ano=".$Ano." and ".$condicion.$sin_afectadas,null,'cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        //$cantidad_registros = $this->v_analisis_presupuesto->findCount($con." and ano=".$Ano." and ".$condicion.$sin_afectadas,null,'cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $this->set('cantidad_registros',159);
        $this->set('DATOS',$vector);

$sql_reformulacion = "SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_reformulacion,
  a.numero_oficio,
  a.codi_dep,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto_disminucion,
  a.monto_aumento,
  b.fecha_decreto,b.numero_decreto
FROM
  cfpd10_reformulacion_partidas a,cfpd10_reformulacion_texto b
WHERE
  upper(a.numero_oficio)=upper(b.numero_oficio) and a.cod_presi=".$this->verifica_SS(1)." and a.cod_entidad=".$this->verifica_SS(2)." and a.cod_tipo_inst=".$this->verifica_SS(3)." and a.cod_inst=".$this->verifica_SS(4)." ".$xcod_dep_ref." and a.ano=".$Ano." and ".$condicion_a." and a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_reformulacion=b.ano_reformulacion ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_decreto ASC";
        $reformulacion=$this->cfpd10_reformulacion_partidas->execute($sql_reformulacion);
    //echo $sql_reformulacion;
    //pr($reformulacion);
   $this->set("reformulacion",$reformulacion);



$RCompromisos=$this->cepd01_compromiso_partidas->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_documento,
  a.numero_documento,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_documento,
  b.beneficiario,
  b.ano_orden_pago,
  b.numero_orden_pago

FROM
 cepd01_compromiso_partidas a,cepd01_compromiso_cuerpo b
WHERE
  b.condicion_actividad=1 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_documento=b.ano_documento AND
  a.numero_documento=b.numero_documento AND
  a.numero_documento_secuencia=b.numero_documento_secuencia and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_documento ASC");
  $this->set("RCompromisos",$RCompromisos);

$OCcompromiso=$this->cscd04_ordencompra_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_orden_compra,
a.numero_orden_compra,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.aumento,
a.disminucion,
a.anticipo,
a.amortizacion,
a.cancelado,
a.numero_asiento_compromiso,
b.fecha_orden_compra,
b.ano_orden_compra,
b.numero_orden_compra,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,
b.ano_cotizacion,
b.numero_cotizacion,
upper(b.rif),
(SELECT x.denominacion from cpcd02 x WHERE upper(x.rif)=upper(b.rif) limit 1) as beneficiario

FROM cscd04_ordencompra_partidas a,cscd04_ordencompra_encabezado b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_orden_compra = b.ano_orden_compra and
  a.numero_orden_compra = b.numero_orden_compra  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_orden_compra ASC");

$this->set("OCompromisos",$OCcompromiso);

//$orden_pago=$this->cepd03_ordenpago_partidas->findAll($con." and ano=".$Ano." and ".$condicion.$sin_afectadas,null,'cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');

//ORDENDE DE PAGOS
$orden_pago=$this->cepd01_compromiso_partidas->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_orden_pago,
  b.beneficiario,
  b.numero_documento_origen,
  b.numero_documento_adjunto,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.fecha_cheque,b.cod_tipo_documento

FROM
 cepd03_ordenpago_partidas a,cepd03_ordenpago_cuerpo b
WHERE
  b.condicion_actividad=1 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago AND
  a.numero_orden_pago_secuencia=b.numero_orden_pago_secuencia and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_orden_pago ASC");

  $this->set("orden_pago",$orden_pago);

//CHEQUES
$cheques=$this->cstd03_cheque_partidas->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_movimiento,
  a.cod_entidad_bancaria,
  a.cod_sucursal,
  a.cuenta_bancaria,
  a.numero_cheque,
  a.clase_orden,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_cheque,
  b.beneficiario,b.clase_beneficiario


FROM
 cstd03_cheque_partidas a,cstd03_cheque_cuerpo b
WHERE
  b.condicion_actividad=1 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_movimiento=b.ano_movimiento AND
  a.cod_entidad_bancaria=b.cod_entidad_bancaria AND
  a.cod_sucursal=b.cod_sucursal AND
  a.cuenta_bancaria=b.cuenta_bancaria AND
  a.numero_cheque=b.numero_cheque AND
  ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_cheque ASC");

  $this->set("cheques",$cheques);

//RETENCION IVA
$retencion_iva=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_iva a,cstd07_retenciones_cuerpo_iva b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_iva",$retencion_iva);

//RETENCION ISLR
$retencion_islr=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_islr a,cstd07_retenciones_cuerpo_islr b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_islr",$retencion_islr);

//RETENCION MUNICIPAL
$retencion_municipal=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_municipal a,cstd07_retenciones_cuerpo_municipal b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_municipal",$retencion_municipal);

//RETENCION TIMBRE
$retencion_timbre=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_timbre a,cstd07_retenciones_cuerpo_timbre b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_timbre",$retencion_timbre);

// CONTRATO OBRAS

$OBcompromiso=$this->cobd01_contratoobras_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_obra,
a.numero_contrato_obra,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.aumento,
a.disminucion,
a.anticipo,
a.amortizacion,
a.numero_control_compromiso,
b.fecha_contrato_obra,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,
upper(b.rif),
(SELECT x.denominacion from cpcd02 x WHERE upper(x.rif)=upper(b.rif) limit 1) as beneficiario

FROM cobd01_contratoobras_partidas a,cobd01_contratoobras_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_obra = b.ano_contrato_obra and
  a.numero_contrato_obra = b.numero_contrato_obra  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_contrato_obra ASC");

$this->set("OBcompromisos",$OBcompromiso);
//pr($OBcompromiso);
// CONTRATO OBRAS MODIFICACIONES

$OBMcompromiso=$this->cobd01_contratoobras_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_obra,
a.numero_contrato_obra,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cobd01_contratoobras_modificacion_partidas a,cobd01_contratoobras_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_obra = b.ano_contrato_obra and
  a.numero_contrato_obra = b.numero_contrato_obra and a.numero_modificacion = b.numero_modificacion  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("OBMcompromisos",$OBMcompromiso);


// CONTRATO SERVICIO

$CScompromiso=$this->cepd02_contratoservicio_cuerpo->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_servicio,
a.numero_contrato_servicio,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.aumento,
a.disminucion,
a.anticipo,
a.amortizacion,
a.numero_control_compromiso,
b.fecha_contrato_servicio,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,
upper(b.rif),
(SELECT x.denominacion from cpcd02 x WHERE upper(x.rif)=upper(b.rif) limit 1) as beneficiario

FROM cepd02_contratoservicio_partidas a,cepd02_contratoservicio_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_servicio = b.ano_contrato_servicio and
  a.numero_contrato_servicio = b.numero_contrato_servicio  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_contrato_servicio ASC");

$this->set("CScompromisos",$CScompromiso);


// CONTRATO SERVICIO MODIFICACIONES

$CSMcompromiso=$this->cepd02_contratoservicio_cuerpo->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_servicio,
a.numero_contrato_servicio,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cepd02_contratoservicio_modificacion_partidas a,cepd02_contratoservicio_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_servicio = b.ano_contrato_servicio and
  a.numero_contrato_servicio = b.numero_contrato_servicio  and a.numero_modificacion = b.numero_modificacion and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("CSMcompromisos",$CSMcompromiso);



// ORDEN COMPRA MODIFICACIONES

$OCMcompromiso=$this->cobd01_contratoobras_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_orden_compra,
a.numero_orden_compra,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cscd04_ordencompra_modificacion_partidas a,cscd04_ordencompra_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_orden_compra = b.ano_orden_compra and
  a.numero_orden_compra = b.numero_orden_compra and a.numero_modificacion = b.numero_modificacion  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("OCMcompromisos",$OCMcompromiso);

//RENDICIONES

$RENDICIONES=$this->cobd01_contratoobras_partidas->execute("SELECT
a.*,
b.fecha_rendicion,
b.funcionario_responsable
FROM cfpd30_rendiciones_partidas a,cfpd30_rendiciones_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_rendicion = b.ano_rendicion and
  a.numero_rendicion = b.numero_rendicion and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_rendicion ASC");

$this->set("RENDICIONES",$RENDICIONES);

//NOTA DE DEBITO

$NOTADEBITO=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.ano_orden_pago,b.numero_orden_pago,b.fecha_nota_debito,b.beneficiario FROM cstd09_notadebito_especial_partidas a,cstd09_notadebito_especial_cuerpo b
WHERE
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.tipo_documento=b.tipo_documento and
a.numero_documento=b.numero_documento and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_nota_debito ASC");

$this->set("NOTADEBITO",$NOTADEBITO);

//REINTEGRO

$REINTEGRO=$this->cobd01_contratoobras_partidas->execute("SELECT
a.*,
b.fecha_reintegro,
b.funcionario_responsable
FROM cfpd30_reintegro_partidas a,cfpd30_reintegro_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_reintegro = b.ano_reintegro and
  a.numero_reintegro = b.numero_reintegro and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_reintegro ASC");

$this->set("REINTEGRO",$REINTEGRO);


//NOTA DE DEBITO NUEVO PROGRAMA

$NOTADEBITO_CA=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.fecha_debito,b.beneficiario FROM cstd09_notadebito_partidas a,cstd09_notadebito_cuerpo b
WHERE
b.condicion_actividad=1 and
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.numero_debito=b.numero_debito and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_debito ASC");

$this->set("NOTADEBITO_CA",$NOTADEBITO_CA);

// NOTA DE DEBITO del IVA y ISLR

$DEBITO=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.fecha_debito,b.beneficiario FROM cstd30_debito_partidas a,cstd30_debito_cuerpo b
WHERE
b.condicion_actividad=1 and
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.numero_debito=b.numero_debito and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_debito ASC");

$this->set("DEBITO",$DEBITO);

}//fin if cronologico



}//fin analisis de presupuesto



function analisis_presupuesto_actividades_cronologico($Ano,$condicion,$condicion_a,$con,$con_a,$pcondicion_dep_ref) {
    set_time_limit(0);
    ini_set("memory_limit","1536M");

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $titulo_a = $this->Session->read('dependencia');
    $this->set('titulo_a',$titulo_a);

    $sin_afectadas=" and (aumento!=0 or disminucion!=0 or compromiso_anual!=0 or causado_anual!=0 or pagado_anual!=0)";
    $vector = $this->v_analisis_presupuesto->findAll($con." and ano=".$Ano." and ".$condicion.$sin_afectadas,null,'cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
    $this->set('DATOS',$vector);

$CRONOLOGICO=$this->cepd01_compromiso_partidas->execute("SELECT
  *
FROM v_reporte_actividades_v2 a
WHERE ".$pcondicion_dep_ref." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,a.fecha_documento,a.numero_documento,a.tipo_documento_reporte ASC");
$this->set("CRONOLOGICO",$CRONOLOGICO);
/*
echo "SELECT
  *
FROM v_reporte_actividades_v2 a
WHERE ".$pcondicion_dep_ref." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,a.fecha_documento,a.numero_documento,a.tipo_documento_reporte ASC";
/**/
//ORDENDE DE PAGOS
$orden_pago=$this->cepd01_compromiso_partidas->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_orden_pago,
  b.beneficiario,
  b.numero_documento_origen,
  b.numero_documento_adjunto,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.fecha_cheque,b.cod_tipo_documento

FROM
 cepd03_ordenpago_partidas a,cepd03_ordenpago_cuerpo b
WHERE
  b.condicion_actividad=1 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago AND
  a.numero_orden_pago_secuencia=b.numero_orden_pago_secuencia and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_orden_pago ASC");

  $this->set("orden_pago",$orden_pago);

//CHEQUES
$cheques=$this->cstd03_cheque_partidas->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_movimiento,
  a.cod_entidad_bancaria,
  a.cod_sucursal,
  a.cuenta_bancaria,
  a.numero_cheque,
  a.clase_orden,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_cheque,
  b.beneficiario,b.clase_beneficiario


FROM
 cstd03_cheque_partidas a,cstd03_cheque_cuerpo b
WHERE
  b.condicion_actividad=1 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_movimiento=b.ano_movimiento AND
  a.cod_entidad_bancaria=b.cod_entidad_bancaria AND
  a.cod_sucursal=b.cod_sucursal AND
  a.cuenta_bancaria=b.cuenta_bancaria AND
  a.numero_cheque=b.numero_cheque AND
  ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_cheque ASC");

  $this->set("cheques",$cheques);

//RETENCION IVA
$retencion_iva=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_iva a,cstd07_retenciones_cuerpo_iva b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_iva",$retencion_iva);

//RETENCION ISLR
$retencion_islr=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_islr a,cstd07_retenciones_cuerpo_islr b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_islr",$retencion_islr);

//RETENCION MUNICIPAL
$retencion_municipal=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_municipal a,cstd07_retenciones_cuerpo_municipal b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_municipal",$retencion_municipal);

//RETENCION TIMBRE
$retencion_timbre=$this->cstd03_cheque_cuerpo->execute("SELECT
  a.cod_presi,
  a.cod_entidad,
  a.cod_tipo_inst,
  a.cod_inst,
  a.cod_dep,
  a.ano_orden_pago,
  a.numero_orden_pago,
  a.clase_orden,
  a.ano,
  a.cod_sector,
  a.cod_programa,
  a.cod_sub_prog,
  a.cod_proyecto,
  a.cod_activ_obra,
  a.cod_partida,
  a.cod_generica,
  a.cod_especifica,
  a.cod_sub_espec,
  a.cod_auxiliar,
  a.monto,
  b.fecha_proceso_registro,
  b.ano_movimiento,
  b.cod_entidad_bancaria,
  b.cod_sucursal,
  b.cuenta_bancaria,
  b.numero_cheque,
  b.status

FROM
 cstd07_retenciones_partidas_timbre a,cstd07_retenciones_cuerpo_timbre b
WHERE
  b.status=2 AND
  a.cod_presi=b.cod_presi AND
  a.cod_entidad=b.cod_entidad AND
  a.cod_tipo_inst=b.cod_tipo_inst AND
  a.cod_inst=b.cod_inst AND
  a.cod_dep=b.cod_dep AND
  a.ano_orden_pago=b.ano_orden_pago AND
  a.numero_orden_pago=b.numero_orden_pago and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_proceso_registro ASC");

  $this->set("retencion_timbre",$retencion_timbre);


$OBMcompromiso=$this->cobd01_contratoobras_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_obra,
a.numero_contrato_obra,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cobd01_contratoobras_modificacion_partidas a,cobd01_contratoobras_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_obra = b.ano_contrato_obra and
  a.numero_contrato_obra = b.numero_contrato_obra and a.numero_modificacion = b.numero_modificacion  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("OBMcompromisos",$OBMcompromiso);


// CONTRATO SERVICIO MODIFICACIONES

$CSMcompromiso=$this->cepd02_contratoservicio_cuerpo->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_contrato_servicio,
a.numero_contrato_servicio,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cepd02_contratoservicio_modificacion_partidas a,cepd02_contratoservicio_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_contrato_servicio = b.ano_contrato_servicio and
  a.numero_contrato_servicio = b.numero_contrato_servicio  and a.numero_modificacion = b.numero_modificacion and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("CSMcompromisos",$CSMcompromiso);



// ORDEN COMPRA MODIFICACIONES

$OCMcompromiso=$this->cobd01_contratoobras_partidas->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_orden_compra,
a.numero_orden_compra,
a.numero_modificacion,
a.ano,
a.cod_sector,
a.cod_programa,
a.cod_sub_prog,
a.cod_proyecto,
a.cod_activ_obra,
a.cod_partida,
a.cod_generica,
a.cod_especifica,
a.cod_sub_espec,
a.cod_auxiliar,
a.monto,
a.numero_control_compromiso,
b.fecha_modificacion,
b.fecha_proceso_registro,
b.fecha_proceso_anulacion,
b.condicion_actividad,b.tipo_modificacion

FROM cscd04_ordencompra_modificacion_partidas a,cscd04_ordencompra_modificacion_cuerpo b
 where
  b.condicion_actividad=1 and
  a.cod_presi = b.cod_presi and
  a.cod_entidad = b.cod_entidad and
  a.cod_tipo_inst = b.cod_tipo_inst and
  a.cod_inst = b.cod_inst and
  a.cod_dep = b.cod_dep and
  a.ano_orden_compra = b.ano_orden_compra and
  a.numero_orden_compra = b.numero_orden_compra and a.numero_modificacion = b.numero_modificacion  and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_modificacion ASC");

$this->set("OCMcompromisos",$OCMcompromiso);


$NOTADEBITO=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.ano_orden_pago,b.numero_orden_pago,b.fecha_nota_debito,b.beneficiario FROM cstd09_notadebito_especial_partidas a,cstd09_notadebito_especial_cuerpo b
WHERE
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.tipo_documento=b.tipo_documento and
a.numero_documento=b.numero_documento and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_nota_debito ASC");

$this->set("NOTADEBITO",$NOTADEBITO);


//NOTA DE DEBITO NUEVO PROGRAMA

$NOTADEBITO_CA=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.fecha_debito,b.beneficiario FROM cstd09_notadebito_partidas a,cstd09_notadebito_cuerpo b
WHERE
b.condicion_actividad=1 and
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.numero_debito=b.numero_debito and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_debito ASC");

$this->set("NOTADEBITO_CA",$NOTADEBITO_CA);

// NOTA DE DEBITO del IVA y ISLR

$DEBITO=$this->cobd01_contratoobras_partidas->execute("SELECT a.*,b.fecha_debito,b.beneficiario FROM cstd30_debito_partidas a,cstd30_debito_cuerpo b
WHERE
b.condicion_actividad=1 and
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_movimiento=b.ano_movimiento and
a.cod_entidad_bancaria=b.cod_entidad_bancaria and
a.cod_sucursal=b.cod_sucursal and
a.cuenta_bancaria=b.cuenta_bancaria and
a.numero_debito=b.numero_debito and ".$con_a." and a.ano=".$Ano." and ".$condicion_a." ORDER BY a.cod_presi,a.cod_entidad,a.cod_tipo_inst,a.cod_inst,a.cod_dep,a.cod_sector,a.cod_programa,a.cod_sub_prog,a.cod_proyecto,a.cod_activ_obra,a.cod_partida,a.cod_generica,a.cod_especifica,a.cod_sub_espec,a.cod_auxiliar,b.fecha_debito ASC");

$this->set("DEBITO",$DEBITO);




}//fin analisis de presupuesto




function form_acta_anulacion(){
    $this->layout="ajax";
    $ano=$this->ano_ejecucion();
    $this->set('ano',$ano);
    $this->Session->write('ano_consulta_actaanul',$ano);
    $documentos=$this->cugd03_acta_anulacion_cuerpo->execute("select distinct tipo_operacion from cugd03_acta_anulacion_cuerpo");
    $i=-1;
    foreach($documentos as $x){$i=$i+1;
       //echo "<br>Tipo Operacion: ".$x[$i][0]['tipo_operacion'];
    }

    $array = array();
    for($j=0; $j<=$i; $j++){
        switch($documentos[$j][0]['tipo_operacion']){
                //case '5':   $array[$documentos[$j][0]['tipo_operacion']] = "hola 5"; break;
                case '231': $array[$documentos[$j][0]['tipo_operacion']] = "Registro de Compromiso"; break;
                case '232': $array[$documentos[$j][0]['tipo_operacion']] = "Ordenes de Compra"; break;
                case '233': $array[$documentos[$j][0]['tipo_operacion']] = "Contrato de Obras"; break;
                case '234': $array[$documentos[$j][0]['tipo_operacion']] = "Contrato de Servicio"; break;
                case '241': $array[$documentos[$j][0]['tipo_operacion']] = "Orden de Pago"; break;
                //case '242': $array[$documentos[$j][0]['tipo_operacion']] = "Anticipo Orden Compra"; break;
                //case '243': $array[$documentos[$j][0]['tipo_operacion']] = "Autorizacion Pago Orden de Compra"; break;
                //case '244': $array[$documentos[$j][0]['tipo_operacion']] = "Anticipo de Contrato de Obras"; break;
                //case '245': $array[$documentos[$j][0]['tipo_operacion']] = "Valuacion de Contrato de Obras"; break;
                //case '246': $array[$documentos[$j][0]['tipo_operacion']] = "Anticipo de Contrato de Servicio"; break;
                //case '247': $array[$documentos[$j][0]['tipo_operacion']] = "Valuacion de Contrato de Servicio"; break;
                case '251': $array[$documentos[$j][0]['tipo_operacion']] = "Cheque de Cancelaciones"; break;
                //case '261': $array[$documentos[$j][0]['tipo_operacion']] = "Deposito Movimientos Bancarios"; break;     //Deposito
                //case '262': $array[$documentos[$j][0]['tipo_operacion']] = "Nota Credito Movimientos Bancarios"; break; //Nota Credito
                //case '263': $array[$documentos[$j][0]['tipo_operacion']] = "Nota Debito Movimientos Bancarios"; break;  //Nota Debito
                //case '264': $array[$documentos[$j][0]['tipo_operacion']] = "Cheque Movimientos Bancarios"; break;       //Cheque
        }//Fin switch
    }
    $this->set('documentos',$array);
}//form_acta_anulacion

function select_tipodocumento_anulados($ano=null){
    $this->layout="ajax";
    if($ano!=null){
        $this->Session->write('ano_consulta_actaanul',$ano);
    }else{
        $this->Session->write('ano_consulta_actaanul',$this->ano_ejecucion());
    }
}

function firmantes_acta_anulacion($var=null){
    $this->layout="ajax";

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

  switch($var){
            case '231': //echo "Registro de Compromiso";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=231");
                        break;
            case '232': //echo "Ordenes de Compra";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=232");
                        break;
            case '233': //echo "Contrato de Obras";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=233");
                        break;
            case '234': //echo "Contrato de Servicio";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=234");
                        break;
            case '241': //echo "Orden de Pago";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=241");
                        break;
            case '251': //echo "Cheque de Cancelaciones (Tesoreria)";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=251");
                        break;
            case '100': //echo "Cheque de Cancelaciones (Tesoreria)";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=100");
                        break;
            case '101': //echo "Cheque de Cancelaciones (Tesoreria)";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=101");
                        break;
            case '102': //echo "Cheque de Cancelaciones (Tesoreria)";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=102");
                        break;
            case '1984':    //echo "reporte balance de ejecucion presupuestaria mes";
                        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=1984");
                        break;
             default: echo "Lo siento no contamos con informacion para este registro"; break;
    }//Fin switch

    if($firmantes!=null){
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
        $this->set('nombre_cuarta_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_cuarta_firma']);
        $this->set('cargo_cuarta_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_cuarta_firma']);
        $this->set('primera_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['primera_copia']);
        $this->set('segunda_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['segunda_copia']);
        $this->set('tercera_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['tercera_copia']);
        $this->set('cuarta_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cuarta_copia']);
        $this->set('quinta_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['quinta_copia']);
        $this->set('sexta_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['sexta_copia']);
        $this->set('septima_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['septima_copia']);
        $this->set('octava_copia',$firmantes[0]['cugd07_firmas_oficio_anulacion']['octava_copia']);
        $this->set('tipo_doc_anul',$var);
        $this->set('firma_existe','si');
    }else{
        $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','');
        $this->set('cargo_tercera_firma','');
        $this->set('nombre_cuarta_firma','');
        $this->set('cargo_cuarta_firma','');
        $this->set('primera_copia','');
        $this->set('segunda_copia','');
        $this->set('tercera_copia','');
        $this->set('cuarta_copia','');
        $this->set('quinta_copia','');
        $this->set('sexta_copia','');
        $this->set('septima_copia','');
        $this->set('octava_copia','');
        $this->set('tipo_doc_anul',$var);
        $this->set('firma_existe','no');
    }

}//firmantes_acta_anulacion

function modificar_firmas(){
    $this->layout="ajax";

    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];
    $nombre_cuarta_firma = $this->data['cugp03_acta_anulacion']['nombre_cuarta_firma'];
    $cargo_cuarta_firma  = $this->data['cugp03_acta_anulacion']['cargo_cuarta_firma'];

    $primera_cc = $this->data['cugp03_acta_anulacion']['primera_copia'];
    $segunda_cc = $this->data['cugp03_acta_anulacion']['segunda_copia'];
    $tercera_cc = $this->data['cugp03_acta_anulacion']['tercera_copia'];
    $cuarta_cc  = $this->data['cugp03_acta_anulacion']['cuarta_copia'];
    $quinta_cc  = $this->data['cugp03_acta_anulacion']['quinta_copia'];
    $sexta_cc   = $this->data['cugp03_acta_anulacion']['sexta_copia'];
    $septima_cc = $this->data['cugp03_acta_anulacion']['septima_copia'];
    $octava_cc  = $this->data['cugp03_acta_anulacion']['octava_copia'];

    $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$nombre_primera_firma', cargo_primera_firma='$cargo_primera_firma', nombre_segunda_firma='$nombre_segunda_firma', cargo_segunda_firma='$cargo_segunda_firma', nombre_tercera_firma='$nombre_tercera_firma', cargo_tercera_firma='$cargo_tercera_firma', nombre_cuarta_firma='$nombre_cuarta_firma', cargo_cuarta_firma='$cargo_cuarta_firma', primera_copia='$primera_cc', segunda_copia='$segunda_cc', tercera_copia='$tercera_cc', cuarta_copia='$cuarta_cc', quinta_copia='$quinta_cc', sexta_copia='$sexta_cc', septima_copia='$septima_cc', octava_copia='$octava_cc' WHERE ".$this->SQLCA()." and tipo_documento=".$tipo_doc_anul;
    $this->cugd07_firmas_oficio_anulacion->execute($update);

    $this->set('mensaje','Las firmas fuer&oacute;n modificadas correctamente');
    $this->firmantes_acta_anulacion($tipo_doc_anul);
    $this->render('firmantes_acta_anulacion');
}


function guardar_firmas_anulacion(){
    $this->layout="ajax";

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];
    $nombre_cuarta_firma = $this->data['cugp03_acta_anulacion']['nombre_cuarta_firma'];
    $cargo_cuarta_firma  = $this->data['cugp03_acta_anulacion']['cargo_cuarta_firma'];

    $primera_cc = $this->data['cugp03_acta_anulacion']['primera_copia'];
    $segunda_cc = $this->data['cugp03_acta_anulacion']['segunda_copia'];
    $tercera_cc = $this->data['cugp03_acta_anulacion']['tercera_copia'];
    $cuarta_cc  = $this->data['cugp03_acta_anulacion']['cuarta_copia'];
    $quinta_cc  = $this->data['cugp03_acta_anulacion']['quinta_copia'];
    $sexta_cc   = $this->data['cugp03_acta_anulacion']['sexta_copia'];
    $septima_cc = $this->data['cugp03_acta_anulacion']['septima_copia'];
    $octava_cc  = $this->data['cugp03_acta_anulacion']['octava_copia'];

    $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc_anul,'$nombre_primera_firma', '$cargo_primera_firma', '$nombre_segunda_firma', '$cargo_segunda_firma', '$nombre_tercera_firma', '$cargo_tercera_firma', '$nombre_cuarta_firma', '$cargo_cuarta_firma', '$primera_cc', '$segunda_cc', '$tercera_cc', '$cuarta_cc', '$quinta_cc', '$sexta_cc', '$septima_cc', '$octava_cc')";
    $this->cugd07_firmas_oficio_anulacion->execute($insert);

    $this->set('mensaje','Las firmas fuer&oacute;n registradas correctamente');
    $this->firmantes_acta_anulacion($tipo_doc_anul);
    $this->render('firmantes_acta_anulacion');
}

function firmas_balance_ejecucion_mes2(){
    $this->layout="ajax";

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];

    $primera_cc = isset($this->data['cugp03_acta_anulacion']['primera_copia'])?$this->data['cugp03_acta_anulacion']['primera_copia']:'';
    $segunda_cc = isset($this->data['cugp03_acta_anulacion']['segunda_copia'])?$this->data['cugp03_acta_anulacion']['segunda_copia']:'';
    $tercera_cc = isset($this->data['cugp03_acta_anulacion']['tercera_copia'])?$this->data['cugp03_acta_anulacion']['tercera_copia']:'';
    $cuarta_cc  = isset($this->data['cugp03_acta_anulacion']['cuarta_copia'])?$this->data['cugp03_acta_anulacion']['cuarta_copia']:'';
    $quinta_cc  = isset($this->data['cugp03_acta_anulacion']['quinta_copia'])?$this->data['cugp03_acta_anulacion']['quinta_copia']:'';
    $sexta_cc   = isset($this->data['cugp03_acta_anulacion']['sexta_copia'])?$this->data['cugp03_acta_anulacion']['sexta_copia']:'';
    $septima_cc = isset($this->data['cugp03_acta_anulacion']['septima_copia'])?$this->data['cugp03_acta_anulacion']['septima_copia']:'';
    $octava_cc  = isset($this->data['cugp03_acta_anulacion']['octava_copia'])?$this->data['cugp03_acta_anulacion']['octava_copia']:'';

    $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc_anul,'$nombre_primera_firma', '$cargo_primera_firma', '$nombre_segunda_firma', '$cargo_segunda_firma', '$nombre_tercera_firma', '$cargo_tercera_firma', '$primera_cc', '$segunda_cc', '$tercera_cc', '$cuarta_cc', '$quinta_cc', '$sexta_cc', '$septima_cc', '$octava_cc')";
    $this->cugd07_firmas_oficio_anulacion->execute($insert);

    $this->set('mensaje','Las firmas fuer&oacute;n registradas correctamente');
    $this->firmantes_acta_anulacion($tipo_doc_anul);
    //$this->render('firmantes_acta_anulacion');
}

function modificar_firmas_balance_mes(){
    $this->layout="ajax";

    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];

    $primera_cc = isset($this->data['cugp03_acta_anulacion']['primera_copia'])?$this->data['cugp03_acta_anulacion']['primera_copia']:'';
    $segunda_cc = isset($this->data['cugp03_acta_anulacion']['segunda_copia'])?$this->data['cugp03_acta_anulacion']['segunda_copia']:'';
    $tercera_cc = isset($this->data['cugp03_acta_anulacion']['tercera_copia'])?$this->data['cugp03_acta_anulacion']['tercera_copia']:'';
    $cuarta_cc  = isset($this->data['cugp03_acta_anulacion']['cuarta_copia'])?$this->data['cugp03_acta_anulacion']['cuarta_copia']:'';
    $quinta_cc  = isset($this->data['cugp03_acta_anulacion']['quinta_copia'])?$this->data['cugp03_acta_anulacion']['quinta_copia']:'';
    $sexta_cc   = isset($this->data['cugp03_acta_anulacion']['sexta_copia'])?$this->data['cugp03_acta_anulacion']['sexta_copia']:'';
    $septima_cc = isset($this->data['cugp03_acta_anulacion']['septima_copia'])?$this->data['cugp03_acta_anulacion']['septima_copia']:'';
    $octava_cc  = isset($this->data['cugp03_acta_anulacion']['octava_copia'])?$this->data['cugp03_acta_anulacion']['octava_copia']:'';


    $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$nombre_primera_firma', cargo_primera_firma='$cargo_primera_firma', nombre_segunda_firma='$nombre_segunda_firma', cargo_segunda_firma='$cargo_segunda_firma', nombre_tercera_firma='$nombre_tercera_firma', cargo_tercera_firma='$cargo_tercera_firma', primera_copia='$primera_cc', segunda_copia='$segunda_cc', tercera_copia='$tercera_cc', cuarta_copia='$cuarta_cc', quinta_copia='$quinta_cc', sexta_copia='$sexta_cc', septima_copia='$septima_cc', octava_copia='$octava_cc' WHERE ".$this->SQLCA()." and tipo_documento=".$tipo_doc_anul;
    $this->cugd07_firmas_oficio_anulacion->execute($update);

    $this->set('mensaje','Las firmas fuer&oacute;n modificadas correctamente');
    $this->firmantes_acta_anulacion($tipo_doc_anul);
    $this->render('firmas_balance_ejecucion_mes2');
}

function reporte_acta_anulacion(){
    $this->layout="pdf";
    $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    $this->set('titulo_a',$this->Session->read('dependencia'));

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    if(empty($this->data['cugp03_acta_anulacion']['tipo_operacion'])){
        //Lo siento llego vacio";
        echo'<script>history.back(1);</script>';

    }else{
           if(isset($this->data['cugp03_acta_anulacion']['ano']) && !empty($this->data['cugp03_acta_anulacion']['ano'])){
                $ano=$this->data['cugp03_acta_anulacion']['ano'];
           }else{
                $ano=$this->ano_ejecucion();
           }

          switch($this->data['cugp03_acta_anulacion']['tipo_operacion']){
                case '5':   echo "hola 5";

                            break;


                case '231': //echo "Registro de Compromiso";
                       if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                           $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                           $busqueda=" and b.numero_documento='$b'";
                           $busqueda_n=" and numero_documento='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $RC="SELECT a.*,
                            b.beneficiario,
                            b.rif,
                            b.cedula_identidad as cedula,
                            b.numero_documento,
                            0::int4 as numero_documento_adjunto,
                            b.fecha_documento,
                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cepd01_compromiso_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.condicion_actividad=2".$busqueda;

                            $filas=$this->cepd01_compromiso_cuerpo->findCount($this->SQLCA()." and condicion_actividad=2 and ano_documento=".$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=231");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Registro de Compromiso");
                            break;

                case '232': //echo "Ordenes de Compra";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_orden_compra='$b'";
                           $busqueda_n=" and numero_orden_compra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            b.razon_social as beneficiario,
                            b.rif,
                            0::int4 as cedula,
                            b.numero_orden_compra,
                            0::int4 as numero_documento_adjunto,
                            b.fecha_orden_compra,
                            b.ano_orden_compra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, v_cscd04_ordencompra_completa b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano."  and b.ano_orden_compra=".$ano." and
                            a.numero_documento::int4    = b.numero_orden_compra::int4   and
                            a.tipo_operacion=232 and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->v_cscd04_ordencompra_completa->findCount($this->SQLCA().' and condicion_actividad=2 and ano_orden_compra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=232");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Orden de Compra");
                            break;


                case '233': //echo "Contrato de Obras";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_obra='$b'";
                           $busqueda_n=" and numero_contrato_obra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=upper(b.rif)) as beneficiario,
                            b.rif,
                            0::int4 as cedula,
                            b.numero_contrato_obra,
                            0::int4 as numero_documento_adjunto,
                            b.fecha_contrato_obra,
                            b.ano_contrato_obra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cobd01_contratoobras_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::varchar(30) = b.numero_contrato_obra::varchar(30)   and
                            a.tipo_operacion=233 and a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cobd01_contratoobras_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_obra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=233");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Contrato de Obras");
                            break;


                case '234': //echo "Contrato de Servicio";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_servicio='$b'";
                           $busqueda_n=" and numero_contrato_servicio='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=upper(b.rif)) as beneficiario,
                            b.rif,
                            0::int4 as cedula,
                            b.numero_contrato_servicio,
                            0::int4 as numero_documento_adjunto,
                            b.fecha_contrato_servicio,
                            b.ano_contrato_servicio,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cepd02_contratoservicio_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::varchar(30) = b.numero_contrato_servicio::varchar(30)   and
                            a.tipo_operacion=234 and a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cepd02_contratoservicio_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_servicio='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=234");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Contrato de Obras");
                            break;


                case '241': //echo "Orden de Pago";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_orden_pago='$b'";
                           $busqueda_n=" and numero_orden_pago='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $RC="SELECT a.*,
                            b.beneficiario,
                            b.rif,
                            b.cedula_identidad as cedula,
                            b.numero_orden_pago as numero_documento,
                            b.numero_documento_origen as numero_documento_origen,
                            b.numero_documento_adjunto,
                            b.fecha_orden_pago as fecha_documento,
                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cepd03_ordenpago_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=$ano and b.ano_orden_pago=$ano and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cepd03_ordenpago_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_orden_pago='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=241");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Orden Pago");
                            //echo $RC;
                            break;


                case '242': //echo "Anticipo Orden Compra";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_orden_compra='$b'";
                           $busqueda_n=" and numero_orden_compra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                          $RC="SELECT a.*,
                            (select v.razon_social from v_cscd04_ordencompra_completa v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_orden_compra=b.ano_orden_compra and v.numero_orden_compra=b.numero_orden_compra) as beneficiario,
                            (select v.rif from v_cscd04_ordencompra_completa v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_orden_compra=b.ano_orden_compra and v.numero_orden_compra=b.numero_orden_compra) as rif,
                            0::int4 as cedula,
                            b.numero_orden_compra,
                            b.numero_anticipo as numero_documento_adjunto,
                            b.fecha_anticipo,
                            b.ano_orden_compra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cscd04_ordencompra_anticipo_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::int4    = b.numero_orden_compra::int4   and
                            a.tipo_operacion=242 and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cscd04_ordencompra_anticipo_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_orden_compra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Anticipo Orden Compra");
                            break;


                case '243': //echo "Autorizacion Pago Orden de Compra";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_orden_compra='$b'";
                          $busqueda_n=" and numero_orden_compra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            (select v.razon_social from v_cscd04_ordencompra_completa v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_orden_compra=b.ano_orden_compra and v.numero_orden_compra=b.numero_orden_compra) as beneficiario,
                            (select v.rif from v_cscd04_ordencompra_completa v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_orden_compra=b.ano_orden_compra and v.numero_orden_compra=b.numero_orden_compra) as rif,
                            0::int4 as cedula,
                            b.numero_orden_compra,
                            b.numero_pago as numero_documento_adjunto,
                            b.fecha_autorizacion,
                            b.ano_orden_compra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cscd04_ordencompra_autorizacion_pago_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::int4    = b.numero_orden_compra::int4   and
                            a.tipo_operacion=243 and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cscd04_ordencompra_autorizacion_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_orden_compra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Autorizacion Pago Orden de Compra");
                            break;


                case '244': //echo "Anticipo de Contrato de Obras";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_obra='$b'";
                           $busqueda_n=" and numero_contrato_obra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=(select v.rif from cobd01_contratoobras_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_obra=b.ano_contrato_obra and v.numero_contrato_obra=b.numero_contrato_obra)) as beneficiario,
                            (select v.rif from cobd01_contratoobras_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_obra=b.ano_contrato_obra and v.numero_contrato_obra=b.numero_contrato_obra) as rif,
                            0::int4 as cedula,
                            b.numero_contrato_obra,
                            b.numero_anticipo as numero_documento_adjunto,
                            b.fecha_anticipo,
                            b.ano_contrato_obra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cobd01_contratoobras_anticipo_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::varchar(30) = b.numero_contrato_obra::varchar(30)   and
                            a.tipo_operacion=244 and a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cobd01_contratoobras_anticipo_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_obra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Anticipo de Contrato de Obras");
                            break;


                case '245': //echo "Valuacion de Contrato de Obras";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_obra='$b'";
                           $busqueda_n=" and numero_contrato_obra='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=(select v.rif from cobd01_contratoobras_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_obra=b.ano_contrato_obra and v.numero_contrato_obra=b.numero_contrato_obra)) as beneficiario,
                            (select v.rif from cobd01_contratoobras_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_obra=b.ano_contrato_obra and v.numero_contrato_obra=b.numero_contrato_obra) as rif,
                            0::int4 as cedula,
                            b.numero_contrato_obra as numero_documento,
                            b.numero_valuacion as numero_documento_adjunto,
                            b.fecha_valuacion,
                            b.ano_contrato_obra,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cobd01_contratoobras_valuacion_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and

                            a.tipo_operacion=245 and a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cobd01_contratoobras_valuacion_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_obra='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Valuacion de Contrato de Obras");
                            break;


                case '246': //echo "Anticipo de Contrato de Servicio";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_servicio='$b'";
                           $busqueda_n=" and numero_contrato_servicio='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=(select v.rif from cepd02_contratoservicio_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_servicio=b.ano_contrato_servicio  and v.numero_contrato_servicio=b.numero_contrato_servicio)) as beneficiario,
                            (select v.rif from cepd02_contratoservicio_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_servicio=b.ano_contrato_servicio and v.numero_contrato_servicio=b.numero_contrato_servicio) as rif,
                            0::int4 as cedula,
                            b.numero_contrato_servicio,
                            b.numero_anticipo as numero_documento_adjunto,
                            b.fecha_anticipo,
                            b.ano_contrato_servicio,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cepd02_contratoservicio_anticipo_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_documento::varchar(30) = b.numero_contrato_servicio::varchar(30)   and
                            a.tipo_operacion=246 and a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cepd02_contratoservicio_anticipo_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_servicio='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Anticipo de Contrato de Servicio");

                            break;
                case '247': //echo "Valuacion de Contrato de Servicio";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_contrato_servicio='$b'";
                           $busqueda_n=" and numero_contrato_servicio='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                           $RC="SELECT a.*,
                            (select denominacion from cpcd02 where upper(rif)=(select v.rif from cepd02_contratoservicio_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_servicio=b.ano_contrato_servicio and v.numero_contrato_servicio=b.numero_contrato_servicio)) as beneficiario,
                            (select v.rif from cepd02_contratoservicio_cuerpo v where v.cod_presi=a.cod_presi and v.cod_entidad=a.cod_entidad and v.cod_tipo_inst=a.cod_tipo_inst and v.cod_inst=a.cod_inst and v.cod_dep=a.cod_dep and v.ano_contrato_servicio=b.ano_contrato_servicio and v.numero_contrato_servicio=b.numero_contrato_servicio) as rif,
                            0::int4 as cedula,
                            b.numero_contrato_servicio as numero_documento,
                            b.numero_valuacion as numero_documento_adjunto,
                            b.fecha_valuacion,
                            b.ano_contrato_servicio,
                            b.fecha_proceso_anulacion
                            FROM cugd03_acta_anulacion_cuerpo a, cepd02_contratoservicio_valuacion_cuerpo b
                            WHERE
                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and
                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = substr(b.fecha_proceso_anulacion::text,0, 5)::int4 and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion=b.numero_anulacion and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cepd02_contratoservicio_valuacion_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_contrato_servicio='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($RC);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"Valuacion de Contrato de Servicio");
                            break;


                case '251': //echo "Cheque de Cancelaciones";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_cheque='$b'";
                           $busqueda_n=" and numero_cheque='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $cheques="select
                            a.cod_presi,
                            a.cod_entidad,
                            a.cod_tipo_inst,
                            a.cod_inst,
                            a.cod_dep,

                            a.ano_acta_anulacion,
                            a.numero_acta_anulacion,
                            a.tipo_operacion,
                            a.ano_documento,
                            a.numero_documento,
                            a.fecha_documento,
                            a.motivo_anulacion,

                            b.beneficiario,
                            b.rif_cedula,
                            b.numero_cheque,
                            b.fecha_cheque,
                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion

                            from cugd03_acta_anulacion_cuerpo a, cstd03_cheque_cuerpo b
                            where

                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst      = b.cod_inst        and
                            a.cod_dep       = b.cod_dep     and

                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.condicion_actividad=2".$busqueda;
                            $filas=$this->cstd03_cheque_cuerpo->findCount($this->SQLCA().' and condicion_actividad=2 and ano_movimiento='.$ano.$busqueda_n);
                            $datos=$this->cugd03_acta_anulacion_cuerpo->execute($cheques);
                            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=251");
                            $this->set('firmas',$firmantes);
                            $this->set('filas',$filas);
                            $this->set('datos',$datos);
                            $this->set('tipo_documento',"cheque de cancelaciones");
                            break;//cheques cancelaciones. (Tesoreria)


                case '261': //echo "Deposito Movimientos Bancarios";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_documento='$b'";
                           $busqueda_n=" and numero_documento='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $mov_manuales="select
                            a.cod_presi,
                            a.cod_entidad,
                            a.cod_tipo_inst,
                            a.cod_inst,
                            a.cod_dep,

                            a.ano_acta_anulacion,
                            a.numero_acta_anulacion,
                            a.tipo_operacion,
                            a.ano_documento,
                            a.numero_documento,
                            a.fecha_documento,
                            a.motivo_anulacion,

                            b.cod_presi,
                            b.cod_entidad,
                            b.cod_tipo_inst,
                            b.cod_inst,
                            b.cod_dep,

                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion,
                            b.beneficiario,
                            b.numero_documento,
                            b.fecha_documento

                            from cugd03_acta_anulacion_cuerpo a, cstd03_movimientos_manuales b
                            where

                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst  = b.cod_inst        and
                            a.cod_dep   = b.cod_dep     and

                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.tipo_documento=1  and
                            b.condicion_actividad=2".$busqueda;

                            $filas_mov_manuales=$this->cstd03_movimientos_manuales->findCount($this->SQLCA().' and condicion_actividad=2 and tipo_documento=1 and ano_movimiento='.$ano.$busqueda_n);
                            $datos_mov_manuales=$this->cugd03_acta_anulacion_cuerpo->execute($mov_manuales);
                            $this->set('filas_mov_manuales',$filas_mov_manuales);
                            $this->set('datos_mov_manuales',$datos_mov_manuales);
                            $this->set('tipo_documento',"deposito movimientos bancarios");
                            break; //Deposito


                case '262': //echo "Nota Credito Movimientos Bancarios";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_documento='$b'";
                           $busqueda_n=" and numero_documento='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $mov_manuales="select
                            a.cod_presi,
                            a.cod_entidad,
                            a.cod_tipo_inst,
                            a.cod_inst,
                            a.cod_dep,

                            a.ano_acta_anulacion,
                            a.numero_acta_anulacion,
                            a.tipo_operacion,
                            a.ano_documento,
                            a.numero_documento,
                            a.fecha_documento,
                            a.motivo_anulacion,

                            b.cod_presi,
                            b.cod_entidad,
                            b.cod_tipo_inst,
                            b.cod_inst,
                            b.cod_dep,

                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion,
                            b.beneficiario,
                            b.numero_documento,
                            b.fecha_documento

                            from cugd03_acta_anulacion_cuerpo a, cstd03_movimientos_manuales b
                            where

                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst  = b.cod_inst        and
                            a.cod_dep   = b.cod_dep     and

                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and

                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            b.tipo_documento=2    and
                            b.condicion_actividad=2".$busqueda;

                            $filas_mov_manuales=$this->cstd03_movimientos_manuales->findCount($this->SQLCA().' and condicion_actividad=2 and tipo_documento=2 and ano_movimiento='.$ano.$busqueda_n);
                            $datos_mov_manuales=$this->cugd03_acta_anulacion_cuerpo->execute($mov_manuales);
                            $this->set('filas_mov_manuales',$filas_mov_manuales);
                            $this->set('datos_mov_manuales',$datos_mov_manuales);
                            $this->set('tipo_documento',"nota de credito movimientos bancarios");
                            break; //Nota Credito



                case '263': //echo "Nota Debito Movimientos Bancarios";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_documento='$b'";
                           $busqueda_n=" and numero_documento='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $mov_manuales="select
                            a.cod_presi,
                            a.cod_entidad,
                            a.cod_tipo_inst,
                            a.cod_inst,
                            a.cod_dep,

                            a.ano_acta_anulacion,
                            a.numero_acta_anulacion,
                            a.tipo_operacion,
                            a.ano_documento,
                            a.numero_documento,
                            a.fecha_documento,
                            a.motivo_anulacion,

                            b.cod_presi,
                            b.cod_entidad,
                            b.cod_tipo_inst,
                            b.cod_inst,
                            b.cod_dep,

                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion,
                            b.beneficiario,
                            b.numero_documento,
                            b.fecha_documento

                            from cugd03_acta_anulacion_cuerpo a, cstd03_movimientos_manuales b
                            where

                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst  = b.cod_inst        and
                            a.cod_dep   = b.cod_dep     and

                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.tipo_documento=3  and
                            b.condicion_actividad=2".$busqueda;

                            $filas_mov_manuales=$this->cstd03_movimientos_manuales->findCount($this->SQLCA().' and condicion_actividad=2 and tipo_documento=3 and ano_movimiento='.$ano.$busqueda_n);
                            $datos_mov_manuales=$this->cugd03_acta_anulacion_cuerpo->execute($mov_manuales);
                            $this->set('filas_mov_manuales',$filas_mov_manuales);
                            $this->set('datos_mov_manuales',$datos_mov_manuales);
                            $this->set('tipo_documento',"nota de debito movimientos bancarios");
                            break; //Nota Debito



                case '264': //echo "Cheque Movimientos Bancarios";
                          if(isset($this->data['cugp03_acta_anulacion']['codigo_busqueda']) && !empty($this->data['cugp03_acta_anulacion']['codigo_busqueda'])){
                             $b=$this->data['cugp03_acta_anulacion']['codigo_busqueda'];
                             $busqueda=" and b.numero_documento='$b'";
                          $busqueda_n=" and numero_documento='$b'";
                       }else{
                           $busqueda="";
                           $busqueda_n="";
                       }
                            $mov_manuales="select
                            a.cod_presi,
                            a.cod_entidad,
                            a.cod_tipo_inst,
                            a.cod_inst,
                            a.cod_dep,

                            a.ano_acta_anulacion,
                            a.numero_acta_anulacion,
                            a.tipo_operacion,
                            a.ano_documento,
                            a.numero_documento,
                            a.fecha_documento,
                            a.motivo_anulacion,

                            b.cod_presi,
                            b.cod_entidad,
                            b.cod_tipo_inst,
                            b.cod_inst,
                            b.cod_dep,

                            b.ano_anulacion,
                            b.numero_anulacion,
                            b.fecha_proceso_anulacion,
                            b.beneficiario,
                            b.numero_documento,
                            b.fecha_documento

                            from cugd03_acta_anulacion_cuerpo a, cstd03_movimientos_manuales b
                            where

                            a.cod_presi     = b.cod_presi       and
                            a.cod_entidad   = b.cod_entidad     and
                            a.cod_tipo_inst = b.cod_tipo_inst   and
                            a.cod_inst  = b.cod_inst        and
                            a.cod_dep   = b.cod_dep     and

                            a.cod_presi      = '$cp'  and
                            a.cod_entidad    = '$ce'  and
                            a.cod_tipo_inst  = '$cti' and
                            a.cod_inst       = '$ci'  and
                            a.cod_dep        = '$cd'  and
                            a.ano_acta_anulacion    = b.ano_anulacion and a.ano_acta_anulacion=".$ano." and
                            a.numero_acta_anulacion = b.numero_anulacion    and
                            b.tipo_documento=4  and
                            b.condicion_actividad=2".$busqueda;

                            $filas_mov_manuales=$this->cstd03_movimientos_manuales->findCount($this->SQLCA().' and condicion_actividad=2 and tipo_documento=4 and ano_movimiento='.$ano.$busqueda_n);
                            $datos_mov_manuales=$this->cugd03_acta_anulacion_cuerpo->execute($mov_manuales);
                            $this->set('filas_mov_manuales',$filas_mov_manuales);
                            $this->set('datos_mov_manuales',$datos_mov_manuales);
                            $this->set('tipo_documento',"cheque movimientos bancarios");
                            break; //Cheque


                     default: echo "Lo siento no contamos con informacion para este registro"; break;
          }//Fin switch

            // Busqueda de la denominacion del municipio por defecto.
            //$cp = $this->verifica_SS(1);
            //$ce = $this->verifica_SS(2);
            //$cti= $this->verifica_SS(3);
            //$ci = $this->verifica_SS(4);
            //$cd = $this->verifica_SS(5);
            $mun_defecto=$this->cugd90_municipio_defecto->findAll($this->SQLCA());
            if(count($mun_defecto) != 0){
                $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
                $cod_estado    = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
                $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];
                $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion, conocido');
                $this->set("denominacion_municipo", "EN ".$municipio[0]['cugd01_municipios']['conocido']);
            }else{
                $this->set("denominacion_municipo","");
            }

    }//Fin if tipo_operacion vacio.

    $this->set('tipo_operacion',$this->data['cugp03_acta_anulacion']['tipo_operacion']);
}//reporte_acta_anulacion



function seleccion_acta_anulacion($var=null){
    $this->layout="ajax";
    $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    $this->set('titulo_a',$this->Session->read('dependencia'));

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    if(isset($var)){
           $ano_session = $this->Session->read('ano_consulta_actaanul');
           if(isset($ano_session) && $ano_session!=''){
               $ano = $ano_session;
           }else{
                $ano =$this->ano_ejecucion();
           }

          switch($var){
                case '231': //echo "Registro de Compromiso";
                            $lista=  $this->cepd01_compromiso_cuerpo->generateList($this->SQLCA()." and ano_documento='$ano' and condicion_actividad=2", 'numero_documento ASC', null, '{n}.cepd01_compromiso_cuerpo.numero_documento', '{n}.cepd01_compromiso_cuerpo.numero_documento');
                            $this->set("lista",$lista);
                            break;
                case '232': //echo "Ordenes de Compra";
                          $lista=  $this->v_cscd04_ordencompra_completa->generateList($this->SQLCA()." and ano_orden_compra='$ano' and condicion_actividad=2", 'numero_orden_compra ASC', null, '{n}.v_cscd04_ordencompra_completa.numero_orden_compra', '{n}.v_cscd04_ordencompra_completa.numero_orden_compra');
                          $this->set("lista",$lista);
                          break;
                case '233': //echo "Contrato de Obras";
                          $lista=  $this->cobd01_contratoobras_cuerpo->generateList($this->SQLCA()." and ano_contrato_obra='$ano' and condicion_actividad=2", 'numero_contrato_obra ASC', null, '{n}.cobd01_contratoobras_cuerpo.numero_contrato_obra', '{n}.cobd01_contratoobras_cuerpo.numero_contrato_obra');
                          $this->set("lista",$lista);
                          break;
                case '234': //echo "Contrato de Servicio";
                          $lista=  $this->cepd02_contratoservicio_cuerpo->generateList($this->SQLCA()." and ano_contrato_servicio='$ano' and condicion_actividad=2", 'numero_contrato_servicio ASC', null, '{n}.cepd02_contratoservicio_cuerpo.numero_contrato_servicio', '{n}.cepd02_contratoservicio_cuerpo.numero_contrato_servicio');
                          $this->set("lista",$lista);
                          break;
                case '241': //echo "Orden de Pago";
                          $lista=  $this->cepd03_ordenpago_cuerpo->generateList($this->SQLCA()." and ano_orden_pago='$ano' and condicion_actividad=2", 'numero_orden_pago ASC', null, '{n}.cepd03_ordenpago_cuerpo.numero_orden_pago', '{n}.cepd03_ordenpago_cuerpo.numero_orden_pago');
                          $this->set("lista",$lista);
                          break;
                case '242': //echo "Anticipo Orden Compra";
                          $lista=  $this->cscd04_ordencompra_anticipo_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_orden_compra ASC', null, '{n}.cscd04_ordencompra_anticipo_cuerpo.numero_orden_compra', '{n}.cscd04_ordencompra_anticipo_cuerpo.numero_orden_compra');
                          $this->set("lista",$lista);
                          break;
                case '243': //echo "Autorizacion Pago Orden de Compra";
                          $lista=  $this->cscd04_ordencompra_autorizacion_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_orden_compra ASC', null, '{n}.cscd04_ordencompra_autorizacion_cuerpo.numero_orden_compra', '{n}.cscd04_ordencompra_autorizacion_cuerpo.numero_orden_compra');
                          $this->set("lista",$lista);
                          break;
                case '244': //echo "Anticipo de Contrato de Obras";
                          $lista=  $this->cobd01_contratoobras_anticipo_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_contrato_obra ASC', null, '{n}.cobd01_contratoobras_anticipo_cuerpo.numero_contrato_obra', '{n}.cobd01_contratoobras_anticipo_cuerpo.numero_contrato_obra');
                          $this->set("lista",$lista);
                          break;
                case '245': //echo "Valuacion de Contrato de Obras";
                          $lista=  $this->cobd01_contratoobras_valuacion_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_contrato_obra ASC', null, '{n}.cobd01_contratoobras_valuacion_cuerpo.numero_contrato_obra', '{n}.cobd01_contratoobras_valuacion_cuerpo.numero_contrato_obra');
                          $this->set("lista",$lista);
                          break;
                case '246': //echo "Anticipo de Contrato de Servicio";
                          $lista=  $this->cepd02_contratoservicio_anticipo_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_contrato_servicio ASC', null, '{n}.cepd02_contratoservicio_anticipo_cuerpo.numero_contrato_servicio', '{n}.cepd02_contratoservicio_anticipo_cuerpo.numero_contrato_servicio');
                          $this->set("lista",$lista);
                          break;
                case '247': //echo "Valuacion de Contrato de Servicio";
                          $lista=  $this->cepd02_contratoservicio_valuacion_cuerpo->generateList($this->SQLCA()." and condicion_actividad=2", 'numero_contrato_servicio ASC', null, '{n}.cepd02_contratoservicio_valuacion_cuerpo.numero_contrato_servicio', '{n}.cepd02_contratoservicio_valuacion_cuerpo.numero_contrato_servicio');
                          $this->set("lista",$lista);
                          break;
                case '251': //echo "Cheque de Cancelaciones";
                          $lista=  $this->cstd03_cheque_cuerpo->generateList($this->SQLCA()." and ano_movimiento='$ano' and condicion_actividad=2", 'numero_cheque ASC', null, '{n}.cstd03_cheque_cuerpo.numero_cheque', '{n}.cstd03_cheque_cuerpo.numero_cheque');
                          $this->set("lista",$lista);
                          break;//cheques cancelaciones. (Tesoreria)
                case '261': //echo "Deposito Movimientos Bancarios";
                          $lista=  $this->cstd03_movimientos_manuales->generateList($this->SQLCA()." and condicion_actividad=2 and tipo_documento=1", 'numero_documento ASC', null, '{n}.cstd03_movimientos_manuales.numero_documento', '{n}.cstd03_movimientos_manuales.numero_documento');
                          $this->set("lista",$lista);
                          break; //Deposito
                case '262': //echo "Nota Credito Movimientos Bancarios";
                          $lista=  $this->cstd03_movimientos_manuales->generateList($this->SQLCA()." and condicion_actividad=2 and tipo_documento=2", 'numero_documento ASC', null, '{n}.cstd03_movimientos_manuales.numero_documento', '{n}.cstd03_movimientos_manuales.numero_documento');
                          $this->set("lista",$lista);
                          break; //Nota Credito
                case '263': //echo "Nota Debito Movimientos Bancarios";
                          $lista=  $this->cstd03_movimientos_manuales->generateList($this->SQLCA()." and condicion_actividad=2 and tipo_documento=3", 'numero_documento ASC', null, '{n}.cstd03_movimientos_manuales.numero_documento', '{n}.cstd03_movimientos_manuales.numero_documento');
                          $this->set("lista",$lista);
                          break; //Nota Debito
                case '264': //echo "Cheque Movimientos Bancarios";
                          $lista=  $this->cstd03_movimientos_manuales->generateList($this->SQLCA()." and condicion_actividad=2 and tipo_documento=4", 'numero_documento ASC', null, '{n}.cstd03_movimientos_manuales.numero_documento', '{n}.cstd03_movimientos_manuales.numero_documento');
                          $this->set("lista",$lista);
                          break; //Cheque
                 default: echo "Lo siento no contamos con informacion para este registro"; break;
          }//Fin switch
    }//Fin if tipo_operacion vacio.

    $this->set('tipo_operacion',$this->data['cugp03_acta_anulacion']['tipo_operacion']);
}//seleccion numeros anulacion




function reporte_relacion_ordenes_pago($ir=null){
    $this->layout="ajax";
    if($ir!=null){
        if($ir=='si'){//va al formulario
          $this->set('ano',$ano=$this->ano_ejecucion());
           $_SESSION['ano_orden_de_pago'] = $this->ano_ejecucion();
          $this->set('ir','si');
        }elseif($ir=='no'){//no va al formulario, va al reporte

        $condicion=$this->SQLCA()." and ano_orden_pago=".$this->data['relacion_ordenpago']['ano'];
        $this->data['relacion_ordenpago']['estilo_reporte'];
        $this->data['relacion_ordenpago']['opcionfecha'];

        $condicion_actividad = $this->data['relacion_ordenpago']['condicion_actividad'];// 1:Todo,     2:Activas,    3:Anuladas.
        if($condicion_actividad==1){
            $cond_actividad = " and (condicion_actividad=1 or condicion_actividad=2)";
        }elseif($condicion_actividad==2){
            $cond_actividad = " and condicion_actividad=1";
        }elseif($condicion_actividad==3){
            $cond_actividad = " and condicion_actividad=2";
        }

                if($this->data['relacion_ordenpago']['opcionfecha']==1){
                      if($this->data['relacion_ordenpago']['estilo_reporte']==1){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion.$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'numero_orden_pago ASC');
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==2){
                         $beneficiario = strtoupper($this->data['relacion_ordenpago']['beneficiarios']);
                         if(is_int($beneficiario)){
                           $cedula=$beneficiario;
                           $cond=$condicion." and cedula_identidad=$cedula";
                         }else{
                            $cedula=0;
                            $cond=$condicion." and upper(rif)='$beneficiario'";
                         }
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($cond.$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'numero_orden_pago ASC');
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','('.$beneficiario.')');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==3){
                         $tipopago = $this->data['relacion_ordenpago']['tipopago'];
                         $cond=$condicion." and cod_tipo_pago='$tipopago'";
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($cond.$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'beneficiario, fecha_orden_pago, numero_orden_pago ASC');
                         $denotipopago=$this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago='.$tipopago);
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','('.$denotipopago[0]['cepd03_ordenpago_tipopago']['denominacion'].')');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==4){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion.$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'numero_orden_pago ASC');
                         $tipopago=$this->cepd03_ordenpago_tipopago->findAll();
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','');
                         $this->set('tipopago',$tipopago);
                         $this->set('seguntipo','si');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==5){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion.' and numero_cheque=0'.$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'numero_orden_pago ASC');
                         $tipopago=$this->cepd03_ordenpago_tipopago->findAll();
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','(ORDENES SIN CHEQUE)');
                         $this->set('tipopago',$tipopago);
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==6){
                        $fecha_inicial = $this->data['relacion_ordenpago']['fecha_inicial'];
                        $fecha_final = $this->data['relacion_ordenpago']['fecha_final'];
                        $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                        $this->set('datos',$datos);
                        $this->set('ir','no');
                        $this->set('subtituloreporte','(ordenes emitidas del '.$fecha_inicial.' al '.$fecha_final.')');
                      }
                }elseif($this->data['relacion_ordenpago']['opcionfecha']==2){
                      $fecha_inicial = $this->data['relacion_ordenpago']['fecha_inicial'];
                      $fecha_final   = $this->data['relacion_ordenpago']['fecha_final'];

                      if($this->data['relacion_ordenpago']['estilo_reporte']==1){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==2){
                         $beneficiario = strtoupper($this->data['relacion_ordenpago']['beneficiarios']);
                         if(is_int($beneficiario)){
                           $cedula=$beneficiario;
                           $cond=$condicion." and cedula_identidad=$cedula";
                         }else{
                            $cedula=0;
                            $cond=$condicion." and upper(rif)='$beneficiario'";
                         }
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($cond." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','('.$beneficiario.')');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==3){
                         $tipopago = $this->data['relacion_ordenpago']['tipopago'];
                         $cond=$condicion." and cod_tipo_pago='$tipopago'";
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($cond." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'beneficiario, fecha_orden_pago, numero_orden_pago ASC');
                         $denotipopago=$this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago='.$tipopago);
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','('.$denotipopago[0]['cepd03_ordenpago_tipopago']['denominacion'].')');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==4){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                         $tipopago=$this->cepd03_ordenpago_tipopago->findAll();
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','');
                         $this->set('tipopago',$tipopago);
                         $this->set('seguntipo','si');
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==5){
                         $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion." and numero_cheque=0 and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                         $tipopago=$this->cepd03_ordenpago_tipopago->findAll();
                         $this->set('datos',$datos);
                         $this->set('ir','no');
                         $this->set('subtituloreporte','(ORDENES SIN CHEQUE)');
                         $this->set('tipopago',$tipopago);
                      }elseif($this->data['relacion_ordenpago']['estilo_reporte']==6){
                        $datos=$this->cepd03_ordenpago_cuerpo->findAll($condicion." and fecha_orden_pago BETWEEN '$fecha_inicial' AND '$fecha_final'".$cond_actividad,array('numero_orden_pago','condicion_actividad','cod_tipo_pago','fecha_orden_pago','beneficiario','monto_orden_pago','cuenta_bancaria','numero_cheque','fecha_cheque','fecha_proceso_anulacion'), 'fecha_orden_pago, numero_orden_pago ASC');
                        $this->set('datos',$datos);
                        $this->set('ir','no');
                        $this->set('subtituloreporte','(ordenes emitidas del '.$fecha_inicial.' al '.$fecha_final.')');
                      }

                }


        }
    }
}//reporte_relacion_ordenes_pago


function distinct_beneficiarios_ordenes_pago($var=null){
    $this->layout="ajax";
    $array = array();
    if(isset($_SESSION['ano_orden_de_pago'])){$year=$_SESSION['ano_orden_de_pago'];}else{$year=$this->ano_ejecucion();}

    if($var==1){
        $this->set('var',$var);
    }else if($var==2){
        $this->set('beneficiarios',$array);
        $this->set('var',$var);
    }else if($var==3){
        $tipopago = $this->cepd03_ordenpago_tipopago->generateList(null, $order = 'denominacion ASC', $limit = null, '{n}.cepd03_ordenpago_tipopago.cod_tipo_pago', '{n}.cepd03_ordenpago_tipopago.denominacion');
        $this->concatena_tres_digitos($tipopago,'tipopago');

        $this->set('var',$var);
    }else if($var==4){
        $this->set('var',$var);
    }else if($var==5){
        $this->set('var',$var);
    }else if($var==6){
        $this->set('var',$var);
    }



echo "<script>";
  echo "if(document.getElementById('datos-consulta')){document.getElementById('datos-consulta').innerHTML='';}";
echo "</script>";



}//distinct_beneficiarios_ordenes_pago



function reporte_relacion_ordenes_compra($ir=null){
    $this->layout="ajax";

     set_time_limit(0);

    if($ir!=null){
        if($ir=='si'){//si va al formulario
          $this->set('ano',$ano=$this->ano_ejecucion());
          $_SESSION['ano_compra_consulta'] = $this->ano_ejecucion();
          $this->set('ir','si');
        }elseif($ir=='no'){//no va al formulario, pero si va al reporte
        $this->layout="pdf";
        $this->set('ir','no');

        $cp  = $this->Session->read('SScodpresi');
        $ce  = $this->Session->read('SScodentidad');
        $cti = $this->Session->read('SScodtipoinst');
        $ci  = $this->Session->read('SScodinst');
        $cd  = $this->Session->read('SScoddep');

        if(isset($_SESSION['ano_compra_consulta'])){$ano = $_SESSION['ano_compra_consulta'];}else{$ano = $this->ano_ejecucion();}

        $condicion_actividad = $this->data['relacion_ordencompra']['condicion_actividad'];// 1:Todo,     2:Activas,    3:Anuladas.
        $opcion_orden_pago   = $this->data['relacion_ordencompra']['opcionop'];

                 if($opcion_orden_pago==1){  $sql_op = "";  $sql_op2 = "";

           }else if($opcion_orden_pago==2){ $sql_op = "  "; $sql_op2 = "";

           }else if($opcion_orden_pago==3){ $sql_op = " ";  $sql_op2 = "   "; }//fin else


$this->set('opcion_orden_pago',$opcion_orden_pago);

        if($condicion_actividad==1){
            $cond = $this->SQLCA()." and ano_orden_compra='$ano'";
        }elseif($condicion_actividad==2){
            $cond = $this->SQLCA()." and ano_orden_compra='$ano' and condicion_actividad=1";
        }elseif($condicion_actividad==3){
            $cond = $this->SQLCA()." and ano_orden_compra='$ano' and condicion_actividad=2";
        }

        //$this->data['relacion_ordencompra']['estilo_reporte'];
        //$this->data['relacion_ordencompra']['opcionfecha'];

        if($this->data['relacion_ordencompra']['opcionfecha']==1){
                    if($this->data['relacion_ordencompra']['estilo_reporte']==1){

                            if($condicion_actividad==1){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano'
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    a.condicion_actividad = 1
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    a.condicion_actividad = 2
                                                    order by a.numero_orden_compra";
                            }

                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond);
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);

                     }elseif($this->data['relacion_ordencompra']['estilo_reporte']==2){

                             $razon_social = strtoupper($this->data['relacion_ordencompra']['razonsocial']);

                            if($condicion_actividad==1){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi      = '$cp'  and
                                                    a.cod_entidad    = '$ce'  and
                                                    a.cod_tipo_inst  = '$cti' and
                                                    a.cod_inst       = '$ci'  and
                                                    a.cod_dep        = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    upper(a.rif)     = '$razon_social'
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi      = '$cp'  and
                                                    a.cod_entidad    = '$ce'  and
                                                    a.cod_tipo_inst  = '$cti' and
                                                    a.cod_inst       = '$ci'  and
                                                    a.cod_dep        = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    upper(a.rif)     = '$razon_social' and
                                                    a.condicion_actividad = 1
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,
                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden
                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi      = '$cp'  and
                                                    a.cod_entidad    = '$ce'  and
                                                    a.cod_tipo_inst  = '$cti' and
                                                    a.cod_inst       = '$ci'  and
                                                    a.cod_dep        = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    upper(a.rif)     = '$razon_social' and
                                                    a.condicion_actividad = 2
                                                    order by a.numero_orden_compra";
                            }


                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond." and upper(rif)='$razon_social'");
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);

                    }elseif($this->data['relacion_ordencompra']['estilo_reporte']==3){

                            $fecha_inicial = $this->data['relacion_ordencompra']['fecha_inicial'];
                            $fecha_final = $this->data['relacion_ordencompra']['fecha_final'];

                            if($condicion_actividad==1){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,

                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden

                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,

                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden

                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    a.condicion_actividad = 1   and
                                                    a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                    order by a.numero_orden_compra";

                            }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select
                                                    a.cod_dep,
                                                    a.cod_entidad,
                                                    a.cod_tipo_inst,
                                                    a.cod_inst,
                                                    a.cod_dep,

                                                    a.ano_orden_compra,
                                                    a.numero_orden_compra,
                                                    a.condicion_actividad,
                                                    a.fecha_orden_compra,
                                                    a.rif,
                                                    (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                    (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                    a.monto_orden

                                                    from cscd04_ordencompra_encabezado a
                                                    where
                                                    a.cod_presi        = '$cp'  and
                                                    a.cod_entidad      = '$ce'  and
                                                    a.cod_tipo_inst    = '$cti' and
                                                    a.cod_inst         = '$ci'  and
                                                    a.cod_dep          = '$cd'  and
                                                    a.ano_orden_compra = '$ano' and
                                                    a.condicion_actividad = 2   and
                                                    a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                    order by a.numero_orden_compra";
                            }


                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond." and fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'");
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);

                     }


        }elseif($this->data['relacion_ordencompra']['opcionfecha']==2){

                    $fecha_inicial = $this->data['relacion_ordencompra']['fecha_inicial'];
                    $fecha_final = $this->data['relacion_ordencompra']['fecha_final'];

                    if($this->data['relacion_ordencompra']['estilo_reporte']==1){

                        $condicion_actividad = $this->data['relacion_ordencompra']['condicion_actividad'];// 1:Todo,     2:Activas,    3:Anuladas.
                        if($condicion_actividad==1){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                      a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                      (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                      (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                      a.monto_orden
                                                      from cscd04_ordencompra_encabezado a
                                                      where
                                                      a.cod_presi        = '$cp'  and
                                                      a.cod_entidad      = '$ce'  and
                                                      a.cod_tipo_inst    = '$cti' and
                                                      a.cod_inst         = '$ci'  and
                                                      a.cod_dep          = '$cd'  and
                                                      a.ano_orden_compra = '$ano' and
                                                      a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                      order by a.fecha_orden_compra, a.numero_orden_compra";

                        }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                      a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                      (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                      (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                      a.monto_orden
                                                      from cscd04_ordencompra_encabezado a
                                                      where
                                                      a.cod_presi        = '$cp'  and
                                                      a.cod_entidad      = '$ce'  and
                                                      a.cod_tipo_inst    = '$cti' and
                                                      a.cod_inst         = '$ci'  and
                                                      a.cod_dep          = '$cd'  and
                                                      a.ano_orden_compra = '$ano' and
                                                      a.condicion_actividad = 1   and
                                                      a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                      order by a.fecha_orden_compra, a.numero_orden_compra";

                        }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                      a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                      (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                      (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                      a.monto_orden
                                                      from cscd04_ordencompra_encabezado a
                                                      where
                                                      a.cod_presi        = '$cp'  and
                                                      a.cod_entidad      = '$ce'  and
                                                      a.cod_tipo_inst    = '$cti' and
                                                      a.cod_inst         = '$ci'  and
                                                      a.cod_dep          = '$cd'  and
                                                      a.ano_orden_compra = '$ano' and
                                                      a.condicion_actividad = 2   and
                                                      a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                      order by a.fecha_orden_compra, a.numero_orden_compra";
                        }


                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond." and fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'");
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);

                     }elseif($this->data['relacion_ordencompra']['estilo_reporte']==2){

                             $razon_social = strtoupper($this->data['relacion_ordencompra']['razonsocial']);

                             if($condicion_actividad==1){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden

                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi      = '$cp'  and
                                                        a.cod_entidad    = '$ce'  and
                                                        a.cod_tipo_inst  = '$cti' and
                                                        a.cod_inst       = '$ci'  and
                                                        a.cod_dep        = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        upper(a.rif)     = '$razon_social' and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";

                             }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden

                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi      = '$cp'  and
                                                        a.cod_entidad    = '$ce'  and
                                                        a.cod_tipo_inst  = '$cti' and
                                                        a.cod_inst       = '$ci'  and
                                                        a.cod_dep        = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        a.condicion_actividad = 1 and
                                                        upper(a.rif)     = '$razon_social' and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";

                             }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden

                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi      = '$cp'  and
                                                        a.cod_entidad    = '$ce'  and
                                                        a.cod_tipo_inst  = '$cti' and
                                                        a.cod_inst       = '$ci'  and
                                                        a.cod_dep        = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        a.condicion_actividad = 2 and
                                                        upper(a.rif)     = '$razon_social' and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";
                             }


                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond." and upper(rif)='$razon_social' and fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'");
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);

                    }elseif($this->data['relacion_ordencompra']['estilo_reporte']==3){

                            if($condicion_actividad==1){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden
                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi        = '$cp'  and
                                                        a.cod_entidad      = '$ce'  and
                                                        a.cod_tipo_inst    = '$cti' and
                                                        a.cod_inst         = '$ci'  and
                                                        a.cod_dep          = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";

                            }elseif($condicion_actividad==2){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden
                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi        = '$cp'  and
                                                        a.cod_entidad      = '$ce'  and
                                                        a.cod_tipo_inst    = '$cti' and
                                                        a.cod_inst         = '$ci'  and
                                                        a.cod_dep          = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        a.condicion_actividad = 1   and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";

                            }elseif($condicion_actividad==3){
                                $sql_orden_encabezado="select a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                                                        a.ano_orden_compra, a.numero_orden_compra, a.condicion_actividad, a.fecha_orden_compra, a.rif,
                                                        (select b.rif from cpcd02 b where b.rif=a.rif)::varchar(20) as rif,
                                                        (select b.denominacion from cpcd02 b where b.rif=a.rif)::varchar(100) as beneficiario,
                                                        a.monto_orden
                                                        from cscd04_ordencompra_encabezado a
                                                        where
                                                        a.cod_presi        = '$cp'  and
                                                        a.cod_entidad      = '$ce'  and
                                                        a.cod_tipo_inst    = '$cti' and
                                                        a.cod_inst         = '$ci'  and
                                                        a.cod_dep          = '$cd'  and
                                                        a.ano_orden_compra = '$ano' and
                                                        a.condicion_actividad = 2   and
                                                        a.fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'
                                                        order by a.fecha_orden_compra, a.numero_orden_compra";
                            }

                            $filas_encabezado=$this->cscd04_ordencompra_encabezado->findCount($cond." and fecha_orden_compra BETWEEN '$fecha_inicial' AND '$fecha_final'");
                            $datos_orden_encabezado=$this->cscd04_ordencompra_encabezado->execute($sql_orden_encabezado);
                            $datos_autorizacion_pago=$this->cscd04_ordencompra_autorizacion_cuerpo->findAll($this->SQLCA().$sql_op2,array('ano_orden_compra','numero_orden_compra','ano_orden_pago','numero_orden_pago'));
                            $datos_ordenpago_cuerpo=$this->cepd03_ordenpago_cuerpo->findAll($this->SQLCA(),array('ano_orden_pago','numero_orden_pago','condicion_actividad','fecha_orden_pago','beneficiario','monto_total','numero_cheque','fecha_cheque'), 'numero_orden_pago ASC');

                            $this->set('filas_encabezado',$filas_encabezado-1);
                            $this->set('datos_orden_encabezado',$datos_orden_encabezado);
                            $this->set('datos_autorizacion_pago',$datos_autorizacion_pago);
                            $this->set('datos_ordenpago_cuerpo',$datos_ordenpago_cuerpo);
                     }

        }

        }
    }
}


function distinct_razonsocial_ordenescompras($var=null){
    $this->layout="ajax";
    $array =  array();
    if($var==1){
        $this->set('var',$var);
    }elseif($var==3){
        $this->set('var',$var);
    }elseif($var==2){
        /*if(isset($_SESSION['ano_compra_consulta'])){$ano = $_SESSION['ano_compra_consulta'];}else{$ano = $this->ano_ejecucion();}
        $cpcd02=$this->cpcd02->findAll(null,array('rif','denominacion'));
        $rif=$this->cscd04_ordencompra_encabezado->execute("select distinct rif from cscd04_ordencompra_encabezado where ".$this->SQLCA()." and  ano_orden_compra='".$ano."' ");
        $i=-1;
        $array = array();
        foreach($rif as $x){$i=$i+1;}
        for($j=0; $j<=$i; $j++){
            foreach($cpcd02 as $razonsocial){
              if($rif[$j][0]['rif'] == $razonsocial['cpcd02']['rif']){
              $array[$rif[$j][0]['rif']] = $razonsocial['cpcd02']['denominacion'];
              }
            }
        }*/
        $this->set('razonsocial',$array);
        $this->set('var',$var);
    }


echo "<script>";
  echo "if(document.getElementById('datos-consulta')){document.getElementById('datos-consulta').innerHTML='';}";
echo "</script>";




}//razonsocial_ordenescompras






function reporte_relacion_otros_compromisos($ir=null){
    $this->layout="ajax";

     set_time_limit(0);

    if($ir!=null){
        if($ir=='si'){//si va al formulario
           $this->set('ano',$this->ano_ejecucion());
           $_SESSION['ano_otroscompromisos'] = $this->ano_ejecucion();
           $this->set('ir','si');
        }elseif($ir=='no'){//no va al formulario, pero si va al reporte
        $this->layout="pdf";
        $this->set('ir','no');

        $cp  = $this->Session->read('SScodpresi');
        $ce  = $this->Session->read('SScodentidad');
        $cti = $this->Session->read('SScodtipoinst');
        $ci  = $this->Session->read('SScodinst');
        $cd  = $this->Session->read('SScoddep');

        $ano = $this->data['relacion_otroscompromisos']['ano'];

        $opcion_orden_pago   = $this->data['relacion_otroscompromisos']['opcionop'];
        $condicion_actividad = $this->data['relacion_otroscompromisos']['condicion_actividad'];

        if($condicion_actividad == 1){
            $cond_actividad = " and condicion_actividad = 1";
        }elseif($condicion_actividad == 2){
            $cond_actividad = " and condicion_actividad = 2";
        }elseif($condicion_actividad == 3){
            $cond_actividad = "";
        }


           if($opcion_orden_pago==1){  $sql_op = $cond_actividad;  $sql_op2 = $cond_actividad;

           }else if($opcion_orden_pago==2){ $sql_op = " and a.numero_orden_pago!=0  ".$cond_actividad; $sql_op2 = " and numero_orden_pago!=0 ".$cond_actividad;
           }else if($opcion_orden_pago==3){ $sql_op = " and a.numero_orden_pago=0 ".$cond_actividad; $sql_op2 = " and numero_orden_pago=0 ".$cond_actividad;
           }//fin else

        //$this->data['relacion_otroscompromisos']['estilo_reporte'];
        //$this->data['relacion_otroscompromisos']['opcionfecha'];

        if($this->data['relacion_otroscompromisos']['opcionfecha']==1){
                    if($this->data['relacion_otroscompromisos']['estilo_reporte']==1){

                        /* $sql_otros_compromisos="select
                        a.cod_dep,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.ano_documento,
                        a.numero_documento,
                        a.condicion_actividad,
                        a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso)::varchar(50) as deno_compromiso,
                        a.fecha_documento,
                        a.rif,
                        a.cedula_identidad,
                        a.monto,
                        a.beneficiario,
                        (select c.numero_orden_pago from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_origen=a.numero_documento)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_origen=a.numero_documento)::date as fecha_orden_pago,
                        (select c.numero_cheque from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_origen=a.numero_documento)::int4 as numero_cheque,
                        (select c.fecha_cheque from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_origen=a.numero_documento)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano'"; */

                        $sql_otros_compromisos="select
                        a.cod_dep,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.ano_documento,
                        a.numero_documento,
                        a.condicion_actividad,
                        a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso)::varchar(50) as deno_compromiso,
                        a.fecha_documento,
                        a.rif,
                        a.cedula_identidad,
                        a.monto,
                        a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                                  c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and 
                                  c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia
                        )::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                                  c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and 
                                  c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia
                        )::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                                  c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and 
                                  c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia
                        )::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                                  c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and 
                                  c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia
                        )::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano' ".$sql_op." and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' ".$sql_op2." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','');


                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==2){

                        $beneficiario = strtoupper($this->data['relacion_otroscompromisos']['beneficiarios']);

                        $sql_otros_compromisos="select
                        a.cod_dep,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.ano_documento,
                        a.numero_documento,
                        a.condicion_actividad,
                        a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso) as deno_compromiso,
                        a.fecha_documento,
                        a.rif,
                        a.cedula_identidad,
                        a.monto,
                        a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and   
                            .cod_inst = a.cod_inst  and   c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            .cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano'  and
                        upper(a.beneficiario) = '$beneficiario' ".$sql_op." and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' and upper(beneficiario)='$beneficiario' ".$sql_op2." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','('.$beneficiario.')');

                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==3){

                        $tipocompromiso = strtoupper($this->data['relacion_otroscompromisos']['tipocompromiso']);

                        $sql_otros_compromisos="select
                        a.cod_dep,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.ano_documento,
                        a.numero_documento,
                        a.condicion_actividad,
                        a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso) as deno_compromiso,
                        a.fecha_documento,
                        a.rif,
                        a.cedula_identidad,
                        a.monto,
                        a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                             c.cod_inst = a.cod_inst  and   c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                             c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano'  and
                        cod_tipo_compromiso = '$tipocompromiso' ".$sql_op." and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' and cod_tipo_compromiso='$tipocompromiso' ".$sql_op2." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','('.$datos_compromiso_cuerpo[1][0]['deno_compromiso'].')');
                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==4){

                        $fecha_inicial = $this->data['relacion_otroscompromisos']['fecha_inicial'];
                        $fecha_final = $this->data['relacion_otroscompromisos']['fecha_final'];
                        $sql_otros_compromisos="select
                        a.cod_dep,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.ano_documento,
                        a.numero_documento,
                        a.condicion_actividad,
                        a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso)::varchar(50) as deno_compromiso,
                        a.fecha_documento,
                        a.rif,
                        a.cedula_identidad,
                        a.monto,
                        a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano' ".$sql_op." and
                        a.fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final' and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.fecha_documento, a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' ".$sql_op2." and fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final'"." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','');

                    }

        }elseif($this->data['relacion_otroscompromisos']['opcionfecha']==2){

                    $fecha_inicial = $this->data['relacion_otroscompromisos']['fecha_inicial'];
                    $fecha_final = $this->data['relacion_otroscompromisos']['fecha_final'];

                    if($this->data['relacion_otroscompromisos']['estilo_reporte']==1){

                        $sql_otros_compromisos="select
                        a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano_documento, a.numero_documento, a.condicion_actividad, a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso)::varchar(50) as deno_compromiso,
                        a.fecha_documento, a.rif, a.cedula_identidad, a.monto, a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and 
                            c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and 
                            c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano'  ".$sql_op." and
                        a.fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final' and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.fecha_documento, a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' ".$sql_op2." and fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final'"." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','');

                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==2){

                        $beneficiario = strtoupper($this->data['relacion_otroscompromisos']['beneficiarios']);

                        $sql_otros_compromisos="select
                        a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano_documento, a.numero_documento, a.condicion_actividad, a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso) as deno_compromiso,
                        a.fecha_documento, a.rif, a.cedula_identidad, a.monto, a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and   c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and
                              c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and 
                             c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and 
                             c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano' and
                        upper(a.beneficiario) = '$beneficiario'  ".$sql_op." and
                        a.fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final' and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.fecha_documento, a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' and upper(beneficiario)='$beneficiario' ".$sql_op2." and fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final'"." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','('.$beneficiario.')');

                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==3){

                        $tipocompromiso = strtoupper($this->data['relacion_otroscompromisos']['tipocompromiso']);

                        $sql_otros_compromisos="select
                        a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano_documento, a.numero_documento, a.condicion_actividad, a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso) as deno_compromiso,
                        a.fecha_documento, a.rif, a.cedula_identidad, a.monto, a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                             c.cod_inst = a.cod_inst  and   c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                             c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and  c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi = a.cod_presi  and  c.cod_entidad = a.cod_entidad  and  c.cod_tipo_inst = a.cod_tipo_inst  and  
                            c.cod_inst = a.cod_inst  and  c.cod_dep = a.cod_dep  and c.ano_orden_pago = a.ano_orden_pago  and  
                            c.numero_orden_pago = a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano' and
                        a.cod_tipo_compromiso = '$tipocompromiso'  ".$sql_op." and
                        a.fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final' and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.fecha_documento, a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' and cod_tipo_compromiso='$tipocompromiso' ".$sql_op2." and fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final'"." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','('.$datos_compromiso_cuerpo[1][0]['deno_compromiso'].')');
                    }elseif($this->data['relacion_otroscompromisos']['estilo_reporte']==4){

                        $sql_otros_compromisos="select
                        a.cod_dep, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano_documento, a.numero_documento, a.condicion_actividad, a.cod_tipo_compromiso,
                        (select d.denominacion from cepd01_tipo_compromiso d where d.cod_tipo_compromiso=a.cod_tipo_compromiso)::varchar(50) as deno_compromiso,
                        a.fecha_documento, a.rif, a.cedula_identidad, a.monto, a.beneficiario,
                        (select c.numero_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and 
                            c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_orden_pago,
                        (select c.fecha_orden_pago 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and 
                            c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_orden_pago,
                        (select c.numero_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and 
                            c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::int4 as numero_cheque,
                        (select c.fecha_cheque 
                            from cepd03_ordenpago_cuerpo c 
                            where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and 
                            c.cod_dep=a.cod_dep and c.ano_orden_pago=a.ano_orden_pago and c.numero_orden_pago=a.numero_orden_pago and c.numero_documento_secuencia=a.numero_documento_secuencia)::date as fecha_cheque
                        from cepd01_compromiso_cuerpo a
                        where
                        a.cod_presi      = '$cp'  and
                        a.cod_entidad    = '$ce'  and
                        a.cod_tipo_inst  = '$cti' and
                        a.cod_inst       = '$ci'  and
                        a.cod_dep        = '$cd'  and
                        a.ano_documento  = '$ano'  ".$sql_op." and
                        a.fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final' and (a.cod_obra='' or a.cod_obra='0' or a.cod_obra IS NULL)
                        order by a.fecha_documento, a.numero_documento";

                        $filas_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->findCount("cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_documento='$ano' ".$sql_op2." and fecha_documento BETWEEN '$fecha_inicial' AND '$fecha_final'"." and (cod_obra='' or cod_obra='0' or cod_obra IS NULL)");
                        $datos_compromiso_cuerpo=$this->cepd01_compromiso_cuerpo->execute($sql_otros_compromisos);
                        $this->set('filas_compromiso_cuerpo',$filas_compromiso_cuerpo-1);
                        $this->set('datos_compromiso_cuerpo',$datos_compromiso_cuerpo);
                        $this->set('subtituloreporte','');

                    }
        }

        }//fin else
    }//fin null


}//relacion_otros_compromisos


function distinct_beneficiarios_otros_compromisos($var=null){
    $this->layout="ajax";
    $array = array();
    if($var==1){
        $this->set('var',$var);
    }if($var==4){
        $this->set('var',$var);
    }else if($var==2){
        /*$beneficiarios=$this->cepd01_compromiso_cuerpo->execute("select distinct beneficiario from cepd01_compromiso_cuerpo where ".$this->SQLCA()." and ano_documento='".$_SESSION['ano_otroscompromisos']."' ");
        $i=-1;
        foreach($beneficiarios as $x){$i=$i+1;}
        for($j=0; $j<=$i; $j++){
        $array[$beneficiarios[$j][0]['beneficiario']] = $beneficiarios[$j][0]['beneficiario'];
        }*/
        $this->set('beneficiarios',$array);
        $this->set('var',$var);
    }else if($var==3){
        $compromisos=$this->cepd01_compromiso_cuerpo->execute("select distinct cod_tipo_compromiso from cepd01_compromiso_cuerpo where ".$this->SQLCA()." and ano_documento='".$_SESSION['ano_otroscompromisos']."' ");
        $tipocompromiso=$this->cepd01_tipo_compromiso->findAll();
        $i=-1;
        foreach($compromisos as $x){$i=$i+1;}
        for($j=0; $j<=$i; $j++){
            foreach($tipocompromiso as $a){
                if($a['cepd01_tipo_compromiso']['cod_tipo_compromiso']==$compromisos[$j][0]['cod_tipo_compromiso']){
                    $array[$compromisos[$j][0]['cod_tipo_compromiso']] = $a['cepd01_tipo_compromiso']['denominacion'];
                }
            }
        }
        $this->set('tipocompromiso',$array);
        $this->set('var',$var);
    }




echo "<script>";
  echo "if(document.getElementById('datos-consulta')){document.getElementById('datos-consulta').innerHTML='';}";
echo "</script>";



}//distinct_beneficiarios_ordenes_pago



function distinct_tipopago($var=null){
    $this->layout="ajax";
    if($var==1){
        $this->set('var',$var);
    }else{
        $documentos=$this->cepd01_compromiso_cuerpo->execute("select distinct cod_tipo_documento from cepd03_ordenpago_cuerpo where ".$this->SQLCA());
        $tipopago=$this->cepd03_ordenpago_tipopago->findAll();
        $i=-1;
        foreach($documentos as $x){$i=$i+1;}
        for($j=0; $j<=$i; $j++){
            foreach($tipopago as $a){
                if($a['cepd03_ordenpago_tipopago']['cod_tipo_pago']==$documentos[$j][0]['cod_tipo_documento']){
                    $array[$documentos[$j][0]['cod_tipo_documento']] = $a['cepd03_ordenpago_tipopago']['denominacion'];
                }
            }
        }
        $this->set('documentos',$array);
        $this->set('var',$var);
    }
}//distinct_beneficiarios_ordenes_pago


function reporte_form_cuadrodisponibilidadbancaria($ir=null){
    $this->layout="ajax";
    if($ir!=null){
        if($ir=='si'){// va al formulario.
           $this->set('ano',$this->ano_ejecucion());
           $this->set('ir','si');
        }elseif($ir=='no'){// no va al formulario, va al reporte.
            $this->layout="pdf";
            $this->set('ir','no');

            $ano_mov = $this->data['cuadro_disponibilidad']['ano'];
            $fecha_inicial = $this->data['cuadro_disponibilidad']['fecha'];

            // Inicializacion de Variables
            $tcuentas=-1;
            $todas_las_cuentas       = array();
            $vector_cuentas_anterior = array();
            $vector_cuentas_actual   = array();
            $vector_dia_actual       = array();
            $vector_resta_anterior   = array();
            $vector_resta_actual     = array();

            $cadena_fecha = split("/",$fecha_inicial);
            $dia=(int) $cadena_fecha[0];
            $mes=(int) $cadena_fecha[1];
            $ano=(int) $cadena_fecha[2];

            if($dia==1){
                switch($mes){
                    case '1':  $dia=1;  $mes=1;      $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '2':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '3':  $dia=29; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '4':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '5':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '6':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '7':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '8':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '9':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '10': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '11': $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '12': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                }
            }else{
                $dia=$dia-1;
                $fecha_anterior=$dia."/".$mes."/".$ano;
            }

            $distinct = $this->v_cstd_mov_gral->execute("select distinct cod_entidad_bancaria, cod_sucursal, cuenta_bancaria from v_cstd_mov_gral where ".$this->SQLCA()."");
            foreach($distinct as $x){$tcuentas++;}

            for($i=0;$i<=$tcuentas;$i++){
                $cod_entidad_ban = $distinct[$i][0]['cod_entidad_bancaria'];
                $cod_sucursal    = $distinct[$i][0]['cod_sucursal'];
                $cod_cuenta      = $distinct[$i][0]['cuenta_bancaria'];

                $todas_las_cuentas[$i]=array($cod_entidad_ban,$cod_sucursal,$cod_cuenta);
                $vector_cuentas_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_anterior from v_cstd_mov_gral where ".$this->SQLCA()." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and condicion_actividad=1 and (tipo_documento=1 or tipo_documento=2) and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $vector_resta_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_anterior from v_cstd_mov_gral where ".$this->SQLCA()." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and condicion_actividad=1 and (tipo_documento=3 or tipo_documento=4) and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");
            }

            $condicion=$this->SQLCA()." and fecha_documento='$fecha_inicial'";
            $vector_dia_actual = $this->v_cstd_mov_gral->findAll($condicion);
            $entidades_banc = $this->cstd01_entidades_bancarias->findAll();

            $this->set('tcuentas',$tcuentas);
            $this->set('distinct',$distinct);
            $this->set('vector_cuentas_anterior',$vector_cuentas_anterior);
            $this->set('vector_cuentas_actual',$vector_cuentas_actual);
            $this->set('vector_dia_actual',$vector_dia_actual);
            $this->set('todas_las_cuentas',$todas_las_cuentas);
            $this->set('vector_resta_anterior',$vector_resta_anterior);
            $this->set('vector_resta_actual',$vector_resta_actual);
            $this->set('entidades_banc',$entidades_banc);
            $this->set('fecha_anterior',$fecha_anterior);
            $this->set('fecha_actual',$fecha_inicial);
        }
    }
}



function reporte_form_cuadrodisponibilidadbancaria_2($ir=null){
    $this->layout="ajax";
    if($ir!=null){
        if($ir=='si'){// va al formulario.
           $this->set('ano',$this->ano_ejecucion());
           $this->set('ir','si');
        }elseif($ir=='no'){// no va al formulario, va al reporte.
            $this->layout="pdf";
            $this->set('ir','no');


            if(isset($this->data["cfpp05"]["consolidacion"])){
                $consolidacion=$this->data["cfpp05"]["consolidacion"];
            }else{
                $consolidacion=2;
            }

            $sql_opcion = $this->SQLCA_consolidado($consolidacion);
            $sql_opcion_2 = $sql_opcion;
            $ano_mov = $this->data['cuadro_disponibilidad']['ano'];
            $fecha_inicial = $this->data['cuadro_disponibilidad']['fecha'];
            $agrupamiento = isset($this->data['cuadro_disponibilidad']['agrupamiento']) ? $this->data['cuadro_disponibilidad']['agrupamiento'] : $agrupamiento = 4;

            // Buscamos todas las entidades bancarias
            $vector_banco =array();
            $entidades_banc = $this->cstd01_entidades_bancarias->execute("select * from cstd01_entidades_bancarias order by cod_entidad_bancaria");
            for($h=0; $h<count($entidades_banc); $h++){
                $vector_banco[$entidades_banc[$h][0]['cod_entidad_bancaria']] = $entidades_banc[$h][0]['denominacion'];
            }

            // Chequeamos como desean el reporte
            if($agrupamiento==1){
                $consolidacion==1 ? $order="cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC" : $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','POR BANCO');

            }elseif($agrupamiento==2){
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','DEPENDENCIA Y BANCO');

            }elseif($agrupamiento==3){
                $codigo_entidad_bancaria = $this->data['cuadro_disponibilidad']['codigo_entidad_bancaria'];
                if($codigo_entidad_bancaria==''){
                    echo "<script>history.back(1)</script>";
                }
                $sql_opcion_2 .=  " and cod_entidad_bancaria='$codigo_entidad_bancaria'";
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','BANCO ESPECIFICO: '.$vector_banco[$codigo_entidad_bancaria]);

            }elseif($agrupamiento==4){
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','');
            }


            $cadena_fecha = split("/",$fecha_inicial);
            $dia=(int) $cadena_fecha[0];
            $mes=(int) $cadena_fecha[1];
            $ano=(int) $cadena_fecha[2];

            if($dia==1){
                switch($mes){
                    case '1':  $dia=1;  $mes=1;      $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '2':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '3':  $dia=29; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '4':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '5':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '6':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '7':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '8':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '9':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '10': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '11': $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '12': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                }
            }else{
                $dia=$dia-1;
                $fecha_anterior=$dia."/".$mes."/".$ano;
            }

            // Inicializacion de Variables
            $vector_cuentas_anterior = array();
            $vector_resta_anterior   = array();
            $suma_anterior_anu = array();
            $resta_anterior_anu = array();
            $suma_actual = array();
            $resta_actual = array();
            $suma_actual_anu = array();
            $resta_actual_anu = array();
            $resta_actual_anulados = array();
            $colocacion = array();
            $rendimiento = array();

            $distinct = $this->v_cstd_mov_gral->execute("select distinct cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria from v_cstd_mov_gral where ".$sql_opcion_2." order by ".$order);
            for($i=0;$i<count($distinct);$i++){
                $cod_entidad_ban = $distinct[$i][0]['cod_entidad_bancaria'];
                $cod_sucursal    = $distinct[$i][0]['cod_sucursal'];
                $cod_cuenta      = $distinct[$i][0]['cuenta_bancaria'];

                $vector_cuentas_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_anterior from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=1 or tipo_documento=2) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $vector_resta_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_anterior from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=3 or tipo_documento=4) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $suma_anterior_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_anterior_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=1 or tipo_documento=2) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $resta_anterior_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_anterior_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $suma_actual[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_actual from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=1 or tipo_documento=2) and fecha='$fecha_inicial'");
                $resta_actual[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=3 or tipo_documento=4) and fecha='$fecha_inicial'");

                $suma_actual_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_actual_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=1 or tipo_documento=2) and fecha='$fecha_inicial' and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $resta_actual_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and fecha='$fecha_inicial' and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $resta_actual_anulados[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual_anulados from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and fecha_documento='$fecha_inicial' and fecha_proceso_anulacion='$fecha_inicial'");

                $colocacion[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as colocacion from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and tipo_documento=3 and colocacion=1 and fecha='$fecha_inicial'");
                $rendimiento[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as rendimiento from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and tipo_documento=2 and colocacion=1 and fecha='$fecha_inicial'");
            }

            $condicion_inst = "cod_presi=".$this->verifica_SS(1)." and cod_entidad=".$this->verifica_SS(2)." and cod_tipo_inst=".$this->verifica_SS(3)." and cod_inst=".$this->verifica_SS(4);
            $dependencias   = $this->arrd05->findAll($condicion_inst, null, 'cod_dep ASC');
            $k=0;
            foreach($dependencias AS $d){
                $k++;
                $lista_dep[$d['arrd05']['cod_dep']] = $d['arrd05']['denominacion'];
            }

            $this->set('suma_anterior_anu',$suma_anterior_anu);
            $this->set('resta_anterior_anu',$resta_anterior_anu);
            $this->set('suma_actual',$suma_actual);
            $this->set('resta_actual',$resta_actual);
            $this->set('suma_actual_anu',$suma_actual_anu);
            $this->set('resta_actual_anu',$resta_actual_anu);
            $this->set('resta_actual_anulados',$resta_actual_anulados);
            $this->set('colocacion',$colocacion);
            $this->set('rendimiento',$rendimiento);

            $this->set('vector_banco',$vector_banco);

            $this->set('distinct',$distinct);
            $this->set('vector_cuentas_anterior',$vector_cuentas_anterior);
            $this->set('vector_resta_anterior',$vector_resta_anterior);
            $this->set('fecha_anterior',$fecha_anterior);
            $this->set('fecha_actual',$fecha_inicial);

            $this->set('lista_dep',$lista_dep);
            $this->set('agrupamiento',$agrupamiento);

            /*
            $sql_datos = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_entidad_bancaria, a.cuenta_bancaria,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 OR b.tipo_documento=2) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=1) as suma_anterior_activos,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 OR b.tipo_documento=4) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=1) as resta_anterior_activos,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 OR b.tipo_documento=2) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=2) as suma_anterior_anul,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 OR b.tipo_documento=4) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=2) as resta_anterior_anul
            FROM v_cstd_mov_general a WHERE a.cod_presi='1' AND a.cod_entidad='11' AND a.cod_tipo_inst='30' AND a.cod_inst='11' AND a.cod_dep='1' GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, cod_dep, a.cod_entidad_bancaria, a.cuenta_bancaria ORDER BY a.cod_entidad_bancaria, a.cuenta_bancaria;";

            $datos = $this->v_cstd_mov_gral->execute($sql_datos);
            $this->set('datos',$datos);
             */
        }
    }
}


function reporte_cuadrodisponibilidadbancaria($ir=null){
    $this->layout="ajax";
    if($ir!=null){
        if($ir=='si'){// va al formulario.
           $this->set('ano',$this->ano_ejecucion());
           $this->set('ir','si');
        }elseif($ir=='no'){// no va al formulario, va al reporte.
            $this->layout="pdf";
            $this->set('ir','no');


            if(isset($this->data["cfpp05"]["consolidacion"])){
                $consolidacion=$this->data["cfpp05"]["consolidacion"];
            }else{
                $consolidacion=2;
            }

            $sql_opcion = $this->SQLCA_consolidado($consolidacion);
            $sql_opcion_2 = $sql_opcion;
            $ano_mov = $this->data['cuadro_disponibilidad']['ano'];
            $fecha_inicial = $this->data['cuadro_disponibilidad']['fecha'];
            $agrupamiento = isset($this->data['cuadro_disponibilidad']['agrupamiento']) ? $this->data['cuadro_disponibilidad']['agrupamiento'] : $agrupamiento = 4;

            // Buscamos todas las entidades bancarias
            $vector_banco =array();
            $entidades_banc = $this->cstd01_entidades_bancarias->execute("select * from cstd01_entidades_bancarias order by cod_entidad_bancaria");
            for($h=0; $h<count($entidades_banc); $h++){
                $vector_banco[$entidades_banc[$h][0]['cod_entidad_bancaria']] = $entidades_banc[$h][0]['denominacion'];
            }

            // Chequeamos como desean el reporte
            if($agrupamiento==1){
                $consolidacion==1 ? $order="cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC" : $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','POR BANCO');

            }elseif($agrupamiento==2){
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','DEPENDENCIA Y BANCO');

            }elseif($agrupamiento==3){
                $codigo_entidad_bancaria = $this->data['cuadro_disponibilidad']['codigo_entidad_bancaria'];
                if($codigo_entidad_bancaria==''){
                    echo "<script>history.back(1)</script>";
                }
                $sql_opcion_2 .=  " and cod_entidad_bancaria='$codigo_entidad_bancaria'";
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','BANCO ESPECIFICO: '.$vector_banco[$codigo_entidad_bancaria]);

            }elseif($agrupamiento==4){
                $order="cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria ASC";
                $this->set('titulo_reporte','');
            }


            $cadena_fecha = split("/",$fecha_inicial);
            $dia=(int) $cadena_fecha[0];
            $mes=(int) $cadena_fecha[1];
            $ano=(int) $cadena_fecha[2];

            if($dia==1){
                switch($mes){
                    case '1':  $dia=1;  $mes=1;      $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '2':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '3':  $dia=29; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '4':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '5':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '6':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '7':  $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '8':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '9':  $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '10': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '11': $dia=31; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                    case '12': $dia=30; $mes=$mes-1; $fecha_anterior=$dia."/".$mes."/".$ano; break;
                }
            }else{
                $dia=$dia-1;
                $fecha_anterior=$dia."/".$mes."/".$ano;
            }

            // Inicializacion de Variables
            //$vector_cuentas_anterior = array();
            //$vector_resta_anterior   = array();
            //$suma_anterior_anu = array();
            //$resta_anterior_anu = array();
            //$suma_actual = array();
            //$resta_actual = array();
            //$suma_actual_anu = array();
            //$resta_actual_anu = array();
            //$resta_actual_anulados = array();
            //$colocacion = array();
            //$rendimiento = array();

            $vector_cuentas = array();

            $sql = "SELECT
                    a.cod_presi,
                    a.cod_entidad,
                    a.cod_tipo_inst,
                    a.cod_inst,
                    a.cod_dep,
                    (SELECT c.denominacion FROM arrd05 c WHERE c.cod_presi=a.cod_presi AND c.cod_entidad=a.cod_entidad AND c.cod_tipo_inst=a.cod_tipo_inst AND c.cod_inst=a.cod_inst AND c.cod_dep=a.cod_dep) as deno_dep,
                    a.cod_entidad_bancaria,
                    (SELECT d.denominacion FROM cstd01_entidades_bancarias d WHERE d.cod_entidad_bancaria=a.cod_entidad_bancaria) as deno_entidad_bancaria,
                    a.cod_sucursal,
                    a.cuenta_bancaria,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 or b.tipo_documento=2) AND ((b.fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior') AND (b.fecha_proceso_anulacion < '01/01/2000' OR b.fecha_proceso_anulacion > '$fecha_anterior'))) as suma_anterior,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 or b.tipo_documento=4) AND ((b.fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior') AND (b.fecha_proceso_anulacion < '01/01/2000' OR b.fecha_proceso_anulacion > '$fecha_anterior'))) as resta_anterior,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND b.tipo_documento=3 AND colocacion=1 AND condicion_actividad=1 AND b.fecha_documento = '$fecha_inicial') as colocacion,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND b.tipo_documento=2 AND colocacion=1 AND condicion_actividad=1 AND b.fecha_documento = '$fecha_inicial') as rendimiento,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 or b.tipo_documento=2) AND b.fecha_documento = '$fecha_inicial' AND b.fecha_proceso_anulacion != '$fecha_inicial') as ingresos,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 or b.tipo_documento=4) AND b.fecha_documento = '$fecha_inicial' AND b.fecha_proceso_anulacion != '$fecha_inicial') as egresos,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 or b.tipo_documento=4) AND b.fecha_proceso_anulacion = '$fecha_inicial') as ingresos_anul,
                    (SELECT Sum(monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 or b.tipo_documento=2) AND b.fecha_proceso_anulacion = '$fecha_inicial') as egresos_anul
                FROM
                    cstd02_cuentas_bancarias a
                WHERE
                    ".$sql_opcion_2."
                ORDER BY
                    ".$order.";";

            $vector_cuentas = $this->v_cstd_mov_gral->execute($sql);

            /*
            $distinct = $this->v_cstd_mov_gral->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, cod_entidad_bancaria, cod_sucursal, cuenta_bancaria from cstd02_cuentas_bancarias where ".$sql_opcion_2." order by ".$order);
            for($i=0;$i<count($distinct);$i++){
                $cod_presi      = $distinct[$i][0]['cod_presi'];
                $cod_entidad    = $distinct[$i][0]['cod_entidad'];
                $cod_tipo_inst  = $distinct[$i][0]['cod_tipo_inst'];
                $cod_inst       = $distinct[$i][0]['cod_inst'];
                $cod_dep        = $distinct[$i][0]['cod_dep'];
                $cod_entidad_ban= $distinct[$i][0]['cod_entidad_bancaria'];
                $cod_sucursal   = $distinct[$i][0]['cod_sucursal'];
                $cod_cuenta     = $distinct[$i][0]['cuenta_bancaria'];

                $sql = "SELECT
                        a.cod_presi,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        (SELECT c.denominacion FROM arrd05 c WHERE c.cod_presi=a.cod_presi AND c.cod_entidad=a.cod_entidad AND c.cod_tipo_inst=a.cod_tipo_inst AND c.cod_inst=a.cod_inst AND c.cod_dep=a.cod_dep) as deno_dep,
                        a.cod_entidad_bancaria,
                        (SELECT d.denominacion FROM cstd01_entidades_bancarias d WHERE d.cod_entidad_bancaria=a.cod_entidad_bancaria) as deno_entidad_bancaria,
                        a.cod_sucursal,
                        a.cuenta_bancaria,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 or b.tipo_documento=2) AND ((b.fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior') AND (b.fecha_proceso_anulacion < '01/01/2000' OR b.fecha_proceso_anulacion >= '$fecha_anterior'))) as suma_anterior,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 or b.tipo_documento=4) AND ((b.fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior') AND (b.fecha_proceso_anulacion < '01/01/2000' OR b.fecha_proceso_anulacion >= '$fecha_anterior'))) as resta_anterior,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND b.tipo_documento=3 AND colocacion=1 AND condicion_actividad=1 AND b.fecha_documento = '$fecha_inicial') as colocacion,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND b.tipo_documento=2 AND colocacion=1 AND condicion_actividad=1 AND b.fecha_documento = '$fecha_inicial') as rendimiento,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 or b.tipo_documento=2) AND b.fecha_documento = '$fecha_inicial' AND b.fecha_proceso_anulacion != '$fecha_inicial') as ingresos,
                        (SELECT Sum(b.monto) FROM v_cstd_mov_gral b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst AND b.cod_dep=a.cod_dep AND b.cod_entidad_bancaria=a.cod_entidad_bancaria AND b.cod_sucursal=a.cod_sucursal AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 or b.tipo_documento=4) AND b.fecha_documento = '$fecha_inicial' AND b.fecha_proceso_anulacion != '$fecha_inicial') as egresos
                    FROM
                        cstd02_cuentas_bancarias a
                    WHERE
                        a.cod_presi = '$cod_presi' AND
                        a.cod_entidad = '$cod_entidad' AND
                        a.cod_tipo_inst = '$cod_tipo_inst' AND
                        a.cod_inst = '$cod_inst' AND
                        a.cod_dep = '$cod_dep' AND
                        a.cod_entidad_bancaria = '$cod_entidad_ban' AND
                        a.cod_sucursal = '$cod_sucursal' AND
                        a.cuenta_bancaria = '$cod_cuenta'
                    GROUP BY
                        a.cod_presi,
                        a.cod_entidad,
                        a.cod_tipo_inst,
                        a.cod_inst,
                        a.cod_dep,
                        a.cod_entidad_bancaria,
                        a.cod_sucursal,
                        a.cuenta_bancaria";

                        $vector_cuentas[$i] = $this->v_cstd_mov_gral->execute($sql);

                */


                /*

                $vector_cuentas_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_anterior from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=1 or tipo_documento=2) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $vector_resta_anterior[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_anterior from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=3 or tipo_documento=4) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $suma_anterior_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_anterior_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=1 or tipo_documento=2) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $resta_anterior_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_anterior_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and (fecha BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $suma_actual[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_actual from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=1 or tipo_documento=2) and fecha='$fecha_inicial'");
                $resta_actual[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and (tipo_documento=3 or tipo_documento=4) and fecha='$fecha_inicial'");

                $suma_actual_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as suma_actual_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=1 or tipo_documento=2) and fecha='$fecha_inicial' and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");
                $resta_actual_anu[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual_anu from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and fecha='$fecha_inicial' and (fecha_documento BETWEEN '01/01/2000' AND '$fecha_anterior')");

                $resta_actual_anulados[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as resta_actual_anulados from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=2 and (tipo_documento=3 or tipo_documento=4) and fecha_documento='$fecha_inicial' and fecha_proceso_anulacion='$fecha_inicial'");

                $colocacion[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as colocacion from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and tipo_documento=3 and colocacion=1 and fecha='$fecha_inicial'");
                $rendimiento[$i] = $this->v_cstd_mov_gral->execute("select Sum(monto) as rendimiento from v_cstd_mov_general where ".$sql_opcion." and cod_entidad_bancaria='$cod_entidad_ban' and cod_sucursal='$cod_sucursal' and cuenta_bancaria='$cod_cuenta' and tipo=1 and tipo_documento=2 and colocacion=1 and fecha='$fecha_inicial'");

                */
            //}

            //$condicion_inst = "cod_presi=".$this->verifica_SS(1)." and cod_entidad=".$this->verifica_SS(2)." and cod_tipo_inst=".$this->verifica_SS(3)." and cod_inst=".$this->verifica_SS(4);
            //$dependencias   = $this->arrd05->findAll($condicion_inst, null, 'cod_dep ASC');
            //$k=0;
            //foreach($dependencias AS $d){
            //  $k++;
            //  $lista_dep[$d['arrd05']['cod_dep']] = $d['arrd05']['denominacion'];
            //}

            //$this->set('suma_anterior_anu',$suma_anterior_anu);
            //$this->set('resta_anterior_anu',$resta_anterior_anu);
            //$this->set('suma_actual',$suma_actual);
            //$this->set('resta_actual',$resta_actual);
            //$this->set('suma_actual_anu',$suma_actual_anu);
            //$this->set('resta_actual_anu',$resta_actual_anu);
            //$this->set('resta_actual_anulados',$resta_actual_anulados);
            //$this->set('colocacion',$colocacion);
            //$this->set('rendimiento',$rendimiento);

            //$this->set('vector_banco',$vector_banco);

            //$this->set('distinct',$distinct);
            //$this->set('vector_cuentas_anterior',$vector_cuentas_anterior);
            //$this->set('vector_resta_anterior',$vector_resta_anterior);
            $this->set('fecha_anterior',$fecha_anterior);
            $this->set('fecha_actual',$fecha_inicial);

            //$this->set('lista_dep',$lista_dep);
            $this->set('agrupamiento',$agrupamiento);

            $this->set('vector_cuentas',$vector_cuentas);

            /*
            $sql_datos = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_entidad_bancaria, a.cuenta_bancaria,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 OR b.tipo_documento=2) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=1) as suma_anterior_activos,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 OR b.tipo_documento=4) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=1) as resta_anterior_activos,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=1 OR b.tipo_documento=2) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=2) as suma_anterior_anul,
                (SELECT Sum(b.monto) as monto FROM v_cstd_mov_general b WHERE b.cod_dep=a.cod_dep AND b.cuenta_bancaria=a.cuenta_bancaria AND (b.tipo_documento=3 OR b.tipo_documento=4) AND (b.fecha BETWEEN '01/01/2000' AND '05/01/2009') AND b.tipo=2) as resta_anterior_anul
            FROM v_cstd_mov_general a WHERE a.cod_presi='1' AND a.cod_entidad='11' AND a.cod_tipo_inst='30' AND a.cod_inst='11' AND a.cod_dep='1' GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, cod_dep, a.cod_entidad_bancaria, a.cuenta_bancaria ORDER BY a.cod_entidad_bancaria, a.cuenta_bancaria;";

            $datos = $this->v_cstd_mov_gral->execute($sql_datos);
            $this->set('datos',$datos);
             */
        }
    }
}


function selectEntidadBancaria($var=null){
    $this->layout="ajax";

    if($var!=null && $var==3){
        $ent_bancarias = $this->cstd01_entidades_bancarias->generateList(null, 'cod_entidad_bancaria ASC', null, '{n}.cstd01_entidades_bancarias.cod_entidad_bancaria', '{n}.cstd01_entidades_bancarias.denominacion');
        $this->set('ent_bancarias',$ent_bancarias);
        $this->set('Message_existe',"Puede seleccionar la entidad bancaria");
    }
    $this->set('var',$var);
}




/** OPCIONFECHA
 * Orden de pago:       1
 * Registro compromiso: 2
 * Orden compra:        3
 */
function opcionfecha($documento=null, $var1=null){
    $this->layout="ajax";
    //$documento: Indica si es una orden de pago:1 -- registro de compromiso:2 -- orden de compra:3
    $this->set('documento',$documento);



echo "<script>";
  echo "document.getElementById('td-fecha').innerHTML='';";
echo "</script>";



}

function seleccionarfecha($documento=null,$opcion=null){
    $this->layout="ajax";
    //$documento: Indica si es una orden de pago:1 -- registro de compromiso:2 -- orden de compra:3
    //$opcion: Indica si marco la opcion de generar todos o generar por fecha.
    if($opcion!=null){
    $this->set('documento',$documento);
    $this->set('opcion',$opcion);
    }
}

function vacio(){
    $this->layout="ajax";
    $this->Session->delete('ano_consulta_actaanul');
}




function reportes_creditos($ir=null){
    $this->Session->write('tipo_reporte', 'reportes_creditos');
    if($ir=="si"){
        $this->layout="ajax";
        $this->set('ir','si');
        $this->set('ano',$this->ano_ejecucion());
        $this->set('mes', date('m'));
    }else if($ir=="no" && $this->data["reporte"]["ano"]!="" && isset($this->data["reporte"]["modo"])){
        //print_r($this->data);
            $this->layout="pdf";
            $this->set('ir','no');
            $this->set('ano',$this->data["reporte"]["ano"]);
    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
            $Ano=$this->data["reporte"]["ano"];
    }else{
            $Ano=$this->ano_ejecucion();
    }
            if(isset($this->data["reporte"]["tipo_recurso"])){
                $tipo_recurso=$this->data["reporte"]["tipo_recurso"];
            }else{
                $tipo_recurso=0;
            }
            $this->set('tipo_recurso',$this->data["reporte"]["tipo_recurso"]);
            $modo=$this->data["reporte"]["modo"];
            if(isset($this->data["cfpp05"]["consolidacion"])){
                $tipo=$this->data["cfpp05"]["consolidacion"];
                $cond_codigos=$this->SQLCA_consolidado($tipo);
            }else{
                $cond_codigos=$this->SQLCA_consolidado();
                $tipo=2;
            }
            if(isset($this->data["cfpp05"]["frecuencia"]) && !empty($this->data["cfpp05"]["frecuencia"])){
                $frecuencia = $this->data["cfpp05"]["frecuencia"];
            }else{
                $frecuencia = 5;
            }
            if(isset($this->data["cfpp05"]["tipo_gasto"])){
                $tipo_gasto = $this->data["cfpp05"]["tipo_gasto"];
            }else{
                $tipo_gasto = 0;
            }



/*
               if($consolidacion!=1){
                    $tabla="v_credito_agrupado_dep2";
                }else{
                    $tabla="v_credito_agrupado_inst2";
                }
*/

         // $sql_opcion = $this->SQLCA_consolidado($consolidacion);



                                                        // *** TIPO DE GASTO ****

        $this->set('tipo_gasto',$tipo_gasto);
        switch ($tipo_gasto) {
            case 0:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=2 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Inversion, Situado y Transferencia
                break;
            case 1:
                $cod_tipo_gasto = " and a.cod_tipo_gasto=2 "; // Inversion
                break;
            case 2:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Situado y Transferencia
                break;

            default:
                break;
        }

                                                    // *** TIPO DE RECURSOS ****

        $this->set('tipo_recurso',$tipo_recurso);

        if($tipo_recurso==0 || $tipo_recurso=='0'){
            $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6 OR a.tipo_presupuesto= 7 OR a.tipo_presupuesto= 8) ";
        }else{
            $cond_tipo_recurso= " and a.tipo_presupuesto=".$tipo_recurso;
        }


        /*
        switch ($tipo_recurso) {
            case 0:
                $cond_tipo_recurso= " and (tipo_presupuesto= 1 OR tipo_presupuesto= 2 OR tipo_presupuesto= 3 OR tipo_presupuesto= 4 OR tipo_presupuesto= 5 OR tipo_presupuesto= 6) ";
                break;
            case 1:
                $cond_tipo_recurso= " and tipo_presupuesto= 1 "; // Ordinario
                break;
            case 2:
                $cond_tipo_recurso= " and tipo_presupuesto= 2 "; // Coordinado
                break;
            case 3:
                $cond_tipo_recurso= " and tipo_presupuesto= 3 "; // Fci
                break;
            case 4:
                $cond_tipo_recurso= " and tipo_presupuesto= 4 "; // Mpps
                break;
            case 5:
                $cond_tipo_recurso= " and tipo_presupuesto= 5 "; // Ingresos Extraordinarios
                break;
            case 6:
                $cond_tipo_recurso= " and tipo_presupuesto= 6 "; // Ingresos Propios
                break;
            case 7:
                $cond_tipo_recurso= " and tipo_presupuesto= 7 "; // Ingresos Extraordinarios
                break;
            case 8:
                $cond_tipo_recurso= " and tipo_presupuesto= 8 "; // Ingresos Propios
                break;

            default:
                break;
        }
        */

        

        switch ($frecuencia) {
            case 2://FRECUENCIA MENSUAL
                $_SESSION['frecuencia']= "MENSUAL";
                $mes = $this->data['cfpp05']['mes'];

                switch ($mes) {//MESES
                    case 1://ENERO
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/01/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene)) as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene) as compromisos,";
                        $causado = "SUM(a.causado_ene) as causado,";
                        $pagado = "SUM(a.pagado_ene) as pagado";
                        break;
                    case 2://FEBRERO
                        $_SESSION['fecha']="01/02/".$Ano." hasta 28/02/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb)) as pagado";
                        break;

                    case 3://MARZO
                        $_SESSION['fecha']="01/03/".$Ano." hasta 31/03/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar)) as pagado";
                        break;

                    case 4://ABRIL
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/04/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr)) as pagado";
                        break;

                    case 5://MAYO
                        $_SESSION['fecha']="01/05/".$Ano." hasta 31/05/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may)) as pagado";
                        break;

                    case 6://JUNIO
                        $_SESSION['fecha']="01/06/".$Ano." hasta 30/06/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagado";
                        break;

                    case 7://JULIO
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/07/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul)) as pagado";
                        break;

                    case 8://AGOSTO
                        $_SESSION['fecha']="01/08/".$Ano." hasta 31/08/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago)) as pagado";
                        break;

                    case 9://SEPTIEMBRE
                        $_SESSION['fecha']="01/09/".$Ano." hasta 30/09/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep)) as pagado";
                        break;

                    case 10://OCTUBRE
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/10/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct)) as pagado";
                        break;

                    case 11://NOVIEMBRE
                        $_SESSION['fecha']="01/11/".$Ano." hasta 30/11/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct) + SUM(a.aumento_traslado_nov) + SUM(a.credito_adicional_nov)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.rebaja_nov)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct) + SUM(a.causado_nov)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov)) as pagado";
                        break;

                    case 12://DICIEMBRE
                        $_SESSION['fecha']="01/12/".$Ano." hasta 31/12/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct) + SUM(a.aumento_traslado_nov) + SUM(a.credito_adicional_nov) + SUM(a.aumento_traslado_dic) + SUM(a.credito_adicional_dic)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.rebaja_nov) + SUM(a.disminucion_traslado_dic) + SUM(a.rebaja_dic)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct) + SUM(a.causado_nov) + SUM(a.causado_dic)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagado";
                        break;

                    default:
                        break;
                }

                break;
            case 3://FRECUENCIA TRIMESTRAL
                $_SESSION['frecuencia']= "TRIMESTRAL";
                $trimestre = $this->data['cfpp05']['trimestre'];

                switch ($trimestre) {
                    case 1:
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar)) as pagado";
                        break;

                    case 2:
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/06/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagado";
                        break;

                    case 3:
                        $_SESSION['fecha']="01/07/".$Ano." hasta 30/09/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep)) as pagado";
                        break;
                    case 4:
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/12/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct) + SUM(a.aumento_traslado_nov) + SUM(a.credito_adicional_nov) + SUM(a.aumento_traslado_dic) + SUM(a.credito_adicional_dic)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.rebaja_nov) + SUM(a.disminucion_traslado_dic) + SUM(a.rebaja_dic)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct) + SUM(a.causado_nov) + SUM(a.causado_dic)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagado";
                        break;

                    default:
                        break;
                }

                break;
            case 4://FRECUENCIA SEMESTRAL
                $_SESSION['frecuencia']= "SEMESTRAL";
                $semestre = $this->data['cfpp05']['semestre'];

                switch ($semestre) {
                    case 1://SEMESTRE 1
                        $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagado";
                        break;

                    case 2://SEMESTRE 2
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/12/".$Ano;
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct) + SUM(a.aumento_traslado_nov) + SUM(a.credito_adicional_nov) + SUM(a.aumento_traslado_dic) + SUM(a.credito_adicional_dic)) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.rebaja_nov) + SUM(a.disminucion_traslado_dic) + SUM(a.rebaja_dic)) as disminucion,";
                        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
                        $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct) + SUM(a.causado_nov) + SUM(a.causado_dic)) as causado,";
                        $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagado";
                        break;

                    default:
                        break;
                }

                break;
            case 5://FRECUENCIA ANUAL
                $_SESSION['frecuencia']= "ANUAL";
                $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
                $asignacion= "(SUM(a.asignacion_anual)) as asignacion_anual,";
                $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.credito_adicional_ene) + SUM(a.aumento_traslado_feb) + SUM(a.credito_adicional_feb) + SUM(a.aumento_traslado_mar) + SUM(a.credito_adicional_mar) + SUM(a.aumento_traslado_abr) + SUM(a.credito_adicional_abr) + SUM(a.aumento_traslado_may) + SUM(a.credito_adicional_may) + SUM(a.aumento_traslado_jun) + SUM(a.credito_adicional_jun) + SUM(a.aumento_traslado_jul) + SUM(a.credito_adicional_jul) + SUM(a.aumento_traslado_ago) + SUM(a.credito_adicional_ago) + SUM(a.aumento_traslado_sep) + SUM(a.credito_adicional_sep) + SUM(a.aumento_traslado_oct) + SUM(a.credito_adicional_oct) + SUM(a.aumento_traslado_nov) + SUM(a.credito_adicional_nov) + SUM(a.aumento_traslado_dic) + SUM(a.credito_adicional_dic)) as aumento,";
                $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.rebaja_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.rebaja_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.rebaja_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.rebaja_abr) + SUM(a.disminucion_traslado_may) + SUM(a.rebaja_may) + SUM(a.disminucion_traslado_jun) + SUM(a.rebaja_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.rebaja_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.rebaja_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.rebaja_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.rebaja_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.rebaja_nov) + SUM(a.disminucion_traslado_dic) + SUM(a.rebaja_dic)) as disminucion,";
                $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
                $causado = "(SUM(a.causado_ene) + SUM(a.causado_feb) + SUM(a.causado_mar) + SUM(a.causado_abr) + SUM(a.causado_may) + SUM(a.causado_jun) + SUM(a.causado_jul) + SUM(a.causado_ago) + SUM(a.causado_sep) + SUM(a.causado_oct) + SUM(a.causado_nov) + SUM(a.causado_dic)) as causado,";
                $pagado = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagado";
                break;

            default:
                break;
        }


    /* *****--- REPORTES POR INSTITUCION ---***** */
    if($tipo==1){
        switch($modo){
            // POR SECTOR
            case 1:
            $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true, $this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ASC";
            break;
            // POR SECTOR - PROGRAMA
            case 2:
              $sql = "(SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true, $this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa) ORDER BY 1, 2, 3, 4, 5, 6, 7 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA
            case 3:
              $sql = "((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - PARTIDA
            case 4:
             $sql = "(((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - SUB-PARTIDA
            case 5:
              $sql = "((((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 ASC";
            break;
            // POR SECTOR - PROGRAMA - PARTIDA
            case 6:
             $sql = "((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PARTIDA
            case 7:
              $sql = "(((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ASC";
            break;
            // POR SECTOR - PARTIDA
            case 8:
              $sql = "(SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7 ASC";
            break;
            // POR SECTOR - SUB-PARTIDA
            case 9:
              $sql = "((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ASC";
            break;
            // PARTIDA
            case 10:
                $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, upper(( SELECT a1.denominacion
                        FROM cfpd01_ano_2_partida a1
                        WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                        LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                        ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida ASC";
            break;

            // SUB-PARTIDA
            case 11:
              $sql = "(((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;

            default:
                break;
        }
    }/* *****--- REPORTES POR DEPENDENCIAS ---***** */
    else if($tipo==2){
        switch($modo){
            // POR SECTOR
            case 1:
            $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ASC";
            break;
            // POR SECTOR - PROGRAMA
            case 2:
            $sql = "(SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA
            case 3:
            $sql = "((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - PARTIDA
            case 4:
            $sql = "(((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - SUB-PARTIDA
            case 5:
            $sql = "((((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13 ASC";
            break;

            // POR SECTOR - PROGRAMA - PARTIDA
            case 6:
            $sql = "((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;

            // POR SECTOR - PROGRAMA - SUB-PARTIDA
            case 7:
            $sql = "(((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 ASC";
            break;

            // POR SECTOR - PARTIDA
            case 8:
            $sql = "(SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;

            // POR SECTOR - SUB-PARTIDA
            case 9:
            $sql = "((((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ASC";
            break;

            // PARTIDA
            case 10:
                $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, upper(( SELECT a1.denominacion
                        FROM cfpd01_ano_2_partida a1
                        WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                        LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                        ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida ASC";
            break;

            // SUB-PARTIDA
            case 11:
            $sql = "(((SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ASC";
            break;

            default:
                break;
        }/* *****--- REPORTE DECENTRALIZADO ---***** */
    }else if($tipo==3){
        switch($modo){
            // POR SECTOR
            case 1:
                $sql = "SELECT a.ano, a.cod_sector, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE  ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >=1000 GROUP BY a.ano, a.cod_sector
                    ORDER BY a.ano, a.cod_sector ASC";
            break;
            // POR SECTOR - PROGRAMA
            case 2:
                $sql = "(SELECT a.ano, a.cod_sector, 0 AS cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE  ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA
            case 3:
                $sql = "((SELECT a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - PARTIDA
            case 4:
                $sql = "(((SELECT a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ASC";
            break;
            // POR SECTOR - PROGRAMA - SUB-PROGRAMA - SUB-PARTIDA
            case 5:
                $sql = "((((((SELECT a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, 0 AS cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sub_prog a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_sub_prog, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13 ASC";
            break;

            // POR SECTOR - PROGRAMA - PARTIDA
            case 6:
            $sql = "((SELECT a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9 ASC";
            break;

            // POR SECTOR - PROGRAMA - SUB-PARTIDA
            case 7:
            $sql = "(((((SELECT a.ano, a.cod_sector, 0 AS cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_programa a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_partida)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_programa, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 ASC";
            break;

            // POR SECTOR - PARTIDA
            case 8:
            $sql = "(SELECT a.ano, a.cod_sector, 0 AS cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_partida, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_partida) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8 ASC";
            break;

            // POR SECTOR - SUB-PARTIDA
            case 9:
            $sql = "((((SELECT a.ano, a.cod_sector, 0 AS cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd02_sector a1
                    WHERE a1.ano = a.ano AND a1.cod_sector = a.cod_sector
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_partida)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    and cod_dep >= 1000 GROUP BY a.ano, a.cod_sector, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ASC";
            break;

            // PARTIDA
            case 10:
                $sql = "SELECT a.ano, a.cod_partida, upper(( SELECT a1.denominacion
                        FROM cfpd01_ano_2_partida a1
                        WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                        LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE  ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                        and cod_dep >= 1000 GROUP BY a.ano, a.cod_partida
                        ORDER BY a.ano, a.cod_partida ASC";
            break;

            // SUB-PARTIDA
            case 11:
            $sql = "(((SELECT a.ano, a.cod_partida, 0 AS cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_2_partida a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.ano, a.cod_partida
                    UNION
                    SELECT a.ano, a.cod_partida, a.cod_generica, 0 AS cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_3_generica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.ano, a.cod_partida, a.cod_generica)
                    UNION
                    SELECT a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, 0 AS cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_4_especifica a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.ano, a.cod_partida, a.cod_generica, a.cod_especifica)
                    UNION
                    SELECT a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec, upper(( SELECT a1.denominacion
                    FROM cfpd01_ano_5_sub_espec a1
                    WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec
                    LIMIT 1)) AS denominacion, ".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$cond_codigos." and ano=".$Ano.$cod_tipo_gasto.$cond_tipo_recurso.$this->exclusion_presupuesto(true,$this->data['cfpp05']['consolidacion'],$Ano)."
                    GROUP BY a.ano, a.cod_partida, a.cod_generica, a.cod_especifica, a.cod_sub_espec) ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ASC";
            break;

            default:
                break;
        }
    }

        $this->set('vista',0);
        $this->set('modo',$modo);
        $data1 = $this->ccfd01_tipo->execute($sql);
        $this->set('datos',$data1);
    }else{
        $this->layout="pdf";
        $this->set('vacio','');
    }

}//fin reportes_creditos

function estado_cuenta_proveedores_form () {
    $this->layout="ajax";
    $Ano=$this->ano_ejecucion();
    $_SESSION['buscar_year_proveed'] = $Ano;
    $this->set('ANO',$Ano);

}//estado_cuentas_proveedores_form

function estado_cuenta_proveedores () {
    set_time_limit(0);
    ini_set("memory_limit","1536M");

    $this->layout="pdf";

     $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);



        if(isset($this->data['cfpp05']['consolidacion'])){
            $con    = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
             $con_a = $this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
        }else{
            $con=$this->SQLCA_consolidado();
            $con_a=$this->SQLCA_consolidado_opcion(null, "a");
        }


        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        $con_rif = "";
        if($this->data['reporte2']['proveed'] == 4){
            if(isset($this->data['reporte2']['rif_prov'])){
                $rif = $this->data['reporte2']['rif_prov'];
                $con_rif = " and a.rif='$rif' ";
            }
        }

     $estado_cuenta_proveedores=$this->cscd04_ordencompra_encabezado->execute("SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
a.cod_dep,
a.ano_orden_compra,
a.numero_orden_compra,
a.tipo_orden,
a.fecha_orden_compra,
a.rif,
upper(a.razon_social) as razon_social,
a.monto_orden,a.modificacion_aumento,a.modificacion_disminucion,
a.monto_anticipo,
a.monto_amortizacion,
a.monto_cancelado,
b.ano_orden_pago,
b.numero_orden_pago,
b.monto_orden_pago,
b.monto_neto_cobrar,
null_cero((SELECT c.monto FROM cstd07_retenciones_cuerpo_islr c WHERE
b.cod_presi=c.cod_presi and
b.cod_entidad=c.cod_entidad and
b.cod_tipo_inst=c.cod_tipo_inst and
b.cod_inst=c.cod_inst and
b.cod_dep=c.cod_dep and
b.ano_orden_pago=c.ano_orden_pago and
b.numero_orden_pago = c.numero_orden_pago and c.status=2)) as monto_isrl,
(SELECT c.numero_cheque FROM cstd07_retenciones_cuerpo_islr c WHERE
b.cod_presi=c.cod_presi and
b.cod_entidad=c.cod_entidad and
b.cod_tipo_inst=c.cod_tipo_inst and
b.cod_inst=c.cod_inst and
b.cod_dep=c.cod_dep and
b.ano_orden_pago=c.ano_orden_pago and
b.numero_orden_pago = c.numero_orden_pago and c.status=2) as cheque_isrl,
(SELECT c.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_islr c WHERE
b.cod_presi=c.cod_presi and
b.cod_entidad=c.cod_entidad and
b.cod_tipo_inst=c.cod_tipo_inst and
b.cod_inst=c.cod_inst and
b.cod_dep=c.cod_dep and
b.ano_orden_pago=c.ano_orden_pago and
b.numero_orden_pago = c.numero_orden_pago and c.status=2) as fecha_isrl,
null_cero((SELECT d.monto FROM cstd07_retenciones_cuerpo_iva d WHERE
b.cod_presi=d.cod_presi and
b.cod_entidad=d.cod_entidad and
b.cod_tipo_inst=d.cod_tipo_inst and
b.cod_inst=d.cod_inst and
b.cod_dep=d.cod_dep and
b.ano_orden_pago=d.ano_orden_pago and
b.numero_orden_pago = d.numero_orden_pago and d.status=2)) as monto_iva,
(SELECT d.numero_cheque FROM cstd07_retenciones_cuerpo_iva d WHERE
b.cod_presi=d.cod_presi and
b.cod_entidad=d.cod_entidad and
b.cod_tipo_inst=d.cod_tipo_inst and
b.cod_inst=d.cod_inst and
b.cod_dep=d.cod_dep and
b.ano_orden_pago=d.ano_orden_pago and
b.numero_orden_pago = d.numero_orden_pago and d.status=2) as cheque_iva,
(SELECT d.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_iva d WHERE
b.cod_presi=d.cod_presi and
b.cod_entidad=d.cod_entidad and
b.cod_tipo_inst=d.cod_tipo_inst and
b.cod_inst=d.cod_inst and
b.cod_dep=d.cod_dep and
b.ano_orden_pago=d.ano_orden_pago and
b.numero_orden_pago = d.numero_orden_pago and d.status=2) as fecha_iva,
null_cero((SELECT e.monto FROM cstd07_retenciones_cuerpo_municipal e WHERE
b.cod_presi=e.cod_presi and
b.cod_entidad=e.cod_entidad and
b.cod_tipo_inst=e.cod_tipo_inst and
b.cod_inst=e.cod_inst and
b.cod_dep=e.cod_dep and
b.ano_orden_pago=e.ano_orden_pago and
b.numero_orden_pago = e.numero_orden_pago and e.status=2)) as monto_municipal,
(SELECT e.numero_cheque FROM cstd07_retenciones_cuerpo_municipal e WHERE
b.cod_presi=e.cod_presi and
b.cod_entidad=e.cod_entidad and
b.cod_tipo_inst=e.cod_tipo_inst and
b.cod_inst=e.cod_inst and
b.cod_dep=e.cod_dep and
b.ano_orden_pago=e.ano_orden_pago and
b.numero_orden_pago = e.numero_orden_pago and e.status=2) as cheque_municipal,
(SELECT e.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_municipal e WHERE
b.cod_presi=e.cod_presi and
b.cod_entidad=e.cod_entidad and
b.cod_tipo_inst=e.cod_tipo_inst and
b.cod_inst=e.cod_inst and
b.cod_dep=e.cod_dep and
b.ano_orden_pago=e.ano_orden_pago and
b.numero_orden_pago = e.numero_orden_pago and e.status=2) as fecha_municipal,
null_cero((SELECT f.monto FROM cstd07_retenciones_cuerpo_timbre f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2)) as monto_timbre,
(SELECT f.numero_cheque FROM cstd07_retenciones_cuerpo_timbre f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as cheque_timbre,
(SELECT f.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_timbre f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as fecha_timbre,






null_cero((SELECT f.monto FROM cstd07_retenciones_cuerpo_multa f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2)) as monto_multa,
(SELECT f.numero_cheque FROM cstd07_retenciones_cuerpo_multa f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as cheque_multa,
(SELECT f.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_multa f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as fecha_multa,






null_cero((SELECT f.monto FROM cstd07_retenciones_cuerpo_responsabilidad f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2)) as monto_responsabilidad,
(SELECT f.numero_cheque FROM cstd07_retenciones_cuerpo_responsabilidad f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as cheque_responsabilidad,
(SELECT f.fecha_proceso_registro FROM cstd07_retenciones_cuerpo_responsabilidad f WHERE
b.cod_presi=f.cod_presi and
b.cod_entidad=f.cod_entidad and
b.cod_tipo_inst=f.cod_tipo_inst and
b.cod_inst=f.cod_inst and
b.cod_dep=f.cod_dep and
b.ano_orden_pago=f.ano_orden_pago and
b.numero_orden_pago = f.numero_orden_pago and f.status=2) as fecha_responsabilidad,








b.fecha_orden_pago,
b.fecha_cheque,
b.numero_cheque,
(SELECT denominacion FROM cstd01_entidades_bancarias x WHERE x.cod_entidad_bancaria=b.cod_entidad_bancaria) as entidad_bancaria
   FROM v_cscd04_ordencompra a, cepd03_ordenpago_cuerpo b
WHERE
a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.ano_orden_compra=b.ano_documento_origen and
a.numero_orden_compra::varchar(30)=b.numero_documento_origen::varchar(30) and
(b.cod_tipo_documento=2 OR b.cod_tipo_documento=3) and
b.condicion_actividad=1 and b.numero_cheque!=0 and ".$con_a." and a.ano_orden_compra=".$Ano.$con_rif." ORDER BY a.rif, a.numero_orden_compra ASC");

$this->set("estado_cuenta_proveedores",$estado_cuenta_proveedores);

}//estado_cuenta_proveedore

function acta_anulacion_op_form () {
    $this->layout="ajax";


}

function acta_anulacion_op () {
    $this->layout="pdf";


}



function cheques_en_caja($ir=null){
    $this->layout="ajax";

    if($ir!=null){
            if($ir=='si'){//IR AL FOMULARIO
                $this->layout="ajax";
                $this->set('ir',$ir);
                $this->set('ano',$this->ano_ejecucion());
            }elseif($ir=='no'){//IR AL REPORTE
                $this->layout="pdf";
                $ano_mov = $this->data['cheques_caja']['ano'];

                $fecha_desde = $this->data['reporte']['fecha_desde'];
                $fecha_hasta = $this->data['reporte']['fecha_hasta'];

                $cond = $this->SQLCA()." and ano_movimiento='$ano_mov' and condicion_actividad=1 and (status_cheque=1 OR status_cheque=2) and (fecha_cheque BETWEEN '".$fecha_desde."' AND '$fecha_hasta')";
                $datos_cheque = $this->cstd03_cheque_cuerpo->findAll($cond,array('ano_movimiento','cuenta_bancaria','numero_cheque','fecha_cheque','beneficiario','monto','cod_tipo_pago'),'cuenta_bancaria, fecha_cheque, numero_cheque ASC');
                $tipo_pago = $this->cepd03_ordenpago_tipopago->findAll();
                $this->set('ir',$ir);
                $this->set('datos_cheque',$datos_cheque);
                $this->set('tipo_pago',$tipo_pago);
                $this->set('fecha_desde',$fecha_desde);
                $this->set('fecha_hasta',$fecha_hasta);
            }
    }//null
}//cheques_en_caja

function reporte_credito_presupuestario_dependencia ($var=null) {
     if(isset($var) && $var=="FORM"){
        $this->layout="ajax";
        $Ano=$this->ano_ejecucion();
        $this->set('ANO',$Ano);
        $this->set('ELFORM',true);
     }else if(isset($var) && $var=="GENERAR"){
        $this->layout="pdf";
        $this->set('ELFORM',false);
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
        }else{
            $con=$this->SQLCA_consolidado();
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        $result=$this->v_credito_presupuestario_dependencia->execute("SELECT * FROM v_credito_presupuestario_dependencia WHERE ano=".$Ano." and ".$con);
        $this->set("DATA",$result);
     }//fin generar


}//fin reporte credito

function devolver_datos_reporte ($mes_seleccion,$Ano,$con,$tipo,$acumulado) {
    $mes=array(1=>'ene',2=>'feb',3=>'mar',4=>'abr',5=>'may',6=>'jun',7=>'jul',8=>'ago',9=>'sep',10=>'oct',11=>'nov',12=>'dic');
        if($acumulado=="SI"){
            for($i=1;$i<=($mes_seleccion-1);$i++){
                $aux[]="b.causado_".$mes[$i];
                $aux1[]="b.monto_".$mes[$i];
            }
            $causado_mes="b.causado_".$mes[$mes_seleccion];
            $causado_mes_ant=implode("+",$aux);
            $monto_ant=implode("+",$aux1);
        }else{
            $monto_ant="b.monto_dic";
            $causado_mes="b.causado_dic";
            $causado_mes_ant="b.causado_".$mes[$mes_seleccion];
        }
        $condicion=$con." and a.ano=".$Ano;
        if($tipo==1){
            $cod_dep1="";
            $cod_dep2="";
            $gr=" ";
        }else{
            $cod_dep1="a.cod_dep,";
            $cod_dep2="AND b.cod_dep=a.cod_dep";
            $gr=", b.cod_dep ";
        }

        $result=$this->v_credito_presupuestario_dependencia->execute("(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
1::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=1 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=1 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=1 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst ".$gr.", b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
2::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=2 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=2 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=2 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
3::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=3 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=3 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=3 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
4::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=4 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=4 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=4 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
5::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=5 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=5 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=5 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
6::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=6 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=6 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=6 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
7::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=7 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=7 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=7 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
8::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND b.cod_sector=8 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=8 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=8 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
9::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=9 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=9 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
10::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=10 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=10 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
11::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=11 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=11 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
12::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=12 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=12 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
13::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=13 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=13 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
14::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst  $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=14 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=14 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
UNION
(SELECT
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano,
15::int4 as cod_sector,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=401 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=401)) as partida_401,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=402 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=402)) as partida_402,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=403 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=403)) as partida_403,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=404 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=404)) as partida_404,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=405 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=405)) as partida_405,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=406 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=406)) as partida_406,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=407 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=407)) as partida_407,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=408 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=408)) as partida_408,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=409 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=409)) as partida_409,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=410 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=410)) as partida_410,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=411 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=411)) as partida_411,
null_cero((SELECT SUM($causado_mes)-null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=498 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=498)) as partida_498,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=401 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=401)) as partida_ant_401,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=402 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=402)) as partida_ant_402,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=403 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=403)) as partida_ant_403,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=404 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=404)) as partida_ant_404,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=405 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=405)) as partida_ant_405,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=406 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=406)) as partida_ant_406,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=407 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=407)) as partida_ant_407,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=408 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=408)) as partida_ant_408,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=409 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=409)) as partida_ant_409,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=410 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=410)) as partida_ant_410,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=411 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=411)) as partida_ant_411,
null_cero((SELECT SUM($causado_mes_ant)-null_cero((SELECT sum($monto_ant) FROM anticipos_anterior2 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=498 GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1."b.ano_documento,b.ano,b.cod_sector,b.cod_partida)) FROM cfpd05 b WHERE b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.cod_partida=498)) as partida_ant_498,
null_cero((SELECT sum(b.monto) FROM cfpd30_reintegro_union_1 b where b.cod_presi=a.cod_presi AND b.cod_entidad=a.cod_entidad AND b.cod_tipo_inst=a.cod_tipo_inst AND b.cod_inst=a.cod_inst $cod_dep2 and b.ano=a.ano AND  b.cod_sector=15 and b.mes=".$mes_seleccion." group by b.cod_presi, b.cod_entidad, b.cod_tipo_inst, b.cod_inst, b.cod_dep, b.ano,b.cod_sector)) as monto_rpv
FROM
cfpd05 a
WHERE
 $condicion
group by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano
order by
a.cod_presi,
a.cod_entidad,
a.cod_tipo_inst,
a.cod_inst,
$cod_dep1
a.ano)
");
//null_cero((SELECT sum(b.monto) FROM anticipos_anterior1 b WHERE b.cod_presi=a.cod_presi and b.cod_entidad=a.cod_entidad and b.cod_tipo_inst=a.cod_tipo_inst and b.cod_inst=a.cod_inst  $cod_dep2 and b.ano_documento=a.ano and b.ano=a.ano and b.cod_sector=15 and b.cod_partida=40 and b.mes=".$mes_seleccion." GROUP BY b.cod_presi,b.cod_entidad,b.cod_tipo_inst,b.cod_inst,".$cod_dep1.",b.ano_documento,b.ano,b.cod_sector,b.cod_partida,b.mes))

 return $result;
}//fin devolver






function reporte_ejecucion_gastos_causados_sectores_partida($var=null){
     $this->layout="ajax";
     if(isset($var) && $var=="FORM"){
        $this->layout="ajax";
        $Ano=$this->ano_ejecucion();
        $this->set('ANO',$Ano);
        $this->set('ELFORM',true);
     }else if(isset($var) && $var=="GENERAR"){
                    $this->layout="pdf";
                    $this->set('ELFORM',false);
                    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
                    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
                          $Ano=$this->data["reporte"]["ano"];
                     }else{
                        $Ano=$this->ano_ejecucion();
                     }
                    $this->set('ANO',$Ano);
                    $this->Session->write('ANO',$Ano);
                                        if(isset($this->data['cfpp05']['consolidacion'])){
                                            $con=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
                                            $tipo=$this->data['cfpp05']['consolidacion'];
                                        }else{
                                            $con=$this->SQLCA_consolidado_opcion(null, "a");
                                            $tipo=2;
                                        }
                    $titulo_a = $this->Session->read('dependencia');
                    $this->set('titulo_a',$titulo_a);
                    if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
                        $this->set("mes",$this->data["reporte"]["mes"]);
                        $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
                        $mes_seleccion=$this->data["reporte"]["mes"];
                        echo "mes es: ".$mes_seleccion;
                     }else{
                        $this->set("mes",date("n"));
                        $this->Session->write("mes_solicitado",date("n"));
                        $mes_seleccion=date("n");
                     }
                    //$meses=array('01'=>'enero','02'=>'febrero','03'=>'marzo','04'=>'abril','05'=>'mayo','06'=>'junio','07'=>'julio','08'=>'agosto','09'=>'septiembre','10'=>'octubre','11'=>'noviembre','12'=>'diciembre');
                    if($mes_seleccion>1){
                        $result2=$this->devolver_datos_reporte($mes_seleccion,$Ano,$con,$tipo,"SI");
                    }else{
                        $result2=$this->devolver_datos_reporte($mes_seleccion,$Ano,$con,$tipo,"NO");
                    }
                        $this->set("DATA2",$result2);
                    //pr($result);
     }//fin genberar
}//


//**************************************************
//          Reporte Historia de los Contratos
//**************************************************
function reporte_historia_contrato($var=null){
    $this->layout="ajax";

    if($var!=null && $var=='no'){//muestra el formulario al usuario (cuando ingresa por primera vez)
        $this->set('ano',$this->ano_ejecucion());
        $this->Session->write('ano_session_reporte2', $this->ano_ejecucion());
        $this->set('pase','no');

    }elseif($var!=null && $var=='si'){//muestra la vista del reporte
        $this->layout="pdf";
        $this->set('pase','si');
        //$this->Session->delete('ano_session_reporte2');
        $ano = $this->data['form_historia_contrato']['ano'];
        $estilo_reporte = $this->data['form_historia_contrato']['estilo_reporte'];

        if(!empty($estilo_reporte) && !empty($ano)){
            $cond = $this->SQLCA();
            $cp  = $this->Session->read('SScodpresi');
            $ce  = $this->Session->read('SScodentidad');
            $cti = $this->Session->read('SScodtipoinst');
            $ci  = $this->Session->read('SScodinst');
            //echo "<br>SScoddep: ".$cd  = $this->Session->read('SScoddep');
            $cd  = $this->Session->read('SScoddep');

            switch($estilo_reporte){
                case '1':
                        $datos_contrato_cuerpo[0] = 0;
                        $datos_anticipos_cuerpo[0] = 0;
                        $datos_valuacion_cuerpo[0] = 0;
                        $datos_retencion_cuerpo[0] = 0;
                        $partidas_contrato[0] = 0;

                        //echo "<br>SScoddeporig: ".$SScoddeporig = $this->Session->read('SScoddeporig');
                        $SScoddeporig = $this->Session->read('SScoddeporig');
                        //$sql_distinct_contratoobra = "SELECT DISTINCT numero_contrato_obra FROM cobd01_contratoobras_cuerpo WHERE cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_contrato_obra='$ano' and condicion_actividad=1 order by numero_contrato_obra;";
                        if($cd==1){
                            $sql_distinct_contratoobra = "
                                    SELECT DISTINCT
                                       a.numero_contrato_obra,
                                       a.cod_dep

                                    FROM cobd01_contratoobras_cuerpo a

                                    WHERE a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and a.condicion_actividad=1 order by a.numero_contrato_obra";
                        }else{
                            $sql_distinct_contratoobra = "SELECT DISTINCT a.numero_contrato_obra, a.cod_dep FROM cobd01_contratoobras_cuerpo a WHERE a.cod_obra=(SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_obra=a.cod_obra and b.ano_estimacion=a.ano_estimacion and b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and b.cod_dep_original='$SScoddeporig') and a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and a.condicion_actividad=1 order by a.numero_contrato_obra";
                        }
                        $distinct_contratoobra = $this->cobd01_contratoobras_cuerpo->execute($sql_distinct_contratoobra);

                        for($i=0; $i<count($distinct_contratoobra); $i++){
                                $num_contrato_obra = $distinct_contratoobra[$i][0]['numero_contrato_obra'];
                                $cod_dep = $distinct_contratoobra[$i][0]['cod_dep'];
                                $condicion = "cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and ano_contrato_obra='$ano' and numero_contrato_obra='$num_contrato_obra'";
                                $condicion22 = "SELECT
                                        a.cod_presi,
                                        a.cod_entidad,
                                        a.cod_tipo_inst,
                                        a.cod_inst,
                                        a.cod_dep,
                                        a.ano_contrato_obra,
                                        a.numero_contrato_obra,
                                        a.ano_estimacion,
                                        a.cod_obra,
                                        a.fecha_contrato_obra,
                                        a.fecha_inicio_contrato,
                                        a.fecha_terminacion_contrato,
                                        a.monto_original_contrato,
                                        a.disminucion,
                                        a.monto_retencion_laboral,
                                        a.monto_retencion_fielcumplimiento,
                                        a.monto_cancelado,
                                        a.monto_anticipo,
                                        a.monto_amortizacion,
                                        (SELECT Sum(monto_retencion_iva) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_retencion_iva,
                                        (SELECT Sum(monto_islr) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_islr,
                                        (SELECT Sum(monto_timbre_fiscal) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_timbre_fiscal,
                                        a.denominacion_obra, a.especifique_ubicacion, a.rif, a.numero_buenapro, a.numero_fianza_anticipo, a.numero_fianza_fielcumplimiento,
                                        (SELECT denominacion FROM cpcd02 p WHERE a.rif=p.rif) as constructora,
                                        (SELECT tipo_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) as tipo_recurso,
                                        (SELECT clasificacion_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) as clasificacion_recurso,
                                        (SELECT denominacion FROM cfpd07_clasificacion_recurso d WHERE a.cod_presi=d.cod_presi and a.cod_entidad=d.cod_entidad and a.cod_tipo_inst=d.cod_tipo_inst and a.cod_inst=d.cod_inst and d.tipo_recurso=(SELECT tipo_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) and d.clasificacion_recurso=(SELECT clasificacion_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra)) as plan_invesion,
                                        (SELECT Sum(monto_modificacion) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1 and mc.tipo_modificacion=1) as monto_modificacion,
                                        (SELECT Sum(aumento_obra_extra) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1) as aumento_obra_extra,
                                        (SELECT Sum(aumento_reconsideracion_precio) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1) as aumento_reconsideracion_precio,
                                        (SELECT Sum(aumento_obras) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1 and mc.tipo_modificacion=1) as aumento_obras
                                    from cobd01_contratoobras_cuerpo a
                                    where
                                        a.cod_presi     = '$cp'  and
                                        a.cod_entidad   = '$ce'  and
                                        a.cod_tipo_inst = '$cti' and
                                        a.cod_inst      = '$ci'  and
                                        a.cod_dep       = '$cod_dep'  and
                                        a.ano_contrato_obra    = '$ano' and
                                        a.numero_contrato_obra = '$num_contrato_obra'";

                            // Se carga el vector
                            $datos_contrato_cuerpo[$i] = $this->cobd01_contratoobras_cuerpo->execute($condicion22);


                            $cond_anticipos="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_anticipo,
                                    a.monto_anticipo,
                                    a.fecha_anticipo,
                                    a.observaciones,
                                    a.condicion_actividad,
                                    a.ano_orden_pago,
                                    a.numero_orden_pago,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_anticipo_cuerpo a
                                where
                                    a.cod_presi     = '$cp' and
                                    a.cod_entidad   = '$ce' and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci' and
                                    a.cod_dep       = '$cod_dep' and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";

                            // Se carga el vector
                            $datos_anticipos_cuerpo[$i] = $this->cobd01_contratoobras_anticipo_cuerpo->execute($cond_anticipos);


                            $cond_valuacion="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_valuacion,
                                    a.monto_neto_cobrar,
                                    a.fecha_valuacion,
                                    a.concepto,
                                    a.condicion_actividad,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_valuacion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cod_dep'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";

                            //Se carga el vector
                            $datos_valuacion_cuerpo[$i] = $this->cobd01_contratoobras_valuacion_cuerpo->execute($cond_valuacion);


                            $cond_retencion="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_retencion,
                                    a.tipo_retencion,
                                    a.monto_neto_cobrar as monto_retencion,
                                    a.fecha_retencion,
                                    a.condicion_actividad,
                                    a.ano_orden_pago,
                                    a.numero_orden_pago,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_retencion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cod_dep'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";

                            //Se carga el vector
                            $datos_retencion_cuerpo[$i] = $this->cobd01_contratoobras_retencion_cuerpo->execute($cond_retencion);
                            //Se carga el vector
                            $partidas_contrato[$i] = $this->cobd01_contratoobras_partidas->findAll($condicion);

                        }//Fin ciclo for

                        $this->set('datos_contrato_cuerpo',$datos_contrato_cuerpo);
                        $this->set('datos_anticipos_cuerpo',$datos_anticipos_cuerpo);
                        $this->set('datos_valuacion_cuerpo',$datos_valuacion_cuerpo);
                        $this->set('datos_retencion_cuerpo',$datos_retencion_cuerpo);
                        $this->set('partidas_contrato',$partidas_contrato);

                        $banco[0]=0;
                        $entidades_banc = $this->cstd01_entidades_bancarias->findAll();
                        foreach($entidades_banc as $ent){
                            $banco[$ent['cstd01_entidades_bancarias']['cod_entidad_bancaria']]=$ent['cstd01_entidades_bancarias']['denominacion'];
                        }

                        $this->set('banco',$banco);
                        $this->set('estilo_reporte',$estilo_reporte);
                        break;

                case '2':
                        $num_contrato_obra = $this->data['form_historia_contrato']['numero_contrato_obra'];
                        if(empty($num_contrato_obra)){
                            echo'<script>history.back(1);</script>';
                        }else{
                            $condicion = "cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and ano_contrato_obra='$ano' and numero_contrato_obra='$num_contrato_obra'";
                            $condicion22 = "SELECT
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.ano_estimacion,
                                    a.cod_obra,
                                    a.fecha_contrato_obra,
                                    a.fecha_inicio_contrato,
                                    a.fecha_terminacion_contrato,
                                    a.monto_original_contrato,
                                    a.disminucion,
                                    a.monto_retencion_laboral,
                                    a.monto_retencion_fielcumplimiento,
                                    a.monto_cancelado,
                                    a.monto_anticipo,
                                    a.monto_amortizacion,
                                    (SELECT Sum(monto_retencion_iva) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_retencion_iva,
                                    (SELECT Sum(monto_islr) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_islr,
                                    (SELECT Sum(monto_timbre_fiscal) FROM cobd01_contratoobras_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_obra=b.ano_contrato_obra and a.numero_contrato_obra=b.numero_contrato_obra and b.condicion_actividad=1) as monto_timbre_fiscal,
                                    a.denominacion_obra, a.especifique_ubicacion, a.rif, a.numero_buenapro, a.numero_fianza_anticipo, a.numero_fianza_fielcumplimiento,
                                    (SELECT denominacion FROM cpcd02 p WHERE a.rif=p.rif) as constructora,
                                    (SELECT tipo_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) as tipo_recurso,
                                    (SELECT clasificacion_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) as clasificacion_recurso,
                                    (SELECT denominacion FROM cfpd07_clasificacion_recurso d WHERE a.cod_presi=d.cod_presi and a.cod_entidad=d.cod_entidad and a.cod_tipo_inst=d.cod_tipo_inst and a.cod_inst=d.cod_inst and d.tipo_recurso=(SELECT tipo_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra) and d.clasificacion_recurso=(SELECT clasificacion_recurso FROM cfpd07_obras_cuerpo c WHERE a.cod_presi=c.cod_presi and a.cod_entidad=c.cod_entidad and a.cod_tipo_inst=c.cod_tipo_inst and a.cod_inst=c.cod_inst and a.cod_dep=c.cod_dep and a.ano_estimacion=c.ano_estimacion and a.cod_obra=c.cod_obra)) as plan_invesion,
                                    (SELECT Sum(monto_modificacion) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1 and mc.tipo_modificacion=1) as monto_modificacion,
                                    (SELECT Sum(aumento_obra_extra) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1) as aumento_obra_extra,
                                    (SELECT Sum(aumento_reconsideracion_precio) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1) as aumento_reconsideracion_precio,
                                    (SELECT Sum(aumento_obras) FROM cobd01_contratoobras_modificacion_cuerpo mc WHERE a.cod_presi=mc.cod_presi and a.cod_entidad=mc.cod_entidad and a.cod_tipo_inst=mc.cod_tipo_inst and a.cod_inst=mc.cod_inst and a.cod_dep=mc.cod_dep and a.ano_contrato_obra=mc.ano_contrato_obra and a.numero_contrato_obra=mc.numero_contrato_obra and mc.condicion_actividad=1 and mc.tipo_modificacion=1) as aumento_obras
                                from cobd01_contratoobras_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";


                            $cond_anticipos="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_anticipo,
                                    a.monto_anticipo,
                                    a.fecha_anticipo,
                                    a.observaciones,
                                    a.condicion_actividad,
                                    a.ano_orden_pago,
                                    a.numero_orden_pago,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_anticipo_cuerpo a
                                where
                                    a.cod_presi     = '$cp' and
                                    a.cod_entidad   = '$ce' and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci' and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";


                            $cond_valuacion="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_valuacion,
                                    a.monto_neto_cobrar,
                                    a.fecha_valuacion,
                                    a.concepto,
                                    a.condicion_actividad,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_valuacion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";


                            $cond_retencion="select
                                    a.cod_presi,
                                    a.cod_entidad,
                                    a.cod_tipo_inst,
                                    a.cod_inst,
                                    a.cod_dep,
                                    a.ano_contrato_obra,
                                    a.numero_contrato_obra,
                                    a.numero_retencion,
                                    a.tipo_retencion,
                                    a.monto_neto_cobrar as monto_retencion,
                                    a.fecha_retencion,
                                    a.condicion_actividad,
                                    a.ano_orden_pago,
                                    a.numero_orden_pago,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cobd01_contratoobras_retencion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_obra    = '$ano' and
                                    a.numero_contrato_obra = '$num_contrato_obra'";

                            $datos_contrato_cuerpo = $this->cobd01_contratoobras_cuerpo->execute($condicion22);
                            $datos_anticipos_cuerpo = $this->cobd01_contratoobras_anticipo_cuerpo->execute($cond_anticipos);
                            $datos_valuacion_cuerpo = $this->cobd01_contratoobras_valuacion_cuerpo->execute($cond_valuacion);
                            $datos_retencion_cuerpo = $this->cobd01_contratoobras_retencion_cuerpo->execute($cond_retencion);
                            $partidas_contrato = $this->cobd01_contratoobras_partidas->findAll($condicion);
                            if($datos_contrato_cuerpo!=null){
                                $this->set('datos_contrato_cuerpo',$datos_contrato_cuerpo);
                                $this->set('datos_anticipos_cuerpo',$datos_anticipos_cuerpo);
                                $this->set('datos_valuacion_cuerpo',$datos_valuacion_cuerpo);
                                $this->set('datos_retencion_cuerpo',$datos_retencion_cuerpo);
                                $this->set('partidas_contrato',$partidas_contrato);
                            }else{
                                $this->set('datos_contrato_cuerpo',null);
                            }
                        }

                        $banco[0]=0;
                        $entidades_banc = $this->cstd01_entidades_bancarias->findAll();
                        foreach($entidades_banc as $ent){
                            $banco[$ent['cstd01_entidades_bancarias']['cod_entidad_bancaria']]=$ent['cstd01_entidades_bancarias']['denominacion'];
                        }

                        $this->set('banco',$banco);
                        $this->set('estilo_reporte',$estilo_reporte);
                        break;
            }// switch

        }else{
            // Esta vacio alguno de los datos del formulario, regreso atras
            echo'<script>history.back(1);</script>';
        }
    }
}//reporte_historia_contrato


/**
 *function buscar_contrato_especifico
 *@var=1 // se imprime todo el reporte.
 *@var=2 // se buscan todos los contratos activos y se listan.
 */
function buscar_contrato_especifico($var=null){
$this->layout="ajax";
    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');
    $ano = $this->Session->read('ano_session_reporte2');

    $lista = array();

    $SScoddeporig = $this->Session->read('SScoddeporig');
    $SScoddep = $this->Session->read('SScoddep');

    //$cond_cod_obra = "cod_presi=".$this->Session->read('SScodpresi')."  and  cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and  cod_inst=".$this->Session->read('SScodinst');
    if($cd==1){
        $cod_contratos_obras = "select a.cod_obra, a.numero_contrato_obra,
            (SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and a.cod_obra=b.cod_obra and cod_dep_original='$SScoddeporig')::varchar(30) as cod_obra22
            from cobd01_contratoobras_cuerpo a where a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and a.condicion_actividad=1 order by a.numero_contrato_obra";
    }else{
    $cod_contratos_obras = "select a.cod_obra, a.numero_contrato_obra,
            (SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and a.cod_obra=b.cod_obra and cod_dep_original='$SScoddeporig')::varchar(30) as cod_obra22
            from cobd01_contratoobras_cuerpo a where a.cod_obra=(SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_obra=a.cod_obra and b.ano_estimacion=a.ano_estimacion and b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and b.cod_dep_original='$SScoddeporig') and a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and a.condicion_actividad=1 order by a.numero_contrato_obra";
    }
    $contratos = $this->cobd01_contratoobras_cuerpo->execute($cod_contratos_obras);
    if($contratos!=null){
        if($var==1){
        $this->set('no_mostrar','no_mostrar');//no se muestra nada, la opcion 1 indica que se imprimen todos los contratos.

        }elseif($var==2){
            for($i=0; $i<count($contratos); $i++){
                $lista[$contratos[$i][0]['numero_contrato_obra']] = $contratos[$i][0]['numero_contrato_obra'];
            }
            $this->set('lista',$lista);
            $this->set('mensaje','Puede seleccionar el n&uacute;mero de contrato');
        }
    }else{
        $this->set('no_mostrar','no_mostrar');
        $this->set('mensajeError','no se encontrar&oacute;n contratos');
    }
}//buscar_contrato_especifico








function buscar_contrato_especifico_pista($pista=null){
$this->layout="ajax";
    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');
    $ano = $this->Session->read('ano_session_reporte2');
    $ano != '' ? '' : $ano = $this->ano_ejecucion();
    $lista = array();

    $SScoddeporig = $this->Session->read('SScoddeporig');
    $SScoddep = $this->Session->read('SScoddep');

    //$cond_cod_obra = "cod_presi=".$this->Session->read('SScodpresi')."  and  cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and  cod_inst=".$this->Session->read('SScodinst');
    if($cd==1){
        $cod_contratos_obras = "select a.cod_obra, a.numero_contrato_obra,
            (SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and a.cod_obra=b.cod_obra and cod_dep_original='$SScoddeporig')::varchar(30) as cod_obra22
            from cobd01_contratoobras_cuerpo a where a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and (upper(a.numero_contrato_obra) LIKE upper('%".$pista."%')) and a.condicion_actividad=1 order by a.numero_contrato_obra";


    }else{
    $cod_contratos_obras = "select a.cod_obra, a.numero_contrato_obra,
            (SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE  b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and a.cod_obra=b.cod_obra and cod_dep_original='$SScoddeporig')::varchar(30) as cod_obra22
            from cobd01_contratoobras_cuerpo a where a.cod_obra=(SELECT b.cod_obra FROM cfpd07_obras_cuerpo b WHERE b.cod_obra=a.cod_obra and b.ano_estimacion=a.ano_estimacion and b.cod_presi='$cp' and b.cod_entidad='$ce' and b.cod_tipo_inst='$cti' and b.cod_inst='$ci' and b.ano_estimacion='$ano' and b.cod_dep_original='$SScoddeporig') and a.cod_presi='$cp' and a.cod_entidad='$ce' and a.cod_tipo_inst='$cti' and a.cod_inst='$ci' and a.ano_contrato_obra='$ano' and upper(a.numero_contrato_obra) LIKE upper('%".$pista."%')  and a.condicion_actividad=1 order by a.numero_contrato_obra";
    }
    $contratos = $this->cobd01_contratoobras_cuerpo->execute($cod_contratos_obras);
    if($contratos!=null){

            for($i=0; $i<count($contratos); $i++){
                $lista[$contratos[$i][0]['numero_contrato_obra']] = $contratos[$i][0]['numero_contrato_obra'];
            }
            $this->set('lista',$lista);
        }

}//buscar_contrato_especifico







function ano_session_reporte2($ano=null){
$this->layout="ajax";
    if($ano!=null){
        $this->Session->write('ano_session_reporte2',$ano);
    }else{
        $ano = $this->ano_ejecucion();
        $this->Session->write('ano_session_reporte2',$ano);
    }
    echo "<script>";
      echo "document.getElementById('estilo_reporte_1').checked=true;";
      echo "document.getElementById('estilo_reporte_2').checked=false;";
      echo "document.getElementById('td-contrato').innerHTML='';";
    echo "</script>";
}


function buscar_contrato_convenio_especifico($var=null){
$this->layout="ajax";
    //@var=1 // se imprime todo el reporte.
    //@var=2 // se buscan todos los contratos activos y se listan.
    if($var!=null){
        if($var==1){
            $this->set('no_mostrar','no_mostrar');//no se muestra nada, la opcion 1 indica que se imprimen todos los contratos.
        }elseif($var==2){
            $lista = $this->cepd02_contratoservicio_cuerpo->generateList($this->SQLCA()." and condicion_actividad=1", 'numero_contrato_servicio ASC', null, '{n}.cepd02_contratoservicio_cuerpo.numero_contrato_servicio', '{n}.cepd02_contratoservicio_cuerpo.numero_contrato_servicio');
            if($lista!=null){
            $this->set('lista',$lista);
            $this->set('mensaje','Puede seleccionar el numero de contrato');
            }else{
            $this->set('no_mostrar','no_mostrar');
            $this->set('mensajeError','No se encontraron registros');
            }
        }
    }else{
    $this->set('no_mostrar','no_mostrar');
    $this->set('mensajeError','Lo siento, no llego la informacion correctamente');
    }
}//buscar_contrato_convenio_especifico



//*******************************************************
//      Reporte Historia de los Contratos o Convenios
//*******************************************************
function reporte_historia_contrato_convenios($var=null){
    $this->layout="ajax";

    if($var!=null && $var=='no'){//muestra el formulario al usuario (cuando ingresa por primera vez)
        $this->set('ano',$this->ano_ejecucion());
        $this->set('pase','no');

    }elseif($var!=null && $var=='si'){//muestra la vista del reporte
        $this->layout="pdf";
        $this->set('pase','si');
        $ano = $this->data['form_historia_contrato']['ano'];
        $estilo_reporte = $this->data['form_historia_contrato']['estilo_reporte'];

        if(!empty($estilo_reporte) && !empty($ano)){
            $cond = $this->SQLCA();
            $cp  = $this->Session->read('SScodpresi');
            $ce  = $this->Session->read('SScodentidad');
            $cti = $this->Session->read('SScodtipoinst');
            $ci  = $this->Session->read('SScodinst');
            $cd  = $this->Session->read('SScoddep');

            switch($estilo_reporte){
                case '1':
                        $datos_contrato_cuerpo[0] = 0;
                        $datos_anticipos_cuerpo[0] = 0;
                        $datos_valuacion_cuerpo[0] = 0;
                        $datos_retencion_cuerpo[0] = 0;
                        $partidas_contrato[0] = 0;

                        $sql_distinct_contratoobra = "SELECT DISTINCT numero_contrato_servicio FROM cepd02_contratoservicio_cuerpo WHERE cod_presi='$cp' and cod_entidad='$ce' and cod_tipo_inst='$cti' and cod_inst='$ci' and cod_dep='$cd' and ano_contrato_servicio='$ano' and condicion_actividad=1 order by numero_contrato_servicio;";
                        $distinct_contratoobra = $this->cepd02_contratoservicio_cuerpo->execute($sql_distinct_contratoobra);

                        for($i=0; $i<count($distinct_contratoobra); $i++){
                            $num_contrato_servicio = $distinct_contratoobra[$i][0]['numero_contrato_servicio'];
                            $condicion = $cond." and ano_contrato_servicio='$ano' and numero_contrato_servicio='$num_contrato_servicio'";
                            $condicion22 = "SELECT
                                a.ano_contrato_servicio,
                                a.numero_contrato_servicio,
                                a.fecha_contrato_servicio,
                                a.fecha_inicio_contrato,
                                a.fecha_terminacion_contrato,
                                a.monto_original_contrato,
                                a.aumento,
                                a.disminucion,
                                a.monto_anticipo,
                                a.monto_amortizacion,
                                a.monto_retencion_laboral,
                                a.monto_retencion_fielcumplimiento,
                                a.monto_cancelado,
                                a.concepto,
                                a.rif,
                                (SELECT Sum(monto_retencion_iva) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_retencion_iva,
                                (SELECT Sum(monto_islr) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_islr,
                                (SELECT Sum(monto_timbre_fiscal) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_timbre_fiscal,
                                (SELECT denominacion FROM cpcd02 p WHERE a.rif=p.rif) as beneficiario
                            from cepd02_contratoservicio_cuerpo a
                            where
                                a.cod_presi     = '$cp'  and
                                a.cod_entidad   = '$ce'  and
                                a.cod_tipo_inst = '$cti' and
                                a.cod_inst      = '$ci'  and
                                a.cod_dep       = '$cd'  and
                                a.condicion_actividad=1 and
                                a.ano_contrato_servicio='$ano' and
                                a.numero_contrato_servicio='$num_contrato_servicio'";

                            // Se carga el vector cuerpo_contrato_servicio
                            $datos_contrato_cuerpo[$i] = $this->cepd02_contratoservicio_cuerpo->execute($condicion22);


                            $cond_anticipos="select
                                    a.numero_anticipo,
                                    a.monto_anticipo,
                                    a.fecha_anticipo,
                                    a.observaciones,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_anticipo_cuerpo a
                                where
                                    a.cod_presi     = '$cp' and
                                    a.cod_entidad   = '$ce' and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci' and
                                    a.cod_dep       = '$cd' and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";

                            //se carga el vector contrato_anticipo_cuerpo
                            $datos_anticipos_cuerpo[$i] = $this->cepd02_contratoservicio_anticipo_cuerpo->execute($cond_anticipos);


                            $cond_valuacion="select
                                    a.numero_valuacion,
                                    a.monto_neto_cobrar,
                                    a.fecha_valuacion,
                                    a.concepto,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_valuacion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cd'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";

                            //Se carga el vector contrato servicio valuacion cuerpo
                            $datos_valuacion_cuerpo[$i] = $this->cepd02_contratoservicio_valuacion_cuerpo->execute($cond_valuacion);


                            $cond_retencion="select
                                    a.numero_retencion,
                                    a.tipo_retencion,
                                    a.monto_neto_cobrar as monto_retencion,
                                    a.fecha_retencion,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_retencion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cd'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";

                        //Se carga el vector
                        $datos_retencion_cuerpo[$i] = $this->cepd02_contratoservicio_retencion_cuerpo->execute($cond_retencion);
                        //Se carga el vector
                        $partidas_contrato[$i] = $this->cepd02_contratoservicio_partidas->findAll($condicion);

                        }//fin for distinct contrato servicio

                        $this->set('datos_contrato_cuerpo',$datos_contrato_cuerpo);
                        $this->set('datos_anticipos_cuerpo',$datos_anticipos_cuerpo);
                        $this->set('datos_valuacion_cuerpo',$datos_valuacion_cuerpo);
                        $this->set('datos_retencion_cuerpo',$datos_retencion_cuerpo);
                        $this->set('partidas_contrato',$partidas_contrato);

                        $banco[0]=0;
                        $entidades_banc = $this->cstd01_entidades_bancarias->findAll();
                        foreach($entidades_banc as $ent){
                            $banco[$ent['cstd01_entidades_bancarias']['cod_entidad_bancaria']]=$ent['cstd01_entidades_bancarias']['denominacion'];
                        }
                        $this->set('banco',$banco);
                        $this->set('estilo_reporte',$estilo_reporte);
                        break;

                case '2':
                        $num_contrato_servicio = strtoupper($this->data['form_historia_contrato']['numero_contrato']);
                        if(empty($num_contrato_servicio)){
                            echo'<script>history.back(1);</script>';
                        }else{
                            $condicion = $cond." and ano_contrato_servicio='$ano' and upper(numero_contrato_servicio)='$num_contrato_servicio'";
                            $condicion22 = "SELECT
                                    a.ano_contrato_servicio,
                                    a.numero_contrato_servicio,
                                    a.fecha_contrato_servicio,
                                    a.fecha_inicio_contrato,
                                    a.fecha_terminacion_contrato,
                                    a.monto_original_contrato,
                                    a.aumento,
                                    a.disminucion,
                                    a.monto_anticipo,
                                    a.monto_amortizacion,
                                    a.monto_retencion_laboral,
                                    a.monto_retencion_fielcumplimiento,
                                    a.monto_cancelado,
                                    a.concepto,
                                    a.rif,
                                    (SELECT Sum(monto_retencion_iva) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_retencion_iva,
                                    (SELECT Sum(monto_islr) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_islr,
                                    (SELECT Sum(monto_timbre_fiscal) FROM cepd02_contratoservicio_valuacion_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_contrato_servicio=b.ano_contrato_servicio and a.numero_contrato_servicio=b.numero_contrato_servicio and b.condicion_actividad=1) as monto_timbre_fiscal,
                                    (SELECT denominacion FROM cpcd02 p WHERE a.rif=p.rif) as beneficiario
                                from cepd02_contratoservicio_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cd'  and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio';";


                            $cond_anticipos="select
                                    a.numero_anticipo,
                                    a.monto_anticipo,
                                    a.fecha_anticipo,
                                    a.observaciones,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_anticipo_cuerpo a
                                where
                                    a.cod_presi     = '$cp' and
                                    a.cod_entidad   = '$ce' and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci' and
                                    a.cod_dep       = '$cd' and
                                    a.condicion_actividad  = 1 and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";


                            $cond_valuacion="select
                                    a.numero_valuacion,
                                    a.monto_neto_cobrar,
                                    a.fecha_valuacion,
                                    a.concepto,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_valuacion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cd'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";


                            $cond_retencion="select
                                    a.numero_retencion,
                                    a.tipo_retencion,
                                    a.monto_neto_cobrar as monto_retencion,
                                    a.fecha_retencion,
                                    (SELECT ano_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_orden_pago,
                                    (SELECT numero_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_orden_pago,
                                    (SELECT fecha_orden_pago FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_orden_pago,
                                    (SELECT ano_movimiento FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as ano_movimiento,
                                    (SELECT cod_entidad_bancaria FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as cod_entidad_bancaria,
                                    (SELECT numero_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as numero_cheque,
                                    (SELECT fecha_cheque FROM cepd03_ordenpago_cuerpo b WHERE a.cod_presi=b.cod_presi and a.cod_entidad=b.cod_entidad and a.cod_tipo_inst=b.cod_tipo_inst and a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and a.ano_orden_pago=b.ano_orden_pago and a.numero_orden_pago=b.numero_orden_pago and b.condicion_actividad=1) as fecha_cheque
                                from cepd02_contratoservicio_retencion_cuerpo a
                                where
                                    a.cod_presi     = '$cp'  and
                                    a.cod_entidad   = '$ce'  and
                                    a.cod_tipo_inst = '$cti' and
                                    a.cod_inst      = '$ci'  and
                                    a.cod_dep       = '$cd'  and
                                    a.condicion_actividad=1  and
                                    a.ano_contrato_servicio    = '$ano' and
                                    a.numero_contrato_servicio = '$num_contrato_servicio'";

                            $datos_contrato_cuerpo = $this->cepd02_contratoservicio_cuerpo->execute($condicion22);
                            $datos_anticipos_cuerpo = $this->cepd02_contratoservicio_anticipo_cuerpo->execute($cond_anticipos);
                            $datos_valuacion_cuerpo = $this->cepd02_contratoservicio_partidas->execute($cond_valuacion);
                            $datos_retencion_cuerpo = $this->cepd02_contratoservicio_retencion_cuerpo->execute($cond_retencion);
                            $partidas_contrato = $this->cepd02_contratoservicio_partidas->findAll($condicion);
                            if($datos_contrato_cuerpo!=null){
                                $this->set('datos_contrato_cuerpo',$datos_contrato_cuerpo);
                                $this->set('datos_anticipos_cuerpo',$datos_anticipos_cuerpo);
                                $this->set('datos_valuacion_cuerpo',$datos_valuacion_cuerpo);
                                $this->set('datos_retencion_cuerpo',$datos_retencion_cuerpo);
                                $this->set('partidas_contrato',$partidas_contrato);
                            }else{
                            $this->set('datos_contrato_cuerpo',null);
                            }

                            $banco[0]=0;
                            $entidades_banc = $this->cstd01_entidades_bancarias->findAll();
                            foreach($entidades_banc as $ent){
                                $banco[$ent['cstd01_entidades_bancarias']['cod_entidad_bancaria']]=$ent['cstd01_entidades_bancarias']['denominacion'];
                            }
                            $this->set('banco',$banco);
                            $this->set('estilo_reporte',$estilo_reporte);
                        }
                        break;
            }//switch

        }else{
            // Esta vacio alguno de los datos del formulario, regreso atras
            echo'<script>history.back(1);</script>';
        }

    }
}

function reporte_plan_cuentas_contables(){
    $this->layout="pdf";

    $cod_tipo_cuenta = "";
    $cod_cuenta      = "";
    $cod_subcuenta   = "";
    $cod_division    = "";
    $cod_subdivision = "";

    $condicion=$this->SQLCA();
    $cod_tipo_cuenta = $this->ccfd01_tipo->findAll($condicion,null,' cod_tipo_cuenta ASC');
    $cod_cuenta      = $this->ccfd01_cuenta->findAll($condicion,null,' cod_tipo_cuenta, cod_cuenta ASC');
    $cod_subcuenta   = $this->ccfd01_subcuenta->findAll($condicion,null,' cod_tipo_cuenta, cod_cuenta, cod_subcuenta ASC');
    $cod_division    = $this->ccfd01_division->findAll($condicion,null,' cod_tipo_cuenta, cod_cuenta, cod_subcuenta, cod_division ASC');
    $cod_subdivision = $this->ccfd01_subdivision->findAll($condicion,null,' cod_tipo_cuenta, cod_cuenta, cod_subcuenta, cod_division, cod_subdivision ASC');

    $this->set('cod_tipo_cuenta',$cod_tipo_cuenta);
    $this->set('cod_cuenta',$cod_cuenta);
    $this->set('cod_subcuenta',$cod_subcuenta);
    $this->set('cod_division',$cod_division);
    $this->set('cod_subdivision',$cod_subdivision);
}





function buscar_year_proveed($var1=null){

    $this->layout = "ajax";
    $_SESSION['buscar_year_proveed'] = $var1;


    echo "<script>";
      echo "document.getElementById('proveed_3').checked=true;";
      echo "document.getElementById('proveed_4').checked=false;";
    echo "</script>";


}//fin function






function buscar_elige_prov($consolida=null, $opc=null, $pista=null){
    $this->layout = "ajax";
    $this->set('opc', $opc);
    //echo $consolida;


       if(isset($_SESSION['buscar_year_proveed'])){$ano = $_SESSION['buscar_year_proveed'];}else{$ano = $this->ano_ejecucion();}

    if($consolida == 1){
        $cond = $this->SQLCA_consolidado($consolida)." and ano_orden_compra='".$ano."' and upper(razon_social) LIKE upper('%".$pista."%') ";
    }else{
        $cond = $this->SQLCA_consolidado($consolida)." and ano_orden_compra='".$ano."' and upper(razon_social) LIKE upper('%".$pista."%')  ";
    }
    $rif = $this->v_cscd04_ordencompra->generateList($conditions = $cond." and condicion_actividad=1", $order = 'razon_social ASC', $limit = null, '{n}.v_cscd04_ordencompra.rif', '{n}.v_cscd04_ordencompra.razon_social');
    $this->concatena_sin_cero($rif, 'rif');

}//fin function




function elige_prov($consolida=null, $opc=null){
    $this->layout = "ajax";
    $this->set('opc', $opc);
    //echo $consolida;


       if(isset($_SESSION['buscar_year_proveed'])){$ano = $_SESSION['buscar_year_proveed'];}else{$ano = $this->ano_ejecucion();}

    if($consolida == 1){
        $cond = $this->SQLCA_consolidado($consolida)." and ano_orden_compra='".$ano."' ";
    }else{
        $cond = $this->SQLCA_consolidado($consolida)." and ano_orden_compra='".$ano."' ";
    }
    //$rif = $this->v_cscd04_ordencompra->generateList($conditions = $cond." and condicion_actividad=1", $order = 'razon_social ASC', $limit = null, '{n}.v_cscd04_ordencompra.rif', '{n}.v_cscd04_ordencompra.razon_social');
    $this->concatena_sin_cero(array(), 'rif');
    $this->set('consolida', $consolida);

}




function elige_consolidar($consolida=null){
    $this->layout = "ajax";
    $this->set('consolida', $consolida);
}



function reporte_trimestre_1($var=null){
     $this->layout="ajax";

     $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
     $estado = $this->ccfd01_tipo->execute("SELECT denominacion FROM cugd01_estados WHERE cod_republica='$cod_presi' and cod_estado='$cod_entidad';");

     $_SESSION['estado'] = $estado[0][0]['denominacion'];
    $this->set('mes', date('m'));
     if(isset($var) && $var=="FORM"){
        $this->layout="ajax";
        $Ano=$this->ano_ejecucion();
        $this->set('ANO',$Ano);
        $this->set('ELFORM',true);
        $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->condicion()." and tipo_documento='100'");
    //echo $cont;
    if($cont == 0){
        $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','N/A');
        $this->set('cargo_tercera_firma','N/A');
        $this->set('tipo_doc_anul', 100);
        $firma_existe = 'no';
    }else{
        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=100");
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
        $this->set('tipo_doc_anul',100);
        $firma_existe = 'si';
    }
        $this->set('firma_existe',$firma_existe);

     }else if(isset($var) && $var=="GENERAR"){


        $firmas = $this->cugd07_firmas_oficio_anulacion->findCount($this->condicion()." and tipo_documento='100'");


        $cp  = $this->Session->read('SScodpresi');
        $ce  = $this->Session->read('SScodentidad');
        $cti = $this->Session->read('SScodtipoinst');
        $ci  = $this->Session->read('SScodinst');
        $cd  = $this->Session->read('SScoddep');

        $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
        $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
        $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
        $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
        $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
        $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
        $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];
        if($firmas==0){
        $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc_anul,'$nombre_primera_firma', '$cargo_primera_firma', '$nombre_segunda_firma', '$cargo_segunda_firma', '$nombre_tercera_firma', '$cargo_tercera_firma')";
        $this->cugd07_firmas_oficio_anulacion->execute($insert);
        }else{
        $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$nombre_primera_firma', cargo_primera_firma='$cargo_primera_firma', nombre_segunda_firma='$nombre_segunda_firma', cargo_segunda_firma='$cargo_segunda_firma', nombre_tercera_firma='$nombre_tercera_firma', cargo_tercera_firma='$cargo_tercera_firma' WHERE ".$this->SQLCA()." and tipo_documento=".$tipo_doc_anul;
        $this->cugd07_firmas_oficio_anulacion->execute($update);
        }


        $this->layout="pdf";
        $this->set('ELFORM',false);
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        $this->Session->write('ANO',$Ano);

                    if(isset($this->data['cfpp05']['consolidacion'])){
                        $con=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
                        $tipo=$this->data['cfpp05']['consolidacion'];
                    }else{
                        $con=$this->SQLCA_consolidado_opcion(null, "a");
                        $tipo=2;
                    }


        if(isset($this->data['cfpp05']['tipo_recurso'])){
            $tipo_recurso=$this->data['cfpp05']['tipo_recurso'];

        }else{
            $tipo_recurso=0;

        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
            $mes_seleccion=$this->data["reporte"]["mes"];
         }else{
            $this->set("mes",date("n"));
            $this->Session->write("mes_solicitado",date("n"));
            $mes_seleccion=date("n");
         }

         if(isset($this->data["cfpp05"]["frecuencia"]) && !empty($this->data["cfpp05"]["frecuencia"])){
            $frecuencia = $this->data["cfpp05"]["frecuencia"];
         }else{
            $frecuencia = 5;
         }

        if(isset($this->data["cfpp05"]["tipo_gasto"])){
            $tipo_gasto = $this->data["cfpp05"]["tipo_gasto"];
        }else{
            $tipo_gasto = 0;
        }

        if(isset($this->data["cfpp05"]["semestre"])){
            $semestre = $this->data['cfpp05']['semestre'];
        }else{
            $semestre = 1;
        }
        if(isset($this->data["cfpp05"]["semestre"])){
            $trimestre = $this->data['cfpp05']['trimestre'];
        }else{
            $trimestre = 1;
        }

        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=100");
        if($firmantes != null){
            $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
            $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
            $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
            $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
            $this->set('tipo_doc_anul',100);
        }else{
            $this->set('nombre_primera_firma','');
            $this->set('cargo_primera_firma','');
            $this->set('nombre_segunda_firma','');
            $this->set('cargo_segunda_firma','');
            $this->set('nombre_tercera_firma','N/A');
            $this->set('cargo_tercera_firma','N/A');
        }

                                                        // *** TIPO DE GASTO ****

        $this->set('tipo_gasto',$tipo_gasto);
        switch ($tipo_gasto) {
            case 0:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=2 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Inversion, Situado y Transferencia
                break;
            case 1:
                $cod_tipo_gasto = " and a.cod_tipo_gasto=2 "; // Inversion
                break;
            case 2:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Situado y Transferencia
                break;

            default:
                break;
        }

                                                    // *** TIPO DE RECURSOS ****

        $this->set('tipo_recurso',$tipo_recurso);

        if($tipo_recurso==0 || $tipo_recurso=='0'){
            $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6 OR a.tipo_presupuesto= 7 OR a.tipo_presupuesto= 8) ";
        }else{
            $cond_tipo_recurso= " and a.tipo_presupuesto=".$tipo_recurso;
        }

/*
        switch ($tipo_recurso) {
            case 0:
                $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6) ";
                break;
            case 1:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 1 "; // Ordinario
                break;
            case 2:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 2 "; // Coordinado
                break;
            case 3:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 3 "; // Fci
                break;
            case 4:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 4 "; // Mpps
                break;
            case 5:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 5 "; // Ingresos Extraordinarios
                break;
            case 6:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 6 "; // Ingresos Propios
                break;

            default:
                break;
        }
*/


      if($tipo == 1 && $frecuencia ==5){ // POR INSTITUCION Y ANUAL

          $_SESSION['frecuencia']= "ANUAL";
          $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
          $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
          a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
          WHERE a.cod_presi=b.cod_presi and
          a.cod_entidad=b.cod_entidad and
          a.cod_tipo_inst=b.cod_tipo_inst and
          a.cod_inst=b.cod_inst and
          a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
          SUM(a.asignacion_anual) as asignacion_original,  (SUM(a.aumento_traslado_anual) + SUM(a.credito_adicional_anual)) as aumento, (SUM(a.disminucion_traslado_anual) + SUM(a.rebaja_anual)) as disminucion,
          ((SUM(a.asignacion_anual) + SUM(a.aumento_traslado_anual)) - SUM(a.disminucion_traslado_anual)) as asignacion_ajustada,
          (SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,
          SUM(a.pagado_anual) as pagos_acumulados
          FROM cfpd05 a
          WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
          GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";

      }

      else if($tipo == 1 && $frecuencia == 4 && $semestre == 1){ // POR INSTITUCION - SEMESTRAL - PRIMER SEMESTRAL

        $_SESSION['frecuencia']= "SEMESTRAL";
        $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
        $suma_creditos_sem1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_sem1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                        SUM(a.asignacion_anual) as asignacion_original,
                        (SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + ".$suma_rebajas_sem1.") as disminucion,
                        (SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos_sem1.") as aumento,
                        (SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,
                        (SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagos_acumulados FROM cfpd05 a
        WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";

      }

      else if($tipo == 1 && $frecuencia == 4 && $semestre == 2){ // POR INSTITUCION - SEMESTRAL - SEGUNDO SEMESTRAL

        $_SESSION['frecuencia']= "SEMESTRAL";
        $_SESSION['fecha']="01/07/".$Ano." hasta 31/12/".$Ano;
        $suma_creditos_sem1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_sem1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $suma_creditos_sem2 = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
        $suma_rebajas_sem2 = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                SUM(a.asignacion_anual) as asignacion_original,
                (SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas_sem1." + ".$suma_rebajas_sem2.") as disminucion,
                (SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos_sem1." + ".$suma_creditos_sem2.") as aumento,
                ((SUM(a.asignacion_anual) + SUM(a.aumento_traslado_anual)) - SUM(a.disminucion_traslado_anual)) as asignacion_ajustada,
                (SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,
                (SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagos_acumulados FROM cfpd05 a
        WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";

      }

      else if($tipo == 1 && $frecuencia == 3 && $trimestre == 1){ // POR INSTITUCION - TRIMESTRAL - PRIMER TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
        $suma_creditos_tri1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
        $suma_rebajas_tri1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + ".$suma_rebajas_tri1.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + ".$suma_creditos_tri1.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
        SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";
      }

      else if($tipo == 1 && $frecuencia == 3 && $trimestre == 2){ // POR INSTITUCION - TRIMESTRAL - SEGUNDO TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/04/".$Ano." hasta 30/06/".$Ano;
        /*$suma_creditos_tri2 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_tri2 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr)+ SUM(a.disminucion_traslado_may)+ SUM(a.disminucion_traslado_jun) + ".$suma_rebajas_tri2.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos_tri2.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagos_acumulados";*/

        $suma_creditos_tri2 = "SUM(a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_tri2 = "SUM(a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $disminucion = "(SUM(a.disminucion_traslado_abr)+ SUM(a.disminucion_traslado_may)+ SUM(a.disminucion_traslado_jun) + ".$suma_rebajas_tri2.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos_tri2.") as aumento,";
        $compromisos = "(SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
        SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";
      }

      else if($tipo == 1 && $frecuencia == 3 && $trimestre == 3){ // POR INSTITUCION - TRIMESTRAL - TERCER TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/07/".$Ano." hasta 30/09/".$Ano;
        $suma_creditos_tri3 = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
        $suma_rebajas_tri3 = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
        $disminucion = "(SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + ".$suma_rebajas_tri3.") as disminucion,";
        $aumento = "( SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + ".$suma_creditos_tri3.") as aumento,";
        $compromisos = "(SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
        SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";
      }

      else if($tipo == 1 && $frecuencia == 3 && $trimestre == 4){ // POR INSTITUCION - TRIMESTRAL - CUARTO TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/10/".$Ano." hasta 31/12/".$Ano;
        $suma_creditos_tri4 = "SUM(a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
        $suma_rebajas_tri4 = "SUM(a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
        $disminucion = "(SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas_tri4.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos_tri4.") as aumento,";
        $compromisos = "(SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
        a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
        WHERE a.cod_presi=b.cod_presi and
        a.cod_entidad=b.cod_entidad and
        a.cod_tipo_inst=b.cod_tipo_inst and
        a.cod_inst=b.cod_inst and
        a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
        SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
        GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";
      }

    else if($tipo == 1 && $frecuencia == 2){ // POR INSTITUCION - MENSUAL
            $_SESSION['frecuencia']= "MENSUAL";
            $mes = $trimestre = $this->data['cfpp05']['mes'];
            switch ($mes) {
                case 1://ene
                    $suma_creditos = "SUM(a.credito_adicional_ene)";
                    $suma_rebajas = "SUM(a.rebaja_ene)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + ".$suma_creditos.") as aumento,";
                    $compromisos = "(SUM(a.compromiso_ene)) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/01/".$Ano;
                    break;
                case 2://febrero
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 28/02/".$Ano;
                    break;
                case 3://marzo
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
                    break;
                case 4://abril
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/04/".$Ano;
                    break;
                case 5://mayo
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/05/".$Ano;
                    break;
                case 6://junio
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
                    break;

                case 7://julio
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/07/".$Ano;
                    break;

                case 8://agosto
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/08/".$Ano;
                    break;

                case 9://septiembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/09/".$Ano;

                    break;
                case 10://octubre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/10/".$Ano;
                    break;

                case 11://noviembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/11/".$Ano;
                    break;

                case 12://diciembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
                    break;
            }//FIN SWITCH  MESES
                $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst,
                a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
                WHERE a.cod_presi=b.cod_presi and
                a.cod_entidad=b.cod_entidad and
                a.cod_tipo_inst=b.cod_tipo_inst and
                a.cod_inst=b.cod_inst and
                a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados."
                FROM cfpd05 a
                WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
                GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_sector;";
    }


                                    /** **** REPORTES CONSOLIDADOS POR DEPENDENCIA ****  **/


       else if($tipo == 2 && $frecuencia ==5){ // POR DEPENDENCIA Y ANUAL

        $_SESSION['frecuencia']= "ANUAL";
        $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
SUM(a.asignacion_anual) as asignacion_original,  (SUM(a.aumento_traslado_anual) + SUM(a.credito_adicional_anual)) as aumento, (SUM(a.disminucion_traslado_anual) + SUM(a.rebaja_anual)) as disminucion,
((SUM(a.asignacion_anual) + SUM(a.aumento_traslado_anual)) - SUM(a.disminucion_traslado_anual)) as asignacion_ajustada,
(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,
SUM(a.pagado_anual) as pagos_acumulados
FROM cfpd05 a
WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
        }

       else if($tipo == 2 && $frecuencia == 4 && $semestre == 1){ // POR INSTITUCION - SEMESTRAL - PRIMER SEMESTRAL

        $_SESSION['frecuencia']= "SEMESTRAL";
        $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
        $suma_creditos_sem1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_sem1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                SUM(a.asignacion_anual) as asignacion_original,
                (SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + ".$suma_rebajas_sem1.") as disminucion,
                (SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos_sem1.") as aumento,
                (SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,
                (SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagos_acumulados FROM cfpd05 a
WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";

        }

       else if($tipo == 2 && $frecuencia == 4 && $semestre == 2){ // POR DEPENDENCIA - SEMESTRAL - SEGUNDO SEMESTRAL

        $_SESSION['frecuencia']= "SEMESTRAL";
        $_SESSION['fecha']="01/07/".$Ano." hasta 31/12/".$Ano;
        $suma_creditos_sem1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_sem1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $suma_creditos_sem2 = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
        $suma_rebajas_sem2 = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                SUM(a.asignacion_anual) as asignacion_original,
                (SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas_sem1." + ".$suma_rebajas_sem2.") as disminucion,
                (SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos_sem1." + ".$suma_creditos_sem2.") as aumento,
                ((SUM(a.asignacion_anual) + SUM(a.aumento_traslado_anual)) - SUM(a.disminucion_traslado_anual)) as asignacion_ajustada,
                (SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,
                (SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagos_acumulados FROM cfpd05 a
WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";

        }

       else if($tipo == 2 && $frecuencia == 3 && $trimestre == 1){ // POR DEPENDENCIA - TRIMESTRAL - PRIMER TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
        $suma_creditos_tri1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
        $suma_rebajas_tri1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + ".$suma_rebajas_tri1.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + ".$suma_creditos_tri1.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
        }

       else if($tipo == 2 && $frecuencia == 3 && $trimestre == 2){ // POR DEPENDENCIA - TRIMESTRAL - SEGUNDO TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/04/".$Ano." hasta 30/06/".$Ano;
        $suma_creditos_tri2 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
        $suma_rebajas_tri2 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr)+ SUM(a.disminucion_traslado_may)+ SUM(a.disminucion_traslado_jun) + ".$suma_rebajas_tri2.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos_tri2.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
        }

       else if($tipo == 2 && $frecuencia == 3 && $trimestre == 3){ // POR DEPENDENCIA - TRIMESTRAL - TERCER TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/07/".$Ano." hasta 30/09/".$Ano;
        $suma_creditos_tri3 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
        $suma_rebajas_tri3 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr)+ SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + ".$suma_rebajas_tri3.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + ".$suma_creditos_tri3.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
        }

       else if($tipo == 2 && $frecuencia == 3 && $trimestre == 4){ // POR DEPENDENCIA - TRIMESTRAL - CUARTO TRIMESTRE

        $_SESSION['frecuencia']= "TRIMESTRAL";
        $_SESSION['fecha']="01/10/".$Ano." hasta 31/12/".$Ano;
        $suma_creditos_tri4 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
        $suma_rebajas_tri4 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
        $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr)+ SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas_tri4.") as disminucion,";
        $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos_tri4.") as aumento,";
        $compromisos = "(SUM(a.compromiso_ene) + SUM(a.compromiso_feb) + SUM(a.compromiso_mar) + SUM(a.compromiso_abr) + SUM(a.compromiso_may) + SUM(a.compromiso_jun) + SUM(a.compromiso_jul) + SUM(a.compromiso_ago) + SUM(a.compromiso_sep) + SUM(a.compromiso_oct) + SUM(a.compromiso_nov) + SUM(a.compromiso_dic)) as compromisos,";
        $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.pagado_feb) + SUM(a.pagado_mar) + SUM(a.pagado_abr) + SUM(a.pagado_may) + SUM(a.pagado_jun) + SUM(a.pagado_jul) + SUM(a.pagado_ago) + SUM(a.pagado_sep) + SUM(a.pagado_oct) + SUM(a.pagado_nov) + SUM(a.pagado_dic)) as pagos_acumulados";
        $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
WHERE a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
        }

    else if($tipo == 2 && $frecuencia == 2){ // POR DEPENDENCIA - MENSUAL
            $_SESSION['frecuencia']= "MENSUAL";
            $mes = $trimestre = $this->data['cfpp05']['mes'];
            switch ($mes) {
                case 1://ene
                    $suma_creditos = "SUM(a.credito_adicional_ene)";
                    $suma_rebajas = "SUM(a.rebaja_ene)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + ".$suma_creditos.") as aumento,";
                    $compromisos = "(SUM(a.compromiso_ene)) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/01/".$Ano;
                    break;
                case 2://febrero
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 28/02/".$Ano;
                    break;
                case 3://marzo
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
                    break;
                case 4://abril
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/04/".$Ano;
                    break;
                case 5://mayo
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/05/".$Ano;
                    break;
                case 6://junio
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                    $pagos_acumulados = "(SUM(a.pagado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun)) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
                    break;

                case 7://julio
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/07/".$Ano;
                    break;

                case 8://agosto
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/08/".$Ano;
                    break;

                case 9://septiembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/09/".$Ano;

                    break;
                case 10://octubre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/10/".$Ano;
                    break;

                case 11://noviembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 30/11/".$Ano;
                    break;

                case 12://diciembre
                    $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                    $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                    $disminucion = "(SUM(a.disminucion_traslado_ene) + SUM(a.disminucion_traslado_feb) + SUM(a.disminucion_traslado_mar) + SUM(a.disminucion_traslado_abr) + SUM(a.disminucion_traslado_may) + SUM(a.disminucion_traslado_jun) + SUM(a.disminucion_traslado_jul) + SUM(a.disminucion_traslado_ago) + SUM(a.disminucion_traslado_sep) + SUM(a.disminucion_traslado_oct) + SUM(a.disminucion_traslado_nov) + SUM(a.disminucion_traslado_dic) + ".$suma_rebajas.") as disminucion,";
                    $aumento = "(SUM(a.aumento_traslado_ene) + SUM(a.aumento_traslado_feb) + SUM(a.aumento_traslado_mar) + SUM(a.aumento_traslado_abr) + SUM(a.aumento_traslado_may) + SUM(a.aumento_traslado_jun) + SUM(a.aumento_traslado_jul) + SUM(a.aumento_traslado_ago) + SUM(a.aumento_traslado_sep) + SUM(a.aumento_traslado_oct) + SUM(a.aumento_traslado_nov) + SUM(a.aumento_traslado_dic) + ".$suma_creditos.") as aumento,";
                    $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,";
                    $pagos_acumulados = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagos_acumulados";
                    $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
                    break;
            }//FIN SWITCH  MESES
                $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep,
                a.cod_sector, (SELECT DISTINCT upper(b.denominacion) FROM cfpd02_sector b
                WHERE a.cod_presi=b.cod_presi and
                a.cod_entidad=b.cod_entidad and
                a.cod_tipo_inst=b.cod_tipo_inst and
                a.cod_inst=b.cod_inst and a.cod_dep=b.cod_dep and
                a.ano=b.ano and a.cod_sector=b.cod_sector) as deno_sector,
                SUM(a.asignacion_anual) as asignacion_original, ".$disminucion.$aumento.$compromisos.$pagos_acumulados."
                FROM cfpd05 a
                WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso." and ano=".$Ano."
                GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_sector;";
    }

        $data = $this->ccfd01_tipo->execute($sql);

        $this->set('data', $data);

     }//fin generar reporte
}//fin funcion reporte trimestral 1

function reporte_ejecucion_presupuestaria_form(){
    $this->layout = "ajax";
    $Ano=$this->ano_ejecucion();
    $this->set('ANO',$Ano);
    $this->set('mes', date('m'));
    $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->condicion()." and tipo_documento='101'");
    //echo $cont;
    if($cont == 0){
        $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','N/A');
        $this->set('cargo_tercera_firma','N/A');
        $this->set('tipo_doc_anul', 101);
        $firma_existe = 'no';
    }else{
        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=101");
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
        $this->set('tipo_doc_anul',101);
        $this->set('firma_existe','si');
        $firma_existe = 'si';
    }

    $this->set('firma_existe', $firma_existe);

}

function reporte_ejecucion_presupuestaria_form2(){
    $this->layout = "ajax";
    $Ano=$this->ano_ejecucion();
    $this->set('ANO',$Ano);
    $this->set('mes', date('m'));
    $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA()." and tipo_documento='101'");
    //echo $cont;
    if($cont == 0){
        $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','N/A');
        $this->set('cargo_tercera_firma','N/A');
        $this->set('tipo_doc_anul', 101);
        $firma_existe = 'no';
    }else{
        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=101");
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
        $this->set('tipo_doc_anul',101);
        $this->set('firma_existe','si');
        $firma_existe = 'si';
    }

    $this->set('firma_existe', $firma_existe);

}

function reporte_ejecucion_presupuestaria_pdf2(){
    $this->layout = "pdf";
    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');
    // Capturamos los firmantes de los documentos
    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];

    // Verificamos si existen los firmantes para hacer una Insercion o Actualizacion
    $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->condicion()." and tipo_documento='101'");
    if($cont == 0){
        $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc_anul,'$nombre_primera_firma', '$cargo_primera_firma', '$nombre_segunda_firma', '$cargo_segunda_firma', '$nombre_tercera_firma', '$cargo_tercera_firma')";
        $this->cugd07_firmas_oficio_anulacion->execute($insert);
    }else{
        $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$nombre_primera_firma', cargo_primera_firma='$cargo_primera_firma', nombre_segunda_firma='$nombre_segunda_firma', cargo_segunda_firma='$cargo_segunda_firma', nombre_tercera_firma='$nombre_tercera_firma', cargo_tercera_firma='$cargo_tercera_firma' WHERE ".$this->SQLCA()." and tipo_documento=".$tipo_doc_anul;
        $this->cugd07_firmas_oficio_anulacion->execute($update);
    }

    // Buscamos los firmantes de este documento para imprimirlo en el reporte
    $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=101");
    if($firmantes != null){
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
    }else{
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','');
        $this->set('cargo_tercera_firma','');
    }
    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        $this->Session->write('ANO',$Ano);

                if(isset($this->data['cfpp05']['consolidacion'])){
                    $con=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
                    $tipo=$this->data['cfpp05']['consolidacion'];
                }else{
                    $con=$this->SQLCA_consolidado_opcion(null, "a");
                    $tipo=2;
                }

        if(isset($this->data['cfpp05']['tipo_recurso'])){
            $tipo_recurso=$this->data['cfpp05']['tipo_recurso'];

        }else{
            $tipo_recurso=0;

        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
            $mes_seleccion=$this->data["reporte"]["mes"];
         }else{
            $this->set("mes",date("n"));
            $this->Session->write("mes_solicitado",date("n"));
            $mes_seleccion=date("n");
         }

         if(isset($this->data["cfpp05"]["frecuencia"]) && !empty($this->data["cfpp05"]["frecuencia"])){
            $frecuencia = $this->data["cfpp05"]["frecuencia"];
         }else{
            $frecuencia = 5;
         }
        if(isset($this->data["cfpp05"]["tipo_gasto"])){
            $tipo_gasto = $this->data["cfpp05"]["tipo_gasto"];
        }else{
            $tipo_gasto = 0;
        }

                                                        // *** TIPO DE GASTO ****

        $this->set('tipo_gasto',$tipo_gasto);
        switch ($tipo_gasto) {
            case 0:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=2 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Inversion, Situado y Transferencia
                break;
            case 1:
                $cod_tipo_gasto = " and a.cod_tipo_gasto=2 "; // Inversion
                break;
            case 2:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Situado y Transferencia
                break;

            default:
                break;
        }

                                                    // *** TIPO DE RECURSOS ****

        $this->set('tipo_recurso',$tipo_recurso);

        if($tipo_recurso==0 || $tipo_recurso=='0'){
            $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6 OR a.tipo_presupuesto= 7 OR a.tipo_presupuesto= 8) ";
        }else{
            $cond_tipo_recurso= " and a.tipo_presupuesto=".$tipo_recurso;
        }

/*
        switch ($tipo_recurso) {
            case 0:
                $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6) ";
                break;
            case 1:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 1 "; // Ordinario
                break;
            case 2:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 2 "; // Coordinado
                break;
            case 3:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 3 "; // Fci
                break;
            case 4:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 4 "; // Mpps
                break;
            case 5:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 5 "; // Ingresos Extraordinarios
                break;
            case 6:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 6 "; // Ingresos Propios
                break;

            default:
                break;
        }
*/


         switch ($frecuencia) {
            case 2://FRECUENCIA MENSUAL
                $_SESSION['frecuencia']= "MENSUAL";
                $mes = $this->data['cfpp05']['mes'];

                switch ($mes) {//MESES
                    case 1://ENERO
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/01/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene)";
                        $suma_rebajas = "SUM(a.rebaja_ene)";
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion, (".$suma_creditos." - ".$suma_rebajas.") as diferencia, ";
                        $aumento = "(SUM(a.aumento_traslado_ene) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene) as compromisos,";
                        $causado = "SUM(a.causado_ene) as causado,";
                        $pagado = "SUM(a.pagado_ene) as pagado";
                        break;
                    case 2://FEBRERO
                        $_SESSION['fecha']="01/02/".$Ano." hasta 28/02/".$Ano;
                        $_SESSION['fecha_al']="01/02/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_feb)";
                        $suma_rebajas = "SUM(a.rebaja_feb)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_feb) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_feb) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_feb) as compromisos, ";
                        $causado = "SUM(a.causado_feb) as causado, ";
                        $pagado = "SUM(a.pagado_feb) as pagado";
                        break;

                    case 3://MARZO
                        $_SESSION['fecha']="01/03/".$Ano." hasta 31/03/".$Ano;
                        $_SESSION['fecha_al']="01/03/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_mar)";
                        $suma_rebajas = "SUM(a.rebaja_mar)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_mar) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_mar) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_mar) as compromisos, ";
                        $causado = "SUM(a.causado_mar) as causado, ";
                        $pagado = "SUM(a.pagado_mar) as pagado";
                        break;

                    case 4://ABRIL
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/04/".$Ano;
                        $_SESSION['fecha_al']="01/04/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_abr)";
                        $suma_rebajas = "SUM(a.rebaja_abr)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_abr) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_abr) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_abr) as compromisos, ";
                        $causado = "SUM(a.causado_abr) as causado, ";
                        $pagado = "SUM(a.pagado_abr) as pagado";
                        break;

                    case 5://MAYO
                        $_SESSION['fecha']="01/05/".$Ano." hasta 31/05/".$Ano;
                        $_SESSION['fecha_al']="01/05/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_may)";
                        $suma_rebajas = "SUM(a.rebaja_may)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_may) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_may) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_may) as compromisos, ";
                        $causado = "SUM(a.causado_may) as causado, ";
                        $pagado = "SUM(a.pagado_may) as pagado";
                        break;

                    case 6://JUNIO
                        $_SESSION['fecha']="01/06/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/06/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_jun)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jun) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_jun) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_jun) as compromisos, ";
                        $causado = "SUM(a.causado_jun) as causado, ";
                        $pagado = "SUM(a.pagado_jun) as pagado";
                        break;

                    case 7://JULIO
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/07/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jul)";
                        $suma_rebajas = "SUM(a.rebaja_jul)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jul) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_jul) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_jul) as compromisos, ";
                        $causado = "SUM(a.causado_jul) as causado, ";
                        $pagado = "SUM(a.pagado_jul) as pagado";
                        break;

                    case 8://AGOSTO
                        $_SESSION['fecha']="01/08/".$Ano." hasta 31/08/".$Ano;
                        $_SESSION['fecha_al']="01/08/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ago)";
                        $suma_rebajas = "SUM(a.rebaja_ago)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_ago) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ago) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_ago) as compromisos, ";
                        $causado = "SUM(a.causado_ago) as causado, ";
                        $pagado = "SUM(a.pagado_ago) as pagado";
                        break;
                    case 9://SEPTIEMBRE
                        $_SESSION['fecha']="01/09/".$Ano." hasta 30/09/".$Ano;
                        $_SESSION['fecha_al']="01/09/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_sep)";
                        $suma_rebajas = "SUM(a.rebaja_sep)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_sep) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_sep) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_sep) as compromisos, ";
                        $causado = "SUM(a.causado_sep) as causado, ";
                        $pagado = "SUM(a.pagado_sep) as pagado";
                        break;

                    case 10://OCTUBRE
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/10/".$Ano;
                        $_SESSION['fecha_al']="01/10/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_oct)";
                        $suma_rebajas = "SUM(a.rebaja_oct)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_oct) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_oct) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_oct) as compromisos, ";
                        $causado = "SUM(a.causado_oct) as causado, ";
                        $pagado = "SUM(a.pagado_oct) as pagado";

                        break;
                    case 11://NOVIEMBRE
                        $_SESSION['fecha']="01/11/".$Ano." hasta 30/11/".$Ano;
                        $_SESSION['fecha_al']="01/11/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_nov)";
                        $suma_rebajas = "SUM(a.rebaja_nov)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_nov) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_nov) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_nov) as compromisos, ";
                        $causado = "SUM(a.causado_nov) as causado, ";
                        $pagado = "SUM(a.pagado_nov) as pagado";

                        break;
                    case 12://DICIEMBRE
                        $_SESSION['fecha']="01/12/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/12/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_dic)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_dic) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_dic) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 3://FRECUENCIA TRIMESTRAL
                $_SESSION['frecuencia']= "TRIMESTRAL";
                $trimestre = $this->data['cfpp05']['trimestre'];

                switch ($trimestre) {
                    case 1:
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
                        $aumento_traslado = "SUM(0)";
                        $disminucion_traslado = "SUM(0)";
                        $credito_anteriores = "SUM(0)";
                        $rebajas_anteriores = "SUM(0)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar) + ".$suma_rebajas.") as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar) as compromisos,";
                        $causado = "SUM(a.causado_ene + a.causado_feb + a.causado_mar) as causado,";
                        $pagado = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar) as pagado";
                        break;

                    case 2:
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/04/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + ".$suma_creditos.") as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + ".$suma_rebajas.") as disminucion,";
                        $compromisos = "SUM(a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                        $causado = "SUM(a.causado_abr + a.causado_may + a.causado_jun) as causado,";
                        $pagado = "SUM(a.pagado_abr + a.pagado_may + a.pagado_jun) as pagado";
                        break;

                    case 3:
                        $_SESSION['fecha']="01/07/".$Ano." hasta 30/09/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $suma_rebajas = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep) + ".$suma_creditos.") as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep) + ".$suma_rebajas.") as disminucion, ";
                        $compromisos = "SUM(a.compromiso_jul + a.compromiso_ago + a.compromiso_sep) as compromisos, ";
                        $causado = "SUM(a.causado_jul + a.causado_ago + a.causado_sep) as causado, ";
                        $pagado = "SUM(a.pagado_jul + a.pagado_ago + a.pagado_sep) as pagado";
                        break;
                    case 4:
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/10/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos.") as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas.") as disminucion, ";
                        $compromisos = "SUM(a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_oct + a.causado_nov + a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 4://FRECUENCIA SEMESTRAL
                $_SESSION['frecuencia']= "SEMESTRAL";
                $semestre = $this->data['cfpp05']['semestre'];

                switch ($semestre) {
                    case 1://SEMESTRE 1
                        $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $asignacion= "SUM(a.asignacion_anual) as asignacion,";
                        $aumento = "(SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + ".$suma_creditos." ) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + ".$suma_rebajas." ) as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                        $causado = "SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun) as causado,";
                        $pagado = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun) as pagado";
                        break;

                    case 2://SEMESTRE 2
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos1 = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $suma_rebajas1 = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $aumento1 = "(SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + ".$suma_creditos1." )";
                        $disminucion1 = "(SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + ".$suma_rebajas1." )";
                        $suma_creditos = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                        $aumento_anterior = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $disminucion_anterior = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion = "(SUM(a.asignacion_anual) + ".$aumento1." - ".$disminucion1." ) as asignacion,";
                        $aumento = "(SUM(a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion, ";
                        $compromisos = "SUM(a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 5://FRECUENCIA ANUAL
                $_SESSION['frecuencia']= "ANUAL";
                $_SESSION['fecha_al']="01/01/".$Ano;
                $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
                $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,
                    (SUM(a.asignacion_anual)) as asignacion,
                    (SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento,
                    (SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion,
                    SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,
                    SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun + a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado,
                    SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado
                    FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,
                    (SUM(a.asignacion_anual)) as asignacion,
                    (SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento,
                    (SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion,
                    SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,
                    SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun + a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado,
                    SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado
                    FROM cfpd05 a WHERE ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;

            default:
                break;
        }
        //echo $sql;
        $data = $this->ccfd01_tipo->execute($sql);
        $this->set('data', $data);


}

function reporte_ejecucion_presupuestaria_pdf(){
    $this->layout = "pdf";

    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');
    // Capturamos los firmantes de los documentos
    $tipo_doc_anul = $this->data['cugp03_acta_anulacion']['tipo_doc_anul'];
    $nombre_primera_firma = $this->data['cugp03_acta_anulacion']['nombre_primera_firma'];
    $cargo_primera_firma  = $this->data['cugp03_acta_anulacion']['cargo_primera_firma'];
    $nombre_segunda_firma = $this->data['cugp03_acta_anulacion']['nombre_segunda_firma'];
    $cargo_segunda_firma  = $this->data['cugp03_acta_anulacion']['cargo_segunda_firma'];
    $nombre_tercera_firma = $this->data['cugp03_acta_anulacion']['nombre_tercera_firma'];
    $cargo_tercera_firma  = $this->data['cugp03_acta_anulacion']['cargo_tercera_firma'];

    // Verificamos si existen los firmantes para hacer una Insercion o Actualizacion
    $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->condicion()." and tipo_documento='101'");
    if($cont == 0){
        $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc_anul,'$nombre_primera_firma', '$cargo_primera_firma', '$nombre_segunda_firma', '$cargo_segunda_firma', '$nombre_tercera_firma', '$cargo_tercera_firma')";
        $this->cugd07_firmas_oficio_anulacion->execute($insert);
    }else{
        $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$nombre_primera_firma', cargo_primera_firma='$cargo_primera_firma', nombre_segunda_firma='$nombre_segunda_firma', cargo_segunda_firma='$cargo_segunda_firma', nombre_tercera_firma='$nombre_tercera_firma', cargo_tercera_firma='$cargo_tercera_firma' WHERE ".$this->SQLCA()." and tipo_documento=".$tipo_doc_anul;
        $this->cugd07_firmas_oficio_anulacion->execute($update);
    }

    // Buscamos los firmantes de este documento para imprimirlo en el reporte
    $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." and tipo_documento=101");
    if($firmantes != null){
        $this->set('nombre_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
        $this->set('cargo_primera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
        $this->set('nombre_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
        $this->set('cargo_segunda_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
        $this->set('nombre_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_tercera_firma']);
        $this->set('cargo_tercera_firma',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_tercera_firma']);
    }else{
        $this->set('nombre_primera_firma','');
        $this->set('cargo_primera_firma','');
        $this->set('nombre_segunda_firma','');
        $this->set('cargo_segunda_firma','');
        $this->set('nombre_tercera_firma','');
        $this->set('cargo_tercera_firma','');
    }
    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];
         }else{
            $Ano=$this->ano_ejecucion();
         }
        $this->set('ANO',$Ano);
        $this->Session->write('ANO',$Ano);

    if(isset($this->data['cfpp05']['consolidacion'])){
        $con=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");
        $tipo=$this->data['cfpp05']['consolidacion'];
    }else{
        $con=$this->SQLCA_consolidado_opcion(null, "a");
        $tipo=2;
    }

        if(isset($this->data['cfpp05']['tipo_recurso'])){
            $tipo_recurso=$this->data['cfpp05']['tipo_recurso'];

        }else{
            $tipo_recurso=0;

        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);
        if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
            $mes_seleccion=$this->data["reporte"]["mes"];
         }else{
            $this->set("mes",date("n"));
            $this->Session->write("mes_solicitado",date("n"));
            $mes_seleccion=date("n");
         }

         if(isset($this->data["cfpp05"]["frecuencia"]) && !empty($this->data["cfpp05"]["frecuencia"])){
            $frecuencia = $this->data["cfpp05"]["frecuencia"];
         }else{
            $frecuencia = 5;
         }
        if(isset($this->data["cfpp05"]["tipo_gasto"])){
            $tipo_gasto = $this->data["cfpp05"]["tipo_gasto"];
        }else{
            $tipo_gasto = 0;
        }

                                                        // *** TIPO DE GASTO ****

        $this->set('tipo_gasto',$tipo_gasto);
        switch ($tipo_gasto) {
            case 0:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=2 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Inversion, Situado y Transferencia
                break;
            case 1:
                $cod_tipo_gasto = " and a.cod_tipo_gasto=2 "; // Inversion
                break;
            case 2:
                $cod_tipo_gasto = " and (a.cod_tipo_gasto=1 OR a.cod_tipo_gasto=3 OR a.cod_tipo_gasto=4) "; // Funcionamiento, Situado y Transferencia
                break;

            default:
                break;
        }

                                                    // *** TIPO DE RECURSOS ****
        $this->set('tipo_recurso',$tipo_recurso);

        if($tipo_recurso==0 || $tipo_recurso=='0'){
            $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6 OR a.tipo_presupuesto= 7 OR a.tipo_presupuesto= 8) ";
        }else{
            $cond_tipo_recurso= " and a.tipo_presupuesto=".$tipo_recurso;
        }


/*
        switch ($tipo_recurso) {
            case 0:
                $cond_tipo_recurso= " and (a.tipo_presupuesto= 1 OR a.tipo_presupuesto= 2 OR a.tipo_presupuesto= 3 OR a.tipo_presupuesto= 4 OR a.tipo_presupuesto= 5 OR a.tipo_presupuesto= 6) ";
                break;
            case 1:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 1 "; // Ordinario
                break;
            case 2:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 2 "; // Coordinado
                break;
            case 3:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 3 "; // Fci
                break;
            case 4:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 4 "; // Mpps
                break;
            case 5:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 5 "; // Ingresos Extraordinarios
                break;
            case 6:
                $cond_tipo_recurso= " and a.tipo_presupuesto= 6 "; // Ingresos Propios
                break;

            default:
                break;
        }
*/


         switch ($frecuencia) {
            case 2://FRECUENCIA MENSUAL
                $_SESSION['frecuencia']= "MENSUAL";
                $mes = $this->data['cfpp05']['mes'];

                switch ($mes) {//MESES
                    case 1://ENERO
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/01/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene)";
                        $suma_rebajas = "SUM(a.rebaja_ene)";
                        $asignacion= "(SUM(a.asignacion_anual)) as asignacion, (".$suma_creditos." - ".$suma_rebajas.") as diferencia, ";
                        $aumento = "(SUM(a.aumento_traslado_ene) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene) as compromisos,";
                        $causado = "SUM(a.causado_ene) as causado,";
                        $pagado = "SUM(a.pagado_ene) as pagado";
                        break;
                    case 2://FEBRERO
                        $_SESSION['fecha']="01/02/".$Ano." hasta 28/02/".$Ano;
                        $_SESSION['fecha_al']="01/02/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_feb)";
                        $suma_rebajas = "SUM(a.rebaja_feb)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_feb) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_feb) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_feb) as compromisos, ";
                        $causado = "SUM(a.causado_feb) as causado, ";
                        $pagado = "SUM(a.pagado_feb) as pagado";
                        break;

                    case 3://MARZO
                        $_SESSION['fecha']="01/03/".$Ano." hasta 31/03/".$Ano;
                        $_SESSION['fecha_al']="01/03/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_mar)";
                        $suma_rebajas = "SUM(a.rebaja_mar)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_mar) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_mar) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_mar) as compromisos, ";
                        $causado = "SUM(a.causado_mar) as causado, ";
                        $pagado = "SUM(a.pagado_mar) as pagado";
                        break;

                    case 4://ABRIL
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/04/".$Ano;
                        $_SESSION['fecha_al']="01/04/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_abr)";
                        $suma_rebajas = "SUM(a.rebaja_abr)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_abr) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_abr) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_abr) as compromisos, ";
                        $causado = "SUM(a.causado_abr) as causado, ";
                        $pagado = "SUM(a.pagado_abr) as pagado";
                        break;

                    case 5://MAYO
                        $_SESSION['fecha']="01/05/".$Ano." hasta 31/05/".$Ano;
                        $_SESSION['fecha_al']="01/05/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_may)";
                        $suma_rebajas = "SUM(a.rebaja_may)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_may) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_may) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_may) as compromisos, ";
                        $causado = "SUM(a.causado_may) as causado, ";
                        $pagado = "SUM(a.pagado_may) as pagado";
                        break;

                    case 6://JUNIO
                        $_SESSION['fecha']="01/06/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/06/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_jun)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jun) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_jun) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_jun) as compromisos, ";
                        $causado = "SUM(a.causado_jun) as causado, ";
                        $pagado = "SUM(a.pagado_jun) as pagado";
                        break;

                    case 7://JULIO
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/07/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jul)";
                        $suma_rebajas = "SUM(a.rebaja_jul)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jul) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_jul) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_jul) as compromisos, ";
                        $causado = "SUM(a.causado_jul) as causado, ";
                        $pagado = "SUM(a.pagado_jul) as pagado";
                        break;

                    case 8://AGOSTO
                        $_SESSION['fecha']="01/08/".$Ano." hasta 31/08/".$Ano;
                        $_SESSION['fecha_al']="01/08/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ago)";
                        $suma_rebajas = "SUM(a.rebaja_ago)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_ago) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ago) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_ago) as compromisos, ";
                        $causado = "SUM(a.causado_ago) as causado, ";
                        $pagado = "SUM(a.pagado_ago) as pagado";
                        break;
                    case 9://SEPTIEMBRE
                        $_SESSION['fecha']="01/09/".$Ano." hasta 30/09/".$Ano;
                        $_SESSION['fecha_al']="01/09/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_sep)";
                        $suma_rebajas = "SUM(a.rebaja_sep)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_sep) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_sep) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_sep) as compromisos, ";
                        $causado = "SUM(a.causado_sep) as causado, ";
                        $pagado = "SUM(a.pagado_sep) as pagado";
                        break;

                    case 10://OCTUBRE
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/10/".$Ano;
                        $_SESSION['fecha_al']="01/10/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_oct)";
                        $suma_rebajas = "SUM(a.rebaja_oct)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_oct) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_oct) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_oct) as compromisos, ";
                        $causado = "SUM(a.causado_oct) as causado, ";
                        $pagado = "SUM(a.pagado_oct) as pagado";

                        break;
                    case 11://NOVIEMBRE
                        $_SESSION['fecha']="01/11/".$Ano." hasta 30/11/".$Ano;
                        $_SESSION['fecha_al']="01/11/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_nov)";
                        $suma_rebajas = "SUM(a.rebaja_nov)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_nov) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_nov) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_nov) as compromisos, ";
                        $causado = "SUM(a.causado_nov) as causado, ";
                        $pagado = "SUM(a.pagado_nov) as pagado";

                        break;
                    case 12://DICIEMBRE
                        $_SESSION['fecha']="01/12/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/12/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_dic)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_dic) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_dic) + ".$suma_rebajas.")as disminucion,";
                        $compromisos = "SUM(a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){ // *** DEPENDENCIA ***
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{ // *** INSTITUCION ***
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 3://FRECUENCIA TRIMESTRAL
                $_SESSION['frecuencia']= "TRIMESTRAL";
                $trimestre = $this->data['cfpp05']['trimestre'];

                switch ($trimestre) {
                    case 1:
                        $_SESSION['fecha']="01/01/".$Ano." hasta 31/03/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar)";
                        $aumento_traslado = "SUM(0)";
                        $disminucion_traslado = "SUM(0)";
                        $credito_anteriores = "SUM(0)";
                        $rebajas_anteriores = "SUM(0)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." ) as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar) + ".$suma_creditos.")as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar) + ".$suma_rebajas.") as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar) as compromisos,";
                        $causado = "SUM(a.causado_ene + a.causado_feb + a.causado_mar) as causado,";
                        $pagado = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar) as pagado";
                        break;

                    case 2:
                        $_SESSION['fecha']="01/04/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/04/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + ".$suma_creditos.") as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + ".$suma_rebajas.") as disminucion,";
                        $compromisos = "SUM(a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                        $causado = "SUM(a.causado_abr + a.causado_may + a.causado_jun) as causado,";
                        $pagado = "SUM(a.pagado_abr + a.pagado_may + a.pagado_jun) as pagado";
                        break;

                    case 3:
                        $_SESSION['fecha']="01/07/".$Ano." hasta 30/09/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $suma_rebajas = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep) + ".$suma_creditos.") as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep) + ".$suma_rebajas.") as disminucion, ";
                        $compromisos = "SUM(a.compromiso_jul + a.compromiso_ago + a.compromiso_sep) as compromisos, ";
                        $causado = "SUM(a.causado_jul + a.causado_ago + a.causado_sep) as causado, ";
                        $pagado = "SUM(a.pagado_jul + a.pagado_ago + a.pagado_sep) as pagado";
                        break;
                    case 4:
                        $_SESSION['fecha']="01/10/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/10/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                        $aumento_traslado = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep)";
                        $disminucion_traslado = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep)";
                        $credito_anteriores = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep)";
                        $rebajas_anteriores = "SUM(a.rebaja_ene + a.rebaja_feb+ a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep)";
                        $asignacion= "(SUM(a.asignacion_anual) + ".$aumento_traslado." - ".$disminucion_traslado."  + ".$credito_anteriores." - ".$rebajas_anteriores." - ".$compromisos_anteriores.") as asignacion, ";
                        $aumento = "(SUM(a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos.") as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas.") as disminucion, ";
                        $compromisos = "SUM(a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_oct + a.causado_nov + a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){ // *** DEPENDENCIA ***
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{ // *** INSTITUCION ***
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE  a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 4://FRECUENCIA SEMESTRAL
                $_SESSION['frecuencia']= "SEMESTRAL";
                $semestre = $this->data['cfpp05']['semestre'];

                switch ($semestre) {
                    case 1://SEMESTRE 1
                        $_SESSION['fecha']="01/01/".$Ano." hasta 30/06/".$Ano;
                        $_SESSION['fecha_al']="01/01/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $asignacion= "SUM(a.asignacion_anual) as asignacion,";
                        $aumento = "(SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + ".$suma_creditos." ) as aumento,";
                        $disminucion = "(SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + ".$suma_rebajas." ) as disminucion,";
                        $compromisos = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun) as compromisos,";
                        $causado = "SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun) as causado,";
                        $pagado = "SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun) as pagado";
                        break;

                    case 2://SEMESTRE 2
                        $_SESSION['fecha']="01/07/".$Ano." hasta 31/12/".$Ano;
                        $_SESSION['fecha_al']="01/07/".$Ano;
                        $suma_creditos = "SUM(a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                        $suma_rebajas = "SUM(a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                        $aumento_anterior = "SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun) + SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun)";
                        $disminucion_anterior = "SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun) + SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun)";
                        $compromisos_anteriores = "SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun)";
                        $asignacion = "(SUM(a.asignacion_anual) + ".$aumento_anterior." - ".$disminucion_anterior." - ".$compromisos_anteriores.") as asignacion,";
                        $aumento = "(SUM(a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento, ";
                        $disminucion = "(SUM(a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion, ";
                        $compromisos = "SUM(a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos, ";
                        $causado = "SUM(a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado, ";
                        $pagado = "SUM(a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado";
                        break;

                    default:
                        break;
                }

                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,".$asignacion.$aumento.$disminucion.$compromisos.$causado.$pagado." FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso;
                    $sql .= "GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                            ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;
            case 5://FRECUENCIA ANUAL
                $_SESSION['frecuencia']= "ANUAL";
                $_SESSION['fecha_al']="01/01/".$Ano;
                $_SESSION['fecha']="01/01/".$Ano." hasta 31/12/".$Ano;
                $suma_creditos = "SUM(a.credito_adicional_ene + a.credito_adicional_feb + a.credito_adicional_mar + a.credito_adicional_abr + a.credito_adicional_may + a.credito_adicional_jun + a.credito_adicional_jul + a.credito_adicional_ago + a.credito_adicional_sep + a.credito_adicional_oct + a.credito_adicional_nov + a.credito_adicional_dic)";
                $suma_rebajas = "SUM(a.rebaja_ene + a.rebaja_feb + a.rebaja_mar + a.rebaja_abr + a.rebaja_may + a.rebaja_jun + a.rebaja_jul + a.rebaja_ago + a.rebaja_sep + a.rebaja_oct + a.rebaja_nov + a.rebaja_dic)";
                if($tipo == 2){
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,
                    (SUM(a.asignacion_anual)) as asignacion,
                    (SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento,
                    (SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion,
                    SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,
                    SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun + a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado,
                    SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado
                    FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.ano, a.cod_partida";
                }else{
                    $sql = "SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida,
                    (SELECT b.denominacion
                    FROM cfpd01_ano_2_partida b
                    WHERE
                    b.ejercicio = a.ano AND
                    b.cod_grupo = 4 AND
                    b.cod_partida = substr(a.cod_partida::text,2,2)::integer LIMIT 1
                    ) as partida,
                    (SUM(a.asignacion_anual)) as asignacion,
                    (SUM(a.aumento_traslado_ene + a.aumento_traslado_feb + a.aumento_traslado_mar + a.aumento_traslado_abr + a.aumento_traslado_may + a.aumento_traslado_jun + a.aumento_traslado_jul + a.aumento_traslado_ago + a.aumento_traslado_sep + a.aumento_traslado_oct + a.aumento_traslado_nov + a.aumento_traslado_dic) + ".$suma_creditos." )as aumento,
                    (SUM(a.disminucion_traslado_ene + a.disminucion_traslado_feb + a.disminucion_traslado_mar + a.disminucion_traslado_abr + a.disminucion_traslado_may + a.disminucion_traslado_jun + a.disminucion_traslado_jul + a.disminucion_traslado_ago + a.disminucion_traslado_sep + a.disminucion_traslado_oct + a.disminucion_traslado_nov + a.disminucion_traslado_dic) + ".$suma_rebajas." )as disminucion,
                    SUM(a.compromiso_ene + a.compromiso_feb + a.compromiso_mar + a.compromiso_abr + a.compromiso_may + a.compromiso_jun + a.compromiso_jul + a.compromiso_ago + a.compromiso_sep + a.compromiso_oct + a.compromiso_nov + a.compromiso_dic) as compromisos,
                    SUM(a.causado_ene + a.causado_feb + a.causado_mar + a.causado_abr + a.causado_may + a.causado_jun + a.causado_jul + a.causado_ago + a.causado_sep + a.causado_oct + a.causado_nov + a.causado_dic) as causado,
                    SUM(a.pagado_ene + a.pagado_feb + a.pagado_mar + a.pagado_abr + a.pagado_may + a.pagado_jun + a.pagado_jul + a.pagado_ago + a.pagado_sep + a.pagado_oct + a.pagado_nov + a.pagado_dic) as pagado
                    FROM cfpd05 a WHERE a.ano=$Ano AND ".$this->SQLCA_consolidado($tipo).$cod_tipo_gasto.$cond_tipo_recurso."
                    GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida
                    ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.ano, a.cod_partida";
                }

                break;

            default:
                break;
        }
        $data = $this->ccfd01_tipo->execute($sql);
        $this->set('data', $data);
}

function ficha_proveedores_contratistas($var=null,$rif=null){
    $this->layout = "ajax";


    if($var!=null && $var=='si'){
        //$list = $this->cpcd02->generateList(null,'rif ASC', null, '{n}.cpcd02.rif', '{n}.cpcd02.denominacion');
        //$list = $list != null ? $list : array();
        //$this->concatena_sin_cero($list, 'list');
        $this->set('ir','si');
    }else{
        $this->layout = "pdf";
        $this->set('ir','no');

        //$rif_proveedor = $this->data['cpcp02']['rif_proveedor'];
        $rif_proveedor = $rif;

        $sql = "SELECT
                a.rif,
                a.objeto,
                a.denominacion,
                a.numero_expediente,
                a.ramo_comercial,
                a.direccion_comercial,
                a.actividades_principales,
                (SELECT denominacion FROM cugd01_estados b WHERE a.cod_estado=b.cod_estado) as estado,
                (SELECT denominacion FROM cugd01_municipios b WHERE a.cod_estado=b.cod_estado and a.cod_municipio=b.cod_municipio) as municipio,
                a.codigo_area_empresa,
                a.telefonos,
                a.codigo_postal,
                a.correo_electronico_empresa,
                a.equipos_disponibles,
                a.inscripcion_sunacoop,
                a.exento_islr_cooperativa,
                a.registro_mercantil,
                a.socios,
                a.capacidad_financiera,
                a.cedula_identidad,
                a.representante_legal,
                a.direccion_representante,
                a.telefonos_fijos_representante,
                a.telefonos_moviles_representante,
                a.correo_electronico_representante,
                a.numero_ocei,
                a.numero_solvencia_laboral,
                a.numero_solvencia_seguro,
                a.numero_solvencia_ince,
                a.numero_solvencia_municipal,
                a.observacion,
                a.fecha_inscripcion,
                a.fecha_actualizacion

                FROM cpcd02 a WHERE
                rif='$rif_proveedor'";

        $datos = $this->cpcd02->execute($sql);
        $this->set('datos',$datos);
    }
}


function ventana_busqueda_proveedor($var1=null){
    $this->layout="ajax";
    $this->set("opcion",$var1);
    $this->Session->delete('pista');
}


function buscar_proveedor_por_pista($var1=null,$var2=null,$var3=null){
    $this->layout="ajax";

    if($var3==null){$var2 = strtoupper($var2);
                    $this->Session->write('pista', $var2);
                    $Tfilas=$this->cpcd02->findCount(" (mayus_acentos(denominacion)  LIKE mayus_acentos('%$var2%') )  OR  (rif LIKE '%$var2%')   ");
                            if($Tfilas!=0){
                                $pagina=1;
                                $Tfilas=(int)ceil($Tfilas/100);
                                $this->set('pag_cant',$pagina.'/'.$Tfilas);
                                $this->set('total_paginas',$Tfilas);
                                $this->set('pagina_actual',$pagina);
                                $this->set('ultimo',$Tfilas);
                                $datos_filas=$this->cpcd02->findAll(" (mayus_acentos(denominacion)  LIKE mayus_acentos('%$var2%') )  OR  (rif LIKE '%$var2%')   ",null,"denominacion ASC",100,1,null);
                                $this->set("datosFILAS",$datos_filas);
                                $this->set('siguiente',$pagina+1);
                                $this->set('anterior',$pagina-1);
                                $this->bt_nav($Tfilas,$pagina);
                              }else{
                                $this->set("datosFILAS",'');
                              }
            }else{
                    $var22 = $this->Session->read('pista');
                    $var22 = strtoupper($var22);
                    $Tfilas=$this->cpcd02->findCount(" (mayus_acentos(denominacion)  LIKE mayus_acentos('%$var22%') )  OR  (rif LIKE '%$var22%')   ");
                            if($Tfilas!=0){
                                $pagina=$var3;
                                $Tfilas=(int)ceil($Tfilas/100);
                                $this->set('pag_cant',$pagina.'/'.$Tfilas);
                                $this->set('total_paginas',$Tfilas);
                                $this->set('pagina_actual',$pagina);
                                $this->set('ultimo',$Tfilas);
                                $datos_filas=$this->cpcd02->findAll(" (mayus_acentos(denominacion)  LIKE mayus_acentos('%$var22%') )  OR  (rif LIKE '%$var22%')   ",null,"denominacion ASC",100,$pagina,null);
                                $this->set("datosFILAS",$datos_filas);
                                $this->set('siguiente',$pagina+1);
                                $this->set('anterior',$pagina-1);
                                $this->bt_nav($Tfilas,$pagina);
                              }else{
                                $this->set("datosFILAS",'');
                              }
                 }//fin else
    $this->set("opcion",$var1);
}


function ejecucion_financiera_presupuesto_gastos_form () {
    $this->layout = "ajax";
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');
    $ano=$this->ano_ejecucion();
    if(!empty($ano)){
         $this->set('ano', $this->ano_ejecucion());
         $this->Session->write('ano',$this->ano_ejecucion());
         $this->Session->write('ano_reporte',$this->ano_ejecucion());
    }else{
        $this->set('ano', '');
    }

    if($this->verifica_SS(5)==1){
        $cond=$this->SQLCA_report(1);
    }else{
        $cond=$this->SQLCA_report();
    }

    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    if(isset($v) &&  is_array($v)){
        $lista = array_combine($v, $d);
    }else{
       $lista = array("0"=>"N/A");
    }

    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }

    if(isset($vp) &&  is_array($vp)){
        $partida = array_combine($vp, $dp);
    }else{
       $partida = array("0"=>"N/A");
    }
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');
    $this->Session->delete('sec');
    $this->Session->delete('prog');
    $this->Session->delete('subp');
    $this->Session->delete('proy');
    $this->Session->delete('actividad');
    $this->Session->delete('cpar');
    $this->Session->delete('cgen');
    $this->Session->delete('cesp');



            $cont = $this->cimd06_acta_firmantes->findCount($this->SQLCA()." AND numero_acta = 99999");
        if($cont == 0){
            $this->set('errorMessage','Por favor, ingrese los nombres y cargos de los firmantes');
            $this->set('firmante_1','');
            $this->set('cedula_1','');
            $this->set('cargo_1','');
            $this->set('firmante_2','');
            $this->set('cedula_2','');
            $this->set('cargo_2','');
            $this->set('firmante_3','');
            $this->set('cedula_3','');
            $this->set('cargo_3','');
            $firma_existe = 'no';
        }else{
            $firmantes= $this->cimd06_acta_firmantes->findAll($this->SQLCA()." AND numero_acta = 99999");
            $this->set('firmante_1',$firmantes[0]['cimd06_acta_firmantes']['funcionario_primero']);
            $this->set('cedula_1',$firmantes[0]['cimd06_acta_firmantes']['cedula_primero']);
            $this->set('cargo_1',$firmantes[0]['cimd06_acta_firmantes']['cargo_primero']);
            $this->set('firmante_2',$firmantes[0]['cimd06_acta_firmantes']['funcionario_segundo']);
            $this->set('cedula_2',$firmantes[0]['cimd06_acta_firmantes']['cedula_segundo']);
            $this->set('cargo_2',$firmantes[0]['cimd06_acta_firmantes']['cargo_segundo']);
            $this->set('firmante_3',$firmantes[0]['cimd06_acta_firmantes']['funcionario_tercer']);
            $this->set('cedula_3',$firmantes[0]['cimd06_acta_firmantes']['cedula_tercer']);
            $this->set('cargo_3',$firmantes[0]['cimd06_acta_firmantes']['cargo_tercer']);
            $firma_existe = 'si';
        }
        $this->set('firma_existe',$firma_existe);

}

function ejecucion_financiera_presupuesto_gastos () {
    set_time_limit(0);
        $this->layout="pdf";

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
        $Ano=$this->data["reporte"]["ano"];
    }else{
            $Ano=$this->ano_ejecucion();
    }
    $this->set('ANO',$Ano);
    if(isset($this->data['cfpp05']['consolidacion'])){
        $con  =$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
        $con_a=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");


        $modelop=$this->data['cfpp05']['consolidacion']==1?'v_ejecucion_dep':'v_ejecucion_dep';
        $condicion_dep=$this->data['cfpp05']['consolidacion']==1?'cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).'':'cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).' and cod_dep='.$this->verifica_SS(5);

    }else{
        $con  =$this->SQLCA_consolidado();
        $con_a=$this->SQLCA_consolidado_opcion(null, "a");


        $modelop='v_ejecucion_dep';
        $condicion_dep='cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).' and cod_dep='.$this->verifica_SS(5);
    }
    $titulo_a = $this->Session->read('dependencia');
    $this->set('titulo_a',$titulo_a);

    if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!=""){
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
            $cod_sector_a=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
    }else{
            $cod_sector=" 1=1 and ";
            $cod_sector_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!=""){
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
            $cod_programa_a=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
    }else{
            $cod_programa=" 1=1 and ";
            $cod_programa_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!=""){
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
            $cod_sub_prog_a=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
    }else{
            $cod_sub_prog=" 1=1 and ";
            $cod_sub_prog_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!=""){
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
            $cod_proyecto_a=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
    }else{
            $cod_proyecto=" 1=1 and ";
            $cod_proyecto_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!=""){
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
            $cod_activ_obra_a=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
    }else{
            $cod_activ_obra=" 1=1 ";
            $cod_activ_obra_a=" 1=1 ";
    }
    if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!=""){
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
            $cod_partida_a=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
    }else{
            $cod_partida=" 1=1 ";
            $cod_partida_a=" 1=1 ";
    }
    if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!=""){
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
            $cod_generica_a=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
    }else{
            $cod_generica=" 1=1 and ";
            $cod_generica_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!=""){
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
            $cod_especifica_a=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
    }else{
            $cod_especifica=" 1=1 and ";
            $cod_especifica_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!=""){
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
            $cod_sub_espec_a=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
    }else{
            $cod_sub_espec=" 1=1 and ";
            $cod_sub_espec_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!=""){
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
            $cod_auxiliar_a=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
    }else{
            $cod_auxiliar=" 1=1 ";
            $cod_auxiliar_a=" 1=1 ";
    }
    $modo= (int) $this->data["reporte"]["modo"];
    //$mesv = $this->data["reporte"]["mes"];
    //$mes = (string) $this->data["reporte"]["mes"];
    $this->set('mes',"");
  //    echo $modo;
    switch($modo){
        case 1://completo todo
             $condicion=" 1=1";
              $condicion_a=" 1=1";
        break;
        case 2://por categoria
              $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
              $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a;
        break;
        case 3://por categoria y partida
            $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a." and ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
        break;
        case 4://por partida
             $condicion=" ".$cod_partida;
             $condicion_a=" ".$cod_partida_a;
        break;
        case 5://por sub-partidas
             $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
             $condicion_a=" ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
        break;
        default: $condicion=" 1=1";
                 $condicion_a=" 1=1";
        break;
    }//fin switch
        //$condicion="cod_sector=1 and cod_programa=6 and cod_sub_prog=1 and cod_proyecto=0 and cod_activ_obra=52 and cod_partida=401";
        $sin_afectadas=" and (aumento!=0 or disminucion!=0 or compromiso_anual!=0 or causado_anual!=0 or pagado_anual!=0)";
        //$vector = $this->$modelop->findAll($con." and ano=".$Ano." and ".$condicion.$sin_afectadas,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $vector = $this->$modelop->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $this->set('modelop',$modelop);
        $this->set('DATOS',$vector);
        $organismo = $this->arrd05->findAll($condicion_dep,array('cod_dep','denominacion'));
        $this->set('ORGANISMOS',$organismo);

        $resultados_mov=$this->v_cfpd20_cfpd21->execute("SELECT * FROM v_cfpd05_movimientos_vision WHERE ". $con." and ano=".$Ano." and ".$condicion);
        $this->set("MOV_CFPD",$resultados_mov);

    /*
        $cfpd20_cfpd21 = $this->v_cfpd20_cfpd21->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha,numero_asiento ASC');
        //$cfpd20 = $this->v_cfpd20->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha ASC');
        //$cfpd21 = $this->v_cfpd21->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha ASC');
        $cfpd22 = $this->v_cfpd22->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha,control_ab ASC');
        $cfpd23 = $this->v_cfpd23->findAll($con." and ano=".$Ano." and ".$condicion,null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha,control_ab ASC');
       // echo $con." and ano=".$Ano." and ".$condicion." and mes='".$mes."'";
        $this->set('vcfpd20_cfpd21',$cfpd20_cfpd21);
       // $this->set('vcfpd20',$cfpd20);
        //$this->set('vcfpd21',$cfpd21);
        $this->set('vcfpd22',$cfpd22);
        $this->set('vcfpd23',$cfpd23);
    */



$_SESSION['nombre1']= $this->data['cimd06_acta_firmantes']['funcionario_primero'];
$_SESSION['cedula1']= $this->data['cimd06_acta_firmantes']['cedula_primero'];
$_SESSION['cargo1']   = $this->data['cimd06_acta_firmantes']['cargo_primero'];
$_SESSION['nombre2'] = $this->data['cimd06_acta_firmantes']['funcionario_segundo'];
$_SESSION['cedula2'] = $this->data['cimd06_acta_firmantes']['cedula_segundo'];
$_SESSION['cargo2'] = $this->data['cimd06_acta_firmantes']['cargo_segundo'];
$_SESSION['nombre3'] = $this->data['cimd06_acta_firmantes']['funcionario_tercer'];
$_SESSION['cedula3'] = $this->data['cimd06_acta_firmantes']['cedula_tercer'];
$_SESSION['cargo3'] = $this->data['cimd06_acta_firmantes']['cargo_tercer'];

}


function ejecucion_financiera_presupuesto_gastos_librodiario_form () {
    $this->layout = "ajax";
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');
    $condicion = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
    $condicion2 = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst." and cod_dep=".$cod_dep;
    $ano=$this->ano_ejecucion();
    if(!empty($ano)){
         $this->set('ano', $this->ano_ejecucion());
         $this->Session->write('ano',$this->ano_ejecucion());
         $this->Session->write('ano_reporte',$this->ano_ejecucion());
    }else{
        $this->set('ano', '');
    }


    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $condicion2." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    if(isset($v) &&  is_array($v)){
        $lista = array_combine($v, $d);
    }else{
       $lista = array("0"=>"N/A");
    }

    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $condicion2." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }

    if(isset($vp) &&  is_array($vp)){
        $partida = array_combine($vp, $dp);
    }else{
       $partida = array("0"=>"N/A");
    }
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');
    $this->Session->delete('sec');
    $this->Session->delete('prog');
    $this->Session->delete('subp');
    $this->Session->delete('proy');
    $this->Session->delete('actividad');
    $this->Session->delete('cpar');
    $this->Session->delete('cgen');
    $this->Session->delete('cesp');
}//fin libro diario


function ejecucion_financiera_presupuesto_gastos_librodiario () {
        $this->layout="pdf";

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
        $Ano=$this->data["reporte"]["ano"];
    }else{
            $Ano=$this->ano_ejecucion();
    }
    $this->set('ANO',$Ano);
    if(isset($this->data['cfpp05']['consolidacion'])){
        $con  =$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
        $con_a=$this->SQLCA_consolidado_opcion($this->data['cfpp05']['consolidacion'], "a");

        $modelop=$this->data['cfpp05']['consolidacion']==1?'v_ejecucion_dep':'v_ejecucion_dep';
        $condicion_dep=$this->data['cfpp05']['consolidacion']==1?'cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).'':'cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).' and cod_dep='.$this->verifica_SS(5);

    }else{
        $con  =$this->SQLCA_consolidado();
        $con_a=$this->SQLCA_consolidado_opcion(null, "a");


        $modelop='v_ejecucion_dep';
        $condicion_dep='cod_presi='.$this->verifica_SS(1).' and cod_entidad='.$this->verifica_SS(2).' and cod_tipo_inst='.$this->verifica_SS(3).' and cod_inst='.$this->verifica_SS(4).' and cod_dep='.$this->verifica_SS(5);
    }
    $titulo_a = $this->Session->read('dependencia');
    $this->set('titulo_a',$titulo_a);

    if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!=""){
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
            $cod_sector_a=" a.cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
    }else{
            $cod_sector=" 1=1 and ";
            $cod_sector_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!=""){
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
            $cod_programa_a=" a.cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
    }else{
            $cod_programa=" 1=1 and ";
            $cod_programa_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!=""){
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
            $cod_sub_prog_a=" a.cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
    }else{
            $cod_sub_prog=" 1=1 and ";
            $cod_sub_prog_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!=""){
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
            $cod_proyecto_a=" a.cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
    }else{
            $cod_proyecto=" 1=1 and ";
            $cod_proyecto_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!=""){
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
            $cod_activ_obra_a=" a.cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
    }else{
            $cod_activ_obra=" 1=1 ";
            $cod_activ_obra_a=" 1=1 ";
    }
    if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!=""){
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
            $cod_partida_a=" a.cod_partida=".$this->data["reporte"]["cod_partida"]." ";
    }else{
            $cod_partida=" 1=1 ";
            $cod_partida_a=" 1=1 ";
    }
    if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!=""){
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
            $cod_generica_a=" a.cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
    }else{
            $cod_generica=" 1=1 and ";
            $cod_generica_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!=""){
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
            $cod_especifica_a=" a.cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
    }else{
            $cod_especifica=" 1=1 and ";
            $cod_especifica_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!=""){
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
            $cod_sub_espec_a=" a.cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
    }else{
            $cod_sub_espec=" 1=1 and ";
            $cod_sub_espec_a=" 1=1 and ";
    }
    if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!=""){
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
            $cod_auxiliar_a=" a.cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
    }else{
            $cod_auxiliar=" 1=1 ";
            $cod_auxiliar_a=" 1=1 ";
    }
    $modo= (int) $this->data["reporte"]["modo"];
    $mesv = $this->data["reporte"]["mes"];
    $mes = (string) $this->data["reporte"]["mes"];
    $dia_desde = (string) $this->data["reporte"]["dia_desde"];
    $dia_hasta = (string) $this->data["reporte"]["dia_hasta"];
    $this->set('mes',$mesv);
    $this->set('dia_desde',$dia_desde);
    $this->set('dia_hasta',$dia_hasta);
    switch($modo){
        case 1://completo todo
             $condicion=" 1=1";
              $condicion_a=" 1=1";
        break;
        case 2://por categoria
              $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
              $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a;
        break;
        case 3://por categoria y partida
            $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            $condicion_a=" ".$cod_sector_a.$cod_programa_a.$cod_sub_prog_a.$cod_proyecto_a.$cod_activ_obra_a." and ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
        break;
        case 4://por partida
             $condicion=" ".$cod_partida;
             $condicion_a=" ".$cod_partida_a;
        break;
        case 5://por sub-partidas
             $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
             $condicion_a=" ".$cod_partida_a." and ".$cod_generica_a.$cod_especifica_a.$cod_sub_espec_a.$cod_auxiliar_a;
        break;
        default: $condicion=" 1=1";
                 $condicion_a=" 1=1";
        break;
    }//fin switch
        $DIA_desde=(int)$dia_desde;
        $fecha_inicial = date("Y-m-d", mktime(0, 0, 0, 1, 1, $Ano));
        $fecha_final   = date("Y-m-d", mktime(0, 0, 0, $mes, $DIA_desde-1, $Ano));
        //echo $fecha_inicial." // ".$fecha_final;
        $this->set("fecha_acumulada",array("inicial"=>$fecha_inicial,"final"=>$fecha_final));
        $sin_afectadas=" and (aumento!=0 or disminucion!=0 or compromiso_anual!=0 or causado_anual!=0 or pagado_anual!=0)";
        $campos_extras="(SELECT null_cero(sum(vl.monto)) FROM v_librodiario_2 vl WHERE vl.cod_presi=".$modelop.".cod_presi and vl.cod_entidad=".$modelop.".cod_entidad and vl.cod_tipo_inst=".$modelop.".cod_tipo_inst and vl.cod_inst=".$modelop.".cod_inst and vl.cod_dep=".$modelop.".cod_dep and vl.ano=".$Ano." and vl.cod_sector=".$modelop.".cod_sector and vl.cod_programa=".$modelop.".cod_programa and vl.cod_sub_prog=".$modelop.".cod_sub_prog and vl.cod_proyecto=".$modelop.".cod_proyecto and vl.cod_activ_obra=".$modelop.".cod_activ_obra and vl.cod_partida=".$modelop.".cod_partida and vl.cod_generica=".$modelop.".cod_generica and vl.cod_especifica=".$modelop.".cod_especifica and vl.cod_sub_espec=".$modelop.".cod_sub_espec and vl.cod_auxiliar=".$modelop.".cod_auxiliar and vl.tipo_asiento=1 and fecha BETWEEN '$fecha_inicial' AND '$fecha_final'  group by cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) as monto_modificaciones,";
        $campos_extras.="(SELECT null_cero(sum(vl.monto)) FROM v_librodiario_2 vl WHERE vl.cod_presi=".$modelop.".cod_presi and vl.cod_entidad=".$modelop.".cod_entidad and vl.cod_tipo_inst=".$modelop.".cod_tipo_inst and vl.cod_inst=".$modelop.".cod_inst and vl.cod_dep=".$modelop.".cod_dep and vl.ano=".$Ano." and  vl.cod_sector=".$modelop.".cod_sector and vl.cod_programa=".$modelop.".cod_programa and vl.cod_sub_prog=".$modelop.".cod_sub_prog and vl.cod_proyecto=".$modelop.".cod_proyecto and vl.cod_activ_obra=".$modelop.".cod_activ_obra and vl.cod_partida=".$modelop.".cod_partida and vl.cod_generica=".$modelop.".cod_generica and vl.cod_especifica=".$modelop.".cod_especifica and vl.cod_sub_espec=".$modelop.".cod_sub_espec and vl.cod_auxiliar=".$modelop.".cod_auxiliar and vl.tipo_asiento=2 and fecha BETWEEN '$fecha_inicial' AND '$fecha_final'  group by cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) as monto_compromisos,";
        $campos_extras.="(SELECT null_cero(sum(vl.monto)) FROM v_librodiario_2 vl WHERE vl.cod_presi=".$modelop.".cod_presi and vl.cod_entidad=".$modelop.".cod_entidad and vl.cod_tipo_inst=".$modelop.".cod_tipo_inst and vl.cod_inst=".$modelop.".cod_inst and vl.cod_dep=".$modelop.".cod_dep and vl.ano=".$Ano." and  vl.cod_sector=".$modelop.".cod_sector and vl.cod_programa=".$modelop.".cod_programa and vl.cod_sub_prog=".$modelop.".cod_sub_prog and vl.cod_proyecto=".$modelop.".cod_proyecto and vl.cod_activ_obra=".$modelop.".cod_activ_obra and vl.cod_partida=".$modelop.".cod_partida and vl.cod_generica=".$modelop.".cod_generica and vl.cod_especifica=".$modelop.".cod_especifica and vl.cod_sub_espec=".$modelop.".cod_sub_espec and vl.cod_auxiliar=".$modelop.".cod_auxiliar and vl.tipo_asiento=3 and fecha BETWEEN '$fecha_inicial' AND '$fecha_final'  group by cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) as monto_causados,";
        $campos_extras.="(SELECT null_cero(sum(vl.monto)) FROM v_librodiario_2 vl WHERE vl.cod_presi=".$modelop.".cod_presi and vl.cod_entidad=".$modelop.".cod_entidad and vl.cod_tipo_inst=".$modelop.".cod_tipo_inst and vl.cod_inst=".$modelop.".cod_inst and vl.cod_dep=".$modelop.".cod_dep and vl.ano=".$Ano." and  vl.cod_sector=".$modelop.".cod_sector and vl.cod_programa=".$modelop.".cod_programa and vl.cod_sub_prog=".$modelop.".cod_sub_prog and vl.cod_proyecto=".$modelop.".cod_proyecto and vl.cod_activ_obra=".$modelop.".cod_activ_obra and vl.cod_partida=".$modelop.".cod_partida and vl.cod_generica=".$modelop.".cod_generica and vl.cod_especifica=".$modelop.".cod_especifica and vl.cod_sub_espec=".$modelop.".cod_sub_espec and vl.cod_auxiliar=".$modelop.".cod_auxiliar and vl.tipo_asiento=4 and fecha BETWEEN '$fecha_inicial' AND '$fecha_final'  group by cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar) as monto_pagados";
        $filas_con_movimiento="(SELECT count(*) FROM v_librodiario_2 vl WHERE vl.cod_presi=".$modelop.".cod_presi and vl.cod_entidad=".$modelop.".cod_entidad and vl.cod_tipo_inst=".$modelop.".cod_tipo_inst and vl.cod_inst=".$modelop.".cod_inst and vl.cod_dep=".$modelop.".cod_dep and vl.ano=".$Ano." and vl.cod_sector=".$modelop.".cod_sector and vl.cod_programa=".$modelop.".cod_programa and vl.cod_sub_prog=".$modelop.".cod_sub_prog and vl.cod_proyecto=".$modelop.".cod_proyecto and vl.cod_activ_obra=".$modelop.".cod_activ_obra and vl.cod_partida=".$modelop.".cod_partida and vl.cod_generica=".$modelop.".cod_generica and vl.cod_especifica=".$modelop.".cod_especifica and vl.cod_sub_espec=".$modelop.".cod_sub_espec and vl.cod_auxiliar=".$modelop.".cod_auxiliar and mes='".$mes."' and dia>='".$dia_desde."' and dia<='".$dia_hasta."')!=0";
        //echo $campos_extras;
        //$vector = $this->$modelop->findAll($con." and ano=".$Ano." and ".$condicion.$sin_afectadas." and ".$filas_con_movimiento,"*,".$campos_extras,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $vector = $this->$modelop->findAll($con." and ano=".$Ano." and ".$condicion." and ".$filas_con_movimiento,"*,".$campos_extras,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        //pr($vector);
        $this->set('modelop',$modelop);
        $this->set('DATOS',$vector);
        $organismo = $this->arrd05->findAll($condicion_dep,array('cod_dep','denominacion'));
        $this->set('ORGANISMOS',$organismo);
        $v_librodiario = $this->v_librodiario_2->findAll($con." and ano=".$Ano." and ".$condicion." and mes='".$mes."' and dia>='".$dia_desde."' and dia<='".$dia_hasta."'",null,'cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,fecha ASC');
        //pr($v_librodiario);
        $this->set('v_librodiario',$v_librodiario);
        $v_librodiario_aumulado = $this->v_librodiario_2->findAll($con." and ano=".$Ano." and ".$condicion." and fecha BETWEEN '$fecha_inicial' AND '$fecha_final'  group by cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,tipo_asiento","cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar,tipo_asiento,sum(monto) as monto",'cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        //pr($v_librodiario_aumulado);
        $this->set('v_librodiario_acumulado',$v_librodiario_aumulado);
}///fin libro diario



function reporte_form_decretos_reformulacion_detallado(){
    $this->layout="ajax";
    $ano=$this->ano_ejecucion();
    $this->set('ano',$ano);
}




function reporte_pdf_decretos_reformulacion_detallado(){
    $this->layout="ajax";
    $ano=$this->data['cfpp10_decretos_reformulacion']['ano'];
    $estilo_reporte=$this->data['cfpp10_decretos_reformulacion']['estilo_reporte'];
    $ordenamiento_reporte=$this->data['cfpp10_decretos_reformulacion']['ordenamiento_reporte'];
    $tipo_presupuesto=$this->data['cfpp10_decretos_reformulacion']['tipo_presupuesto'];

    switch($ordenamiento_reporte){
        case '1': $orden="fecha_decreto, numero_oficio ASC"; break;
        case '2': $orden="numero_oficio ASC"; break;
        case '3': $orden="numero_decreto, numero_oficio ASC"; break;
    }

    $presupuesto="";
    switch($tipo_presupuesto){
        case '0': $cond_presupuesto=" "; $presupuesto="TIPO DE RECURSO: TODO"; break;
        case '1': $cond_presupuesto=" and tipo_presupuesto=1 "; $presupuesto="TIPO DE RECURSO: ORDINARIO"; break;
        case '2': $cond_presupuesto=" and tipo_presupuesto=2 "; $presupuesto="TIPO DE RECURSO: COORDINADO"; break;
        case '3': $cond_presupuesto=" and tipo_presupuesto=3 "; $presupuesto="TIPO DE RECURSO: F.C.I."; break;
        case '4': $cond_presupuesto=" and tipo_presupuesto=4 "; $presupuesto="TIPO DE RECURSO: MPPS"; break;
        case '5': $cond_presupuesto=" and tipo_presupuesto=5 "; $presupuesto="TIPO DE RECURSO: INGRESOS EXTRAORDINARIO"; break;
        case '6': $cond_presupuesto=" and tipo_presupuesto=6 "; $presupuesto="TIPO DE RECURSO: INGRESOS PROPIOS"; break;
        case '7': $cond_presupuesto=" and tipo_presupuesto=7 "; $presupuesto="TIPO DE RECURSO: LAEE"; break;
        case '8': $cond_presupuesto=" and tipo_presupuesto=8 "; $presupuesto="TIPO DE RECURSO: FIDES"; break;
    }

    switch($estilo_reporte){

        case '1':
                $sql_aprob=$this->SQLCA()." and ano_reformulacion='$ano'";

                $datos_1_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        		$datos_6_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        $datos_6=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql_aprob." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                count($datos_1)==0 ? $pase1=0 : $pase1=1;
                count($datos_2)==0 ? $pase2=0 : $pase2=1;
                count($datos_3)==0 ? $pase3=0 : $pase3=1;
                count($datos_4)==0 ? $pase4=0 : $pase4=1;
                count($datos_5)==0 ? $pase5=0 : $pase5=1;
        count($datos_6)==0 ? $pase6=0 : $pase6=1;

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6==0) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
        $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
        $this->set('datos_6',$datos_6);

                $this->set('datos_1_texto',$datos_1_texto);
                $this->set('datos_2_texto',$datos_2_texto);
                $this->set('datos_3_texto',$datos_3_texto);
                $this->set('datos_4_texto',$datos_4_texto);
                $this->set('datos_5_texto',$datos_5_texto);
        $this->set('datos_6_texto',$datos_6_texto);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS REGISTRADOS');
                break;

        case '2':
                $sql=$this->SQLCA()." and ano_reformulacion='$ano' and aprobado='2'";

                $datos_1_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        $datos_6_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        $datos_6=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                count($datos_1)==0 ? $pase1=0 : $pase1=1;
                count($datos_2)==0 ? $pase2=0 : $pase2=1;
                count($datos_3)==0 ? $pase3=0 : $pase3=1;
                count($datos_4)==0 ? $pase4=0 : $pase4=1;
                count($datos_5)==0 ? $pase5=0 : $pase5=1;
        count($datos_6)==0 ? $pase6=0 : $pase6=1;

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6==0) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
        $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
        $this->set('datos_6',$datos_6);

                $this->set('datos_1_texto',$datos_1_texto);
                $this->set('datos_2_texto',$datos_2_texto);
                $this->set('datos_3_texto',$datos_3_texto);
                $this->set('datos_4_texto',$datos_4_texto);
                $this->set('datos_5_texto',$datos_5_texto);
        $this->set('datos_6_texto',$datos_5_texto);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS APROBADOS');
                break;

        case '3':
                $sql=$this->SQLCA()." and ano_reformulacion='$ano' and aprobado='0'";

                $datos_1_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        $datos_6_texto=$this->cfpd10_reformulacion_texto->execute("select distinct cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, numero_oficio, fecha_oficio, concepto, monto, fecha_aprobacion, numero_decreto, fecha_decreto, numero_aprobacion from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                $datos_1=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=1 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_2=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=2 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_3=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=3 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_4=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=4 ".$cond_presupuesto." ORDER BY ".$orden);
                $datos_5=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=5 ".$cond_presupuesto." ORDER BY ".$orden);
        $datos_6=$this->cfpd10_reformulacion_texto->execute("select * from v_cfpd10_reformulacion_texto_partidas where ".$sql." and cod_tipo=6 ".$cond_presupuesto." ORDER BY ".$orden);

                count($datos_1)==0 ? $pase1=0 : $pase1=1;
                count($datos_2)==0 ? $pase2=0 : $pase2=1;
                count($datos_3)==0 ? $pase3=0 : $pase3=1;
                count($datos_4)==0 ? $pase4=0 : $pase4=1;
                count($datos_5)==0 ? $pase5=0 : $pase5=1;
        count($datos_6)==0 ? $pase6=0 : $pase6=1;

                if($pase1==0 && $pase2==0 && $pase3==0 && $pase4==0 && $pase5==0 && $pase6==0) $this->set('vacio',"si");

                $this->set('pase1',$pase1);
                $this->set('pase2',$pase2);
                $this->set('pase3',$pase3);
                $this->set('pase4',$pase4);
                $this->set('pase5',$pase5);
        $this->set('pase6',$pase6);

                $this->set('datos_1',$datos_1);
                $this->set('datos_2',$datos_2);
                $this->set('datos_3',$datos_3);
                $this->set('datos_4',$datos_4);
                $this->set('datos_5',$datos_5);
        $this->set('datos_6',$datos_6);

                $this->set('datos_1_texto',$datos_1_texto);
                $this->set('datos_2_texto',$datos_2_texto);
                $this->set('datos_3_texto',$datos_3_texto);
                $this->set('datos_4_texto',$datos_4_texto);
                $this->set('datos_5_texto',$datos_5_texto);
        $this->set('datos_6_texto',$datos_6_texto);

                $this->set('estilo_reporte',$estilo_reporte);
                $this->set('titulo_reporte','REPORTE DE OFICIOS POR APROBAR');
                break;

    }

    $this->set('ano_reporte', $ano);
    $this->set('presupuesto', $presupuesto);
    $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    $this->set('titulo_a',$this->Session->read('dependencia'));
}// Reporte_pdf_decretos_reformulacion




function proyeccion_gastos_nomina_form($var=null) {
    ini_set("memory_limit","2560M");
    $this->layout="ajax";
    $this->limpia_menu();
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $ano = $this->ano_ejecucion();
    $this->set('ano', $ano);
    $this->Session->write('ano_reporte',$ano);
    if($this->verifica_SS(5)==1){
            $cond=$this->SQLCA_report(1);
        }else{
            $cond=$this->SQLCA_report();
        }
    $rs=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_sector,deno_sector FROM v_cfpd05_denominaciones WHERE ". $cond." and ano=".$ano." ORDER BY cod_sector ASC");
    foreach($rs as $l){
        $v[]=$l[0]["cod_sector"];
        $d[]=$l[0]["deno_sector"];
    }
    $lista = array_combine($v, $d);
    $rsp=$this->v_cfpd05_denominaciones->execute("SELECT DISTINCT cod_partida,deno_partida FROM v_cfpd05_denominaciones  WHERE ". $cond." and ano=".$ano." ORDER BY cod_partida ASC");
    foreach($rsp as $lp){
        $vp[]=$lp[0]["cod_partida"];
        $dp[]=$lp[0]["deno_partida"];
    }
    $partida = array_combine($vp, $dp);
    $this->concatena($lista, 'sector');
    $this->concatena($partida, 'partida');
    //$this->set('partida',$partida);
    $this->Session->write('tipo_reporte', '');
    if(isset($var)){
        $this->set('tipo_reporte',$var);
    }else{
        $this->set('tipo_reporte',"reporte_balance_ejecucion");
    }





if($_SESSION['SScoddep']==1 && $_SESSION["SScoddeporig"]==1){
      $condicion =" 1=1";
   }else{
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');
    $condicion = "a.cod_presi = ".$cod_presi." and a.cod_entidad = ".$cod_entidad." and a.cod_tipo_inst = ".$cod_tipo_inst." and a.cod_inst = ".$cod_inst." and a.cod_dep=".$cod_dep;

   }


   $sql1 = " SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano,b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion, sum(b.monto_cuota) AS monto_cuota,d.denominacion,

 (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion) as cantidad_existe
   FROM cnmd08_historia_nomina a, cnmd08_historia_transacciones b,cnmd03_transacciones d
  WHERE
  (a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.cod_tipo_nomina=b.cod_tipo_nomina and
a.ano=b.ano and
a.numero_nomina=b.numero_nomina and
d.cod_tipo_transaccion=b.cod_tipo_transaccion and
d.cod_transaccion=b.cod_transaccion and b.cod_tipo_transaccion=1 and $condicion
and (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion)=0
) or

(a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.cod_tipo_nomina=b.cod_tipo_nomina and
a.ano=b.ano and
a.numero_nomina=b.numero_nomina and
d.cod_tipo_transaccion=b.cod_tipo_transaccion and
d.cod_transaccion=b.cod_transaccion and b.cod_tipo_transaccion=2 and d.uso_transaccion=6 and $condicion
and (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion)=0
)


  GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano, b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion,d.denominacion
  ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano, b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion ASC;
";

//echo $sql1;
//  $data = $this->v_proyeccion_gastos_nomina_final2->execute($sql1);
//  $this->set('DATA',$data);

//echo $sql1;



}//fin proyeccion_gastos_nomina_form


function proyeccion_gastos_nomina() {
    $this->layout="pdf";
    //$this->layout="ajax";
    //print_r($this->data);
    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
         if(isset($this->data["reporte"]["ano"]) && !empty($this->data["reporte"]["ano"])){
              $Ano=$this->data["reporte"]["ano"];

         }else{
            $Ano=$this->ano_ejecucion();

         }
        $this->set('ANO',$Ano);
        if(isset($this->data['cfpp05']['consolidacion'])){
            $con=$this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            $modelo=$this->data['cfpp05']['consolidacion']==1?"v_proyeccion_gastos_nomina_final2_i":"v_proyeccion_gastos_nomina_final2";
              $this->set("modelo",$modelo);
        }else{
            $con=$this->SQLCA_consolidado();
            $modelo="v_proyeccion_gastos_nomina_final2";
              $this->set("modelo",$modelo);
        }
        $titulo_a = $this->Session->read('dependencia');
        $this->set('titulo_a',$titulo_a);

        if(isset($this->data["reporte"]["cod_sector"]) && $this->data["reporte"]["cod_sector"]!="")
            $cod_sector=" cod_sector=".$this->data["reporte"]["cod_sector"]." and ";
        else
            $cod_sector=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_programa"]) && $this->data["reporte"]["cod_programa"]!="")
            $cod_programa=" cod_programa=".$this->data["reporte"]["cod_programa"]." and ";
        else
            $cod_programa=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subprograma"]) && $this->data["reporte"]["cod_subprograma"]!="")
            $cod_sub_prog=" cod_sub_prog=".$this->data["reporte"]["cod_subprograma"]." and ";
        else
            $cod_sub_prog=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_proyecto"]) && $this->data["reporte"]["cod_proyecto"]!="")
            $cod_proyecto=" cod_proyecto=".$this->data["reporte"]["cod_proyecto"]." and ";
        else
            $cod_proyecto=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_actividad"]) && $this->data["reporte"]["cod_actividad"]!="")
            $cod_activ_obra=" cod_activ_obra=".$this->data["reporte"]["cod_actividad"]." ";
        else
            $cod_activ_obra=" 1=1 ";
        if(isset($this->data["reporte"]["cod_partida"]) && $this->data["reporte"]["cod_partida"]!="")
            $cod_partida=" cod_partida=".$this->data["reporte"]["cod_partida"]." ";
        else
            $cod_partida=" 1=1 ";
        if(isset($this->data["reporte"]["cod_generica"]) && $this->data["reporte"]["cod_generica"]!="")
            $cod_generica=" cod_generica=".$this->data["reporte"]["cod_generica"]." and ";
        else
            $cod_generica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_especifica"]) && $this->data["reporte"]["cod_especifica"]!="")
            $cod_especifica=" cod_especifica=".$this->data["reporte"]["cod_especifica"]." and ";
        else
            $cod_especifica=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_subespecifica"]) && $this->data["reporte"]["cod_subespecifica"]!="")
            $cod_sub_espec=" cod_sub_espec=".$this->data["reporte"]["cod_subespecifica"]." and ";
        else
            $cod_sub_espec=" 1=1 and ";
        if(isset($this->data["reporte"]["cod_auxiliar"]) && $this->data["reporte"]["cod_auxiliar"]!="")
            $cod_auxiliar=" cod_auxiliar=".$this->data["reporte"]["cod_auxiliar"]." ";
        else
            $cod_auxiliar=" 1=1 ";

        $modo= (int) $this->data["reporte"]["modo"];
        //echo "MODO: ".$modo;
        switch($modo){
            case 1:
                 //completo todo
                 $condicion=" 1=1";
            break;
            case 2:
                  //por categoria
                  $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra;
            break;
            case 3:
                //por categoria y partida
                $condicion=" ".$cod_sector.$cod_programa.$cod_sub_prog.$cod_proyecto.$cod_activ_obra." and ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            case 4:
                 $condicion=" ".$cod_partida;
            break;
            case 5:
                 $condicion=" ".$cod_partida." and ".$cod_generica.$cod_especifica.$cod_sub_espec.$cod_auxiliar;
            break;
            default: $condicion=" 1=1";
        }//fin switch
         if(isset($this->data["reporte"]["mes"]) && !empty($this->data["reporte"]["mes"])){
            $this->set("mes",$this->data["reporte"]["mes"]);
            $this->Session->write("mes_solicitado",$this->data["reporte"]["mes"]);
            $mes = $this->data["reporte"]["mes"];
         }else{
            $this->set("mes",date("m"));
            $this->Session->write("mes_solicitado",date("m"));
            $mes = date("m");
         }
        $vector = $this->$modelo->findAll($con." and ano=".$Ano." and ".$condicion."  and mes::integer=$mes",null,'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
        $total_spsppa = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." and mes::integer=$mes  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");
        $distinto_sector = $this->$modelo->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM ".$modelo." WHERE ".$con." and ano=".$Ano." and ".$condicion." and mes::integer=$mes GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
        $this->set('distintos_sectores',$total_spsppa);
        $this->set('cfpd05',$vector);
}//fin proyeccion_gastos_nomina

function transacciones_no_conectadas () {
   $this->layout="ajax";

   if($_SESSION['SScoddep']==1 && $_SESSION["SScoddeporig"]==1){
      $condicion =" 1=1";
   }else{
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');
    $cod_dep = $this->Session->read('SScoddep');
    $condicion = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst." and cod_dep=".$cod_dep;

   }


   $sql1 = " SELECT a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano, a.numero_nomina, substr(a.periodo_hasta::text, 6, 2) AS mes,b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion, sum(b.monto_cuota) AS monto_cuota,d.denominacion,

 (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion) as cantidad_existe
   FROM cnmd08_historia_nomina a, cnmd08_historia_transacciones b,cnmd03_transacciones d
  WHERE
  (a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.cod_tipo_nomina=b.cod_tipo_nomina and
a.ano=b.ano and
a.numero_nomina=b.numero_nomina and
d.cod_tipo_transaccion=b.cod_tipo_transaccion and
d.cod_transaccion=b.cod_transaccion and b.cod_tipo_transaccion=1 and $condicion
and (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion)=0
) or

(a.cod_presi=b.cod_presi and
a.cod_entidad=b.cod_entidad and
a.cod_tipo_inst=b.cod_tipo_inst and
a.cod_inst=b.cod_inst and
a.cod_dep=b.cod_dep and
a.cod_tipo_nomina=b.cod_tipo_nomina and
a.ano=b.ano and
a.numero_nomina=b.numero_nomina and
d.cod_tipo_transaccion=b.cod_tipo_transaccion and
d.cod_transaccion=b.cod_transaccion and b.cod_tipo_transaccion=2 and d.uso_transaccion=6 and $condicion
and (select count(*) from cnmd03_conexion_transacciones c where c.cod_presi=a.cod_presi and c.cod_entidad=a.cod_entidad and c.cod_tipo_inst=a.cod_tipo_inst and c.cod_inst=a.cod_inst and c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina and c.ano=a.ano and c.cod_cargo=b.cod_cargo and c.cod_tipo_transaccion=b.cod_tipo_transaccion and c.cod_transaccion=b.cod_transaccion)=0
)


  GROUP BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano, a.numero_nomina, substr(a.periodo_hasta::text, 6, 2),b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion,d.denominacion
  ORDER BY a.cod_presi, a.cod_entidad, a.cod_tipo_inst, a.cod_inst, a.cod_dep, a.cod_tipo_nomina, a.ano, a.numero_nomina, substr(a.periodo_hasta::text, 6, 2),b.cod_cargo, b.cod_tipo_transaccion, b.cod_transaccion ASC;
";


  $data = $this->v_proyeccion_gastos_nomina_final2->execute($sql1);
  $this->set('DATA',$data);

echo $sql1;



}//fin funcion transacciones_no_conectadas


function oficios_decretos_reformulacion($var=null){
    $this->layout="ajax";
    $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    if($var == 1){
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $cond = "a.cod_presi = ".$this->Session->read('SScodpresi')." and a.cod_entidad = ".$this->Session->read('SScodentidad')." and a.cod_tipo_inst = ".$this->Session->read('SScodtipoinst')." and a.cod_inst = ".$this->Session->read('SScodinst').' and a.cod_dep='.$cod_dep;
        $this->set('ano_reformulacion',$ano);
        $v1="SELECT (a.numero_oficio || '@' || a.cod_dep) as numero_oficio,  (a.numero_oficio || ' -  ' || x.denominacion) as denominacion FROM cfpd10_reformulacion_texto a,arrd05 x
            WHERE x.cod_presi=a.cod_presi and x.cod_entidad=a.cod_entidad and x.cod_tipo_inst=a.cod_tipo_inst and x.cod_inst=a.cod_inst and
            x.cod_dep=a.cod_dep and $cond and a.ano_reformulacion=$ano and a.elaborado='1' order by x.denominacion,a.numero_oficio ASC";
        $rs=$this->v_cfpd05_denominaciones->execute($v1);
        if($rs != null){
            foreach($rs as $l){
                $v[]=$l[0]["numero_oficio"];
                $d[]=$l[0]["denominacion"];
            }
        }else{
            $v=array('0'=>'');
            $d=array('0'=>'');
        }
        $lista = array_combine($v, $d);
        $this->set('reform_aprobado',$lista);


        $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA()." AND tipo_documento = 2001");
        if($cont == 0){
            $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
            $this->set('firmante_1','');
            $this->set('cargo_1','');
            $firma_existe = 'no';
        }else{
            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = 2001");
            $this->set('firmante_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $firma_existe = 'si';
        }
        $this->set('firma_existe',$firma_existe);

    // PDF
    }else if($var == 2){
        $this->layout="pdf";
        //pr($this->data);
        $this->set('abc','');
        //$ano          = $this->ano_ejecucion();
        $cod_presi      = $this->verifica_SS(1);
        $cod_entidad    = $this->verifica_SS(2);
        $cod_tipo_inst  = $this->verifica_SS(3);
        $cod_inst       = $this->verifica_SS(4);
        $cod_dep        = $this->verifica_SS(5);

        $ano            = $this->data['cfpp10']['ano'];
        $codigo_oficio  = $this->data['cfpp10']['codigo_oficio'];
        $numero_oficio  = $this->data['cfpp10']['numero_oficio'];
        $fecha_oficio   = $this->data['cfpp10']['fecha_oficio'];
        $deno_tipo_reformulacion = $this->data['cfpp10']['tipo_reformulacion'];

        $x=explode('@',$codigo_oficio);
        $var_ofi=$x[0];
        $cod_dep=$x[1];

        $condicion = "cod_presi = '$cod_presi' AND cod_entidad = '$cod_entidad' AND cod_tipo_inst = '$cod_tipo_inst' AND cod_inst = '$cod_inst' AND cod_dep = '$cod_dep' AND ano_reformulacion = '$ano' AND numero_oficio = '$numero_oficio'";
        $oficio    = $this->cfpd10_reformulacion_texto->findAll($condicion);
        $decretado = $oficio[0]['cfpd10_reformulacion_texto']['decretado'];
        $cod_tipo  = $oficio[0]['cfpd10_reformulacion_texto']['cod_tipo'];

        $this->set('fecha_oficio',$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio']);
        $this->set('monto_oficio',$oficio[0]['cfpd10_reformulacion_texto']['monto']);
        $this->set('ano_fiscal',$ano);

        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = 2001");
        if(count($firmantes) == 0){
            $this->set('firmante_1','');
            $this->set('cargo_1','');
        }else{
            $this->set('firmante_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $firma_existe = 'si';
        }

        if($decretado == '0'){
            $tabla = "cfpd10_reformulacion_partidas_tmp";
        }else{
            $tabla = "cfpd10_reformulacion_partidas";
        }

            $deno_inst = $this->cugd02_institucion->findAll("cod_tipo_institucion='$cod_tipo_inst' AND cod_institucion='$cod_inst'",'denominacion');
            $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];

        $mun_defecto=$this->cugd90_municipio_defecto->findAll($this->SQLCA());
        if(count($mun_defecto) != 0){
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');

        }else{
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');
        }

        $order_by = "ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, monto_disminucion, monto_aumento";

        $sql_partidas = "SELECT
                  a.cod_presi,
                  a.cod_entidad,
                  a.cod_tipo_inst,
                  a.cod_inst,
                  a.cod_dep,
                  a.ano_reformulacion,
                  a.numero_oficio,
                  a.codi_dep,
                  a.ano,
                  a.cod_sector,
                  upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
                  a.cod_programa,
                  upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
                  a.cod_sub_prog,
                  upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog,
                  a.cod_proyecto,
                  upper(( SELECT a1.denominacion FROM cfpd02_proyecto a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto,
                  a.cod_activ_obra,
                  upper(( SELECT a1.denominacion FROM cfpd02_activ_obra a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra,
                  a.cod_partida,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
                  a.cod_generica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica)) AS deno_generica,
                  a.cod_especifica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica)) AS deno_especifica,
                  a.cod_sub_espec,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec,
                  a.cod_auxiliar,
                  upper(( SELECT a1.denominacion FROM cfpd05_auxiliar a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar,
                  a.monto_disminucion,
                  a.monto_aumento

                FROM ".$tabla." a

                WHERE
                  a.cod_presi = '$cod_presi' AND
                  a.cod_entidad = '$cod_entidad' AND
                  a.cod_tipo_inst = '$cod_tipo_inst' AND
                  a.cod_inst = '$cod_inst' AND
                  a.cod_dep = '$cod_dep' AND
                  a.ano_reformulacion = '$ano' AND
                  a.numero_oficio = '$numero_oficio'";
                  
        switch($cod_tipo){
            case '1':// Traslado entre partidas.
                    $partidas_aumento     = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_traslado");
                    break;
            case '2':// Credito adicional.
            case '6':
            case '8':
            case '7':
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento");
                    break;
            case '3':// Rebaja presupuestaria.
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_disminucion");
                    break;
            case '4':// Saldo de compromisos ano anterior.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento");
                    break;

            case '5':// Ingresos propios
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento");
                    break;

            default : break;
        }
        $this->set('cod_tipo',$cod_tipo);
        $this->set('oficio',$oficio);

    }
    $this->set('opcion',$var);
}

function oficios_decretos_reformulacion_partidas($var=null){
    $this->layout="ajax";
    $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    if($var == 1){
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $cond = "a.cod_presi = ".$this->Session->read('SScodpresi')." and a.cod_entidad = ".$this->Session->read('SScodentidad')." and a.cod_tipo_inst = ".$this->Session->read('SScodtipoinst')." and a.cod_inst = ".$this->Session->read('SScodinst').' and a.cod_dep='.$cod_dep;
        $this->set('ano_reformulacion',$ano);
        $v1="SELECT (a.numero_oficio || '@' || a.cod_dep) as numero_oficio,  (a.numero_oficio || ' -  ' || x.denominacion) as denominacion FROM cfpd10_reformulacion_texto a,arrd05 x
            WHERE x.cod_presi=a.cod_presi and x.cod_entidad=a.cod_entidad and x.cod_tipo_inst=a.cod_tipo_inst and x.cod_inst=a.cod_inst and
            x.cod_dep=a.cod_dep and $cond and a.ano_reformulacion=$ano and a.elaborado='1' order by x.denominacion,a.numero_oficio ASC";
        $rs=$this->v_cfpd05_denominaciones->execute($v1);
        if($rs != null){
            foreach($rs as $l){
                $v[]=$l[0]["numero_oficio"];
                $d[]=$l[0]["denominacion"];
            }
        }else{
            $v=array('0'=>'');
            $d=array('0'=>'');
        }
        $lista = array_combine($v, $d);
        $this->set('reform_aprobado',$lista);


        $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA()." AND tipo_documento = 2001");
        if($cont == 0){
            $this->set('mensaje','Por favor, ingrese los nombres y cargos de los firmantes');
            $this->set('firmante_1','');
            $this->set('cargo_1','');
            $firma_existe = 'no';
        }else{
            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = 2001");
            $this->set('firmante_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $firma_existe = 'si';
        }
        $this->set('firma_existe',$firma_existe);

    // PDF
    }else if($var == 2){
        $this->layout="pdf";
        //pr($this->data);
        $this->set('abc','');
        //$ano          = $this->ano_ejecucion();
        $cod_presi      = $this->verifica_SS(1);
        $cod_entidad    = $this->verifica_SS(2);
        $cod_tipo_inst  = $this->verifica_SS(3);
        $cod_inst       = $this->verifica_SS(4);
        $cod_dep        = $this->verifica_SS(5);

        $ano            = $this->data['cfpp10']['ano'];
        $codigo_oficio  = $this->data['cfpp10']['codigo_oficio'];
        $numero_oficio  = $this->data['cfpp10']['numero_oficio'];
        $fecha_oficio   = $this->data['cfpp10']['fecha_oficio'];
        $deno_tipo_reformulacion = $this->data['cfpp10']['tipo_reformulacion'];

        $x=explode('@',$codigo_oficio);
        $var_ofi=$x[0];
        $cod_dep=$x[1];

        $condicion = "cod_presi = '$cod_presi' AND cod_entidad = '$cod_entidad' AND cod_tipo_inst = '$cod_tipo_inst' AND cod_inst = '$cod_inst' AND cod_dep = '$cod_dep' AND ano_reformulacion = '$ano' AND numero_oficio = '$numero_oficio'";
        $oficio    = $this->cfpd10_reformulacion_texto->findAll($condicion);
        $decretado = $oficio[0]['cfpd10_reformulacion_texto']['decretado'];
        $cod_tipo  = $oficio[0]['cfpd10_reformulacion_texto']['cod_tipo'];

        $this->set('fecha_oficio',$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio']);
        $this->set('monto_oficio',$oficio[0]['cfpd10_reformulacion_texto']['monto']);
        $this->set('ano_fiscal',$ano);

        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = 2001");
        if(count($firmantes) == 0){
            $this->set('firmante_1','');
            $this->set('cargo_1','');
        }else{
            $this->set('firmante_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $firma_existe = 'si';
        }

        if($decretado == '0'){
            $tabla = "cfpd10_reformulacion_partidas_tmp";
        }else{
            $tabla = "cfpd10_reformulacion_partidas";
        }

            $deno_inst = $this->cugd02_institucion->findAll("cod_tipo_institucion='$cod_tipo_inst' AND cod_institucion='$cod_inst'",'denominacion');
            $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];

        $mun_defecto=$this->cugd90_municipio_defecto->findAll($this->SQLCA());
        if(count($mun_defecto) != 0){
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');

        }else{
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');
        }

        $order_by = "ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, monto_disminucion, monto_aumento";

        $sql_partidas = "SELECT
                  a.cod_presi,
                  a.cod_entidad,
                  a.cod_tipo_inst,
                  a.cod_inst,
                  a.cod_dep,
                  a.ano_reformulacion,
                  a.numero_oficio,
                  a.codi_dep,
                  a.ano,
                  a.cod_sector,
                  upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
                  a.cod_programa,
                  upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
                  a.cod_sub_prog,
                  upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog,
                  a.cod_proyecto,
                  upper(( SELECT a1.denominacion FROM cfpd02_proyecto a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto,
                  a.cod_activ_obra,
                  upper(( SELECT a1.denominacion FROM cfpd02_activ_obra a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra,
                  a.cod_partida,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
                  a.cod_generica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica)) AS deno_generica,
                  a.cod_especifica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica)) AS deno_especifica,
                  a.cod_sub_espec,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec,
                  a.cod_auxiliar,
                  upper(( SELECT a1.denominacion FROM cfpd05_auxiliar a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar,
                  a.monto_disminucion,
                  a.monto_aumento

                FROM ".$tabla." a

                WHERE
                  a.cod_presi = '$cod_presi' AND
                  a.cod_entidad = '$cod_entidad' AND
                  a.cod_tipo_inst = '$cod_tipo_inst' AND
                  a.cod_inst = '$cod_inst' AND
                  a.cod_dep = '$cod_dep' AND
                  a.ano_reformulacion = '$ano' AND
                  a.numero_oficio = '$numero_oficio'";

        switch($cod_tipo){
            case '1':// Traslado entre partidas.
                    $partidas_aumento     = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_traslado_partidas");
                    break;
            case '2':// Credito adicional.
            case '7':
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento_partidas");
                    break;
            case '3':// Rebaja presupuestaria.
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_disminucion_partidas");
                    break;
            case '4':// Saldo de compromisos ano anterior.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento_partidas");
                    break;

            case '5':// Ingresos propios
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento_partidas"); 
                    break;

            default : break;
        }
        $this->set('cod_tipo',$cod_tipo);
        $this->set('oficio',$oficio);

    }
    $this->set('opcion',$var);
}

/**
 * Creditos adicionales
 */
function creditos_adicionales_asignados($var=null){
    $this->layout="ajax";
    $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    if($var == 1){
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $this->set('ano_reformulacion',$ano);

        if (count($this->cfpd10_reformulacion_partidas->findAll("codi_dep = $cod_dep AND ano_reformulacion=".$this->ano_ejecucion())) > 0) {
            $v1="SELECT 
              DISTINCT a.numero_oficio as numero_oficio 
            FROM 
              cfpd10_reformulacion_texto a 
            JOIN 
             cfpd10_reformulacion_partidas as y ON 
              a.cod_presi = y.cod_presi and 
              a.cod_entidad = y.cod_entidad and 
              a.cod_tipo_inst = y.cod_tipo_inst and 
              a.cod_inst = y.cod_inst and 
              a.cod_dep = y.cod_dep and
              a.ano_reformulacion = y.ano_reformulacion and
              a.numero_oficio = y.numero_oficio
            WHERE 
              a.elaborado= '1' and 
              a.cod_tipo = 2 and 
              y.codi_dep = ".$this->verifica_SS(5)." and 
              a.ano_reformulacion=".$this->ano_ejecucion()."  
            order by 
              a.numero_oficio ASC";
        
            $rs=$this->v_cfpd05_denominaciones->execute($v1);
            if($rs != null){
                foreach($rs as $l){
                    $v[]=$l[0]["numero_oficio"];
                    $d[]=$l[0]["numero_oficio"];
                }
            }else{
                $v=array('0'=>'');
                $d=array('0'=>'');
            }
            $lista = array_combine($v, $d);
            $this->set('reform_aprobado',$lista);
        } else {
           $this->set('reform_aprobado', array());
        }
    // PDF
    }else if($var == 2){
        $this->layout="pdf";
        //pr($this->data);
        $this->set('abc','');
        //$ano          = $this->ano_ejecucion();
        $cod_presi      = $this->verifica_SS(1);
        $cod_entidad    = $this->verifica_SS(2);
        $cod_tipo_inst  = $this->verifica_SS(3);
        $cod_inst       = $this->verifica_SS(4);
        $cod_dep        = $this->verifica_SS(5);

        $ano            = $this->data['cfpp10']['ano'];
        $codigo_oficio  = $this->data['cfpp10']['codigo_oficio'];
        $numero_oficio  = $this->data['cfpp10']['numero_oficio'];
        $fecha_oficio   = $this->data['cfpp10']['fecha_oficio'];
        $deno_tipo_reformulacion = $this->data['cfpp10']['tipo_reformulacion'];

        /*$x=explode('@',$codigo_oficio);
        $var_ofi=$x[0];
        $cod_dep=$x[1];*/

        $condicion = "cod_dep = '1' AND ano_reformulacion = '$ano' AND numero_oficio = '$numero_oficio' AND cod_tipo = 2";
        
        $oficio    = $this->cfpd10_reformulacion_texto->findAll($condicion);
        

        $decretado = $oficio[0]['cfpd10_reformulacion_texto']['decretado'];
        $cod_tipo  = $oficio[0]['cfpd10_reformulacion_texto']['cod_tipo'];

        $this->set('fecha_oficio',$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio']);
        $this->set('monto_oficio',$oficio[0]['cfpd10_reformulacion_texto']['monto']);
        $this->set('ano_fiscal',$ano);

        $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = 2001");
        if(count($firmantes) == 0){
            $this->set('firmante_1','');
            $this->set('cargo_1','');
        }else{
            $this->set('firmante_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_1',$firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $firma_existe = 'si';
        }

        if($decretado == '0'){
            $tabla = "cfpd10_reformulacion_partidas_tmp";
        }else{
            $tabla = "cfpd10_reformulacion_partidas";
        }

            $deno_inst = $this->cugd02_institucion->findAll("cod_tipo_institucion='$cod_tipo_inst' AND cod_institucion='$cod_inst'",'denominacion');
            $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];

        /**
         * Verificamos que no sea una ULA
         */
        $cod_dep1 = ($this->verifica_SS(5) >= 1000) ? $this->verifica_SS(5) : '1' ;

        $mun_defecto=$this->cugd90_municipio_defecto->findAll('cod_dep='.$cod_dep1);

        if(count($mun_defecto) != 0){
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');

        }else{
            $cod_republica = $mun_defecto[0]['cugd90_municipio_defecto']['cod_republica'];
            $cod_estado = $mun_defecto[0]['cugd90_municipio_defecto']['cod_estado'];
            $cod_municipio = $mun_defecto[0]['cugd90_municipio_defecto']['cod_municipio'];

            $estado    = $this->cugd01_estados->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado'",'denominacion');
            $municipio = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'denominacion');
            $ciudad = $this->cugd01_municipios->findAll("cod_republica='$cod_republica' AND cod_estado='$cod_estado' AND cod_municipio='$cod_municipio'",'conocido');
        }

        $order_by = "ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, monto_disminucion, monto_aumento";

        $sql_partidas = "SELECT
                  a.cod_presi,
                  a.cod_entidad,
                  a.cod_tipo_inst,
                  a.cod_inst,
                  a.cod_dep,
                  a.ano_reformulacion,
                  a.numero_oficio,
                  a.codi_dep,
                  a.ano,
                  a.cod_sector,
                  upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
                  a.cod_programa,
                  upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
                  a.cod_sub_prog,
                  upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog,
                  a.cod_proyecto,
                  upper(( SELECT a1.denominacion FROM cfpd02_proyecto a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto,
                  a.cod_activ_obra,
                  upper(( SELECT a1.denominacion FROM cfpd02_activ_obra a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra,
                  a.cod_partida,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
                  a.cod_generica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica)) AS deno_generica,
                  a.cod_especifica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica)) AS deno_especifica,
                  a.cod_sub_espec,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec,
                  a.cod_auxiliar,
                  upper(( SELECT a1.denominacion FROM cfpd05_auxiliar a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar,
                  a.monto_disminucion,
                  a.monto_aumento

                FROM ".$tabla." a

                WHERE
                  a.cod_presi = '$cod_presi' AND
                  a.cod_entidad = '$cod_entidad' AND
                  a.cod_tipo_inst = '$cod_tipo_inst' AND
                  a.cod_inst = '$cod_inst' AND
                  a.codi_dep = '$cod_dep' AND
                  a.ano_reformulacion = '$ano' AND
                  a.numero_oficio = '$numero_oficio'";

        switch($cod_tipo){
            case '1':// Traslado entre partidas.
                    $partidas_aumento     = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_traslado");
                    break;
            case '2':// Credito adicional.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->set('asignado', true);
                    $this->render("pdf_reformulacion_aumento");
                    break;
            case '3':// Rebaja presupuestaria.
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_disminucion");
                    break;
            case '4':// Saldo de compromisos ano anterior.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento");
                    break;
            case '5':// Ingresos propios
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('num_oficio',$numero_oficio);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set("denominacion_estado",$estado[0]['cugd01_estados']['denominacion'].", ");
                    $this->set("denominacion_municipo",$municipio[0]['cugd01_municipios']['denominacion'].", ");
                    $this->set("denominacion_ciudad",$ciudad[0]['cugd01_municipios']['conocido'].", ");
                    $_SESSION['ins_deno']=$deno_inst[0]['cugd02_institucion']['denominacion'];
                    $this->render("pdf_reformulacion_aumento");
                    break;
            default : break;
        }

        $this->set('cod_tipo',$cod_tipo);
        $this->set('oficio',$oficio);
        $this->render('oficios_decretos_reformulacion');
    }
    $this->set('opcion',$var);
}

function select_creditos_adicionales_asignados($ano_oficios=null){
    $this->layout="ajax";
   // $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    
    //$ano=$ano_oficios;
    $this->set('ano_reformulacion',$ano_oficios);
     if (count($this->cfpd10_reformulacion_partidas->findAll("codi_dep = $cod_dep AND ano_reformulacion=".$ano_oficios)) > 0) {
            $v1="SELECT 
                      DISTINCT a.numero_oficio as numero_oficio 
                    FROM 
                      cfpd10_reformulacion_texto a 
                    JOIN 
                     cfpd10_reformulacion_partidas as y ON 
                      a.cod_presi = y.cod_presi and 
                      a.cod_entidad = y.cod_entidad and 
                      a.cod_tipo_inst = y.cod_tipo_inst and 
                      a.cod_inst = y.cod_inst and 
                      a.cod_dep = y.cod_dep and
                      a.ano_reformulacion = y.ano_reformulacion and
                      a.numero_oficio = y.numero_oficio
                    WHERE 
                      a.elaborado= '1' and 
                      a.cod_tipo = 2 and 
                      y.codi_dep = ".$this->verifica_SS(5)." and 
                      a.ano_reformulacion=".$ano_oficios."  
                    order by 
                      a.numero_oficio ASC";
            
            $rs=$this->v_cfpd05_denominaciones->execute($v1);

            if($rs != null){
                foreach($rs as $l){
                    $v[]=$l[0]["numero_oficio"];
                    $d[]=$l[0]["numero_oficio"];
                }
                    $lista = array_combine($v, $d);
            }else{
                
                $lista=array();
            }

    } else {
        $lista = array();
    }
    $this->set('reform_aprobado',$lista);
    $this->set('ano_reformulacion',$ano_oficios);
    $this->set('asignados', 1);
    $this->render('select_oficios_decretos_reformulacion');
}

function mostrar_oficio_creditos_adicionales($select=null,$var=null){
    $this->layout="ajax";
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');

    if($var!=null){
        /*$x=explode('@',$var);
        $var=$x[0];
        $cod_dep=$x[1];*/

        //$aprobado="cod_presi=$cod_presi and cod_entidad=$cod_entidad and cod_tipo_inst=$cod_tipo_inst and cod_inst=$cod_inst and cod_dep=$cod_dep and elaborado='1' and ano_reformulacion=".$select." and numero_oficio='".$var."'";
        $aprobado="elaborado='1' and ano_reformulacion=".$select." and numero_oficio='".$var."'";

        if($oficio = $this->cfpd10_reformulacion_texto->findAll($aprobado,'cod_tipo, numero_oficio, fecha_oficio')){
        // Busco el oficio filtrado por "elaborado", "numero_oficio" y el "ano" de la reformulacion -- y me traigo los siguientes campos 'cod_tipo, numero_oficio, fecha_oficio'
            $t_reformulacion=$this->cfpd10_reformulacion_tipo->findAll('cod_tipo='.$oficio[0]['cfpd10_reformulacion_texto']['cod_tipo']);
            $this->set('numero_oficio',$oficio[0]['cfpd10_reformulacion_texto']['numero_oficio']);
            $fa=$fecha_oficio=$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio'];
            $fecha_oficio=$fa[8].$fa[9]."/".$fa[5].$fa[6]."/".$fa[0].$fa[1].$fa[2].$fa[3];
            echo"<script>
                    document.getElementById('fecha_oficio').value='".$fecha_oficio."';
                    document.getElementById('tipo_reformulacio').value='".$t_reformulacion[0]['cfpd10_reformulacion_tipo']['denominacion']."';
                </script>";
        }else{
            $this->set('mensajeError','Lo siento, no se encontro el Oficio buscado');
        }

    }else{
        echo"<script>
                document.getElementById('fecha_oficio').value='';
                document.getElementById('tipo_reformulacio').value='';
            </script>";
        $this->set('mensajeError','Seleccione un oficio por favor');
        $this->set('numero_oficio','');
    }
    $this->render('mostrar_oficio_reformulacion');
}

function emision_oficios_reformulacion($var=null, $oficio_o_decreto=null){
    $this->layout="ajax";
    $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    if($var == 1){
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $cond = "a.cod_presi = ".$this->Session->read('SScodpresi')." and a.cod_entidad = ".$this->Session->read('SScodentidad')." and a.cod_tipo_inst = ".$this->Session->read('SScodtipoinst')." and a.cod_inst = ".$this->Session->read('SScodinst').' and a.cod_dep='.$cod_dep;
        $this->set('ano_reformulacion',$ano);

        if($oficio_o_decreto=='oficios'){
            $v1="SELECT (a.numero_oficio || '@' || a.cod_dep) as numero_oficio,  (a.numero_oficio || ' -  ' || x.denominacion) as denominacion FROM cfpd10_reformulacion_texto a,arrd05 x
            WHERE x.cod_presi=a.cod_presi and x.cod_entidad=a.cod_entidad and x.cod_tipo_inst=a.cod_tipo_inst and x.cod_inst=a.cod_inst and
            x.cod_dep=a.cod_dep and $cond and a.ano_reformulacion=$ano and a.elaborado='1' order by x.denominacion,a.numero_oficio ASC";

            $rs=$this->v_cfpd05_denominaciones->execute($v1);
            if($rs != null){
                foreach($rs as $l){
                    $v[]=$l[0]["numero_oficio"];
                    $d[]=$l[0]["denominacion"];
                }
            }else{
                $v=array('0'=>'');
                $d=array('0'=>'');
            }

        }else if($oficio_o_decreto=='decretos'){
            $v1="SELECT (a.numero_oficio || '@' || a.cod_dep) as numero_oficio,  (a.numero_decreto || ' -  ' || x.denominacion) as denominacion FROM cfpd10_reformulacion_texto a,arrd05 x
            WHERE x.cod_presi=a.cod_presi and x.cod_entidad=a.cod_entidad and x.cod_tipo_inst=a.cod_tipo_inst and x.cod_inst=a.cod_inst and
            x.cod_dep=a.cod_dep and $cond and a.ano_reformulacion=$ano and a.decretado!='0' order by x.denominacion,a.numero_oficio ASC";

            $rs=$this->v_cfpd05_denominaciones->execute($v1);
            if($rs != null){
                foreach($rs as $l){
                    $v[]=$l[0]["numero_oficio"];
                    $d[]=$l[0]["denominacion"];
                }
            }else{
                $v=array('0'=>'');
                $d=array('0'=>'');
            }
        }


        $lista = array_combine($v, $d);
        $this->set('reform_aprobado',$lista);
        $this->set('oficio_o_decreto',$oficio_o_decreto);

    // PDF
    }else if($var == 2){
        $this->layout="pdf";
        $this->set('abc','');
        $cod_presi      = $this->verifica_SS(1);
        $cod_entidad    = $this->verifica_SS(2);
        $cod_tipo_inst  = $this->verifica_SS(3);
        $cod_inst       = $this->verifica_SS(4);
        $cod_dep        = $this->verifica_SS(5);

        $ano            = $this->data['cfpp10']['ano'];
        $codigo_oficio  = $this->data['cfpp10']['codigo_oficio'];
        $numero_oficio  = $this->data['cfpp10']['numero_oficio'];
        $fecha_oficio   = $this->data['cfpp10']['fecha_oficio'];
        $deno_tipo_reformulacion = $this->data['cfpp10']['tipo_reformulacion'];

        $x=explode('@',$codigo_oficio);
        $var_ofi=$x[0];
        $cod_dep=$x[1];

        $condicion = "cod_presi = '$cod_presi' AND cod_entidad = '$cod_entidad' AND cod_tipo_inst = '$cod_tipo_inst' AND cod_inst = '$cod_inst' AND cod_dep = '$cod_dep' AND ano_reformulacion = '$ano' AND numero_oficio = '$numero_oficio'";
        $oficio    = $this->cfpd10_reformulacion_texto->findAll($condicion);
        $decretado = $oficio[0]['cfpd10_reformulacion_texto']['decretado'];
        $cod_tipo  = $oficio[0]['cfpd10_reformulacion_texto']['cod_tipo'];
        //pr($oficio);

        $this->set('fecha_oficio',$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio']);
        $this->set('monto_oficio',$oficio[0]['cfpd10_reformulacion_texto']['monto']);
        $this->set('ano_fiscal',$ano);

        if($decretado == '0'){
            $tabla = "cfpd10_reformulacion_partidas_tmp";
        }else{
            $tabla = "cfpd10_reformulacion_partidas";
        }

        $order_by = "ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, monto_disminucion, monto_aumento";

        $sql_partidas = "SELECT
                  a.cod_presi,
                  a.cod_entidad,
                  a.cod_tipo_inst,
                  a.cod_inst,
                  a.cod_dep,
                  a.ano_reformulacion,
                  a.numero_oficio,
                  a.codi_dep,
                  a.ano,
                  a.cod_sector,
                  upper(( SELECT a1.denominacion FROM cfpd02_sector a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector)) AS deno_sector,
                  a.cod_programa,
                  upper(( SELECT a1.denominacion FROM cfpd02_programa a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa)) AS deno_programa,
                  a.cod_sub_prog,
                  upper(( SELECT a1.denominacion FROM cfpd02_sub_prog a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog)) AS deno_sub_prog,
                  a.cod_proyecto,
                  upper(( SELECT a1.denominacion FROM cfpd02_proyecto a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto)) AS deno_proyecto,
                  a.cod_activ_obra,
                  upper(( SELECT a1.denominacion FROM cfpd02_activ_obra a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra)) AS deno_activ_obra,
                  a.cod_partida,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_2_partida a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer)) AS deno_partida,
                  a.cod_generica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_3_generica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica)) AS deno_generica,
                  a.cod_especifica,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_4_especifica a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica)) AS deno_especifica,
                  a.cod_sub_espec,
                  upper(( SELECT a1.denominacion FROM cfpd01_ano_5_sub_espec a1 WHERE a1.ejercicio = a.ano AND a1.cod_grupo = 4 AND a1.cod_partida = substr(a.cod_partida::text, 2, 2)::integer AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec)) AS deno_sub_espec,
                  a.cod_auxiliar,
                  upper(( SELECT a1.denominacion FROM cfpd05_auxiliar a1 WHERE a1.cod_presi = a.cod_presi AND a1.cod_entidad = a.cod_entidad AND a1.cod_tipo_inst = a.cod_tipo_inst AND a1.cod_inst = a.cod_inst AND a1.cod_dep = a.cod_dep AND a1.ano = a.ano AND a1.cod_sector = a.cod_sector AND a1.cod_programa = a.cod_programa AND a1.cod_sub_prog = a.cod_sub_prog AND a1.cod_proyecto = a.cod_proyecto AND a1.cod_activ_obra = a.cod_activ_obra AND a1.cod_partida = a.cod_partida AND a1.cod_generica = a.cod_generica AND a1.cod_especifica = a.cod_especifica AND a1.cod_sub_espec = a.cod_sub_espec AND a1.cod_auxiliar = a.cod_auxiliar)) AS deno_auxiliar,
                  a.monto_disminucion,
                  a.monto_aumento

                FROM ".$tabla." a

                WHERE
                  a.cod_presi = '$cod_presi' AND
                  a.cod_entidad = '$cod_entidad' AND
                  a.cod_tipo_inst = '$cod_tipo_inst' AND
                  a.cod_inst = '$cod_inst' AND
                  a.cod_dep = '$cod_dep' AND
                  a.ano_reformulacion = '$ano' AND
                  a.numero_oficio = '$numero_oficio'";


        switch($cod_tipo){
            case '1':// Traslado entre partidas.
                    $partidas_aumento     = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('partidas_aumento',$partidas_aumento);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    //$this->render("pdf_reformulacion_traslado");
                    break;
            case '2':// Credito adicional.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('partidas_aumento',$partidas_aumento);
                    //$this->render("pdf_reformulacion_aumento");
                    break;
            case '3':// Rebaja presupuestaria.
                    $partidas_disminucion = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_disminucion != 0 ORDER BY ".$order_by);
                    $this->set('partidas_disminucion',$partidas_disminucion);
                    //$this->render("pdf_reformulacion_disminucion");
                    break;
            case '4':// Saldo de compromisos ano anterior.
                    $partidas_aumento = $this->cfpd10_reformulacion_partidas->execute($sql_partidas." AND monto_aumento != 0 ORDER BY ".$order_by);
                    $this->set('partidas_aumento',$partidas_aumento);
                    //$this->render("pdf_reformulacion_aumento");
                    break;

            default : break;
        }

        $this->set('cod_tipo',$cod_tipo);
        $this->set('oficio',$oficio);
        $this->set('oficio_o_decreto',$oficio_o_decreto);
    }
    $this->set('opcion',$var);
}

function select_oficios_decretos_reformulacion($ano_oficios=null){
    $this->layout="ajax";
    $ano            = $this->ano_ejecucion();
    $cod_presi      = $this->verifica_SS(1);
    $cod_entidad    = $this->verifica_SS(2);
    $cod_tipo_inst  = $this->verifica_SS(3);
    $cod_inst       = $this->verifica_SS(4);
    $cod_dep        = $this->verifica_SS(5);

    $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    $cond = "a.cod_presi = ".$this->Session->read('SScodpresi')." and a.cod_entidad = ".$this->Session->read('SScodentidad')." and a.cod_tipo_inst = ".$this->Session->read('SScodtipoinst')." and a.cod_inst = ".$this->Session->read('SScodinst').' and a.cod_dep='.$cod_dep;
    $ano=$ano_oficios;
    $this->set('ano_reformulacion',$ano);
    $v1="SELECT (a.numero_oficio || '@' || a.cod_dep) as numero_oficio,  (a.numero_oficio || ' -  ' || x.denominacion) as denominacion FROM cfpd10_reformulacion_texto a,arrd05 x
        WHERE x.cod_presi=a.cod_presi and x.cod_entidad=a.cod_entidad and x.cod_tipo_inst=a.cod_tipo_inst and x.cod_inst=a.cod_inst and
        x.cod_dep=a.cod_dep and $cond and a.ano_reformulacion=$ano and a.elaborado='1' order by x.denominacion,a.numero_oficio ASC";
    $rs=$this->v_cfpd05_denominaciones->execute($v1);
    if($rs != null){
        foreach($rs as $l){
            $v[]=$l[0]["numero_oficio"];
            $d[]=$l[0]["denominacion"];
        }
    }else{
        $v=array('0'=>'');
        $d=array('0'=>'');
    }
    $lista = array_combine($v, $d);
    $this->set('reform_aprobado',$lista);
    $this->set('ano_reformulacion',$ano);
    if(count($lista) == 1){
        //$this->set('mensajeError','No se encontrarÃ³n oficios para el aÃ±o ingresado');
    }
}


function mostrar_oficio_reformulacion($select=null,$var=null){
    $this->layout="ajax";
    $cod_presi = $this->Session->read('SScodpresi');
    $cod_entidad = $this->Session->read('SScodentidad');
    $cod_tipo_inst = $this->Session->read('SScodtipoinst');
    $cod_inst = $this->Session->read('SScodinst');

    if($var!=null){
        $x=explode('@',$var);
        $var=$x[0];
        $cod_dep=$x[1];

        //$aprobado="cod_presi=$cod_presi and cod_entidad=$cod_entidad and cod_tipo_inst=$cod_tipo_inst and $cod_inst=$cod_inst and cod_dep=$cod_dep and elaborado='1' and revisado='2' and por_enviar='1' and enviado='2' and por_remitir='1' and remitido='2' and por_aprobar='1' and aprobado='0' and ano_reformulacion=".$select." and numero_oficio='".$var."'";
        $aprobado="cod_presi=$cod_presi and cod_entidad=$cod_entidad and cod_tipo_inst=$cod_tipo_inst and cod_inst=$cod_inst and cod_dep=$cod_dep and elaborado='1' and ano_reformulacion=".$select." and numero_oficio='".$var."'";

        if($oficio = $this->cfpd10_reformulacion_texto->findAll($aprobado,'cod_tipo, numero_oficio, fecha_oficio')){// Busco el oficio filtrado por "elaborado", "numero_oficio" y el "ano" de la reformulacion -- y me traigo los siguientes campos 'cod_tipo, numero_oficio, fecha_oficio'
            $t_reformulacion=$this->cfpd10_reformulacion_tipo->findAll('cod_tipo='.$oficio[0]['cfpd10_reformulacion_texto']['cod_tipo']);
            $this->set('numero_oficio',$oficio[0]['cfpd10_reformulacion_texto']['numero_oficio']);
            $fa=$fecha_oficio=$oficio[0]['cfpd10_reformulacion_texto']['fecha_oficio'];
            $fecha_oficio=$fa[8].$fa[9]."/".$fa[5].$fa[6]."/".$fa[0].$fa[1].$fa[2].$fa[3];
            echo"<script>
                    document.getElementById('fecha_oficio').value='".$fecha_oficio."';
                    document.getElementById('tipo_reformulacio').value='".$t_reformulacion[0]['cfpd10_reformulacion_tipo']['denominacion']."';
                </script>";
        }else{
            $this->set('mensajeError','Lo siento, no se encontro el Oficio buscado');
        }

    }else{
        echo"<script>
                document.getElementById('fecha_oficio').value='';
                document.getElementById('tipo_reformulacio').value='';
            </script>";
        $this->set('mensajeError','Seleccione un oficio por favor');
        $this->set('numero_oficio','');
    }

}// mostrar_oficio_reformulacion

function guardar_firmas_reformulacion($opcion = null){
    $this->layout="ajax";
    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    $firmante_1 = $this->data['cfpp10']['firmante_1'];
    $cargo_1    = $this->data['cfpp10']['cargo_1'];
    $firmante_2 = '.';
    $cargo_2    = '.';
    $firmante_3 = '.';
    $cargo_3    = '.';
    $tipo_documento = '2001';

    // Opcion de guardar.
    if($opcion == 1){
        if($firmante_1 != '' && $cargo_1 != ''){
            $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ($cp, $ce, $cti, $ci, $cd,'$tipo_documento','$firmante_1', '$cargo_1', '$firmante_2', '$cargo_2', '$firmante_3', '$cargo_3')";
            $this->cugd07_firmas_oficio_anulacion->execute($insert);
            $firmantes= $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA()." AND tipo_documento = ".$tipo_documento);
            $this->set('mensaje','Firmas registradas correctamente');
            $this->set('firma_existe','si');
            $this->set('firmante_1',$firmante_1);
            $this->set('cargo_1',$cargo_1);
        }else{
            $this->set('mensajeError','Las firmas no fuerÃ³n registradas');
            $this->set('firma_existe','no');
            $this->set('firmante_1','');
            $this->set('cargo_1','');
        }

    // Opcion de modificar.
    }else{
        $update = "UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='".$firmante_1."', cargo_primera_firma='".$cargo_1."' WHERE ".$this->SQLCA()." AND tipo_documento = '$tipo_documento'";
        $this->cugd07_firmas_oficio_anulacion->execute($update);
        $this->set('mensaje','Firmas modificadas correctamente');
        $this->set('firma_existe','si');
        $this->set('firmante_1',$firmante_1);
        $this->set('cargo_1',$cargo_1);
    }
}


function guardar_firmas_gastos_from($opcion = null){
    $this->layout="ajax";
    $cp  = $this->Session->read('SScodpresi');
    $ce  = $this->Session->read('SScodentidad');
    $cti = $this->Session->read('SScodtipoinst');
    $ci  = $this->Session->read('SScodinst');
    $cd  = $this->Session->read('SScoddep');

    $firmante_1 = $this->data['cimd06_acta_firmantes']['funcionario_primero'];
    $cedula_1 = $this->data['cimd06_acta_firmantes']['cedula_primero'];
    $cargo_1    = $this->data['cimd06_acta_firmantes']['cargo_primero'];
    $firmante_2 = $this->data['cimd06_acta_firmantes']['funcionario_segundo'];
    $cedula_2 = $this->data['cimd06_acta_firmantes']['cedula_segundo'];
    $cargo_2    = $this->data['cimd06_acta_firmantes']['cargo_segundo'];
    $firmante_3 = $this->data['cimd06_acta_firmantes']['funcionario_tercer'];
    $cedula_3 = $this->data['cimd06_acta_firmantes']['cedula_tercer'];
    $cargo_3    = $this->data['cimd06_acta_firmantes']['cargo_tercer'];
    $firmante_4 = '.';
    $cedula_4='.';
    $cargo_4    = '.';
    $tipo_documento = '99999';

    // Opcion de guardar.
    if($opcion == 1){
        if($firmante_1 != '' && $cargo_1 != ''){
            $insert = "INSERT INTO cimd06_acta_firmantes VALUES ($cp, $ce, $cti, $ci, $cd,2013,'$tipo_documento','$firmante_1', '$cedula_1', '$cargo_1', '$firmante_2', '$cedula_2', '$cargo_2', '$firmante_3', '$cedula_3', '$cargo_3', '$firmante_4', '$cedula_4', '$cargo_4')";
            $this->cimd06_acta_firmantes->execute($insert);
            $firmantes= $this->cimd06_acta_firmantes->findAll($this->SQLCA()." AND numero_acta = ".$tipo_documento);
            $this->set('mensaje','Firmas registradas correctamente');
            $this->set('firma_existe','si');

        }else{
            $this->set('mensajeError','Las firmas no fuerÃ³n registradas');
            $this->set('firma_existe','no');
        }

    // Opcion de modificar.
    }else{
        $update = "UPDATE cimd06_acta_firmantes SET funcionario_primero='".$firmante_1."',cedula_primero='".$cedula_1."', cargo_primero='".$cargo_1."',funcionario_segundo='".$firmante_2."',cedula_segundo='".$cedula_2."', cargo_segundo='".$cargo_2."',funcionario_tercer='".$firmante_3."',cedula_tercer='".$cedula_3."', cargo_tercer='".$cargo_3."' WHERE ".$this->SQLCA()." AND numero_acta = '$tipo_documento'";
        $this->cimd06_acta_firmantes->execute($update);
        $this->set('mensaje','Firmas modificadas correctamente');
        $this->set('firma_existe','si');
        $this->set('firmante_1',$firmante_1);
        $this->set('cargo_1',$cargo_1);
    }
}
// fin funcion

}//fin class
?>

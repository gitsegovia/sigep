<?php

class ReporteController extends AppController {

    var $uses = array('Modulos', 'cugd99_firmas_responsabilidad', 'cfpd97', 'arrd05', 'cfpd07_plan_inversion', 'cfpd09_metas_sector', 'cnmd04_tipo', 'cnmd04_ocupacion', 'cugd01_estados',
        'cfpd08', 'cfpd01_formulacion', 'cfpd03', 'cnmd05_clasificacion', 'cnmd04_ocupacion', 'cnmd04_tipo',
        'cfpd07_clasificacion_recurso', 'cugd01_municipios', 'cugd01_parroquias', 'cugd01_centropoblados', 'cfpd05', 'Cnmd01',
        'cfpd05_2032_tmp', 'cfpd05_distribucion_tmp', 'ccfd03_instalacion', 'cugd06_oficios_poremitir_comun', 'cstd06_comprobante_poremitir_egreso',
        'cugd01_vialidad', 'cugd01_vereda', 'cugd02_institucion', 'cugd02_dependencia', 'cfpd05_auxiliar', 'cstd01_entidades_bancarias',
        'cugd02_direccionsuperior', 'cugd02_coordinacion', 'cugd02_secretaria', 'cfpd05_requerimiento', 'cepd01_compromiso_cuerpo',
        'cugd02_direccion', 'cugd02_division', 'cugd02_departamento', 'cugd02_oficina', 'cnmd01', 'cnmd05_escala_salario',
        'cnmd05_escala_sueldo', 'v_cscd04_ordencompra', 'v_cscd03_cotizacion', 'cscd04_ordencompra_numero', 'ccfd04_cierre_mes',
        'cfpd01_grupo', 'cfpd01_partida', 'cfpd01_generica', 'cfpd01_especifica', 'cobd01_contratoobras_partidas', 'v_cfpd97_reporte2_dep_final', 'v_cfpd97_reporte2_inst_final',
        'cfpd01_sub_espec', 'cfpd01_auxiliar', 'cfpd01_ano_grupo', 'cfpd01_ano_partida', 'cfpd02_sector', 'cfpd02_programa',
        'cfpd02_sub_prog', 'cfpd02_proyecto', 'cfpd02_activ_obra', 'cfpd01_formulacion', 'cscd02_solicitud_numero_poremitir',
        'cfpd01_ano_generica', 'cfpd01_ano_especifica', 'cfpd01_ano_sub_espec', 'cnmd05_clasificacion', 'cfpd07_obras_cuerpo',
        'cfpd07_obras_partidas', 'cscd04_ordencompra_poremitir_servicio', 'cscd04_ordencompra_poremitir_bienes',
        'cfpd01_ano_auxiliar', 'cfpd01_grupo', 'cfpd01_partida', 'cfpd01_generica', 'cfpd09_metas_actividad', 'cstd02_cuentas_bancarias',
        'cfpd01_especifica', 'cfpd01_sub_espec', 'cfpd01_auxiliar', 'Cnmd02_obreros_ramos', 'Cnmd02_obreros_grupos',
        'Cnmd02_obreros_series', 'Cnmd02_obreros_puestos', 'cepd03_ordenpago_poremitir', 'cepd01_compromiso_poremitir',
        'Cnmd02_empleados_ramos', 'Cnmd02_empleados_grupos', 'Cnmd02_empleados_series', 'Cnmd02_empleados_puestos', 'cugd02_dependencia',
        'Usuario', 'cfpd07', 'distribucion', 'distribucion_institucional', 'cepd03_ordenpago_numero', 'cepd03_ordenpago_facturas',
        'cscd04_ordencompra_encabezado', 'cscd03_cotizacion_encabezado', 'cpcd02', 'cscd02_solicitud_encabezado', 'cugd02_direccion',
        'cscd03_cotizacion_cuerpo', 'cscd04_ordencompra_partidas', 'cepd03_ordenpago_cuerpo', 'cepd03_ordenpago_partidas', 'cepd03_ordenpago_tipopago',
        'cepd03_tipo_documento', 'cepd01_compromiso_partidas', 'cepd01_tipo_compromiso', 'cepd01_compromiso_numero', 'cscd01_catalogo', 'cscd01_unidad_medida',
        'cscd02_solicitud_cuerpo', 'cstd03_cheque_poremitir', 'cstd01_sucursales_bancarias', 'cstd02_cuentas_bancarias', 'cstd06_comprobante_cuerpo_egreso',
        'cstd03_cheque_cuerpo', 'cstd06_comprobante_cuerpo_iva', 'cstd06_comprobante_poremitir_iva', 'cugd06_oficios_poremitir_comun'
        , 'cstd06_comprobante_poremitir_islr', 'cstd06_comprobante_poremitir_timbre', 'cstd06_comprobante_poremitir_municipal', 'cstd06_comprobante_cuerpo_iva',
        'cstd06_comprobante_poremitir_iva', 'cugd06_oficios_poremitir_comun', 'csrd01_solicitud_recurso_cuerpo', 'v_forma_2032_dep', 'v_forma_2032_inst',
        'csrd01_solicitud_recurso_partidas', 'Usuario', 'cugd05_restriccion_tipo', 'cfpd10_reformulacion_tipo', 'cugd05_restriccion_clave', 'cugd05_restriccion_tipo',
        'cstd07_retenciones_cuerpo_islr', 'cstd07_retenciones_cuerpo_iva', 'cstd07_retenciones_cuerpo_timbre', 'cstd07_retenciones_cuerpo_municipal',
        'cscd04_ordencompra_parametros', 'cpcd02', 'cobd01_contratoobras_cuerpo', 'cepd02_contratoservicio_cuerpo', 'csrd01_tipo_solicitud',
        "v_cobp01_cfpd07_partidas", "v_cobp01_cfpd07_cuerpo", "cugd07_firmas_oficio_anulacion", 'cstd07_retenciones_cuerpo_multa', 'cstd07_retenciones_cuerpo_responsabilidad', 'cstd07_retenciones_partidas_multa', 'cstd07_retenciones_partidas_responsabilidad',
        'cstd06_comprobante_poremitir_multa', 'cstd06_comprobante_poremitir_responsabilidad', 'cstd06_comprobante_numero_multa', 'cstd06_comprobante_numero_responsabilidad',
        'cstd06_comprobante_cuerpo_multa', 'cstd06_comprobante_cuerpo_responsabilidad', 'cugd01_republica', 'v_relacion_zonageografica', 'cfpd31_escala_sueldos_salarios',
        'v_forma_2106_dep_vision', 'v_forma_2106_inst_vision', 'v_forma_2107_dep_vision', 'v_forma_2107_inst_vision',
        'v_forma_2113_a_dep_vision', 'v_forma_2113_a_inst_vision', 'v_forma_2113_b_dep_vision', 'v_forma_2113_b_inst_vision', 'v_forma_2113_dep_vision', 'v_forma_2113_inst_vision',
        'v_forma_2114_a_dep_vision', 'v_forma_2114_a_inst_vision', 'v_forma_2114_b_dep_vision', 'v_forma_2114_b_inst_vision', 'v_forma_2114_dep_vision', 'v_forma_2114_inst_vision', 'v_distribucion_asignacion_deduccion', 'v_distribucion_asignacion_deduccion_historico', 'v_cnmd08_historia_transacciones','cstd09_notadebito_cuerpo_pago', 'cstd09_notadebito_ordenes', 'cstd09_notadebito_partidas_pago', 'cstd09_notadebito_poremitir');
    var $helpers = array('Html', 'Ajax', 'Javascript', 'Sisap', 'Fpdf');

    function checkSession() {
        if (!$this->Session->check('Usuario')) {
            $this->redirect('/salir/');
            exit();
        } else {
            //$this->set('userTable', $this->requestAction('/cnmp03partidas/', array('return')));
            //echo "H".$this->requestAction('/usuarios/actualizar_user',array('return'));
            $this->requestAction('/usuarios/actualizar_user');
        }
    }

//fin checksession

    function beforeFilter() {
        $this->checkSession();
    }

    function add_c_c($var) {
        if ($var <= 9 && strlen($var) == 1) {
            $codigo = '0' . $var;
        } else {
            $codigo = '' . $var;
        }
        return $codigo;
    }

//fin AddCero

    function verifica_SS($i) {
        switch ($i) {
            case 1:return $this->Session->read('SScodpresi');
                break;
            case 2:return $this->Session->read('SScodentidad');
                break;
            case 3:return $this->Session->read('SScodtipoinst');
                break;
            case 4:return $this->Session->read('SScodinst');
                break;
            case 5:return $this->Session->read('SScoddep');
                break;
            case 6:return $this->Session->read('entidad_federal');
                break;
            default:
                return "NULO";
        }//fin switch
    }

//fin verifica_SS

    function SQLCA($ano = null) {//sql para busqueda de codigos de arranque con y sin año
        $sql_re = "cod_presi=" . $this->verifica_SS(1) . "  and    ";
        $sql_re .= "cod_entidad=" . $this->verifica_SS(2) . "  and  ";
        $sql_re .= "cod_tipo_inst=" . $this->verifica_SS(3) . "  and ";
        $sql_re .= "cod_inst=" . $this->verifica_SS(4) . "  and  ";
        if ($ano != null) {
            $sql_re .= "cod_dep=" . $this->verifica_SS(5) . "  and  ";
            $sql_re .= "ano=" . $ano . "  ";
        } else {
            $sql_re .= "cod_dep=" . $this->verifica_SS(5) . " ";
        }
        return $sql_re;
    }

//fin funcion SQLCA

    function SQLCA_report($pre = null) {
        $sql_re = "cod_presi=" . $this->verifica_SS(1) . "  and    ";
        $sql_re .= "cod_entidad=" . $this->verifica_SS(2) . "  and  ";
        $sql_re .= "cod_tipo_inst=" . $this->verifica_SS(3) . "  and ";
        if ($pre != null && $pre == 1) {
            $sql_re .= "cod_inst=" . $this->verifica_SS(4) . " ";
            //$sql_re .= "cod_dep=0";
        } else {
            $sql_re .= "cod_inst=" . $this->verifica_SS(4) . "  and  ";
            $sql_re .= "cod_dep=" . $this->verifica_SS(5) . " ";
        }

        return $sql_re;
    }

//fin funcion SQLCA

    function SQLCA_report_in($pre = null) {
        $sql_re = $this->verifica_SS(1) . ",";
        $sql_re .= $this->verifica_SS(2) . ",";
        $sql_re .= $this->verifica_SS(3) . ",";
        if ($pre != null && $pre == 1) {
            $sql_re .= $this->verifica_SS(4) . ",";
            $sql_re .= 0;
        } else {
            $sql_re .= $this->verifica_SS(4) . ",";
            $sql_re .= $this->verifica_SS(5) . " ";
        }

        return $sql_re;
    }

//fin funcion SQLCA

    function AddCero($nomVar, $vector = object, $extra = null) {
        if ($vector != null) {
            if ($extra == null) {
                foreach ($vector as $x) {
                    if ($x < 10) {
                        $Var[$x] = "0" . $x;
                    } else {
                        $Var[$x] = $x;
                    }
                }//fin each
            } else {
                foreach ($vector as $x) {
                    if ($x < 10) {
                        $Var[$x] = $extra . ".0" . $x;
                    } else {
                        $Var[$x] = $extra . "." . $x;
                    }
                }//fin each
            }
            $this->set($nomVar, $Var);
        } else {
            $this->set($nomVar, '');
        }
    }

//fin AddCero

    function AddCeroR($n, $extra = null) {
        if ($n != null) {
            if ($extra == null) {
                if ($n < 10) {
                    $Var = "0" . $n;
                } else {
                    $Var = $n;
                }
            } else {
                if ($n < 10) {
                    $Var = $extra . ".0" . $n;
                } else {
                    $Var = $extra . "." . $n;
                }
            }
            return $Var;
        } else {
            //return $Var;
        }
    }

    function limpia_menu() {

        echo'<script>
                             document.getElementById("valida_codigo").innerHTML = "";
                             document.getElementById("valida_codigo").style.display = "none";
                             if(document.getElementById("registro")){document.getElementById("registro").style.visibility = "hidden";}
                             if(document.getElementById("nomina")){document.getElementById("nomina").style.visibility = "hidden";}
                             if(document.getElementById("dependencia")){document.getElementById("dependencia").style.visibility = "hidden";}
                             if(document.getElementById("sistema_general")){document.getElementById("sistema_general").style.visibility = "hidden";}
               </script>';
    }

    function reporte_entidad_federal($var = null) {

        $ano = '';
        $ano = $this->data['cfpp08']['ano'];
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

        $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
        $dato = null;
        foreach ($year as $year) {
            $dato = $year['cfpd01_formulacion']['ano_formular'];
        }
        if (!empty($dato)) {
            $this->set('year', $dato);
        } else {
            $this->set('year', '');
        }

        if ($var == null) {
            $this->layout = 'ajax';
            $this->limpia_menu();
            $this->set('ir', 'no');
        } else {
            $this->layout = 'pdf';
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');

            $consolidado = 1;
            if (isset($this->data['cfpp08']['consolidacion'])) {
                $consolidado = $this->data['cfpp08']['consolidacion'];
            }

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            if ($ano == '') {
                $vector_cfpp08 = $this->cfpd08->findAll($sql);
            } else {
                $vector_cfpp08 = $this->cfpd08->findAll($sql . 'and ejercicio_fiscal=' . $ano);
            }
            $this->set('DATOS', $vector_cfpp08);
            $this->set('titulo_a', $titulo_a);
        }//fin else


        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        //$this->render();
    }

    function reporte_cfpp07($tipo = null, $year = null) {

        $sql = '';
        set_time_limit(0);
        $SScoddeporig = $this->Session->read('SScoddeporig');
        $SScoddep = $this->Session->read('SScoddep');
        $Modulo = $this->Session->read('Modulo');
        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            $this->set('tipo', $tipo);

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp07']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp07']['consolidacion'])) {
                $consolidado = $this->data['cfpp07']['consolidacion'];
            }
            $sql_ano = '';
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }


            if ($consolidado == 2) {
                $sql = "b.cod_presi = " . $cod_presi . " and b.cod_entidad = " . $cod_entidad . " and b.cod_tipo_inst = " . $cod_tipo_inst . " and b.cod_inst = " . $cod_inst . "and b.cod_dep = " . $cod_dep . " and b.ano_estimacion=" . $ano;
                $sql2 = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "b.cod_presi = " . $cod_presi . " and b.cod_entidad = " . $cod_entidad . " and b.cod_tipo_inst = " . $cod_tipo_inst . " and b.cod_inst = " . $cod_inst . " and b.ano_estimacion=" . $ano;
                $sql2 = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            }



            $sql_ano = $sql;
            $subprograma = $this->cfpd02_sub_prog->findAll($sql2);

            if ($tipo == 1) {
                $sql = $sql_ano . null;
            } else if ($tipo == 2) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=3';
                } else {
                    $sql = $sql_ano . ' and a.tipo_recurso=3';
                }
            } else if ($tipo == 3) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=4';
                } else {
                    $sql = $sql_ano . ' and a.tipo_recurso=4';
                }
            } else if ($tipo == 4) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=1';
                } else {
                    $sql = $sql_ano . ' and a.tipo_recurso=1';
                }
            }

            //$DATOS_res = $this->cfpd07->findAll($sql, null , ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC',  null, null);
            //$DATOS_res = $this->cfpd07_obras_cuerpo->findAll($sql.' and  ano_estimacion='.$ano.'', null, 'cod_obra ASC', null, null, null);
            //$DATOS_res2 = $this->cfpd07_obras_partidas->findAll($sql.' and  ano_estimacion='.$ano.'', null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC', null, null, null);
            // $this->set('DATOS',$DATOS_res);
            //$this->set('DATOS2',$DATOS_res2);


            $datos = $this->cfpd05->execute("SELECT

                                        b.cod_presi ,
                                        b.cod_entidad,
                                        b.cod_tipo_inst,
                                        b.cod_inst,
                                        b.ano_estimacion,
                                        b.cod_obra,
                                        b.cod_sector,
                                        b.cod_programa,
                                        b.cod_sub_prog,
                                        b.cod_proyecto,
                                        b.cod_activ_obra,
                                        a.costo_total,
                                        a.funcionario_responsable,
                                        a.fecha_inicio,
                                        a.fecha_conclusion,
                                        a.situacion,
                                        a.tipo_recurso,
                                        a.denominacion,
                                        a.compro_ano_ante,
                                        a.compro_ano_vige,
                                        a.ejecuta_ano_ante,
                                        a.ejecuta_ano_vige,
                                        a.estimado_presu,
                                        a.estimado_ano_posterior,
                                        a.monto_contratado


                                      FROM  cfpd07_obras_partidas b, cfpd07_obras_cuerpo a

                                 where " . $sql . " and
                                        a.cod_presi            =  b.cod_presi             and
                                        a.cod_entidad          =  b.cod_entidad           and
                                        a.cod_tipo_inst        =  b.cod_tipo_inst         and
                                        a.cod_inst             =  b.cod_inst              and
                                        a.cod_dep              =  b.cod_dep               and
                                        a.cod_obra             =  b.cod_obra

                                GROUP BY
                                            b.cod_presi,
                                            b.cod_entidad,
                                            b.cod_tipo_inst,
                                            b.cod_inst,
                                            b.ano_estimacion ,
                                            b.cod_obra,
                                            b.cod_sector ,
                                            b.cod_programa ,
                                            b.cod_sub_prog,
                                            b.cod_proyecto,
                                            b.cod_activ_obra,
                                            a.fecha_inicio,
                                            a.fecha_conclusion,
                                            a.situacion,
                                            a.tipo_recurso,
                                            a.funcionario_responsable,
                                            a.denominacion,
                                            a.compro_ano_ante,
                                            a.compro_ano_vige,
                                            a.ejecuta_ano_ante,
                                            a.ejecuta_ano_vige,
                                            a.estimado_presu,
                                            a.estimado_ano_posterior,
                                            a.monto_contratado,
                                            a.costo_total


                                order by b.ano_estimacion, b.cod_sector, b.cod_programa, b.cod_sub_prog, b.cod_proyecto, b.cod_obra ASC


                                        ");




            $datos2 = $this->cfpd05->execute("SELECT

                                        b.cod_presi ,
                                        b.cod_entidad,
                                        b.cod_tipo_inst,
                                        b.cod_inst,
                                        b.ano_estimacion,
                                        b.cod_obra,
                                        b.cod_sector,
                                        b.cod_programa,
                                        b.cod_sub_prog,
                                        b.cod_proyecto,
                                        b.cod_activ_obra,
                                        b.cod_partida,
                                        b.cod_generica,
                                        b.cod_especifica,
                                        b.cod_sub_espec,
                                        b.cod_auxiliar,
                                        b.monto as monto_partidas



                                      FROM  cfpd07_obras_partidas b

                                 where " . $sql_ano . "




                                order by b.cod_obra, b.cod_sector, b.cod_programa, b.cod_sub_prog, b.cod_proyecto ASC


                                        ");





            $this->set('datos2', $datos2);








//pr($datos);

            $this->set('datos', $datos);
            $this->set('titulo_a', $titulo_a);
            $this->set('subprograma', $subprograma);
            $this->set('tipo', $tipo);
        }

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp07_agrupar($tipo = null, $year = null) {

        $sql = '';
        set_time_limit(0);

        $SScoddeporig = $this->Session->read('SScoddeporig');
        $SScoddep = $this->Session->read('SScoddep');
        $Modulo = $this->Session->read('Modulo');

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            $this->set('tipo', $tipo);


            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp07']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp07']['consolidacion'])) {
                $consolidado = $this->data['cfpp07']['consolidacion'];
            }
            $sql_ano = '';
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $sql = "";

            if ($consolidado == 2) {
                $sql = "b.cod_presi = " . $cod_presi . " and b.cod_entidad = " . $cod_entidad . " and b.cod_tipo_inst = " . $cod_tipo_inst . " and b.cod_inst = " . $cod_inst . "and b.cod_dep = " . $SScoddeporig . " and b.ano_estimacion=" . $ano;
                $sql2 = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
                $sql = "b.cod_presi = " . $cod_presi . " and b.cod_entidad = " . $cod_entidad . " and b.cod_tipo_inst = " . $cod_tipo_inst . " and b.cod_inst = " . $cod_inst . " and b.ano_estimacion=" . $ano;
                $sql2 = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }



            $sql_ano = $sql;
            $subprograma = $this->cfpd02_sub_prog->findAll($sql2);

            if ($tipo == 1) {
                $sql = $sql_ano . null;
            } else if ($tipo == 2) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=3';
                } else {
                    $sql = $sql_ano . 'and tipo_recurso=3';
                }
            } else if ($tipo == 3) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=4';
                } else {
                    $sql = $sql_ano . 'and tipo_recurso=4';
                }
            } else if ($tipo == 4) {
                if ($ano == '') {
                    $sql = $sql_ano . ' and a.tipo_recurso=1';
                } else {
                    $sql = $sql_ano . 'and tipo_recurso=1';
                }
            }

            //$DATOS_res = $this->cfpd07->findAll($sql, null , ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC',  null, null);
            //$DATOS_res = $this->cfpd07_obras_cuerpo->findAll($sql.' and  ano_estimacion='.$ano.'', null, 'cod_obra ASC', null, null, null);
            //$DATOS_res2 = $this->cfpd07_obras_partidas->findAll($sql.' and  ano_estimacion='.$ano.'', null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC', null, null, null);
            // $this->set('DATOS',$DATOS_res);
            //$this->set('DATOS2',$DATOS_res2);


            $datos = $this->cfpd05->execute("SELECT

                                        b.cod_presi ,
                                        b.cod_entidad,
                                        b.cod_tipo_inst,
                                        b.cod_inst,
                                        b.ano_estimacion,
                                        b.cod_obra,
                                        b.cod_sector,
                                        b.cod_programa,
                                        b.cod_sub_prog,
                                        b.cod_proyecto,
                                        b.cod_activ_obra,
                                        a.costo_total,
                                        a.funcionario_responsable,
                                        a.fecha_inicio,
                                        a.fecha_conclusion,
                                        a.situacion,
                                        a.tipo_recurso,
                                        a.denominacion,
                                        a.compro_ano_ante,
                                        a.compro_ano_vige,
                                        a.ejecuta_ano_ante,
                                        a.ejecuta_ano_vige,
                                        a.estimado_presu,
                                        a.estimado_ano_posterior,
                                        a.monto_contratado


                                      FROM  cfpd07_obras_partidas b, cfpd07_obras_cuerpo a

                                 where " . $sql . " and
                                        a.cod_presi            =  b.cod_presi             and
                                        a.cod_entidad          =  b.cod_entidad           and
                                        a.cod_tipo_inst        =  b.cod_tipo_inst         and
                                        a.cod_inst             =  b.cod_inst              and
                                        a.cod_dep              =  b.cod_dep               and
                                        a.cod_obra             =  b.cod_obra

                                GROUP BY
                                            b.cod_presi,
                                            b.cod_entidad,
                                            b.cod_tipo_inst,
                                            b.cod_inst,
                                            b.ano_estimacion ,
                                            b.cod_obra,
                                            b.cod_sector ,
                                            b.cod_programa ,
                                            b.cod_sub_prog,
                                            b.cod_proyecto,
                                            b.cod_activ_obra,
                                            a.fecha_inicio,
                                            a.fecha_conclusion,
                                            a.situacion,
                                            a.tipo_recurso,
                                            a.funcionario_responsable,
                                            a.denominacion,
                                            a.compro_ano_ante,
                                            a.compro_ano_vige,
                                            a.ejecuta_ano_ante,
                                            a.ejecuta_ano_vige,
                                            a.estimado_presu,
                                            a.estimado_ano_posterior,
                                            a.monto_contratado,
                                            a.costo_total


                                order by b.cod_obra, b.cod_sector, b.cod_programa, b.cod_sub_prog, b.cod_proyecto ASC


                                        ");
            $this->set('datos', $datos);


            $datos2 = $this->cfpd05->execute("SELECT

                                        b.cod_presi ,
                                        b.cod_entidad,
                                        b.cod_tipo_inst,
                                        b.cod_inst,
                                        b.ano_estimacion,
                                        b.cod_obra,
                                        b.cod_sector,
                                        b.cod_programa,
                                        b.cod_sub_prog,
                                        b.cod_proyecto,
                                        b.cod_activ_obra,
                                        b.cod_partida,
                                        b.cod_generica,
                                        b.cod_especifica,
                                        b.cod_sub_espec,
                                        b.cod_auxiliar,
                                        a.costo_total,
                                        a.funcionario_responsable,
                                        a.fecha_inicio,
                                        a.fecha_conclusion,
                                        a.situacion,
                                        a.tipo_recurso,
                                        a.denominacion,
                                        a.compro_ano_ante,
                                        a.compro_ano_vige,
                                        a.ejecuta_ano_ante,
                                        a.ejecuta_ano_vige,
                                        a.estimado_presu,
                                        a.estimado_ano_posterior,
                                        a.monto_contratado


                                      FROM  cfpd07_obras_partidas b, cfpd07_obras_cuerpo a

                                 where " . $sql . " and
                                        a.cod_presi            =  b.cod_presi             and
                                        a.cod_entidad          =  b.cod_entidad           and
                                        a.cod_tipo_inst        =  b.cod_tipo_inst         and
                                        a.cod_inst             =  b.cod_inst              and
                                        a.cod_dep              =  b.cod_dep               and
                                        a.cod_obra             =  b.cod_obra




                                order by b.cod_obra, b.cod_sector, b.cod_programa, b.cod_sub_prog, b.cod_proyecto ASC


                                        ");





            $this->set('datos2', $datos2);
            $this->set('titulo_a', $titulo_a);
            $this->set('subprograma', $subprograma);
            $this->set('tipo', $tipo);
        }

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp03($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }

            for ($minCount = 2007; $minCount < 2030; $minCount++) {
                $anos[sprintf('%02d', $minCount)] = sprintf('%02d', $minCount);
                $this->set('anos', $anos);
                $this->set('ano_formulacion', $dato);
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cfpp03']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp03']['consolidacion'])) {
                $consolidado = $this->data['cfpp03']['consolidacion'];
            }



            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = $this->SQLCA_consolidado($consolidado);
                $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
                $sql = $this->SQLCA_consolidado($consolidado);
                $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('auxiliar', $this->cfpd01_ano_auxiliar->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));

            if ($ano != '') {
                $condicion_sql = $sql . " and ano=" . $ano;
            } else {
                $condicion_sql = $sql;
            }

            $campos = "   cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              cod_partida,
              cod_generica,
              cod_especifica,
              cod_sub_espec,
              cod_auxiliar,
              SUM(estimacion_inicial)   as estimacion_inicial,
              SUM(ingresos_adicionales) as ingresos_adicionales,
              SUM(rebajas)              as rebajas,
              SUM(monto_facturado)      as monto_facturado,
              SUM(monto_cobrado)        as monto_cobrado ";

            $group = "  GROUP BY cod_presi,
                      cod_entidad,
                      cod_tipo_inst,
                      cod_inst,
                      ano,
                      cod_partida,
                      cod_generica,
                      cod_especifica,
                      cod_sub_espec,
                      cod_auxiliar ";



            if ($consolidado == 2) {
                $DATOS_res = $this->cfpd03->findAll($condicion_sql, null, 'cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC', null, null);
            } else {
                $DATOS_res = $this->cfpd03->findAll($condicion_sql . " " . $group, $campos, 'cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC', null, null);
            }


            $this->set('datos', $DATOS_res);


            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp05_sp($year = null) {
        $sql = '';
        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            //$cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            $consolidacion = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidacion = $this->data['cfpp05']['consolidacion'];
                if ($consolidacion == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($consolidacion == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }
            $sql = $this->SQLCA_consolidado($consolidacion);

            if ($ano != '') {
                $condicion = $sql . "and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('sector', $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprog', $this->cfpd02_sub_prog->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog  ASC', null, null);
            $this->set('datos', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
            $this->set('consolidado', $consolidacion);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp05_p($year = null) {
        $sql = '';
        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidacion = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidacion);

            if ($consolidacion == 2) {
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidacion == 1) {
                $titulo_a = $this->Session->read('dependencia');
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));
            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_partida ASC', null, null);
            $this->set('datos', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp05_2005($year = null) {

        $sql = '';
        ini_set("memory_limit", "2000M");
        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }
            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        } else {

            set_time_limit(0);
            $this->layout = "pdf";
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $consolidado = 2;
            if (isset($this->data)) {
                $Ano = $this->data['cfpp05']['ano'];
                $this->set('ANO', $Ano);

                if (isset($this->data['cfpp05']['consolidacion'])) {
                    $consolidado = $this->data['cfpp05']['consolidacion'];
                } else {
                    $consolidado = 2;
                }
                $con = $this->SQLCA_consolidado($consolidado);

                if ($consolidado == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');

                    $conin = $this->verifica_SS(1) . ",";
                    $conin .= $this->verifica_SS(2) . ",";
                    $conin .= $this->verifica_SS(3) . ",";
                    $conin .= $this->verifica_SS(4) . ",";
                    $conin .= $this->Session->read('cod_dep_reporte_consolidado') . " ";
                } else if ($consolidado == 1) {
                    $titulo_a = $this->Session->read('dependencia');

                    $conin = $this->verifica_SS(1) . ",";
                    $conin .= $this->verifica_SS(2) . ",";
                    $conin .= $this->verifica_SS(3) . ",";
                    $conin .= $this->verifica_SS(4) . ",";
                    $conin .= 0;
                }

                $this->set('titulo_a', $titulo_a);

                /*
                  if(isset($this->data['cfpp05']['consolidacion'])){
                  $conin=$this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
                  }else{
                  $conin=$this->SQLCA_report_in();
                  }
                 */

                $tc = $this->cfpd05_2032_tmp->findCount($con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "'");

                if ($tc != 0) {
                    $this->cfpd05_2032_tmp->execute("DELETE FROM cfpd05_2032_tmp WHERE username='" . $this->Session->read('nom_usuario') . "'");
                } else {
                    
                }
                $vector = $this->cfpd05->findAll($con);
                //$vector = $this->cfpd05->execute("");
                for ($g = 1; $g <= 15; $g++) {
                    $sector[$g] = 0;
                }
                $sqlin = "INSERT INTO cfpd05_2032_tmp (cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,username,ano,cod_partida,cod_generica,cod_especifica,cod_sub_espec,monto_estimado_anterior,monto_sector_uno,monto_sector_dos,monto_sector_tres,monto_sector_cuatro,monto_sector_cinco,monto_sector_seis,monto_sector_siete,monto_sector_ocho,monto_sector_nueve,monto_sector_diez,monto_sector_once,monto_sector_doce,monto_sector_trece,monto_sector_catorce,monto_sector_quince,monto_total_estimado) ";
                $sqlin .=" VALUES (" . $conin . ",'" . $this->Session->read('nom_usuario') . "'," . $Ano . ",";

                $sqlup = "UPDATE cfpd05_2032_tmp SET monto_sector_";
                $sqlup2 = " WHERE " . $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";

                $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";

                //$distinto_partida = $this->cfpd05->execute("SELECT DISTINCT cod_partida, count(DISTINCT cod_partida) FROM cfpd05 WHERE ".$con);
                $distinto_partida = $this->cfpd05->execute("SELECT DISTINCT cod_partida FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " GROUP BY cod_partida");
                //print_r($distinto_partida);
                for ($i = 0; $i < count($distinto_partida); $i++) {//a
                    $cd = $distinto_partida[$i][0]['cod_partida'];
                    $sqlin_1 = $sqlin . $cd . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $this->cfpd05_2032_tmp->execute($sqlin_1);
                    $distinto_generica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_partida=" . $cd . " GROUP BY cod_partida,cod_generica");
                    foreach ($distinto_generica as $ds) {//b
                        $cp = $ds[0]['cod_partida'];
                        $cg = $ds[0]['cod_generica'];
                        $sqlin_2 = $sqlin . $cp . "," . $cg . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                        $this->cfpd05_2032_tmp->execute($sqlin_2);
                        $distinto_especifica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_partida=" . $cp . " and cod_generica=" . $cg . " GROUP BY cod_partida,cod_generica,cod_especifica");
                        foreach ($distinto_especifica as $de) {//c
                            $cpp = $de[0]['cod_partida'];
                            $cgg = $de[0]['cod_generica'];
                            $ce = $de[0]['cod_especifica'];
                            $sqlin_3 = $sqlin . $cpp . "," . $cgg . "," . $ce . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                            $this->cfpd05_2032_tmp->execute($sqlin_3);
                            $distinto_sub_espe = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica,cod_sub_espec FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_partida=" . $cpp . " and cod_generica=" . $cgg . " and cod_especifica=" . $ce . " GROUP BY cod_partida,cod_generica,cod_especifica,cod_sub_espec");
                            foreach ($distinto_sub_espe as $dse) {//d
                                $cppp = $dse[0]['cod_partida'];
                                $cggg = $dse[0]['cod_generica'];
                                $cee = $dse[0]['cod_especifica'];
                                $cse = $dse[0]['cod_sub_espec'];
                                $sqlin_4 = $sqlin . $cppp . "," . $cggg . "," . $cee . "," . $cse . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                                $this->cfpd05_2032_tmp->execute($sqlin_4);
                            }//d
                        }//c
                    }//b
                }//a
                ///
                ///partidas
                $nn = array(1 => 'uno=', 2 => 'dos=', 3 => 'tres=', 4 => 'cuatro=', 5 => 'cinco=', 6 => 'seis=', 7 => 'siete=', 8 => 'ocho=', 9 => 'nueve=', 10 => 'diez=', 11 => 'once=', 12 => 'doce=', 13 => 'trece=', 14 => 'catorce=', 15 => 'quince=');
                for ($y = 1; $y <= 15; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0");
                        }
                    }
                }
                //
                ///generica
                for ($y = 1; $y <= 15; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=0 and cod_sub_espec=0");
                        }
                    }
                }
                ///especifica
                for ($y = 1; $y <= 15; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=0");
                        }
                    }
                }
                ///sub-especifica
                for ($y = 1; $y <= 15; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=" . $xx1[0]['cod_sub_espec'] . "");
                        }
                    }
                }

                $nna = array(1 => 'uno', 2 => 'dos', 3 => 'tres', 4 => 'cuatro', 5 => 'cinco', 6 => 'seis', 7 => 'siete', 8 => 'ocho', 9 => 'nueve', 10 => 'diez', 11 => 'once', 12 => 'doce', 13 => 'trece', 14 => 'catorce', 15 => 'quince');
                $hola = $this->cfpd05_2032_tmp->findAll($sql_s, null, "cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");
                $this->set("reporte_cfpd05", $hola);
                $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('generica', $this->cfpd01_ano_generica->findAll('ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $Ano, null, null, null, null, null));
                //$this->set('auxiliar',$this->cfpd01_ano_auxiliar->findAll('ejercicio='.$Ano,null,null,null, null, null));
                /* foreach($hola as $saludo){
                  echo "<br>".$saludo['cfpd05_2032_tmp']['cod_partida']." ";
                  for($i=1;$i<=15;$i++)
                  echo " [".$i."]:".$saludo['cfpd05_2032_tmp']['monto_sector_'.$nna[$i]];
                  } */
            }//isset
        }//fin else
    }

//fin function

    function reporte_cfpp02() {
        $this->layout = "ajax";
        $this->limpia_menu();
        //A partir de aqui esta el codiog para bajar el año presupuestario por defecto
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

        $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);

        $dato = null;
        foreach ($year as $year) {
            $dato = $year['cfpd01_formulacion']['ano_formular'];
        }

        if (!empty($dato)) {

            $this->set('year', $dato);
        } else {
            $this->set('year', '');
        }
    }

    function reporte_forma2002($ano = null) {
        $this->layout = "pdf";
        $this->set('entidad', $this->verifica_SS(6));

        if (isset($this->data['cfpp02']['ano'])) {
            $this->set('presupuesto', $this->data['cfpp02']['ano']);
            $ano = $this->data['cfpp02']['ano'];
        }
        //'cfpd02_sector', 'cfpd02_programa', 'cfpd02_sub_prog', 'cfpd02_proyecto', 'cfpd02_activ_obra'
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');



        if ($cod_dep == 1) {
            $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=1";
            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
        } else {
            $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            $titulo_a = $this->Session->read('dependencia');
        }

        if (isset($ano) && !empty($ano)) {
            $condicion = $sql . 'and ano=' . $ano;
        } else {
            $condicion = $sql;
        }
        $this->set('titulo_a', $titulo_a);
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
        $c_sector = $this->cfpd02_sector->findCount($condicion);
        $programa = $this->cfpd02_programa->findAll($condicion, null, 'cod_programa ASC');
        $c_programa = $this->cfpd02_programa->findCount($condicion);
        $subprograma = $this->cfpd02_sub_prog->findAll($condicion, null, 'cod_sub_prog ASC');
        $c_subprograma = $this->cfpd02_sub_prog->findCount($condicion); //200.84.68.85
        $proyecto = $this->cfpd02_proyecto->findAll($condicion, null, 'cod_proyecto ASC');
        $c_proyecto = $this->cfpd02_proyecto->findCount($condicion);
        $actividad = $this->cfpd02_activ_obra->findAll($condicion, null, 'cod_activ_obra ASC');
        $c_actividad = $this->cfpd02_activ_obra->findCount($condicion);

        $sector_aux = $sector;

        $this->set('sector_aux', $sector_aux);
        $this->set('sector', $sector);
        $this->set('c_sector', $c_sector);
        $this->set('programa', $programa);
        $this->set('c_programa', $c_programa);
        $this->set('subprograma', $subprograma);
        $this->set('c_subprograma', $c_subprograma);
        $this->set('proyecto', $proyecto);
        $this->set('c_proyecto', $c_proyecto);
        $this->set('actividad', $actividad);
        $this->set('c_actividad', $c_actividad);
    }

//fin func reporte
    /*
     *
     */

    function reporte_forma2002_html($ano = null) {
        $this->layout = "ajax";
        $this->limpia_menu();
        //'cfpd02_sector', 'cfpd02_programa', 'cfpd02_sub_prog', 'cfpd02_proyecto', 'cfpd02_activ_obra'


        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');

        $consolidado = 1;
        if (isset($this->data['cfpp02']['consolidacion'])) {
            $consolidado = $this->data['cfpp02']['consolidacion'];
        }

        if ($consolidado == 2) {
            $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            $titulo_a = $this->Session->read('dependencia');
        } else if ($consolidado == 1) {
            $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
        }

        if (isset($ano) && !empty($ano)) {
            $condicion = $sql . 'and ano=' . $ano;
        } else {
            $condicion = $sql;
        }
        $this->set('titulo_a', $titulo_a);
        $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
        $c_sector = $this->cfpd02_sector->findCount($condicion);
        echo '<table width="700">' .
        '<tr><td>SECTOR</td><td>PROGRAMA</td><td>SUBPROGRAMA</td><td>PROYECTO</td><td>ACTIVIDAD</td><td>DENOMINACION</td></tr>';
        if ($c_sector != 0) {
            foreach ($sector as $sec) {
                echo "<tr><td>" . $sec['cfpd02_sector']['cod_sector'] . "</td><td>00</td><td>00</td><td>00</td><td>00</td><td>" . $sec['cfpd02_sector']['denominacion'] . "</td></tr>";
                $programa = $this->cfpd02_programa->findAll($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'], null, 'cod_programa ASC');
                $c_programa = $this->cfpd02_programa->findCount($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector']);
                if ($c_programa != 0) {
                    foreach ($programa as $pro) {
                        echo "<tr><td>" . $sec['cfpd02_sector']['cod_sector'] . "</td><td>" . $pro['cfpd02_programa']['cod_programa'] . "</td><td>00</td><td>00</td><td>00</td><td>" . $pro['cfpd02_programa']['denominacion'] . "</td></tr>";
                        $subprograma = $this->cfpd02_sub_prog->findAll($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa'], null, 'cod_sub_prog ASC');
                        $c_subprograma = $this->cfpd02_sub_prog->findCount($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa']); //200.84.68.85
                        if ($c_subprograma != 0) {
                            foreach ($subprograma as $sub) {
                                echo "<tr><td>" . $sec['cfpd02_sector']['cod_sector'] . "</td><td>" . $pro['cfpd02_programa']['cod_programa'] . "</td><td>" . $sub['cfpd02_sub_prog']['cod_sub_prog'] . "</td><td>00</td<td>00</td><td>" . $sub['cfpd02_sub_prog']['denominacion'] . "</td></tr>";
                                $proyecto = $this->cfpd02_proyecto->findAll($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa'] . " and cod_sub_prog=" . $sub['cfpd02_sub_prog']['cod_sub_prog'], null, 'cod_proyecto ASC');
                                $c_proyecto = $this->cfpd02_proyecto->findCount($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa'] . " and cod_sub_prog=" . $sub['cfpd02_sub_prog']['cod_sub_prog']);
                                if ($c_proyecto != 0) {
                                    foreach ($proyecto as $proy) {
                                        echo "<tr><td>" . $sec['cfpd02_sector']['cod_sector'] . "</td><td>" . $pro['cfpd02_programa']['cod_programa'] . "</td><td>" . $sub['cfpd02_sub_prog']['cod_sub_prog'] . "</td><td>" . $proy['cfpd02_proyecto']['cod_proyecto'] . "</td><td>00</td><td>" . $proy['cfpd02_proyecto']['denominacion'] . "</td></tr>";
                                        $actividad = $this->cfpd02_activ_obra->findAll($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa'] . " and cod_sub_prog=" . $sub['cfpd02_sub_prog']['cod_sub_prog'] . " and cod_proyecto=" . $proy['cfpd02_proyecto']['cod_proyecto'], null, 'cod_activ_obra ASC');
                                        $c_actividad = $this->cfpd02_activ_obra->findCount($condicion . " and cod_sector=" . $sec['cfpd02_sector']['cod_sector'] . " and cod_programa=" . $pro['cfpd02_programa']['cod_programa'] . " and cod_sub_prog=" . $sub['cfpd02_sub_prog']['cod_sub_prog'] . " and cod_proyecto=" . $proy['cfpd02_proyecto']['cod_proyecto']);
                                        if ($c_actividad != 0) {
                                            foreach ($actividad as $act) {
                                                echo "<tr><td>" . $sec['cfpd02_sector']['cod_sector'] . "</td><td>" . $pro['cfpd02_programa']['cod_programa'] . "</td><td>" . $sub['cfpd02_sub_prog']['cod_sub_prog'] . "</td><td>" . $proy['cfpd02_proyecto']['cod_proyecto'] . "</td><td>" . $act['cfpd02_activ_obra']['cod_activ_obra'] . "</td><td>" . $act['cfpd02_activ_obra']['denominacion'] . "</td></tr>";
                                            }
                                        }//act
                                    }
                                }//proy
                            }
                        }//sub prog
                    }
                }//prog
            }
        }//sector
        echo '</table>';

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin func reporte

    function reporte_cfpp05_partida($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;



            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_partida ASC', null, null);
            $this->set('datos', $DATOS_res);

            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_forma_2032_b() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function reporte_form() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function reporte_form_distribucion() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function reporte_form_distribucion_por_proyectos() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function reporte_form_actividades() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function reporte_form_partida() {
        $this->layout = "ajax";
        $this->limpia_menu();
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $Cpresi = $this->verifica_SS(1);
        $Centidad = $this->verifica_SS(2);
        $Ctipo_inst = $this->verifica_SS(3);
        $Cinst = $this->verifica_SS(4);
        $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
        //echo "el ano es: ".$ano;
        $this->set('ano', $ano);
    }

    function generar_reporte() {
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if (isset($this->data['cfpp05']) && !empty($this->data['cfpp05']['ano'])) {
            $Ano = $this->data['cfpp05']['ano'];
            $gr = $this->cfpd05->execute("SELECT cod_sector FROM cfpd05  WHERE " . $this->SQLCA($Ano) . " GROUP BY cod_sector");
            //echo "<br>Cantidad de Sectores Registrados ".count($gr);
            $gr2 = $this->cfpd05->execute("SELECT  cod_sector,cod_partida, SUM(cfpd05.asignacion_anual) as monto FROM cfpd05 WHERE " . $this->SQLCA($Ano) . " GROUP BY cod_sector,cod_partida ORDER BY cod_partida");
            /* echo "<hr>";
              foreach($gr2 as $aa){
              echo $this->AddCeroR($aa[0]['cod_sector'])." ___ ".$this->AddCeroR($aa[0]['cod_partida'],4)." ___ ".$aa[0]['monto']."<br>";
              } */
            $this->set('datos', $gr2);
        }
    }

//generar_reporte

    function reporte_cfpp05_2032_v2($var1, $var2, $var3, $var4, $var5) {
        ini_set("memory_limit", "1024M");
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $this->set('reporte_cfpd05', $var1);
        $this->set('partida', $var2);
        $this->set('generica', $var3);
        $this->set('especifica', $var4);
        $this->set('subespecifica', $var5);
    }

    function reporte_cfpd05_forma_2032_b() {
        ini_set("memory_limit", "1536M");
        set_time_limit(0);
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $consolidado = 2;
        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);

            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $modelo_vista = 'v_forma_2032_dep';
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                    $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $modelo_vista = 'v_forma_2032_inst';
                    $titulo_a = $this->Session->read('dependencia');
                    $con = $this->SQLCA_report($consolidado);
                }
            } else {
                $modelo_vista = 'v_forma_2032_dep';
                $consolidado = 2;
                $titulo_a = $this->Session->read('dependencia');
                $con = $this->SQLCA_report();
            }

            $this->set('titulo_a', $titulo_a);
            $this->set('modelo_vista', $modelo_vista);

            $sql_s = $con . " and ano=" . $Ano;

            $datos_forma = $this->$modelo_vista->findAll($sql_s, null, "cod_partida, cod_generica, cod_especifica, cod_sub_espec ASC");

            $this->set("reporte_cfpd05", $datos_forma);
            $q1 = $this->cfpd01_ano_partida->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q2 = $this->cfpd01_ano_generica->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q3 = $this->cfpd01_ano_especifica->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q4 = $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $this->set('partida', $q1);
            $this->set('generica', $q2);
            $this->set('especifica', $q3);
            $this->set('subespecifica', $q4);
        }//isset
    }

//fin function

    function reporte_cfpd05_2032() {
        ini_set("memory_limit", "1536M");
        set_time_limit(0);
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $consolidado = 2;
        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);


            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                    $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
                    $conin = $this->verifica_SS(1) . ",";
                    $conin .= $this->verifica_SS(2) . ",";
                    $conin .= $this->verifica_SS(3) . ",";
                    $conin .= $this->verifica_SS(4) . ",";
                    $conin .= $_SESSION['cod_dep_reporte_consolidado'] . " ";
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                    $con = $this->SQLCA_report($consolidado);
                    $conin = $this->SQLCA_report_in();
                }
            } else {
                $consolidado = 2;
                $titulo_a = $this->Session->read('dependencia');
                $con = $this->SQLCA_report();
                $conin = $this->SQLCA_report_in();
            }



            $this->set('titulo_a', $titulo_a);





            $tc = $this->cfpd05_2032_tmp->findCount($con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "'");
            if ($tc != 0) {
                $this->cfpd05_2032_tmp->execute("DELETE FROM cfpd05_2032_tmp WHERE username='" . $this->Session->read('nom_usuario') . "'");
            } else {
                
            }

            /*
              $vector = $this->cfpd05->findAll($con);

              for($g=1;$g<=15;$g++){
              $sector[$g]=0;
              }
             */


            $sqlin_tmp = "INSERT INTO cfpd05_2032_tmp (cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,username,ano,cod_partida,cod_generica,cod_especifica,cod_sub_espec,monto_estimado_anterior,monto_sector_uno,monto_sector_dos,monto_sector_tres,monto_sector_cuatro,monto_sector_cinco,monto_sector_seis,monto_sector_siete,monto_sector_ocho,monto_sector_nueve,monto_sector_diez,monto_sector_once,monto_sector_doce,monto_sector_trece,monto_sector_catorce,monto_sector_quince,monto_total_estimado) VALUES ";
            $sqlin_comp = " (" . $conin . ",'" . $this->Session->read('nom_usuario') . "'," . $Ano . ",";
            $valores_in = null;

            $sqlup = "UPDATE cfpd05_2032_tmp SET monto_sector_";
            $sqlup2 = " WHERE " . $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $sqlselec = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";

            $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $sql_sv2 = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0";

            $distinto_partida_ant = $this->cfpd05->execute("SELECT cod_partida, sum(asignacion_anual) as monto_estimado_partida_anterior FROM cfpd05 WHERE " . $con . " and ano= " . ($Ano - 1) . " GROUP BY cod_partida ORDER BY cod_partida");
            $distinto_partida = $this->cfpd05->execute("SELECT cod_partida FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " GROUP BY cod_partida ORDER BY cod_partida");

            for ($i = 0; $i < count($distinto_partida); $i++) {
                $pd = $distinto_partida[$i][0]['cod_partida'];
                $monto_est_ante_part = 0;

                for ($j = 0; $j < count($distinto_partida_ant); $j++) {

                    $pd_ant = $distinto_partida_ant[$j][0]['cod_partida'];
                    $monto_ant = $distinto_partida_ant[$j][0]['monto_estimado_partida_anterior'];

                    if ($pd == $pd_ant && $monto_est_ante_part == 0) {
                        $monto_est_ante_part = $distinto_partida_ant[$j][0]['monto_estimado_partida_anterior'];
                    }
                }

                $s = $this->cfpd05_2032_tmp->findCount($sqlselec . " and cod_partida=" . $pd . " and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0");
                if ($s == 0) {
                    $valores_in[] = $sqlin_comp . $pd . ",0,0,0,$monto_est_ante_part,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $monto_est_ante_part = 0;
                }
            }

            $distinto_generica_ant = $this->cfpd05->execute("SELECT cod_partida,cod_generica, sum(asignacion_anual) as monto_estimado_generica_anterior FROM cfpd05 WHERE " . $con . " and ano=" . ($Ano - 1) . " GROUP BY cod_partida,cod_generica ORDER BY cod_partida, cod_generica");
            $distinto_generica = $this->cfpd05->execute("SELECT cod_partida,cod_generica FROM cfpd05 WHERE " . $con . " and ano=" . $Ano . " GROUP BY cod_partida,cod_generica ORDER BY cod_partida, cod_generica");

            for ($ii = 0; $ii < count($distinto_generica); $ii++) {
                $pd = $distinto_generica[$ii][0]['cod_partida'];
                $ge = $distinto_generica[$ii][0]['cod_generica'];
                $monto_est_ge_ante = 0;

                for ($j = 0; $j < count($distinto_generica_ant); $j++) {
                    $pd_ant = $distinto_generica_ant[$j][0]['cod_partida'];
                    $ge_ant = $distinto_generica_ant[$j][0]['cod_generica'];
                    if ($pd == $pd_ant && $ge == $ge_ant && $monto_est_ge_ante == 0) {
                        $monto_est_ge_ante = $distinto_generica_ant[$j][0]['monto_estimado_generica_anterior'];
                    }
                }

                $ss = $this->cfpd05_2032_tmp->findCount($sqlselec . " and cod_partida=" . $pd . " and cod_generica=" . $ge . " and cod_especifica=0 and cod_sub_espec=0");
                if ($ss == 0) {
                    $valores_in[] = $sqlin_comp . $pd . "," . $ge . ",0,0,$monto_est_ge_ante,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $monto_est_ge_ante = 0;
                }
            }

            $distinto_especifica_ant = $this->cfpd05->execute("SELECT cod_partida,cod_generica,cod_especifica, sum(asignacion_anual) as monto_estimado_especifica_anterior FROM cfpd05 WHERE " . $con . " and ano= " . ($Ano - 1) . " GROUP BY cod_partida,cod_generica,cod_especifica ORDER BY cod_partida, cod_generica, cod_especifica");
            $distinto_especifica = $this->cfpd05->execute("SELECT cod_partida,cod_generica,cod_especifica FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " GROUP BY cod_partida,cod_generica,cod_especifica ORDER BY cod_partida, cod_generica, cod_especifica");

            for ($k = 0; $k < count($distinto_especifica); $k++) {
                $pd = $distinto_especifica[$k][0]['cod_partida'];
                $ge = $distinto_especifica[$k][0]['cod_generica'];
                $esp = $distinto_especifica[$k][0]['cod_especifica'];

                $monto_est_espec_ante = 0;
                for ($j = 0; $j < count($distinto_especifica_ant); $j++) {
                    $pd_ant = $distinto_especifica_ant[$j][0]['cod_partida'];
                    $ge_ant = $distinto_especifica_ant[$j][0]['cod_generica'];
                    $es_ant = $distinto_especifica_ant[$j][0]['cod_especifica'];

                    if ($pd == $pd_ant && $ge == $ge_ant && $esp == $es_ant && $monto_est_espec_ante == 0) {
                        $monto_est_espec_ante = $distinto_especifica_ant[$j][0]['monto_estimado_especifica_anterior'];
                    }
                }

                $sss = $this->cfpd05_2032_tmp->findCount($sqlselec . " and cod_partida=" . $pd . " and cod_generica=" . $ge . " and cod_especifica=" . $esp . " and cod_sub_espec=0");
                if ($sss == 0) {
                    $valores_in[] = $sqlin_comp . "$pd,$ge,$esp,0,$monto_est_espec_ante,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $monto_est_espec_ante = 0;
                }
            }

            $distinto_subespec_ant = $this->cfpd05->execute("SELECT cod_partida, cod_generica, cod_especifica, cod_sub_espec, sum(asignacion_anual) as monto_estimado_subespecifica_anterior FROM cfpd05 WHERE " . $con . " and ano= " . ($Ano - 1) . " and cod_sub_espec!=0 GROUP BY cod_partida,cod_generica,cod_especifica,cod_sub_espec ORDER BY cod_partida,cod_generica,cod_especifica,cod_sub_espec");
            $distinto_sub_espe = $this->cfpd05->execute("SELECT cod_partida,cod_generica,cod_especifica,cod_sub_espec FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sub_espec!=0 GROUP BY cod_partida,cod_generica,cod_especifica,cod_sub_espec ORDER BY cod_partida,cod_generica,cod_especifica,cod_sub_espec");

            for ($m = 0; $m < count($distinto_sub_espe); $m++) {
                $pd = $distinto_sub_espe[$m][0]['cod_partida'];
                $ge = $distinto_sub_espe[$m][0]['cod_generica'];
                $es = $distinto_sub_espe[$m][0]['cod_especifica'];
                $se = $distinto_sub_espe[$m][0]['cod_sub_espec'];
                $monto_est_sub_espec_ante = 0;

                for ($j = 0; $j < count($distinto_subespec_ant); $j++) {
                    $pd_ant = $distinto_subespec_ant[$j][0]['cod_partida'];
                    $ge_ant = $distinto_subespec_ant[$j][0]['cod_generica'];
                    $es_ant = $distinto_subespec_ant[$j][0]['cod_especifica'];
                    $se_ant = $distinto_subespec_ant[$j][0]['cod_sub_espec'];

                    if ($pd == $pd_ant && $ge == $ge_ant && $es == $es_ant && $se == $se_ant && $monto_est_sub_espec_ante == 0) {
                        $monto_est_sub_espec_ante = $distinto_subespec_ant[$j][0]['monto_estimado_subespecifica_anterior'];
                    }
                }

                $ssss = $this->cfpd05_2032_tmp->findCount($sqlselec . " and cod_partida=" . $pd . " and cod_generica=" . $ge . " and cod_especifica=" . $es . " and cod_sub_espec=" . $se . "");
                if ($ssss == 0) {
                    $valores_in[] = $sqlin_comp . "$pd,$ge,$es,$se,$monto_est_espec_ante,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $monto_est_sub_espec_ante = 0;
                }
            }

            // SE EJECUTA EL INSERT:

            if ($valores_in != null) {
                $sqlin_tmp .= " " . implode(',', $valores_in) . ";";
                $this->cfpd05_2032_tmp->execute($sqlin_tmp);
            }



            /** ACTUALIZACION DE LA ASIGNACION ANUAL POR SECTOR DE LAS CATEGORIAS PROGRAMATICAS */
            // partidas
            $nn = array(1 => 'uno=', 2 => 'dos=', 3 => 'tres=', 4 => 'cuatro=', 5 => 'cinco=', 6 => 'seis=', 7 => 'siete=', 8 => 'ocho=', 9 => 'nueve=', 10 => 'diez=', 11 => 'once=', 12 => 'doce=', 13 => 'trece=', 14 => 'catorce=', 15 => 'quince=');
            for ($y = 1; $y <= 15; $y++) {
                $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida");
                if ($vxx1 != null) {
                    foreach ($vxx1 as $xx1) {
                        $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0");
                    }
                }
            }

            // generica
            for ($y = 1; $y <= 15; $y++) {
                $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica");
                if ($vxx1 != null) {
                    foreach ($vxx1 as $xx1) {
                        $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=0 and cod_sub_espec=0");
                    }
                }
            }
            // especifica
            for ($y = 1; $y <= 15; $y++) {
                $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica");
                if ($vxx1 != null) {
                    foreach ($vxx1 as $xx1) {
                        $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=0");
                    }
                }
            }
            // sub-especifica
            for ($y = 1; $y <= 15; $y++) {
                $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sector=" . $y . " GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec");
                if ($vxx1 != null) {
                    foreach ($vxx1 as $xx1) {
                        $this->cfpd05_2032_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=" . $xx1[0]['cod_sub_espec'] . "");
                    }
                }
            }

            $nna = array(1 => 'uno', 2 => 'dos', 3 => 'tres', 4 => 'cuatro', 5 => 'cinco', 6 => 'seis', 7 => 'siete', 8 => 'ocho', 9 => 'nueve', 10 => 'diez', 11 => 'once', 12 => 'doce', 13 => 'trece', 14 => 'catorce', 15 => 'quince');

            $hola = $this->cfpd05_2032_tmp->findAll($sql_s, null, "cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");
            $holav2 = $this->cfpd05_2032_tmp->findAll($sql_sv2, null, "cod_partida ASC");
            $this->set("reporte_cfpd05", $hola);
            $q1 = $this->cfpd01_ano_partida->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q2 = $this->cfpd01_ano_generica->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q3 = $this->cfpd01_ano_especifica->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $q4 = $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $Ano, null, null, null, null, null);
            $this->set('partida', $q1);
            $this->set('generica', $q2);
            $this->set('especifica', $q3);
            $this->set('subespecifica', $q4);

            if (isset($this->data['cfpp05']['forma']) && $this->data['cfpp05']['forma'] == 2) {
                $this->reporte_cfpp05_2032_v2($holav2, $q1, $q2, $q3, $q4);
                $this->render("reporte_cfpp05_2032_v2", "pdf");
            }
        }//isset
    }

//fin function

    function reporte_cfpp05_distribucion_v1($por_proyectos = null) {
        $this->layout = "pdf";
        //$this->layout="ajax";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            } else {
                $con = $this->SQLCA_report();
            }


            /*
              if(isset($this->data['cfpp05']['consolidacion'])){
              $conin=$this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
              }else{
              $conin=$this->SQLCA_report_in();
              }
             */



            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }

            $this->set('titulo_a', $titulo_a);
            /**
              $tc=$this->cfpd05_distribucion_tmp->findCount($con." and ano=".$Ano." and username='".$this->Session->read('nom_usuario')."'");

              if($tc!=0){
              $this->cfpd05_distribucion_tmp->execute("DELETE FROM cfpd05_distribucion_tmp WHERE username='".$this->Session->read('nom_usuario')."'");
              }else{

              } */
            $vector = $this->cfpd05->findAll($con . " and asignacion_anual!=0 and ano= " . $Ano, array('cod_presi', 'cod_entidad', 'cod_tipo_inst', 'cod_inst', 'cod_dep', 'ano', 'cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'cod_partida', 'cod_generica', 'cod_especifica', 'cod_sub_espec', 'cod_auxiliar', 'cod_tipo_gasto', 'tipo_presupuesto', 'asignacion_anual'), 'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
            $total_spsppa = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05 WHERE " . $con . " and asignacion_anual!=0 and ano=" . $Ano . "  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");

            $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $distinto_sector = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05 WHERE " . $con . " and asignacion_anual!=0 and ano=" . $Ano . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
            $this->set('distintos_sectores', $total_spsppa);
            $this->set('cfpd05', $vector);
            $this->set('sector', $this->cfpd02_sector->findAll($this->SQLCA($Ano), array('cod_sector', 'denominacion'), null, null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'denominacion'), null, null, null, null));
            $this->set('subprograma', $this->cfpd02_sub_prog->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'denominacion'), null, null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
            $this->set('actividad', $this->cfpd02_activ_obra->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
            $this->set('partida', $this->cfpd01_ano_partida->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('auxiliar', $this->cfpd05_auxiliar->findAll("ano=" . $Ano, null, null, null, null, null));
            //print_r($this->cfpd05_auxiliar->findAll($this->SQLCA($Ano),null,null,null, null, null));
            /* foreach($hola as $saludo){
              echo "<br>".$saludo['cfpd05_distribucion_tmp']['cod_sector']." ".$saludo['cfpd05_distribucion_tmp']['cod_programa']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_prog']." ".$saludo['cfpd05_distribucion_tmp']['cod_proyecto']." ".$saludo['cfpd05_distribucion_tmp']['cod_partida']." ".$saludo['cfpd05_distribucion_tmp']['cod_generica']." ".$saludo['cfpd05_distribucion_tmp']['cod_especifica']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_espec'];
              for($i=51;$i<=70;$i++)
              echo " [".$i."]:".$saludo['cfpd05_distribucion_tmp']['monto_actividad_'.$nna[$i]];
              } */

            // Para mostrar la vista por proyectos, solicitada por la gobernacion del estado apure.
            if ($por_proyectos == 'proyectos') {
                $this->render('reporte_cfpp05_distribucion_v1_por_proyectos');
            }
        }//isset
    }

//fin function distribucion

    function reporte_cfpp05_distribucion_v1_por_proyectos() {
        $this->layout = "pdf";
        //$this->layout="ajax";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);


            if (isset($this->data['cfpp05']['consolidacion'])) {
                $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
            } else {
                $con = $this->SQLCA_report();
            }


            /*
              if(isset($this->data['cfpp05']['consolidacion'])){
              $conin=$this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
              }else{
              $conin=$this->SQLCA_report_in();
              }
             */



            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }

            $this->set('titulo_a', $titulo_a);
            /**
              $tc=$this->cfpd05_distribucion_tmp->findCount($con." and ano=".$Ano." and username='".$this->Session->read('nom_usuario')."'");

              if($tc!=0){
              $this->cfpd05_distribucion_tmp->execute("DELETE FROM cfpd05_distribucion_tmp WHERE username='".$this->Session->read('nom_usuario')."'");
              }else{

              } */
            $vector = $this->cfpd05->findAll($con . " and asignacion_anual!=0 and ano= " . $Ano, array('cod_presi', 'cod_entidad', 'cod_tipo_inst', 'cod_inst', 'cod_dep', 'ano', 'cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'cod_partida', 'cod_generica', 'cod_especifica', 'cod_sub_espec', 'cod_auxiliar', 'cod_tipo_gasto', 'tipo_presupuesto', 'asignacion_anual'), 'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
            $total_spsppa = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05 WHERE " . $con . " and asignacion_anual!=0 and ano=" . $Ano . "  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");

            $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $distinto_sector = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05 WHERE " . $con . " and asignacion_anual!=0 and ano=" . $Ano . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
            $this->set('distintos_sectores', $total_spsppa);
            $this->set('cfpd05', $vector);
            $this->set('sector', $this->cfpd02_sector->findAll($this->SQLCA($Ano), array('cod_sector', 'denominacion'), null, null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'denominacion'), null, null, null, null));
            $this->set('subprograma', $this->cfpd02_sub_prog->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'denominacion'), null, null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
            $this->set('actividad', $this->cfpd02_activ_obra->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
            $this->set('partida', $this->cfpd01_ano_partida->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('auxiliar', $this->cfpd05_auxiliar->findAll("ano=" . $Ano, null, null, null, null, null));
            //print_r($this->cfpd05_auxiliar->findAll($this->SQLCA($Ano),null,null,null, null, null));
            /* foreach($hola as $saludo){
              echo "<br>".$saludo['cfpd05_distribucion_tmp']['cod_sector']." ".$saludo['cfpd05_distribucion_tmp']['cod_programa']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_prog']." ".$saludo['cfpd05_distribucion_tmp']['cod_proyecto']." ".$saludo['cfpd05_distribucion_tmp']['cod_partida']." ".$saludo['cfpd05_distribucion_tmp']['cod_generica']." ".$saludo['cfpd05_distribucion_tmp']['cod_especifica']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_espec'];
              for($i=51;$i<=70;$i++)
              echo " [".$i."]:".$saludo['cfpd05_distribucion_tmp']['monto_actividad_'.$nna[$i]];
              } */
        }//isset
    }

//fin function distribucion

    function reporte_cfpp05_2032_actividad() {
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));

        set_time_limit(0);
        ini_set("memory_limit", "1024M");

        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);
            $codfcpd05[1] = $this->verifica_SS(1);
            $codfcpd05[2] = $this->verifica_SS(2);
            $codfcpd05[3] = $this->verifica_SS(3);
            $codfcpd05[4] = $this->verifica_SS(4);
            $codfcpd05[5] = $this->verifica_SS(5);
            $codfcpd05[6] = $Ano;




            if (isset($this->data['cfpp05']['consolidacion'])) {
                $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);
                if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $condicion_cfpd05 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . "  and ano=" . $codfcpd05[6];
                    $condicion_cfpd052 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . "  and ano=" . $codfcpd05[6];
                } else {
                    $condicion_cfpd05 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . " and cod_dep=" . $_SESSION['cod_dep_reporte_consolidado'] . " and ano=" . $codfcpd05[6];
                    $condicion_cfpd052 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . " and cod_dep=" . $_SESSION['cod_dep_reporte_consolidado'] . " and ano=" . $codfcpd05[6];
                }
            } else {
                $condicion_cfpd05 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . " and cod_dep=" . $codfcpd05[5] . " and ano=" . $codfcpd05[6];
                $con = $this->SQLCA_report();
                $condicion_cfpd052 = "cod_presi=" . $codfcpd05[1] . " and cod_entidad=" . $codfcpd05[2] . " and cod_tipo_inst=" . $codfcpd05[3] . " and cod_inst=" . $codfcpd05[4] . " and cod_dep=" . $codfcpd05[5] . " and ano=" . $codfcpd05[6];
            }


            /*
              if(isset($this->data['cfpp05']['consolidacion'])){
              $conin=$this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
              }else{
              $conin=$this->SQLCA_report_in();
              }
             */


            $tc = $this->cfpd05_distribucion_tmp->findCount($condicion_cfpd052 . " and username='" . $this->Session->read('nom_usuario') . "'");

            if ($tc != 0) {
                $this->cfpd05_distribucion_tmp->execute("DELETE FROM cfpd05_distribucion_tmp WHERE username='" . $this->Session->read('nom_usuario') . "'");
            } else {
                
            }


            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                    $idep = "L.cod_dep,";
                    $idep2 = $_SESSION['cod_dep_reporte_consolidado'];
                    $idep3 = "and cod_dep=L.cod_dep ";
                    $modelo = "distribucion";
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                    $idep = "";
                    $idep2 = "0";
                    $idep3 = " ";
                    $modelo = "distribucion_institucional";
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
                $idep = "L.cod_dep,";
                $idep2 = $codfcpd05[5];
                $idep3 = "and cod_dep=L.cod_dep ";
                $modelo = "distribucion";
            }

            $this->set('titulo_a', $titulo_a);
            /**
              $xx=$this->cfpd05->execute("SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              ".$idep."
              L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              0 as cod_generica,
              0 as cod_especifica,
              0 as cod_sub_espec,
              0 as cod_auxiliar,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=51 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ51,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=52 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ52,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=53 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ53,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=54 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ54,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=55 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ55,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=56 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ56,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=57 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ57,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=58 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ58,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=59 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ59,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=60 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ60,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=61 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ61,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=62 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ62,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=63 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ63,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=64 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ64,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=65 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ65,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=66 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ66,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=67 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ67,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=68 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ68,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=69 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ69,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=70 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida ) as activ70
              FROM cfpd05 L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,".$idep."L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida
              UNION
              SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              ".$idep."L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              L.cod_generica,
              0 as cod_especifica,
              0 as cod_sub_espec,
              0 as cod_auxiliar,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=51 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ51,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=52 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ52,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=53 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ53,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=54 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ54,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=55 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ55,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=56 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ56,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=57 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ57,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=58 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ58,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=59 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ59,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=60 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ60,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=61 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ61,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=62 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ62,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=63 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ63,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=64 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ64,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=65 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ65,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=66 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ66,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=67 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ67,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=68 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ68,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=69 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ69,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=70 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica) as activ70
              FROM cfpd05 L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,".$idep."L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida,L.cod_generica
              UNION
              SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              ".$idep."L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              L.cod_generica,
              L.cod_especifica,
              0 as cod_sub_espec,
              0 as cod_auxiliar,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=51 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ51,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=52 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ52,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=53 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ53,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=54 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ54,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=55 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ55,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=56 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ56,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=57 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ57,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=58 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ58,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=59 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ59,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=60 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ60,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=61 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ61,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=62 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ62,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=63 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ63,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=64 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ64,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=65 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ65,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=66 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ66,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=67 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ67,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=68 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ68,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=69 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ69,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=70 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica) as activ70
              FROM cfpd05 L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,".$idep."L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida,L.cod_generica,L.cod_especifica
              UNION
              SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              ".$idep."L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              L.cod_generica,
              L.cod_especifica,
              L.cod_sub_espec,
              0 as cod_auxiliar,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=51 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ51,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=52 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ52,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=53 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ53,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=54 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ54,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=55 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ55,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=56 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ56,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=57 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ57,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=58 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ58,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=59 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ59,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=60 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ60,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=61 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ61,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=62 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ62,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=63 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ63,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=64 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ64,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=65 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ65,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=66 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ66,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=67 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ67,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=68 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ68,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=69 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ69,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=70 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec) as activ70
              FROM cfpd05 L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,".$idep."L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida,L.cod_generica,L.cod_especifica,L.cod_sub_espec
              UNION
              SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              ".$idep."L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              L.cod_generica,
              L.cod_especifica,
              L.cod_sub_espec,
              L.cod_auxiliar,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=51 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ51,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=52 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ52,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=53 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ53,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=54 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ54,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=55 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ55,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=56 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ56,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=57 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ57,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=58 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ58,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=59 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ59,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=60 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ60,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=61 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ61,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=62 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ62,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=63 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ63,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=64 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ64,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=65 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ65,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=66 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ66,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=67 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ67,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=68 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ68,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=69 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ69,
              (select SUM(asignacion_anual) from cfpd05 where cod_activ_obra=70 and cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  ".$idep3." and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ70
              FROM cfpd05 L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,".$idep."L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida,L.cod_generica,L.cod_especifica,L.cod_sub_espec,L.cod_auxiliar;
              ");
              $xx=$this->distribucion->execute("SELECT L.cod_presi,
              L.cod_entidad,
              L.cod_tipo_inst,
              L.cod_inst,
              L.cod_dep,L.ano,
              L.cod_sector,
              L.cod_programa,
              L.cod_sub_prog,
              L.cod_proyecto,
              L.cod_partida,
              L.cod_generica,
              L.cod_especifica,
              L.cod_sub_espec,
              L.cod_auxiliar,
              (select SUM(activ51) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ51,
              (select SUM(activ52) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ52,
              (select SUM(activ53) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ53,
              (select SUM(activ54) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ54,
              (select SUM(activ55) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ55,
              (select SUM(activ56) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ56,
              (select SUM(activ57) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ57,
              (select SUM(activ58) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ58,
              (select SUM(activ59) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ59,
              (select SUM(activ60) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ60,
              (select SUM(activ61) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ61,
              (select SUM(activ62) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ62,
              (select SUM(activ63) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ63,
              (select SUM(activ64) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ64,
              (select SUM(activ65) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ65,
              (select SUM(activ66) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ66,
              (select SUM(activ67) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ67,
              (select SUM(activ68) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ68,
              (select SUM(activ69) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ69,
              (select SUM(activ70) from v_distribucion where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst  and cod_dep=L.cod_dep and ano=L.ano and cod_sector=L.cod_sector and cod_programa=L.cod_programa and cod_sub_prog=L.cod_sub_prog and cod_proyecto=L.cod_proyecto and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec and cod_auxiliar=L.cod_auxiliar) as activ70
              FROM v_distribucion L WHERE ".$condicion_cfpd05." group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.cod_dep,L.ano,L.cod_sector,L.cod_programa,L.cod_sub_prog,L.cod_proyecto,L.cod_partida,L.cod_generica,L.cod_especifica,L.cod_sub_espec,L.cod_auxiliar ");
             */
            //$agrupar=" GROUP BY cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,ano,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar";//",activ51,activ52,activ53,activ54,activ55,activ56,activ57,activ58,activ59,activ60";
            $this->set('MODELO', $modelo);
            $xx = $this->$modelo->findAll($condicion_cfpd05, null, 'cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC', null, null, null);
            /*
              $campos="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep, username , ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, cod_obra, monto_obra, activ51, activ52, activ53, activ54, activ55, activ56, activ57, activ58, activ59, activ60, activ61, activ62, activ63, activ64, activ65, activ66, activ67, activ68, activ69, activ70, total)";
              foreach($xx as $yy){
              ".$yy['distribucion']['cod_presi'].";
              $co="cod_presi=".$yy['distribucion']['cod_presi']." and cod_entidad=".$yy['distribucion']['cod_entidad']." and cod_tipo_inst= and cod_inst= and cod_dep= and username= and ano= and cod_sector= and cod_programa= and cod_sub_prog= and cod_proyecto= and cod_partida= and cod_generica= and cod_especifica= and  cod_sub_espec= and  cod_auxiliar=";
              $values;
              }
             */
            //print_r($xx);
            $this->set("reporte_cfpd05_tmp_activ", $xx);
            $totalf = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto FROM cfpd05 WHERE " . $condicion_cfpd052 . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto ASC");
            $this->set("distintos_sectores", $totalf);
            $this->set('sector', $this->cfpd02_sector->findAll($this->SQLCA($Ano), array('cod_sector', 'denominacion'), 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'denominacion'), 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprograma', $this->cfpd02_sub_prog->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'denominacion', 'unidad_ejecutora'), 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'denominacion'), 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC', null, null, null));
            $this->set('actividad', $this->cfpd02_activ_obra->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'denominacion'), 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra ASC', null, null, null));
            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $Ano, array('cod_grupo', 'cod_partida', 'denominacion'), 'cod_grupo,cod_partida ASC', null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('ejercicio=' . $Ano, array('cod_grupo', 'cod_partida', 'cod_generica', 'denominacion'), 'cod_grupo,cod_partida, cod_generica ASC', null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $Ano, array('cod_grupo', 'cod_partida', 'cod_generica', 'cod_especifica', 'denominacion'), 'cod_grupo,cod_partida, cod_generica,cod_especifica ASC', null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $Ano, array('cod_grupo', 'cod_partida', 'cod_generica', 'cod_especifica', 'cod_sub_espec', 'denominacion'), 'cod_grupo,cod_partida, cod_generica,cod_especifica,cod_sub_espec ASC', null, null, null));
            $this->set('auxiliar', $this->cfpd05_auxiliar->findAll('ano=' . $Ano, null, null, null, null, null));
        }//isset
    }

//fin function distribucion

    function reporte_cfpp05_2032_actividad_copia() {
        $this->layout = "pdf";
        //$this->layout="ajax";

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        if (isset($this->data)) {
            $Ano = $this->data['cfpp05']['ano'];
            $this->set('ANO', $Ano);
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $con = $this->SQLCA_report($this->data['cfpp05']['consolidacion']);
            } else {
                $con = $this->SQLCA_report();
            }

            if (isset($this->data['cfpp05']['consolidacion'])) {
                $conin = $this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
            } else {
                $conin = $this->SQLCA_report_in();
            }
            $tc = $this->cfpd05_distribucion_tmp->findCount($con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "'");

            if ($tc != 0) {
                $this->cfpd05_distribucion_tmp->execute("DELETE FROM cfpd05_distribucion_tmp WHERE username='" . $this->Session->read('nom_usuario') . "'");
            } else {
                
            }
            $vector = $this->cfpd05->findAll($con);
            //$vector = $this->cfpd05->execute("");
            for ($g = 1; $g <= 15; $g++) {
                $sector[$g] = 0;
            }
            $sqlin = "INSERT INTO cfpd05_distribucion_tmp (cod_presi,cod_entidad,cod_tipo_inst,cod_inst,cod_dep,username,ano,cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_obra,monto_obra,monto_actividad_51,monto_actividad_52,monto_actividad_53,monto_actividad_54,monto_actividad_55,monto_actividad_56,monto_actividad_57,monto_actividad_58,monto_actividad_59,monto_actividad_60,monto_actividad_61,monto_actividad_62,monto_actividad_63,monto_actividad_64,monto_actividad_65,monto_actividad_66,monto_actividad_67,monto_actividad_68,monto_actividad_69,monto_actividad_70,total) ";
            $sqlin .=" VALUES (" . $conin . ",'" . $this->Session->read('nom_usuario') . "'," . $Ano . ",";

            $sqlup = "UPDATE cfpd05_distribucion_tmp SET monto_actividad_";
            $sqlup2 = " WHERE " . $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";


            $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";

            //$distinto_partida = $this->cfpd05->execute("SELECT DISTINCT cod_partida, count(DISTINCT cod_partida) FROM cfpd05 WHERE ".$con);
            //$distinto_sector = $this->cfpd05->execute("SELECT DISTINCT cod_sector,cod_programa,cod_sub_prog,cod_proyecto FROM cfpd05 WHERE ".$con." GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto");
            $distinto_sector = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto");
            for ($d = 0; $d < count($distinto_sector); $d++) {//1
                $j[1] = $distinto_sector[$d][0]['cod_sector'];
                $j[2] = $distinto_sector[$d][0]['cod_programa'];
                $j[3] = $distinto_sector[$d][0]['cod_sub_prog'];
                $j[4] = $distinto_sector[$d][0]['cod_proyecto'];
                //echo "<hr>".$d."sec:".$j[1]." prog:".$j[2]." sprog:".$j[3]." proy:".$j[4];
                //$sqlin_a= $sqlin.$jcs.",0,0,0,0,0,0,0,"."0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                $distinto_partida = $this->cfpd05->execute("SELECT DISTINCT cod_partida FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4] . " GROUP BY cod_partida");
                for ($i = 0; $i < count($distinto_partida); $i++) {//a
                    $cd = $distinto_partida[$i][0]['cod_partida'];
                    //echo "<br>HOLA".$cd;
                    $sqlin_1 = $sqlin . $j[1] . "," . $j[2] . "," . $j[3] . "," . $j[4] . "," . $cd . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                    $this->cfpd05_distribucion_tmp->execute($sqlin_1);
                    $distinto_generica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_partida=" . $cd . " and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4] . " GROUP BY cod_partida,cod_generica");
                    foreach ($distinto_generica as $ds) {//b
                        $cp = $ds[0]['cod_partida'];
                        $cg = $ds[0]['cod_generica'];
                        // echo "<br>".$cp." ".$cg;
                        $sqlin_2 = $sqlin . $j[1] . "," . $j[2] . "," . $j[3] . "," . $j[4] . "," . $cp . "," . $cg . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                        $this->cfpd05_distribucion_tmp->execute($sqlin_2);
                        $distinto_especifica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_partida=" . $cp . " and cod_generica=" . $cg . " and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4] . " GROUP BY cod_partida,cod_generica,cod_especifica");
                        foreach ($distinto_especifica as $de) {//c
                            $cpp = $de[0]['cod_partida'];
                            $cgg = $de[0]['cod_generica'];
                            $ce = $de[0]['cod_especifica'];
                            //echo "<br>".$cpp." "." ".$cgg." ".$ce;
                            $sqlin_3 = $sqlin . $j[1] . "," . $j[2] . "," . $j[3] . "," . $j[4] . "," . $cpp . "," . $cgg . "," . $ce . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                            $this->cfpd05_distribucion_tmp->execute($sqlin_3);
                            $distinto_sub_espe = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica,cod_sub_espec FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_partida=" . $cpp . " and cod_generica=" . $cgg . " and cod_especifica=" . $ce . " and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4] . " GROUP BY cod_partida,cod_generica,cod_especifica,cod_sub_espec");
                            foreach ($distinto_sub_espe as $dse) {//d
                                $cppp = $dse[0]['cod_partida'];
                                $cggg = $dse[0]['cod_generica'];
                                $cee = $dse[0]['cod_especifica'];
                                $cse = $dse[0]['cod_sub_espec'];
                                //echo "<br>".$cppp." ".$cggg." ".$cee." ".$cse;
                                $sqlin_4 = $sqlin . $j[1] . "," . $j[2] . "," . $j[3] . "," . $j[4] . "," . $cppp . "," . $cggg . "," . $cee . "," . $cse . ",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
                                $this->cfpd05_distribucion_tmp->execute($sqlin_4);
                            }//d
                        }//c
                    }//b
                }//a
            }//1
            ///
            for ($d = 0; $d < count($distinto_sector); $d++) {//1
                $j[1] = $distinto_sector[$d][0]['cod_sector'];
                $j[2] = $distinto_sector[$d][0]['cod_programa'];
                $j[3] = $distinto_sector[$d][0]['cod_sub_prog'];
                $j[4] = $distinto_sector[$d][0]['cod_proyecto'];
                ///partidas
                $nn = array(51 => '51=', 52 => '52=', 53 => '53=', 54 => '54=', 55 => '55=', 56 => '56=', 57 => '57=', 58 => '58=', 59 => '59=', 60 => '60=', 61 => '61=', 62 => '62=', 63 => '63=', 64 => '64=', 65 => '65=', 66 => '66=', 67 => '67=', 68 => '68=', 69 => '69=', 70 => '70=');
                for ($y = 51; $y <= 70; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_activ_obra=" . $y . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_distribucion_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0 and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4]);
                        }
                    }
                }
                //
                ///generica
                for ($y = 51; $y <= 70; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_activ_obra=" . $y . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_distribucion_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=0 and cod_sub_espec=0 and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4]);
                        }
                    }
                }
                ///especifica
                for ($y = 51; $y <= 70; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_activ_obra=" . $y . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_distribucion_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=0 and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4]);
                        }
                    }
                }
                ///sub-especifica
                for ($y = 51; $y <= 70; $y++) {
                    $vxx1 = $this->cfpd05->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec, SUM(asignacion_anual) as ts FROM cfpd05 WHERE " . $con . " and ano= " . $Ano . " and cod_activ_obra=" . $y . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra,cod_partida,cod_generica,cod_especifica,cod_sub_espec");
                    if ($vxx1 != null) {
                        foreach ($vxx1 as $xx1) {
                            $this->cfpd05_distribucion_tmp->execute($sqlup . $nn[$y] . $xx1[0]['ts'] . $sqlup2 . " and cod_partida=" . $xx1[0]['cod_partida'] . "  and cod_generica=" . $xx1[0]['cod_generica'] . " and cod_especifica=" . $xx1[0]['cod_especifica'] . " and cod_sub_espec=" . $xx1[0]['cod_sub_espec'] . " and cod_sector=" . $j[1] . " and cod_programa=" . $j[2] . " and cod_sub_prog=" . $j[3] . " and cod_proyecto=" . $j[4]);
                        }
                    }
                }
            }//fin for de los sectores_programa_sub.....
            /**
             * ciclos para inicializar todos los registros de las partidas en cero
              for($i=0;$i<count($distinto_partida);$i++){//a
              $cd=$distinto_partida[$i][0]['cod_partida'];
              $sqlin_1 = $sqlin.$cd.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
              $this->cfpd05_2032_tmp->execute($sqlin_1);
              $distinto_generica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica FROM cfpd05 WHERE ".$con."and cod_partida=".$cd." GROUP BY cod_partida,cod_generica");
              foreach($distinto_generica as $ds){//b
              $cp=$ds[0]['cod_partida'];
              $cg=$ds[0]['cod_generica'];
              $sqlin_2 = $sqlin.$cp.",".$cg.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
              $this->cfpd05_2032_tmp->execute($sqlin_2);
              $distinto_especifica = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica FROM cfpd05 WHERE ".$con."and cod_partida=".$cp." and cod_generica=".$cg." GROUP BY cod_partida,cod_generica,cod_especifica");
              foreach($distinto_especifica as $de){//c
              $cpp=$de[0]['cod_partida'];
              $cgg=$de[0]['cod_generica'];
              $ce=$de[0]['cod_especifica'];
              $sqlin_3 = $sqlin.$cpp.",".$cgg.",".$ce.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
              $this->cfpd05_2032_tmp->execute($sqlin_3);
              $distinto_sub_espe = $this->cfpd05->execute("SELECT DISTINCT cod_partida,cod_generica,cod_especifica,cod_sub_espec FROM cfpd05 WHERE ".$con."and cod_partida=".$cpp." and cod_generica=".$cgg." and cod_especifica=".$ce." GROUP BY cod_partida,cod_generica,cod_especifica,cod_sub_espec");
              foreach($distinto_sub_espe as $dse){//d
              $cppp=$dse[0]['cod_partida'];
              $cggg=$dse[0]['cod_generica'];
              $cee=$dse[0]['cod_especifica'];
              $cse=$dse[0]['cod_sub_espec'];
              $sqlin_4 = $sqlin.$cppp.",".$cggg.",".$cee.",".$cse.",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
              $this->cfpd05_2032_tmp->execute($sqlin_4);
              }//d
              }//c
              }//b
              }//a
              //fin de los ciclos
             */
            /**
              ///
              ///partidas
              $nn=array(1=>'uno=',2=>'dos=',3=>'tres=',4=>'cuatro=',5=>'cinco=',6=>'seis=',7=>'siete=',8=>'ocho=',9=>'nueve=',10=>'diez=',11=>'once=',12=>'doce=',13=>'trece=',14=>'catorce=',15=>'quince=');
              for($y=1;$y<=15;$y++){
              $vxx1= $this->cfpd05->execute("SELECT cod_sector,cod_partida, SUM(asignacion_anual) as ts FROM cfpd05 WHERE ".$con." and cod_sector=".$y." GROUP BY cod_sector,cod_partida");
              if($vxx1!=null){
              foreach($vxx1 as $xx1){
              $this->cfpd05_2032_tmp->execute($sqlup.$nn[$y].$xx1[0]['ts'].$sqlup2." and cod_partida=".$xx1[0]['cod_partida']."  and cod_generica=0 and cod_especifica=0 and cod_sub_espec=0");
              }
              }
              }
              //
              ///generica
              for($y=1;$y<=15;$y++){
              $vxx1= $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE ".$con." and cod_sector=".$y." GROUP BY cod_sector,cod_partida,cod_generica");
              if($vxx1!=null){
              foreach($vxx1 as $xx1){
              $this->cfpd05_2032_tmp->execute($sqlup.$nn[$y].$xx1[0]['ts'].$sqlup2." and cod_partida=".$xx1[0]['cod_partida']."  and cod_generica=".$xx1[0]['cod_generica']." and cod_especifica=0 and cod_sub_espec=0");
              }
              }
              }
              ///especifica
              for($y=1;$y<=15;$y++){
              $vxx1= $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica, SUM(asignacion_anual) as ts FROM cfpd05 WHERE ".$con." and cod_sector=".$y." GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica");
              if($vxx1!=null){
              foreach($vxx1 as $xx1){
              $this->cfpd05_2032_tmp->execute($sqlup.$nn[$y].$xx1[0]['ts'].$sqlup2." and cod_partida=".$xx1[0]['cod_partida']."  and cod_generica=".$xx1[0]['cod_generica']." and cod_especifica=".$xx1[0]['cod_especifica']." and cod_sub_espec=0");
              }
              }
              }
              ///sub-especifica
              for($y=1;$y<=15;$y++){
              $vxx1= $this->cfpd05->execute("SELECT cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec, SUM(asignacion_anual) as ts FROM cfpd05 WHERE ".$con." and cod_sector=".$y." GROUP BY cod_sector,cod_partida,cod_generica,cod_especifica,cod_sub_espec");
              if($vxx1!=null){
              foreach($vxx1 as $xx1){
              $this->cfpd05_2032_tmp->execute($sqlup.$nn[$y].$xx1[0]['ts'].$sqlup2." and cod_partida=".$xx1[0]['cod_partida']."  and cod_generica=".$xx1[0]['cod_generica']." and cod_especifica=".$xx1[0]['cod_especifica']." and cod_sub_espec=".$xx1[0]['cod_sub_espec']."");
              }
              }
              } */
            $nna = array(51 => '51', 52 => '52', 53 => '53', 54 => '54', 55 => '55', 56 => '56', 57 => '57', 58 => '58', 59 => '59', 60 => '60', 61 => '61', 62 => '62', 63 => '63', 64 => '64', 65 => '65', 66 => '66', 67 => '67', 68 => '68', 69 => '69', 70 => '70');
            $condicion_delete = "delete from cfpd05_distribucion_tmp where username='" . $this->Session->read('nom_usuario') . "' and monto_actividad_51=0.00 and monto_actividad_52=0.00 and monto_actividad_53=0.00 and monto_actividad_54=0.00 and monto_actividad_55=0.00 and monto_actividad_56=0.00 and monto_actividad_57=0.00 and monto_actividad_58=0.00 and monto_actividad_59=0.00 and monto_actividad_60=0.00 and monto_actividad_61=0.00 and monto_actividad_62=0.00 and monto_actividad_63=0.00 and monto_actividad_64=0.00 and monto_actividad_65=0.00 and monto_actividad_66=0.00 and monto_actividad_67=0.00 and monto_actividad_68=0.00 and monto_actividad_69=0.00 and monto_actividad_70=0.00";
            $this->cfpd05_distribucion_tmp->execute($condicion_delete);
            $hola = $this->cfpd05_distribucion_tmp->findAll($sql_s, null, "cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_partida,cod_generica,cod_especifica,cod_sub_espec ASC");
            $this->set("reporte_cfpd05_tmp_activ", $hola);
            $totalf = $this->cfpd05_distribucion_tmp->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto FROM cfpd05_distribucion_tmp WHERE " . $con . " and ano= " . $Ano . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto    ");
            //0 print_r($totalf);
            $this->set("distintos_sectores", $totalf);
            $this->set('sector', $this->cfpd02_sector->findAll($this->SQLCA($Ano), array('cod_sector', 'denominacion'), null, null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->SQLCA($Ano), array('cod_programa', 'denominacion'), null, null, null, null));
            $this->set('subprograma', $this->cfpd02_sub_prog->findAll($this->SQLCA($Ano), array('cod_sub_prog', 'denominacion'), null, null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($this->SQLCA($Ano), array('cod_proyecto', 'denominacion'), null, null, null, null));
            $this->set('actividad', $this->cfpd02_activ_obra->findAll($this->SQLCA($Ano), array('cod_activ_obra', 'denominacion'), null, null, null, null));
            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $Ano, null, null, null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $Ano, null, null, null, null, null));
            //$this->set('auxiliar',$this->cfpd01_ano_auxiliar->findAll('ejercicio='.$Ano,null,null,null, null, null));
            /* foreach($hola as $saludo){
              echo "<br>".$saludo['cfpd05_distribucion_tmp']['cod_sector']." ".$saludo['cfpd05_distribucion_tmp']['cod_programa']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_prog']." ".$saludo['cfpd05_distribucion_tmp']['cod_proyecto']." ".$saludo['cfpd05_distribucion_tmp']['cod_partida']." ".$saludo['cfpd05_distribucion_tmp']['cod_generica']." ".$saludo['cfpd05_distribucion_tmp']['cod_especifica']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_espec'];
              for($i=51;$i<=70;$i++)
              echo " [".$i."]:".$saludo['cfpd05_distribucion_tmp']['monto_actividad_'.$nna[$i]];
              } */
        }//isset
    }

//fin function distribucion

    function reporte_cfpd05_2010($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;



            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('generica', $this->cfpd01_ano_generica->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('ejercicio=' . $ejercicio, null, null, null, null, null));
            $this->set('auxiliar', $this->cfpd05_auxiliar->findAll('ano=' . $ejercicio . '', null, null, null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC', null, null);
            $this->set('datos', $DATOS_res);

            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp02_2011($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp02']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep . " and ano=" . $ano;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep . " and ano=" . $ano;
                $titulo_a = $this->Session->read('dependencia');
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            //$sector=$this->cfpd02_sector->findAll($condicion,null,'cod_sector ASC');
            $sector = $this->cfpd02_sector->findAll($sql, null, 'cod_sector ASC');
            $this->set('sector', $sector);
            $this->set('titulo_a', $titulo_a);
        }//fin condicion
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp02_2012($year = null) {

        $sql = '';
        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }
            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp02']['ano'];
            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            }
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep . " and ano=" . $ano;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep . " and ano=" . $ano;
                $titulo_a = $this->Session->read('dependencia');
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
            $this->set('sector', $sector);

            $programa = $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC');
            $this->set('programa', $programa);

            $this->set('titulo_a', $titulo_a);
        }//fin condicion

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpp02_2018($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp02']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp02']['consolidacion'])) {
                $consolidado = $this->data['cfpp02']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;



            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $_SESSION['cod_dep_reporte_consolidado'];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                }
            } else {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia');
            }




            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
            $this->set('sector', $sector);

            $programa = $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC');
            $this->set('programa', $programa);

            $this->set('subprograma', $this->cfpd02_sub_prog->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto  ASC', null, null, null));


            $this->set('titulo_a', $titulo_a);
        }//fin condicion
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function reporte_cfpd05_requerimiento_especiales() {


        if (!isset($this->data)) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $Cpresi = $this->verifica_SS(1);
            $Centidad = $this->verifica_SS(2);
            $Ctipo_inst = $this->verifica_SS(3);
            $Cinst = $this->verifica_SS(4);
            $ano = $this->cfpd01_formulacion->field('ano_formular', 'cod_presi=' . $Cpresi . ' and cod_entidad=' . $Centidad . ' and cod_tipo_inst=' . $Ctipo_inst . ' and cod_inst=' . $Cinst, 'ano_formular ASC');
            //echo "el ano es: ".$ano;
            $this->set('ano', $ano);
            $this->set('acepta', 'no');
        } else {


            $this->layout = "pdf";
            $this->set('acepta', 'si');
            //$this->layout="ajax";
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            if (isset($this->data)) {
                $Ano = $this->data['cfpp05']['ano'];
                $this->set('ANO', $Ano);




                if (isset($this->data['cfpp05']['consolidacion'])) {
                    $con = $this->SQLCA_consolidado($this->data['cfpp05']['consolidacion']);

                    if ($this->data['cfpp05']['consolidacion'] == 2) {
                        $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                    } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                        $titulo_a = $this->Session->read('dependencia');
                    }
                } else {

                    $con = $this->SQLCA_report();
                    $titulo_a = $this->Session->read('dependencia');
                }


                /*

                  if(isset($this->data['cfpp05']['consolidacion'])){
                  $conin=$this->SQLCA_report_in($this->data['cfpp05']['consolidacion']);
                  }else{
                  $conin=$this->SQLCA_report_in();
                  }
                 */






                $this->set('titulo_a', $titulo_a);
                /**
                  $tc=$this->cfpd05_distribucion_tmp->findCount($con." and ano=".$Ano." and username='".$this->Session->read('nom_usuario')."'");

                  if($tc!=0){
                  $this->cfpd05_distribucion_tmp->execute("DELETE FROM cfpd05_distribucion_tmp WHERE username='".$this->Session->read('nom_usuario')."'");
                  }else{

                  } */
                $vector = $this->cfpd05_requerimiento->findAll($con . " and ano=" . $Ano, array('cod_presi', 'cod_entidad', 'cod_tipo_inst', 'cod_inst', 'cod_dep', 'ano', 'cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'cod_partida', 'cod_generica', 'cod_especifica', 'cod_sub_espec', 'cod_auxiliar', 'cod_tipo_gasto', 'tipo_presupuesto', 'asignacion_anual'), 'cod_partida,cod_generica,cod_especifica,cod_sub_espec,cod_auxiliar ASC');
                $total_spsppa = $this->cfpd05_requerimiento->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05_requerimiento WHERE " . $con . "  GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra  ORDER BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra ASC");

                $sql_s = $con . " and ano=" . $Ano . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $distinto_sector = $this->cfpd05_requerimiento->execute("SELECT cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra FROM cfpd05_requerimiento WHERE " . $con . " and ano=" . $Ano . " GROUP BY cod_sector,cod_programa,cod_sub_prog,cod_proyecto,cod_activ_obra");
                $this->set('distintos_sectores', $total_spsppa);
                $this->set('cfpd05', $vector);
                $this->set('sector', $this->cfpd02_sector->findAll($this->SQLCA($Ano), array('cod_sector', 'denominacion'), null, null, null, null));
                $this->set('programa', $this->cfpd02_programa->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'denominacion'), null, null, null, null));
                $this->set('subprograma', $this->cfpd02_sub_prog->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'denominacion'), null, null, null, null));
                $this->set('proyecto', $this->cfpd02_proyecto->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
                $this->set('actividad', $this->cfpd02_activ_obra->findAll($this->SQLCA($Ano), array('cod_sector', 'cod_programa', 'cod_sub_prog', 'cod_proyecto', 'cod_activ_obra', 'denominacion', 'unidad_ejecutora'), null, null, null, null));
                $this->set('partida', $this->cfpd01_ano_partida->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('generica', $this->cfpd01_ano_generica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('especifica', $this->cfpd01_ano_especifica->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('subespecifica', $this->cfpd01_ano_sub_espec->findAll('cod_grupo=' . CE . ' and ejercicio=' . $Ano, null, null, null, null, null));
                $this->set('auxiliar', $this->cfpd05_auxiliar->findAll($this->SQLCA($Ano), null, null, null, null, null));
                //print_r($this->cfpd05_auxiliar->findAll($this->SQLCA($Ano),null,null,null, null, null));
                /* foreach($hola as $saludo){
                  echo "<br>".$saludo['cfpd05_distribucion_tmp']['cod_sector']." ".$saludo['cfpd05_distribucion_tmp']['cod_programa']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_prog']." ".$saludo['cfpd05_distribucion_tmp']['cod_proyecto']." ".$saludo['cfpd05_distribucion_tmp']['cod_partida']." ".$saludo['cfpd05_distribucion_tmp']['cod_generica']." ".$saludo['cfpd05_distribucion_tmp']['cod_especifica']." ".$saludo['cfpd05_distribucion_tmp']['cod_sub_espec'];
                  for($i=51;$i<=70;$i++)
                  echo " [".$i."]:".$saludo['cfpd05_distribucion_tmp']['monto_actividad_'.$nna[$i]];
                  } */
            }//isset
        }//fin else
    }

//fin function

    function reporte_clasificador() {

        $this->layout = 'pdf';
        set_time_limit(0);

        $grupo = $this->cfpd01_grupo->findAll(null, null, 'cod_grupo ASC', null, null, null);
        $partida = $this->cfpd01_partida->findAll(null, null, 'cod_partida ASC', null, null, null);
        $generica = $this->cfpd01_generica->findAll(null, null, 'cod_generica ASC', null, null, null);
        $especifica = $this->cfpd01_especifica->findAll(null, null, 'cod_especifica ASC', null, null, null);
        $subespecifica = $this->cfpd01_sub_espec->findAll(null, null, 'cod_sub_espec ASC', null, null, null);
        $auxiliar = $this->cfpd01_auxiliar->findAll(null, null, 'cod_auxiliar ASC', null, null, null);





        $grupo_ver = '';
        $partida_ver = '';
        $generica_ver = '';
        $especifica_ver = '';
        $subespecifica_ver = '';
        $auxiliar_ver = '';


        $grupo_ver_aux = '';
        $partida_ver_aux = '';
        $generica_ver_aux = '';
        $especifica_ver_aux = '';
        $subespecifica_ver_aux = '';
        $auxiliar_ver_aux = '';




        $consulta = '';
        $index = 0;


        $i = 0;
        $j = 0;
        $k = 0;
        $l = 0;
        $n = 0;
        $o = 0;


        foreach ($grupo as $row) {
            $i++;

            $grupo_ver[$i] = $row['cfpd01_grupo']['cod_grupo'];

            $grupo_ver_aux[$i] = $row['cfpd01_grupo']['cod_grupo'];


            $grupo_descripcion[$i] = $row['cfpd01_grupo']['descripcion'];
            $grupo_concepto[$i] = $row['cfpd01_grupo']['concepto'];
        }



        foreach ($partida as $row) {
            $j++;

            $partida_ver[$j] = $row['cfpd01_partida']['cod_grupo'] . "." . $this->add_c_c($row['cfpd01_partida']['cod_partida']);

            $partida_ver_aux[$j] = $this->add_c_c($row['cfpd01_partida']['cod_partida']);

            $partida_descripcion[$j] = $row['cfpd01_partida']['descripcion'];
            $partida_concepto[$j] = $row['cfpd01_partida']['concepto'];
        }

        foreach ($generica as $row) {
            $k++;

            $generica_ver[$k] = $row['cfpd01_generica']['cod_grupo'] . "." . $this->add_c_c($row['cfpd01_generica']['cod_partida']) . "." . $this->add_c_c($row['cfpd01_generica']['cod_generica']);

            $generica_ver_aux[$k] = $this->add_c_c($row['cfpd01_generica']['cod_generica']);

            $generica_descripcion[$k] = $row['cfpd01_generica']['descripcion'];
            $generica_concepto[$k] = $row['cfpd01_generica']['concepto'];
        }


        foreach ($especifica as $row) {
            $l++;

            $especifica_ver [$l] = $row['cfpd01_especifica']['cod_grupo'] . "." . $this->add_c_c($row['cfpd01_especifica']['cod_partida']) . "." . $this->add_c_c($row['cfpd01_especifica']['cod_generica']) . "." . $this->add_c_c($row['cfpd01_especifica']['cod_especifica']);

            $especifica_ver_aux[$l] = $this->add_c_c($row['cfpd01_especifica']['cod_especifica']);

            $especifica_descripcion[$l] = $row['cfpd01_especifica']['descripcion'];
            $especifica_concepto[$l] = $row['cfpd01_especifica']['concepto'];
        }


        foreach ($subespecifica as $row) {
            $n++;


            $subespecifica_ver[$n] = $row['cfpd01_sub_espec']['cod_grupo'] . "." . $this->add_c_c($row['cfpd01_sub_espec']['cod_partida']) . "." . $this->add_c_c($row['cfpd01_sub_espec']['cod_generica']) . "." . $this->add_c_c($row['cfpd01_sub_espec']['cod_especifica']) . "." . $this->add_c_c($row['cfpd01_sub_espec']['cod_sub_espec']);

            $subespecifica_ver_aux[$n] = $this->add_c_c($row['cfpd01_sub_espec']['cod_sub_espec']);

            $subespecifica_descripcion[$n] = $row['cfpd01_sub_espec']['descripcion'];
            $subespecifica_concepto[$n] = $row['cfpd01_sub_espec']['concepto'];
        }



        foreach ($auxiliar as $row) {
            $o++;

            $auxiliar_ver[$o] = $row['cfpd01_auxiliar']['cod_grupo'] . "." . $this->add_c_c($row['cfpd01_auxiliar']['cod_partida']) . "." . $this->add_c_c($row['cfpd01_auxiliar']['cod_generica']) . "." . $this->add_c_c($row['cfpd01_auxiliar']['cod_especifica']) . "." . $this->add_c_c($row['cfpd01_auxiliar']['cod_sub_espec']) . "." . $this->add_c_c($row['cfpd01_auxiliar']['cod_auxiliar']);

            $auxiliar_ver_aux[$o] = $this->add_c_c($row['cfpd01_auxiliar']['cod_auxiliar']);

            $auxiliar_descripcion[$o] = $row['cfpd01_auxiliar']['descripcion'];
            $auxiliar_concepto[$o] = $row['cfpd01_auxiliar']['concepto'];
        }




        for ($a = 1; $a <= $i; $a++) {

            if ($grupo_ver[$a] != '') {

                $index++;
                $consulta[$index]['codigo'] = $grupo_ver[$a] . '.00.00.00.00.00';
                $consulta[$index]['descripcion'] = $grupo_descripcion[$a];
                $consulta[$index]['concepto'] = $grupo_concepto[$a];
            }//fin if

            $grupo_ver[$a] = '';





            for ($b = 1; $b <= $j; $b++) {

                $aux = $grupo_ver_aux[$a] . '.' . $partida_ver_aux[$b];

                if ($aux == $partida_ver[$b]) {

                    if ($partida_ver[$b] != '') {

                        $index++;
                        $consulta[$index]['codigo'] = $partida_ver[$b] . '.00.00.00.00';
                        $consulta[$index]['descripcion'] = $partida_descripcion[$b];
                        $consulta[$index]['concepto'] = $partida_concepto[$b];
                    }//fin if


                    $partida_ver[$b] = '';
                    break;
                }


                for ($c = 1; $c <= $k; $c++) {


                    $aux = $grupo_ver_aux[$a] . '.' . $partida_ver_aux[$b] . '.' . $generica_ver_aux[$c];

                    if ($aux == $generica_ver[$c]) {

                        if ($generica_ver[$c] != '') {

                            $index++;
                            $consulta[$index]['codigo'] = $generica_ver[$c] . '.00.00.00';
                            $consulta[$index]['descripcion'] = $generica_descripcion[$c];
                            $consulta[$index]['concepto'] = $generica_concepto[$c];
                        }//fin if

                        $generica_ver[$c] = '';
                        break;
                    }


                    for ($d = 1; $d <= $l; $d++) {

                        $aux = $grupo_ver_aux[$a] . '.' . $partida_ver_aux[$b] . '.' . $generica_ver_aux[$c] . '.' . $especifica_ver_aux[$d];

                        if ($aux == $especifica_ver[$d]) {

                            if ($especifica_ver[$d] != '') {

                                $index++;
                                $consulta[$index]['codigo'] = $especifica_ver[$d] . '.00.00';
                                $consulta[$index]['descripcion'] = $especifica_descripcion[$d];
                                $consulta[$index]['concepto'] = $especifica_concepto[$d];
                            }//fin if

                            $especifica_ver[$d] = '';
                            break;
                        }





                        for ($e = 1; $e <= $n; $e++) {

                            $aux = $grupo_ver_aux[$a] . '.' . $partida_ver_aux[$b] . '.' . $generica_ver_aux[$c] . '.' . $especifica_ver_aux[$d] . '.' . $subespecifica_ver_aux[$e];

                            if ($aux == $subespecifica_ver[$e]) {

                                if ($subespecifica_ver[$e] != '') {

                                    $index++;
                                    $consulta[$index]['codigo'] = $subespecifica_ver[$e] . '.00';
                                    $consulta[$index]['descripcion'] = $subespecifica_descripcion[$e];
                                    $consulta[$index]['concepto'] = $subespecifica_concepto[$e];
                                }//fin if

                                $subespecifica_ver[$e] = '';
                                break;
                            }





                            for ($f = 1; $f <= $o; $f++) {

                                $aux = $grupo_ver_aux[$a] . '.' . $partida_ver_aux[$b] . '.' . $generica_ver_aux[$c] . '.' . $especifica_ver_aux[$d] . '.' . $subespecifica_ver_aux[$e] . '.' . $auxiliar_ver_aux[$f];

                                if ($aux == $auxiliar_ver[$f]) {

                                    if ($auxiliar_ver[$f] != '') {

                                        $index++;
                                        $consulta[$index]['codigo'] = $auxiliar_ver[$f];
                                        $consulta[$index]['descripcion'] = $auxiliar_descripcion[$f];
                                        $consulta[$index]['concepto'] = $auxiliar_concepto[$f];
                                    }//fin if

                                    $auxiliar_ver[$f] = '';
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }


        $this->set('consulta', $consulta);
    }

//fin funtion

    function plantillas_sectores() {
        $this->layout = "pdf";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
        $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
        $dato = null;
        foreach ($year as $year) {
            $dato = $year['cfpd01_formulacion']['ano_formular'];
        }

        if (!empty($dato)) {

            $this->set('year', $dato);
        } else {
            $this->set('year', '');
        }
    }

//fin funtion

    function forma_2006($year = null) {

        $sql = '';
        set_time_limit(0);

        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];
            $consolidado = 2;

            if (isset($this->data['cnmp05']['consolidacion'])) {
                if ($this->data['cnmp05']['consolidacion'] == 2) {
                    $consolidado = 2;
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($this->data['cnmp05']['consolidacion'] == 1) {
                    $consolidado = 1;
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            //$cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ejercicio;
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and ano=" . $year;


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;


            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }


            if ($this->data['cnmp05']['consolidacion'] == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($this->data['cnmp05']['consolidacion'] == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }


            if ($ano_formular == $ano) {

                if ($this->data['cnmp05']['consolidacion'] == 2) {
                    $sql = $this->SQLCA_consolidado();
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                    $modelo = "v_forma_2106_dep_vision";
                    // $modelo="v_cfpd97_reporte2_dep_final";
                } else if ($this->data['cnmp05']['consolidacion'] == 1) {
                    // $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
                    $sql = $this->SQLCA_consolidado($this->data['cnmp05']['consolidacion']);
                    $titulo_a = $this->Session->read('dependencia');
                    $modelo = "v_forma_2106_inst_vision";
                    // $modelo="v_cfpd97_reporte2_inst_final";
                }
            }//fin if


            $this->set('ano_reporte', $ano);

            $this->set('modelo_vista', $modelo);

            $DATOS_res = $this->$modelo->findAll($sql);

            if (!empty($DATOS_res)) {
                $this->set('datos', $DATOS_res);
            } else {
                $this->set('datos', array());
            }

            $this->set('titulo_a', $titulo_a);
        }//fin else pdf

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2006

    function forma_2006_origen($year = null) {

        $sql = '';
        set_time_limit(0);

        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }


            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $ejercicio = $ano;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ejercicio;
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and ano=" . $year;


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;


            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_clasificacion->execute("delete from cnmd05_clasificacion where " . $condicion);

                pr($cnmd05);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;
                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';


                for ($jjj = 1; $jjj <= $k; $jjj++) {


                    if ($var_cnmd05[$jjj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jjj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jjj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jjj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jjj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jjj]['cod_sub_prog'];
                        $cod_sector = $var_aux[$z]['cod_sector'];
                        $cod_programa = $var_aux[$z]['cod_programa'];
                        $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];


                        for ($ii = 1; $ii <= $j; $ii++) {

                            $cod_nivel_i = $var_cnmd04_tipo[$ii]['cod_nivel_i'];
                            $cod_nivel_ii = 0;
                            $index_aux = $index;
                            $numero_cargo_actual = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            //$cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $numero_cargo_actual++;

                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                            }break;
                                    }//fin


                                    $sueldo_actual += $aux_sueldo;
                                    $compensaciones_actual += $aux_compensaciones;
                                    $primas_actual += $aux_primas;
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = 0;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;


                            for ($iii = 1; $iii <= $i; $iii++) {
                                if ($var_cnmd04_ocupacion[$iii]['cod_nivel_i'] == $cod_nivel_i) {
                                    $cod_nivel_ii = $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'];
                                    $index_aux = $index;
                                    $numero_cargo_actual = 0;
                                    $numero_cargo_anterior = 0;
                                    $sueldo_anterior = 0;
                                    $compensaciones_anterior = 0;
                                    $primas_anterior = 0;
                                    $numero_cargo_actual = 0;
                                    $sueldo_actual = 0;
                                    $compensaciones_actual = 0;
                                    $primas_actual = 0;
                                    $cod_dep_aux_aux = 0;

                                    for ($ll = 1; $ll <= $k; $ll++) {
                                        if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_nivel_ii'] == $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                            $numero_cargo_actual++;
                                            $frecuencia = '';
                                            $clasificacion_personal = '';
                                            for ($aux = 1; $aux <= $xi; $aux++) {
                                                if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                                    $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                                    $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                                    $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                                }//fin if
                                            }//fin for

                                            switch ($frecuencia) {
                                                case '1': {
                                                        if ($clasificacion_personal == '2') {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                        } else {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                        }
                                                    }break;
                                                case '2': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                    }break;
                                                case '3': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                    }break;
                                                case '4': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                    }break;
                                                case '5': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                    }break;
                                                case '6': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                    }break;
                                            }//fin


                                            $sueldo_actual += $aux_sueldo;
                                            $compensaciones_actual += $aux_compensaciones;
                                            $primas_actual += $aux_primas;
                                        }//fin if
                                    }//fin for

                                    $index++;
                                    $reporte[$index]['cod_sector'] = $cod_sector;
                                    $reporte[$index]['cod_programa'] = $cod_programa;
                                    $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                                    $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                                    $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                                    $reporte[$index]['numero_cargo_anterior'] = 0;
                                    $reporte[$index]['sueldo_anterior'] = 0;
                                    $reporte[$index]['compensaciones_anterior'] = 0;
                                    $reporte[$index]['primas_anterior'] = 0;
                                    $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                                    $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                                    $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                                    $reporte[$index]['primas_actual'] = $primas_actual;
                                    $reporte[$index]['ano'] = $year;
                                    $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                                }//fin if
                            }//fin for
                        }//fin for
                    }//fin if
                }//fin for


                $DATOS_res22 = $reporte;

                for ($r = 1; $r <= $index; $r++) {
                    $aux_d['cod_sector'] = $DATOS_res22[$r]['cod_sector'];
                    $aux_d['cod_programa'] = $DATOS_res22[$r]['cod_programa'];
                    $aux_d['cod_sub_prog'] = $DATOS_res22[$r]['cod_sub_prog'];
                    $aux_d['cod_nivel_i'] = $DATOS_res22[$r]['cod_nivel_i'];
                    $aux_d['cod_nivel_ii'] = $DATOS_res22[$r]['cod_nivel_ii'];
                    $aux_d['numero_cargo_actual'] = $DATOS_res22[$r]['numero_cargo_actual'];
                    $aux_d['sueldo_actual'] = $DATOS_res22[$r]['sueldo_actual'];
                    $aux_d['compensaciones_actual'] = $DATOS_res22[$r]['compensaciones_actual'];
                    $aux_d['primas_actual'] = $DATOS_res22[$r]['primas_actual'];
                    $aux_d['ano'] = $DATOS_res22[$r]['ano'];
                    $aux_d['cod_dep'] = $DATOS_res22[$r]['cod_dep'];
                    if ($this->cnmd05_clasificacion->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . " and  cod_nivel_i=" . $aux_d['cod_nivel_i'] . " and cod_nivel_ii=" . $aux_d['cod_nivel_ii'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_clasificacion";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "',  '" . $aux_d['cod_sub_prog'] . "',  '" . $aux_d['cod_nivel_i'] . "', '" . $aux_d['cod_nivel_ii'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_clasificacion->execute($sql);
                    }//fin
                }//fin for
            }//fin if



            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse




            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_nivel_i,
                  cod_nivel_ii,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(sueldo_anterior)         as  sueldo_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(sueldo_actual)         as  sueldo_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_nivel_i,
                                      cod_nivel_ii';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
//           echo $campos;
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_nivel_i,
                          cod_nivel_ii,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(sueldo_anterior)         as  sueldo_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(sueldo_actual)         as  sueldo_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_nivel_i,
                                              cod_nivel_ii';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            /* $DATOS_res = $this->cnmd05_clasificacion->findAll($condicion.$agrupar, $campos, 'cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC', null, null);
              $this->set('datos', $DATOS_res);
              $DATOS_res2 = $this->cnmd05_clasificacion->findAll($condicion2.$agrupar, $campos, 'cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC', null, null);
              $this->set('datos_aux', $DATOS_res2); */
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS
                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.cod_nivel_i,
                                      aa.cod_nivel_ii,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.sueldo_actual         as sueldo_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.cod_nivel_i      =  aa.cod_nivel_i      and
                                              b.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.cod_nivel_i      =  aa.cod_nivel_i      and
                                              c.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              c.ano              =  " . $ano2 . " ) as sueldo_actual,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.cod_nivel_i      =  aa.cod_nivel_i      and
                                              d.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.cod_nivel_i      =  aa.cod_nivel_i      and
                                              e.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_clasificacion aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS
                                select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.cod_nivel_i,
                                      a.cod_nivel_ii,
                                      (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.cod_nivel_i      =  a.cod_nivel_i      and
                                              b.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.cod_nivel_i      =  a.cod_nivel_i      and
                                              c.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              c.ano              =  " . $ano3 . " ) as sueldo_anterior,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.cod_nivel_i      =  a.cod_nivel_i      and
                                              d.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.cod_nivel_i      =  a.cod_nivel_i      and
                                              e.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.sueldo_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_clasificacion a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                              select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");
//echo "select ".$campos." from v_cnmd05_anterior_actual_".$random."  ".$agrupar." order by cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC;";
            $DATOS_res = $this->cnmd05_clasificacion->execute("select " . $campos . " from v_cnmd05_anterior_actual_" . $random . "  " . $agrupar . " order by cod_nivel_i, cod_nivel_ii ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);


            $this->set('titulo_a', $titulo_a);
            $this->set('cnmd04_tipo', $cnmd04_tipo);
            $this->set('cnmd04_ocupacion', $cnmd04_ocupacion);
            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
        }//fin



        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2014($year = null) {

        $sql = '';
        set_time_limit(0);

        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];
            /* $consolidado = 2;
              if(isset($this->data['cnmp05']['consolidacion'])){
              $consolidado = $this->data['cnmp05']['consolidacion'];
              } */
            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            //$sql = $this->SQLCA_consolidado($consolidado);

            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $ejercicio = $ano;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ejercicio;
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and ano=" . $year;


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;


            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_clasificacion->execute("delete from cnmd05_clasificacion where " . $condicion);

                // pr($cnmd05);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;
                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';


                for ($jjj = 1; $jjj <= $k; $jjj++) {


                    if ($var_cnmd05[$jjj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jjj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jjj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jjj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jjj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jjj]['cod_sub_prog'];
                        $cod_sector = $var_aux[$z]['cod_sector'];
                        $cod_programa = $var_aux[$z]['cod_programa'];
                        $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];


                        for ($ii = 1; $ii <= $j; $ii++) {

                            $cod_nivel_i = $var_cnmd04_tipo[$ii]['cod_nivel_i'];
                            $cod_nivel_ii = 0;
                            $index_aux = $index;
                            $numero_cargo_actual = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            //$cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $numero_cargo_actual++;

                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                            }break;
                                    }//fin


                                    $sueldo_actual += $aux_sueldo;
                                    $compensaciones_actual += $aux_compensaciones;
                                    $primas_actual += $aux_primas;
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = 0;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;


                            for ($iii = 1; $iii <= $i; $iii++) {
                                if ($var_cnmd04_ocupacion[$iii]['cod_nivel_i'] == $cod_nivel_i) {
                                    $cod_nivel_ii = $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'];
                                    $index_aux = $index;
                                    $numero_cargo_actual = 0;
                                    $numero_cargo_anterior = 0;
                                    $sueldo_anterior = 0;
                                    $compensaciones_anterior = 0;
                                    $primas_anterior = 0;
                                    $numero_cargo_actual = 0;
                                    $sueldo_actual = 0;
                                    $compensaciones_actual = 0;
                                    $primas_actual = 0;
                                    $cod_dep_aux_aux = 0;

                                    for ($ll = 1; $ll <= $k; $ll++) {
                                        if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_nivel_ii'] == $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                            $numero_cargo_actual++;
                                            $frecuencia = '';
                                            $clasificacion_personal = '';
                                            for ($aux = 1; $aux <= $xi; $aux++) {
                                                if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                                    $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                                    $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                                    $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                                }//fin if
                                            }//fin for

                                            switch ($frecuencia) {
                                                case '1': {
                                                        if ($clasificacion_personal == '2') {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                        } else {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                        }
                                                    }break;
                                                case '2': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                    }break;
                                                case '3': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                    }break;
                                                case '4': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                    }break;
                                                case '5': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                    }break;
                                                case '6': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                    }break;
                                            }//fin


                                            $sueldo_actual += $aux_sueldo;
                                            $compensaciones_actual += $aux_compensaciones;
                                            $primas_actual += $aux_primas;
                                        }//fin if
                                    }//fin for

                                    $index++;
                                    $reporte[$index]['cod_sector'] = $cod_sector;
                                    $reporte[$index]['cod_programa'] = $cod_programa;
                                    $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                                    $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                                    $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                                    $reporte[$index]['numero_cargo_anterior'] = 0;
                                    $reporte[$index]['sueldo_anterior'] = 0;
                                    $reporte[$index]['compensaciones_anterior'] = 0;
                                    $reporte[$index]['primas_anterior'] = 0;
                                    $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                                    $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                                    $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                                    $reporte[$index]['primas_actual'] = $primas_actual;
                                    $reporte[$index]['ano'] = $year;
                                    $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                                }//fin if
                            }//fin for
                        }//fin for
                    }//fin if
                }//fin for


                $DATOS_res22 = $reporte;

                for ($r = 1; $r <= $index; $r++) {
                    $aux_d['cod_sector'] = $DATOS_res22[$r]['cod_sector'];
                    $aux_d['cod_programa'] = $DATOS_res22[$r]['cod_programa'];
                    $aux_d['cod_sub_prog'] = $DATOS_res22[$r]['cod_sub_prog'];
                    $aux_d['cod_nivel_i'] = $DATOS_res22[$r]['cod_nivel_i'];
                    $aux_d['cod_nivel_ii'] = $DATOS_res22[$r]['cod_nivel_ii'];
                    $aux_d['numero_cargo_actual'] = $DATOS_res22[$r]['numero_cargo_actual'];
                    $aux_d['sueldo_actual'] = $DATOS_res22[$r]['sueldo_actual'];
                    $aux_d['compensaciones_actual'] = $DATOS_res22[$r]['compensaciones_actual'];
                    $aux_d['primas_actual'] = $DATOS_res22[$r]['primas_actual'];
                    $aux_d['ano'] = $DATOS_res22[$r]['ano'];
                    $aux_d['cod_dep'] = $DATOS_res22[$r]['cod_dep'];
                    if ($this->cnmd05_clasificacion->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . " and  cod_nivel_i=" . $aux_d['cod_nivel_i'] . " and cod_nivel_ii=" . $aux_d['cod_nivel_ii'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_clasificacion";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "',  '" . $aux_d['cod_sub_prog'] . "',  '" . $aux_d['cod_nivel_i'] . "', '" . $aux_d['cod_nivel_ii'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_clasificacion->execute($sql);
                    }//fin
                }//fin for
            }//fin if



            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse




            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  cod_nivel_i,
                  cod_nivel_ii,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(sueldo_anterior)         as  sueldo_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(sueldo_actual)         as  sueldo_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      cod_nivel_i,
                                      cod_nivel_ii';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
//           echo $campos;
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          cod_nivel_i,
                          cod_nivel_ii,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(sueldo_anterior)         as  sueldo_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(sueldo_actual)         as  sueldo_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              cod_nivel_i,
                                              cod_nivel_ii';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            /* $DATOS_res = $this->cnmd05_clasificacion->findAll($condicion.$agrupar, $campos, 'cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC', null, null);
              $this->set('datos', $DATOS_res);
              $DATOS_res2 = $this->cnmd05_clasificacion->findAll($condicion2.$agrupar, $campos, 'cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC', null, null);
              $this->set('datos_aux', $DATOS_res2); */
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS
                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.cod_nivel_i,
                                      aa.cod_nivel_ii,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.sueldo_actual         as sueldo_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.cod_nivel_i      =  aa.cod_nivel_i      and
                                              b.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.cod_nivel_i      =  aa.cod_nivel_i      and
                                              c.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              c.ano              =  " . $ano2 . " ) as sueldo_actual,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.cod_nivel_i      =  aa.cod_nivel_i      and
                                              d.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.cod_nivel_i      =  aa.cod_nivel_i      and
                                              e.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_clasificacion aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS
                                select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.cod_nivel_i,
                                      a.cod_nivel_ii,
                                      (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.cod_nivel_i      =  a.cod_nivel_i      and
                                              b.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.cod_nivel_i      =  a.cod_nivel_i      and
                                              c.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              c.ano              =  " . $ano3 . " ) as sueldo_anterior,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.cod_nivel_i      =  a.cod_nivel_i      and
                                              d.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.cod_nivel_i      =  a.cod_nivel_i      and
                                              e.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.sueldo_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_clasificacion a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                              select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");
//echo "select ".$campos." from v_cnmd05_anterior_actual_".$random."  ".$agrupar." order by cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC;";
            $DATOS_res = $this->cnmd05_clasificacion->execute("select " . $campos . " from v_cnmd05_anterior_actual_" . $random . "  " . $agrupar . " order by cod_sector, cod_programa, cod_nivel_i, cod_nivel_ii ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);







            $this->set('titulo_a', $titulo_a);
            $this->set('cnmd04_tipo', $cnmd04_tipo);
            $this->set('cnmd04_ocupacion', $cnmd04_ocupacion);
            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
        }//fin



        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2014

    function forma_2007($year = null) {
        set_time_limit(0);
        $sql = '';
        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year = $this->cfpd01_formulacion->ano_formulacion($condicion);
            if (!empty($year)) {
                $this->set('year', $year);
            } else {
                $this->set('year', '');
            }
        } else {
            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cnmp05']['consolidacion'])) {
                $consolidado = $this->data['cnmp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            // $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;
            $year = $ejercicio;
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->ano_formulacion($condicion);
            $ano_formular = $year_dato;
            $year = $ano;
            $condicion .= " and ano=" . $year;

            if ($consolidado == 2) {
                $sql = $this->SQLCA_consolidado();
                $titulo_a = $this->Session->read('dependencia');
                $modelo = "v_forma_2107_dep_vision";
                // $modelo="v_forma_2107_dep";
            } else if ($consolidado == 1) {
                $sql = $this->SQLCA_consolidado($consolidado);
                $titulo_a = $this->Session->read('dependencia');
                $modelo = "v_forma_2107_inst_vision";
                // $modelo="v_forma_2107_inst";
            }

            $DATOS_res = $this->$modelo->findAll($sql, null, 'escala ASC');
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $this->set('titulo_a', $titulo_a);
            $this->set('year', $year);
            $this->set('ano_presupuesto', $ano_formular);
            $this->set('modelo', $modelo);
            if (!empty($DATOS_res)) {
                $this->set('data', $DATOS_res);
            } else {
                $this->set('data', array());
            }
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin funcion forma_2007

    function forma_2008($year = null) {
        set_time_limit(0);
        $sql = '';
        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year = $this->cfpd01_formulacion->ano_formulacion($condicion);
            if (!empty($year)) {
                $this->set('year', $year);
            } else {
                $this->set('year', '');
            }
        } else {
            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cnmp05']['consolidacion'])) {
                $consolidado = $this->data['cnmp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            // $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;
            $year = $ejercicio;
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->ano_formulacion($condicion);
            $ano_formular = $year_dato;
            $year = $ano;
            $condicion .= " and ano=" . $year;

            if ($consolidado == 2) {
                $sql = $this->SQLCA_consolidado();
                $titulo_a = $this->Session->read('dependencia');
                $modelo = "v_forma_2107_dep_vision";
                // $modelo="v_forma_2107_dep";
            } else if ($consolidado == 1) {
                $sql = $this->SQLCA_consolidado($consolidado);
                $titulo_a = $this->Session->read('dependencia');
                $modelo = "v_forma_2107_inst_vision";
                // $modelo="v_forma_2107_inst";
            }

            $DATOS_res = $this->$modelo->findAll($sql, null, 'escala ASC');
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $this->set('titulo_a', $titulo_a);
            $this->set('year', $year);
            $this->set('ano_presupuesto', $ano_formular);
            $this->set('modelo', $modelo);
            if (!empty($DATOS_res)) {
                $this->set('data', $DATOS_res);
            } else {
                $this->set('data', array());
            }
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2008

    function forma_2007_origi($year = null) {
        set_time_limit(0);
        ini_set("memory_limit", "1536M");

        $sql = '';
        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data['cnmp05']['consolidacion'])) {
                $consolidado = $this->data['cnmp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }//fin function

            $condicion_2 = $sql;

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $DATOS_res = $this->cfpd97->findAll($condicion, null, null, null, null);
            $DATOS_res_1 = $this->cnmd01->findAll($condicion_2, null, null, null, null);
            $this->set('cfpd97', $DATOS_res);
            $this->set('cnmd01', $DATOS_res_1);


            if ($ano_formular == $ano) {

                $i = 0;
                $xi = 0;
                $j = 0;
                $k = 0;
                $l = 0;
                $index = 0;
                $cod_presi = $this->Session->read('SScodpresi');
                $cod_entidad = $this->Session->read('SScodentidad');
                $cod_tipo_inst = $this->Session->read('SScodtipoinst');
                $cod_inst = $this->Session->read('SScodinst');
                $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
                $year = $ano;

                if ($consolidado == 2) {
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($consolidado == 1) {
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                    $titulo_a = $this->Session->read('dependencia');
                }


                if ($ano != '') {
                    $condicion = $sql . " and ano=" . $ano;
                } else {
                    $condicion = $sql;
                }


                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_sueldo->execute("delete from cnmd05_escala_sueldo where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach

                $reporte = '';
                $index = 0;


                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;



                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {
                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin
                                    $sueldo = $sueldo / 12;

                                    /*
                                      if($ii==1){ $ir="I"; }
                                      if($ii==2){ $ir="II"; }
                                      if($ii==3){ $ir="III"; }
                                      if($ii==4){ $ir="IV"; }
                                      if($ii==5){ $ir="V"; }
                                      if($ii==6){ $ir="VI"; }
                                      if($ii==7){ $ir="VII"; }
                                      if($ii==8){ $ir="VIII"; }
                                      if($ii==9){ $ir="IX"; }
                                      if($ii==10){ $ir="X"; }
                                      if($ii==11){ $ir="XI"; }
                                      if($ii==12){ $ir="XII"; }
                                      if($ii==13){ $ir="XIII"; }
                                      if($ii==14){ $ir="XIV"; }
                                      if($ii==15){ $ir="XV"; }
                                      if($ii==16){ $ir="XVI"; }
                                      if($ii==17){ $ir="XVII"; }

                                     */

                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 16 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for




                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin


                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_sueldo->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . " and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_sueldo";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_sueldo->execute($sql);
                    }//fin
                }//fin
            }//fin if



            if ($consolidado == 2) {
                $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              cod_dep,
              ano,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(sueldo_actual)         as  sueldo_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
            ";

                $agrupar = ' GROUP BY  cod_presi,
                                  cod_entidad,
                                  cod_tipo_inst,
                                  cod_inst,
                                  cod_dep,
                                  ano,
                                  numero_escala';
            } else if ($consolidado == 1) {
                $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(sueldo_actual)         as  sueldo_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
            ";

                $agrupar = ' GROUP BY  cod_presi,
                                  cod_entidad,
                                  cod_tipo_inst,
                                  cod_inst,
                                  ano,
                                  numero_escala ';
            }//fin if


            $this->set('year_vista', $ano);


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }


            $DATOS_res = $this->cnmd05_escala_sueldo->findAll($condicion . $agrupar, $campos, 'numero_escala ASC', null, null);
            $this->set('datos', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2008_origi($year = null) {
        set_time_limit(0);
        ini_set("memory_limit", "1536M");

        $sql = '';

        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cnmp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cnmp05']['consolidacion'])) {
                $consolidado = $this->data['cnmp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $condicion_2 = $sql;

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $DATOS_res = $this->cfpd97->findAll($condicion, null, null, null, null);
            $DATOS_res_1 = $this->cnmd01->findAll($condicion_2, null, null, null, null);
            $this->set('cfpd97', $DATOS_res);
            $this->set('cnmd01', $DATOS_res_1);

            if ($ano_formular == $ano) {

                $i = 0;
                $xi = 0;
                $j = 0;
                $k = 0;
                $l = 0;
                $index = 0;
                $cod_presi = $this->Session->read('SScodpresi');
                $cod_entidad = $this->Session->read('SScodentidad');
                $cod_tipo_inst = $this->Session->read('SScodtipoinst');
                $cod_inst = $this->Session->read('SScodinst');
                $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
                $year = $ano;

                if ($consolidado == 2) {
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($consolidado == 1) {
                    $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                    $titulo_a = $this->Session->read('dependencia');
                }

                if ($ano != '') {
                    $condicion = $sql . " and ano=" . $ano;
                } else {
                    $condicion = $sql;
                }

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_salario->execute("delete from cnmd05_escala_salario where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach


                $reporte = '';
                $index = 0;

                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin
                                    $sueldo = $sueldo / 12;
                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 16 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin

                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_salario->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . "  and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_salario";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, salario_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_salario->execute($sql);
                    }//fin
                }//fin
            }//fin if


            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  numero_escala,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(salario_actual)        as  salario_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";

                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      numero_escala';
            } else if ($consolidado == 1) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  ano,
                  numero_escala,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(salario_actual)        as  salario_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";


                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      ano,
                                      numero_escala ';
            }//fin if

            $this->set('year_vista', $ano);

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }

            $DATOS_res = $this->cnmd05_escala_salario->findAll($condicion . $agrupar, $campos, 'numero_escala ASC', null, null);
            $this->set('datos', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2014_sub_prog($year = null) {

        $sql = '';
        set_time_limit(0);

        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidado);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;
            $index = 0;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
//  $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            if ($ano_formular == $ano) {

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_clasificacion->execute("delete from cnmd05_clasificacion where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;
                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';


                for ($jjj = 1; $jjj <= $k; $jjj++) {


                    if ($var_cnmd05[$jjj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jjj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jjj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jjj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jjj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jjj]['cod_sub_prog'];
                        $cod_sector = $var_aux[$z]['cod_sector'];
                        $cod_programa = $var_aux[$z]['cod_programa'];
                        $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];


                        for ($ii = 1; $ii <= $j; $ii++) {

                            $cod_nivel_i = $var_cnmd04_tipo[$ii]['cod_nivel_i'];
                            $cod_nivel_ii = 0;
                            $index_aux = $index;
                            $numero_cargo_actual = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            //$cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $numero_cargo_actual++;

                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                            }break;
                                    }//fin

                                    $sueldo_actual += $aux_sueldo;
                                    $compensaciones_actual += $aux_compensaciones;
                                    $primas_actual += $aux_primas;
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = 0;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;


                            for ($iii = 1; $iii <= $i; $iii++) {
                                if ($var_cnmd04_ocupacion[$iii]['cod_nivel_i'] == $cod_nivel_i) {
                                    $cod_nivel_ii = $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'];
                                    $index_aux = $index;
                                    $numero_cargo_actual = 0;
                                    $numero_cargo_anterior = 0;
                                    $sueldo_anterior = 0;
                                    $compensaciones_anterior = 0;
                                    $primas_anterior = 0;
                                    $numero_cargo_actual = 0;
                                    $sueldo_actual = 0;
                                    $compensaciones_actual = 0;
                                    $primas_actual = 0;
                                    $cod_dep_aux_aux = 0;

                                    for ($ll = 1; $ll <= $k; $ll++) {
                                        if ($var_cnmd05[$ll]['cod_nivel_i'] == $var_cnmd04_tipo[$ii]['cod_nivel_i'] && $var_cnmd05[$ll]['cod_nivel_ii'] == $var_cnmd04_ocupacion[$iii]['cod_nivel_ii'] && $var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                            $numero_cargo_actual++;
                                            $frecuencia = '';
                                            $clasificacion_personal = '';
                                            for ($aux = 1; $aux <= $xi; $aux++) {
                                                if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                                    $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                                    $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                                    $cod_dep_aux_aux = $var_cnmd05[$ll]['cod_dep'];
                                                }//fin if
                                            }//fin for

                                            switch ($frecuencia) {
                                                case '1': {
                                                        if ($clasificacion_personal == '2') {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                        } else {
                                                            $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                            $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                            $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                        }
                                                    }break;
                                                case '2': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                    }break;
                                                case '3': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                    }break;
                                                case '4': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                    }break;
                                                case '5': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                    }break;
                                                case '6': {
                                                        $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                        $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                        $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                    }break;
                                            }//fin

                                            $sueldo_actual += $aux_sueldo;
                                            $compensaciones_actual += $aux_compensaciones;
                                            $primas_actual += $aux_primas;
                                        }//fin if
                                    }//fin for

                                    $index++;
                                    $reporte[$index]['cod_sector'] = $cod_sector;
                                    $reporte[$index]['cod_programa'] = $cod_programa;
                                    $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                                    $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                                    $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                                    $reporte[$index]['numero_cargo_anterior'] = 0;
                                    $reporte[$index]['sueldo_anterior'] = 0;
                                    $reporte[$index]['compensaciones_anterior'] = 0;
                                    $reporte[$index]['primas_anterior'] = 0;
                                    $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                                    $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                                    $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                                    $reporte[$index]['primas_actual'] = $primas_actual;
                                    $reporte[$index]['ano'] = $year;
                                    $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                                }//fin if
                            }//fin for
                        }//fin for
                    }//fin if
                }//fin for


                $DATOS_res22 = $reporte;

                for ($r = 1; $r <= $index; $r++) {
                    $aux_d['cod_sector'] = $DATOS_res22[$r]['cod_sector'];
                    $aux_d['cod_programa'] = $DATOS_res22[$r]['cod_programa'];
                    $aux_d['cod_sub_prog'] = $DATOS_res22[$r]['cod_sub_prog'];
                    $aux_d['cod_nivel_i'] = $DATOS_res22[$r]['cod_nivel_i'];
                    $aux_d['cod_nivel_ii'] = $DATOS_res22[$r]['cod_nivel_ii'];
                    $aux_d['numero_cargo_actual'] = $DATOS_res22[$r]['numero_cargo_actual'];
                    $aux_d['sueldo_actual'] = $DATOS_res22[$r]['sueldo_actual'];
                    $aux_d['compensaciones_actual'] = $DATOS_res22[$r]['compensaciones_actual'];
                    $aux_d['primas_actual'] = $DATOS_res22[$r]['primas_actual'];
                    $aux_d['ano'] = $DATOS_res22[$r]['ano'];
                    $aux_d['cod_dep'] = $DATOS_res22[$r]['cod_dep'];
                    if ($this->cnmd05_clasificacion->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . " and  cod_nivel_i=" . $aux_d['cod_nivel_i'] . " and cod_nivel_ii=" . $aux_d['cod_nivel_ii'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_clasificacion";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "',  '" . $aux_d['cod_sub_prog'] . "',  '" . $aux_d['cod_nivel_i'] . "', '" . $aux_d['cod_nivel_ii'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_clasificacion->execute($sql);
                    }//fin
                }//fin for
            }//fin if

            /*

              if($consolidado==2){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
              $titulo_a = $this->Session->read('dependencia');
              }else if($consolidado==1){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
              $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
              }


              if($ano!=''){
              $condicion  = $sql." and ano=".$ano;
              $ano--;
              $condicion2 = $sql." and ano=".$ano;
              }else{
              $condicion  = $sql;
              $condicion2 = $sql;
              }


              $DATOS_res = $this->cnmd05_clasificacion->findAll($condicion, null, 'cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii ASC', null, null);
              $this->set('datos', $DATOS_res);

              $DATOS_res2 = $this->cnmd05_clasificacion->findAll($condicion2, null, 'cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii  ASC', null, null);
              $this->set('datos_aux', $DATOS_res2);




             */

            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse
            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  cod_nivel_i,
                  cod_nivel_ii,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(sueldo_anterior)         as  sueldo_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(sueldo_actual)         as  sueldo_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      cod_nivel_i,
                                      cod_nivel_ii';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          cod_nivel_i,
                          cod_nivel_ii,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(sueldo_anterior)         as  sueldo_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(sueldo_actual)         as  sueldo_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              cod_nivel_i,
                                              cod_nivel_ii';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS

                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.cod_nivel_i,
                                      aa.cod_nivel_ii,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.sueldo_actual         as sueldo_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.cod_nivel_i      =  aa.cod_nivel_i      and
                                              b.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.cod_nivel_i      =  aa.cod_nivel_i      and
                                              c.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              c.ano              =  " . $ano2 . " ) as sueldo_actual,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.cod_nivel_i      =  aa.cod_nivel_i      and
                                              d.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.cod_nivel_i      =  aa.cod_nivel_i      and
                                              e.cod_nivel_ii     =  aa.cod_nivel_ii     and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_clasificacion aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;


        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS
                                select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.cod_nivel_i,
                                      a.cod_nivel_ii,
                                      (select numero_cargo_actual from cnmd05_clasificacion b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.cod_nivel_i      =  a.cod_nivel_i      and
                                              b.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select sueldo_actual from cnmd05_clasificacion c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.cod_nivel_i      =  a.cod_nivel_i      and
                                              c.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              c.ano              =  " . $ano3 . " ) as sueldo_anterior,
                                        (select compensaciones_actual from cnmd05_clasificacion d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.cod_nivel_i      =  a.cod_nivel_i      and
                                              d.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_clasificacion e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.cod_nivel_i      =  a.cod_nivel_i      and
                                              e.cod_nivel_ii     =  a.cod_nivel_ii     and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.sueldo_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_clasificacion a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . " and " .
                    "1=1
                 UNION

                              select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual!=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");

            $DATOS_res = $this->cnmd05_clasificacion->execute("select * from v_cnmd05_anterior_actual_" . $random . " order by cod_sector, cod_programa, cod_subprograma, cod_nivel_i, cod_nivel_ii  ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);




            //$DATOS_res =$reporte;
            //$this->set('reporte', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
            $this->set('cnmd04_tipo', $cnmd04_tipo);
            $this->set('cnmd04_ocupacion', $cnmd04_ocupacion);
            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprog', $this->cfpd02_sub_prog->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
        }//fin else
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2014_sub_prog

    function forma_2015($year = null) {

        $sql = '';
        set_time_limit(0);

        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            //$sql = $this->SQLCA_consolidado($consolidado);


            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;
            $index = 0;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            //$cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {
                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_sueldo->execute("delete from cnmd05_escala_sueldo where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;

                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin


                                    $sueldo = $sueldo / 12;
                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 17 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin



                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_sueldo->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . "  and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_sueldo";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_sueldo->execute($sql);
                    }//fin
                }//fin
            }//fin if




            /*


              if($consolidado==2){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
              $titulo_a = $this->Session->read('dependencia');
              }else if($consolidado==1){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
              $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
              }
              if($ano!=''){
              $condicion  = $sql." and ano=".$ano;
              $ano--;
              $condicion2 = $sql." and ano=".$ano;
              }else{
              $condicion  = $sql;
              $condicion2 = $sql;
              }//finelse
              if($consolidado==2){
              $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              cod_dep,
              ano,
              cod_sector,
              cod_programa,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(sueldo_actual)         as  sueldo_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
              ";
              $agrupar = 'GROUP BY  cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              cod_dep,
              ano,
              cod_sector,
              cod_programa,
              numero_escala';
              }else if($consolidado==1){
              $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              cod_sector,
              cod_programa,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(sueldo_actual)         as  sueldo_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
              ";
              $agrupar = 'GROUP BY   cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              cod_sector,
              cod_programa,
              numero_escala';
              }//fin if


              $DATOS_res = $this->cnmd05_escala_sueldo->findAll($condicion.$agrupar, $campos, 'cod_sector, cod_programa, numero_escala ASC', null, null);
              $this->set('datos', $DATOS_res);

              $DATOS_res2 = $this->cnmd05_escala_sueldo->findAll($condicion2.$agrupar, $campos, 'cod_sector, cod_programa, numero_escala ASC', null, null);
              $this->set('datos_aux', $DATOS_res2);



             */





            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse

            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  numero_escala,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(sueldo_anterior)         as  sueldo_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(sueldo_actual)         as  sueldo_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      numero_escala';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          numero_escala,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(sueldo_anterior)         as  sueldo_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(sueldo_actual)         as  sueldo_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              numero_escala';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();


            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');


            $this->cnmd05_clasificacion->execute("
        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS

                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.numero_escala,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.sueldo_actual         as sueldo_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_escala_sueldo b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.numero_escala    =  aa.numero_escala    and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select sueldo_actual from cnmd05_escala_sueldo c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.numero_escala    =  aa.numero_escala    and
                                              c.ano              =  " . $ano2 . " ) as sueldo_actual,
                                        (select compensaciones_actual from cnmd05_escala_sueldo d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.numero_escala    =  aa.numero_escala    and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_escala_sueldo e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.numero_escala    =  aa.numero_escala  and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_escala_sueldo aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS

                                select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.numero_escala,
                                      (select numero_cargo_actual from cnmd05_escala_sueldo b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.numero_escala    =  a.numero_escala    and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select sueldo_actual from cnmd05_escala_sueldo c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.numero_escala    =  a.numero_escala    and
                                              c.ano              =  " . $ano3 . " ) as sueldo_anterior,
                                        (select compensaciones_actual from cnmd05_escala_sueldo d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.numero_escala    =  a.numero_escala    and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_escala_sueldo e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.numero_escala    =  a.numero_escala    and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.sueldo_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_escala_sueldo a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                               select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");

            $DATOS_res = $this->cnmd05_clasificacion->execute("select " . $campos . " from v_cnmd05_anterior_actual_" . $random . " " . $agrupar . " order by  cod_sector, cod_programa, numero_escala  ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);






            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2015

    function forma_2015_sub_prog($year = null) {

        $sql = '';
        set_time_limit(0);
        ini_set("memory_limit", "1024M");
        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidado);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }



            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;
            $index = 0;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
//  $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {
                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_sueldo->execute("delete from cnmd05_escala_sueldo where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;

                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin


                                    $sueldo = $sueldo / 12;
                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 17 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 1 || $clasificacion_personal == 3 || $clasificacion_personal == 4 || $clasificacion_personal == 5 || $clasificacion_personal == 6 || $clasificacion_personal == 7 || $clasificacion_personal == 9 || $clasificacion_personal == 11 || $clasificacion_personal == 12 || $clasificacion_personal == 13 || $clasificacion_personal == 14 || $clasificacion_personal == 17 || $clasificacion_personal == 18)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin



                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_sueldo->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . "  and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_sueldo";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, sueldo_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_sueldo->execute($sql);
                    }//fin
                }//fin
            }//fin if




            /*


              if($consolidado==2){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
              $titulo_a = $this->Session->read('dependencia');
              }else if($consolidado==1){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
              $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
              }


              if($ano!=''){
              $condicion  = $sql." and ano=".$ano;
              $ano--;
              $condicion2 = $sql." and ano=".$ano;
              }else{
              $condicion  = $sql;
              $condicion2 = $sql;
              }


              $DATOS_res = $this->cnmd05_escala_sueldo->findAll($condicion, null, 'cod_sector, cod_programa, cod_subprograma, numero_escala ASC', null, null);
              $this->set('datos', $DATOS_res);

              $DATOS_res2 = $this->cnmd05_escala_sueldo->findAll($condicion2, null, 'cod_sector, cod_programa, cod_subprograma, numero_escala  ASC', null, null);
              $this->set('datos_aux', $DATOS_res2);




              $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
              $cnmd04_tipo = $this->cnmd04_tipo->findAll();

              $DATOS_res =$reporte;
              $this->set('reporte', $DATOS_res); */




            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse
            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  numero_escala,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(sueldo_anterior)         as  sueldo_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(sueldo_actual)         as  sueldo_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      numero_escala';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          numero_escala,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(sueldo_anterior)         as  sueldo_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(sueldo_actual)         as  sueldo_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              numero_escala';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

       CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS

                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.numero_escala,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.sueldo_actual         as sueldo_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_escala_sueldo b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.numero_escala    =  aa.numero_escala    and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select sueldo_actual from cnmd05_escala_sueldo c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.numero_escala    =  aa.numero_escala    and
                                              c.ano              =  " . $ano2 . " ) as sueldo_actual,
                                        (select compensaciones_actual from cnmd05_escala_sueldo d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.numero_escala    =  aa.numero_escala    and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_escala_sueldo e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.numero_escala    =  aa.numero_escala  and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_escala_sueldo aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;


        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS

                        select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.numero_escala,
                                      (select numero_cargo_actual from cnmd05_escala_sueldo b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.numero_escala    =  a.numero_escala    and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select sueldo_actual from cnmd05_escala_sueldo c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.numero_escala    =  a.numero_escala    and
                                              c.ano              =  " . $ano3 . " ) as sueldo_anterior,
                                        (select compensaciones_actual from cnmd05_escala_sueldo d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.numero_escala    =  a.numero_escala    and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_escala_sueldo e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.numero_escala    =  a.numero_escala    and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.sueldo_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_escala_sueldo a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                              select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");

            $DATOS_res = $this->cnmd05_clasificacion->execute("select * from v_cnmd05_anterior_actual_" . $random . "  order by  cod_sector, cod_programa, cod_subprograma, numero_escala  ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);


            $this->set('titulo_a', $titulo_a);
            $this->set('cnmd04_tipo', $cnmd04_tipo);
            $this->set('cnmd04_ocupacion', $cnmd04_ocupacion);
            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprog', $this->cfpd02_sub_prog->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
        }//fin else
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2015_sub_prog

    function forma_2016($year = null) {

        $sql = '';
        set_time_limit(0);
        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cnmp05']['ano'];
            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            //$sql = $this->SQLCA_consolidado($consolidado);

            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;
            $index = 0;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            //$cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $year = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_salario->execute("delete from cnmd05_escala_salario where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;

                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin


                                    $sueldo = $sueldo / 12;
                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 17 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin

                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_salario->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . "  and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_salario";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, salario_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_salario->execute($sql);
                    }//fin
                }//fin
            }//fin if




            /*
              if($consolidado==2){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
              $titulo_a = $this->Session->read('dependencia');
              }else if($consolidado==1){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
              $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
              }
              if($ano!=''){
              $condicion  = $sql." and ano=".$ano;
              $ano--;
              $condicion2 = $sql." and ano=".$ano;
              }else{
              $condicion  = $sql;
              $condicion2 = $sql;
              }//finelse
              if($consolidado==2){
              $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              cod_dep,
              ano,
              cod_sector,
              cod_programa,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(salario_actual)         as  salario_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
              ";
              $agrupar = 'GROUP BY  cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              cod_dep,
              ano,
              cod_sector,
              cod_programa,
              numero_escala';
              }else if($consolidado==1){
              $campos = "
              cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              cod_sector,
              cod_programa,
              numero_escala,
              SUM(numero_cargo_actual)   as  numero_cargo_actual,
              SUM(salario_actual)         as  salario_actual,
              SUM(compensaciones_actual) as  compensaciones_actual,
              SUM(primas_actual)         as  primas_actual
              ";
              $agrupar = 'GROUP BY   cod_presi,
              cod_entidad,
              cod_tipo_inst,
              cod_inst,
              ano,
              cod_sector,
              cod_programa,
              numero_escala';
              }//fin if


              $DATOS_res = $this->cnmd05_escala_salario->findAll($condicion.$agrupar, $campos, 'cod_sector, cod_programa, numero_escala ASC', null, null);
              $this->set('datos', $DATOS_res);

              $DATOS_res2 = $this->cnmd05_escala_salario->findAll($condicion2.$agrupar, $campos, 'cod_sector, cod_programa, numero_escala ASC', null, null);
              $this->set('datos_aux', $DATOS_res2);

             */








            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse
            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  numero_escala,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(salario_anterior)         as  salario_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(salario_actual)         as  salario_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      numero_escala';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          numero_escala,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(salario_anterior)         as  salario_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(salario_actual)         as  salario_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              numero_escala';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS

                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.numero_escala,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.salario_actual        as salario_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_escala_salario b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.numero_escala    =  aa.numero_escala    and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select salario_actual from cnmd05_escala_salario c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.numero_escala    =  aa.numero_escala    and
                                              c.ano              =  " . $ano2 . " ) as salario_actual,
                                        (select compensaciones_actual from cnmd05_escala_salario d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.numero_escala    =  aa.numero_escala    and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_escala_salario e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.numero_escala    =  aa.numero_escala  and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_escala_salario aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;


        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS

                      select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.numero_escala,
                                      (select numero_cargo_actual from cnmd05_escala_salario b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.numero_escala    =  a.numero_escala    and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select salario_actual from cnmd05_escala_salario c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.numero_escala    =  a.numero_escala    and
                                              c.ano              =  " . $ano3 . " ) as salario_anterior,
                                        (select compensaciones_actual from cnmd05_escala_salario d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.numero_escala    =  a.numero_escala    and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_escala_salario e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.numero_escala    =  a.numero_escala    and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.salario_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_escala_salario a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                               select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");

            $DATOS_res = $this->cnmd05_clasificacion->execute("select " . $campos . " from v_cnmd05_anterior_actual_" . $random . " where cod_dep!=0 " . $agrupar . " order by  cod_sector, cod_programa, numero_escala  ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);


            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2016

    function forma_2016_sub_prog($year = null) {

        $sql = '';
        set_time_limit(0);
        ini_set("memory_limit", "1024M");

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {



            $this->layout = "pdf";
            $ano = '';

            $ano = $this->data['cnmp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidado);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }


            $i = 0;
            $xi = 0;
            $j = 0;
            $k = 0;
            $l = 0;
            $index = 0;
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
//  $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $year = $ano;

            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $year_dato = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            foreach ($year_dato as $year_aux) {
                $ano_formular = $year_aux['cfpd01_formulacion']['ano_formular'];
            }

            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($ano_formular == $ano) {

                $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll('cod_nivel_i<=5');
                $cnmd04_tipo = $this->cnmd04_tipo->findAll('cod_nivel_i<=5');
                $cnmd05 = $this->cfpd97->findAll($condicion . ' and cod_nivel_i<=5', null, 'cod_sector, cod_programa, cod_sub_prog ASC');
                $cnmd01 = $this->cnmd01->findAll($sql);
                $this->cnmd05_escala_salario->execute("delete from cnmd05_escala_salario where " . $condicion);

                foreach ($cnmd04_ocupacion as $aux_a) {
                    $i++;
                    $var_cnmd04_ocupacion[$i]['cod_nivel_i'] = $aux_a['cnmd04_ocupacion']['cod_nivel_i'];
                    $var_cnmd04_ocupacion[$i]['cod_nivel_ii'] = $aux_a['cnmd04_ocupacion']['cod_nivel_ii'];
                    $var_cnmd04_ocupacion[$i]['denominacion'] = $aux_a['cnmd04_ocupacion']['denominacion'];
                }//fin foreach

                foreach ($cnmd01 as $aux_cnmd01) {
                    $xi++;
                    $var_cnmd01[$xi]['cod_presi'] = $aux_cnmd01['Cnmd01']['cod_presi'];
                    $var_cnmd01[$xi]['cod_entidad'] = $aux_cnmd01['Cnmd01']['cod_entidad'];
                    $var_cnmd01[$xi]['cod_tipo_inst'] = $aux_cnmd01['Cnmd01']['cod_tipo_inst'];
                    $var_cnmd01[$xi]['cod_inst'] = $aux_cnmd01['Cnmd01']['cod_inst'];
                    $var_cnmd01[$xi]['cod_dep'] = $aux_cnmd01['Cnmd01']['cod_dep'];
                    $var_cnmd01[$xi]['frecuencia_cobro'] = $aux_cnmd01['Cnmd01']['frecuencia_cobro'];
                    $var_cnmd01[$xi]['cod_tipo_nomina'] = $aux_cnmd01['Cnmd01']['cod_tipo_nomina'];
                    $var_cnmd01[$xi]['clasificacion_personal'] = $aux_cnmd01['Cnmd01']['clasificacion_personal'];
                }//fin foreach

                foreach ($cnmd04_tipo as $aux_b) {
                    $j++;
                    $var_cnmd04_tipo[$j]['cod_nivel_i'] = $aux_b['cnmd04_tipo']['cod_nivel_i'];
                    $var_cnmd04_tipo[$j]['denominacion'] = $aux_b['cnmd04_tipo']['denominacion'];
                }//fin foreach

                foreach ($cnmd05 as $aux_c) {
                    $k++;
                    $var_cnmd05[$k]['cod_tipo_nomina'] = $aux_c['cfpd97']['cod_tipo_nomina'];
                    $var_cnmd05[$k]['cod_sector'] = $aux_c['cfpd97']['cod_sector'];
                    $var_cnmd05[$k]['cod_programa'] = $aux_c['cfpd97']['cod_programa'];
                    $var_cnmd05[$k]['cod_sub_prog'] = $aux_c['cfpd97']['cod_sub_prog'];
                    $var_cnmd05[$k]['cod_nivel_i'] = $aux_c['cfpd97']['cod_nivel_i'];
                    $var_cnmd05[$k]['cod_nivel_ii'] = $aux_c['cfpd97']['cod_nivel_ii'];
                    //$var_cnmd05[$k]['numero_cargo_anterior']    =     $aux_c['cfpd97']['numero_cargo_anterior'];
                    $var_cnmd05[$k]['sueldo_basico'] = $aux_c['cfpd97']['sueldo_basico'];
                    $var_cnmd05[$k]['compensaciones'] = $aux_c['cfpd97']['compensaciones'];
                    $var_cnmd05[$k]['primas'] = $aux_c['cfpd97']['primas'];
                    $var_cnmd05[$k]['cod_dep'] = $aux_c['cfpd97']['cod_dep'];
                }//fin foreach



                $reporte = '';
                $index = 0;

                $z = 1;
                $var_aux[$z]['cod_sector'] = '';
                $var_aux[$z]['cod_programa'] = '';
                $var_aux[$z]['cod_sub_prog'] = '';

                for ($jj = 1; $jj <= $k; $jj++) {
                    if ($var_cnmd05[$jj]['cod_sector'] != $var_aux[$z]['cod_sector'] || $var_cnmd05[$jj]['cod_programa'] != $var_aux[$z]['cod_programa'] || $var_cnmd05[$jj]['cod_sub_prog'] != $var_aux[$z]['cod_sub_prog']) {
                        $var_aux[$z]['cod_sector'] = $var_cnmd05[$jj]['cod_sector'];
                        $var_aux[$z]['cod_programa'] = $var_cnmd05[$jj]['cod_programa'];
                        $var_aux[$z]['cod_sub_prog'] = $var_cnmd05[$jj]['cod_sub_prog'];

                        for ($ii = 1; $ii <= 18; $ii++) {
                            $cod_sector = 0;
                            $cod_programa = 0;
                            $cod_sub_prog = 0;
                            $cod_nivel_i = 0;
                            $cod_nivel_ii = 0;
                            $numero_cargo_anterior = 0;
                            $sueldo_anterior = 0;
                            $compensaciones_anterior = 0;
                            $primas_anterior = 0;
                            $numero_cargo_actual = 0;
                            $sueldo_actual = 0;
                            $compensaciones_actual = 0;
                            $primas_actual = 0;
                            $cod_dep_aux_aux = 0;

                            for ($ll = 1; $ll <= $k; $ll++) {
                                if ($var_cnmd05[$ll]['cod_sector'] == $var_aux[$z]['cod_sector'] && $var_cnmd05[$ll]['cod_programa'] == $var_aux[$z]['cod_programa'] && $var_cnmd05[$ll]['cod_sub_prog'] == $var_aux[$z]['cod_sub_prog']) {

                                    $cod_sector = $var_aux[$z]['cod_sector'];
                                    $cod_programa = $var_aux[$z]['cod_programa'];
                                    $cod_sub_prog = $var_aux[$z]['cod_sub_prog'];
                                    $sueldo = $var_cnmd05[$ll]['sueldo_basico'];
                                    $frecuencia = '';
                                    $clasificacion_personal = '';
                                    for ($aux = 1; $aux <= $xi; $aux++) {
                                        if ($var_cnmd01[$aux]['cod_presi'] == $cod_presi && $var_cnmd01[$aux]['cod_entidad'] == $cod_entidad && $var_cnmd01[$aux]['cod_tipo_inst'] == $cod_tipo_inst && $var_cnmd01[$aux]['cod_inst'] == $cod_inst && $var_cnmd01[$aux]['cod_dep'] == $var_cnmd05[$ll]['cod_dep'] && $var_cnmd01[$aux]['cod_tipo_nomina'] == $var_cnmd05[$ll]['cod_tipo_nomina']) {
                                            $frecuencia = $var_cnmd01[$aux]['frecuencia_cobro'];
                                            $clasificacion_personal = $var_cnmd01[$aux]['clasificacion_personal'];
                                            $cod_dep_aux_aux = $var_cnmd01[$aux]['cod_dep'];
                                        }//fin if
                                    }//fin for

                                    switch ($frecuencia) {
                                        case '1': {
                                                if ($clasificacion_personal == '2') {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 365;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 365;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 365;
                                                    $sueldo = $sueldo * 365;
                                                } else {
                                                    $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 360;
                                                    $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 360;
                                                    $aux_primas = $var_cnmd05[$ll]['primas'] * 360;
                                                    $sueldo = $sueldo * 360;
                                                }
                                            }break;
                                        case '2': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 52;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 52;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 52;
                                                $sueldo = $sueldo * 52;
                                            }break;
                                        case '3': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 24;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 24;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 24;
                                                $sueldo = $sueldo * 24;
                                            }break;
                                        case '4': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 12;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 12;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 12;
                                                $sueldo = $sueldo * 12;
                                            }break;
                                        case '5': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 6;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 6;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 6;
                                                $sueldo = $sueldo * 6;
                                            }break;
                                        case '6': {
                                                $aux_sueldo = $var_cnmd05[$ll]['sueldo_basico'] * 4;
                                                $aux_compensaciones = $var_cnmd05[$ll]['compensaciones'] * 4;
                                                $aux_primas = $var_cnmd05[$ll]['primas'] * 4;
                                                $sueldo = $sueldo * 4;
                                            }break;
                                    }//fin


                                    $sueldo = $sueldo / 12;
                                    if ($sueldo >= escalas_array_su_sa(2, 0, 1) && $sueldo <= escalas_array_su_sa(1, 1, 1) && $ii == 1 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 1, 1) && $sueldo <= escalas_array_su_sa(1, 2, 1) && $ii == 2 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 2, 1) && $sueldo <= escalas_array_su_sa(1, 3, 1) && $ii == 3 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 3, 1) && $sueldo <= escalas_array_su_sa(1, 4, 1) && $ii == 4 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 4, 1) && $sueldo <= escalas_array_su_sa(1, 5, 1) && $ii == 5 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 5, 1) && $sueldo <= escalas_array_su_sa(1, 6, 1) && $ii == 6 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 6, 1) && $sueldo <= escalas_array_su_sa(1, 7, 1) && $ii == 7 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 7, 1) && $sueldo <= escalas_array_su_sa(1, 8, 1) && $ii == 8 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 8, 1) && $sueldo <= escalas_array_su_sa(1, 9, 1) && $ii == 9 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 9, 1) && $sueldo <= escalas_array_su_sa(1, 10, 1) && $ii == 10 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 10, 1) && $sueldo <= escalas_array_su_sa(1, 11, 1) && $ii == 11 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 11, 1) && $sueldo <= escalas_array_su_sa(1, 12, 1) && $ii == 12 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 12, 1) && $sueldo <= escalas_array_su_sa(1, 13, 1) && $ii == 13 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 13, 1) && $sueldo <= escalas_array_su_sa(1, 14, 1) && $ii == 14 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 14, 1) && $sueldo <= escalas_array_su_sa(1, 15, 1) && $ii == 15 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 15, 1) && $sueldo <= escalas_array_su_sa(1, 16, 1) && $ii == 16 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 16, 1) && $sueldo <= escalas_array_su_sa(1, 17, 1) && $ii == 17 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                    if ($sueldo >= escalas_array_su_sa(2, 17, 1) && $ii == 18 && ($clasificacion_personal == 2 || $clasificacion_personal == 8 || $clasificacion_personal == 10 || $clasificacion_personal == 15 || $clasificacion_personal == 16)) {
                                        $numero_cargo_actual++;
                                        $sueldo_actual += $aux_sueldo;
                                        $compensaciones_actual += $aux_compensaciones;
                                        $primas_actual += $aux_primas;
                                    }
                                }//fin if
                            }//fin for

                            $index++;
                            $reporte[$index]['cod_sector'] = $cod_sector;
                            $reporte[$index]['cod_programa'] = $cod_programa;
                            $reporte[$index]['cod_sub_prog'] = $cod_sub_prog;
                            $reporte[$index]['cod_nivel_i'] = $cod_nivel_i;
                            $reporte[$index]['cod_nivel_ii'] = $cod_nivel_ii;
                            $reporte[$index]['numero_cargo_anterior'] = 0;
                            $reporte[$index]['sueldo_anterior'] = 0;
                            $reporte[$index]['compensaciones_anterior'] = 0;
                            $reporte[$index]['primas_anterior'] = 0;
                            $reporte[$index]['numero_cargo_actual'] = $numero_cargo_actual;
                            $reporte[$index]['sueldo_actual'] = $sueldo_actual;
                            $reporte[$index]['compensaciones_actual'] = $compensaciones_actual;
                            $reporte[$index]['primas_actual'] = $primas_actual;
                            $reporte[$index]['ano'] = $year;
                            $reporte[$index]['numero_escala'] = $ii;
                            $reporte[$index]['cod_dep'] = $cod_dep_aux_aux;
                        }//fin
                    }//fin
                }//fin

                $DATOS_res22 = $reporte;
                foreach ($DATOS_res22 as $aux_d) {
                    if ($this->cnmd05_escala_salario->findCount("cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $aux_d['cod_dep'] . " and ano=" . $year . " and cod_sector=" . $aux_d['cod_sector'] . " and cod_programa=" . $aux_d['cod_programa'] . " and  cod_subprograma=" . $aux_d['cod_sub_prog'] . "  and numero_escala = " . $aux_d['numero_escala'] . "") == 0) {
                        $sql = "INSERT INTO cnmd05_escala_salario";
                        $sql.="(cod_presi, cod_entidad, cod_tipo_inst, cod_inst , cod_dep, ano, cod_sector, cod_programa, cod_subprograma, numero_escala, numero_cargo_actual, salario_actual, compensaciones_actual, primas_actual)";
                        $sql.=" VALUES ";
                        $sql.="('$cod_presi', '$cod_entidad', '$cod_tipo_inst', '$cod_inst', '" . $aux_d['cod_dep'] . "', '" . $aux_d['ano'] . "', '" . $aux_d['cod_sector'] . "', '" . $aux_d['cod_programa'] . "', '" . $aux_d['cod_sub_prog'] . "', '" . $aux_d['numero_escala'] . "',  '" . $aux_d['numero_cargo_actual'] . "', '" . $aux_d['sueldo_actual'] . "', '" . $aux_d['compensaciones_actual'] . "', '" . $aux_d['primas_actual'] . "')";
                        $this->cnmd05_escala_salario->execute($sql);
                    }//fin
                }//fin
            }//fin if




            /*
              if($consolidado==2){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
              $titulo_a = $this->Session->read('dependencia');
              }else if($consolidado==1){
              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
              $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
              }
              if($ano!=''){$condicion  = $sql." and ano=".$ano;$ano--;$condicion2 = $sql." and ano=".$ano;}else{$condicion  = $sql;$condicion2 = $sql;}
              $DATOS_res = $this->cnmd05_escala_salario->findAll($condicion." and cod_dep!=0  ", null, 'cod_sector, cod_programa, cod_subprograma, numero_escala ASC', null, null);
              $this->set('datos', $DATOS_res);
              $DATOS_res2 = $this->cnmd05_escala_salario->findAll($condicion2." and cod_dep!=0 ", null, 'cod_sector, cod_programa, cod_subprograma, numero_escala  ASC', null, null);
              $this->set('datos_aux', $DATOS_res2);




              $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
              $cnmd04_tipo = $this->cnmd04_tipo->findAll();
              $DATOS_res =$reporte;
              $this->set('reporte', $DATOS_res); */






            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }

            $ano2 = $ano;
            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
                $ano--;
                $condicion2 = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
                $condicion2 = $sql;
            }//finelse
            if ($consolidado == 2) {
                $campos = "
                  cod_presi,
                  cod_entidad,
                  cod_tipo_inst,
                  cod_inst,
                  cod_dep,
                  ano,
                  cod_sector,
                  cod_programa,
                  numero_escala,
                  SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                  SUM(salario_anterior)         as  salario_anterior,
                  SUM(compensaciones_anterior) as  compensaciones_anterior,
                  SUM(primas_anterior)         as  primas_anterior,
                  SUM(numero_cargo_actual)   as  numero_cargo_actual,
                  SUM(salario_actual)         as  salario_actual,
                  SUM(compensaciones_actual) as  compensaciones_actual,
                  SUM(primas_actual)         as  primas_actual
                ";
                $agrupar = 'GROUP BY  cod_presi,
                                      cod_entidad,
                                      cod_tipo_inst,
                                      cod_inst,
                                      cod_dep,
                                      ano,
                                      cod_sector,
                                      cod_programa,
                                      numero_escala';
                $adep_sql = "  a.cod_dep = " . $cod_dep . " and ";
                $adep_sql2 = " aa.cod_dep = " . $cod_dep . " and ";
                $bdep_sql2 = " bb.cod_dep = a.cod_dep and ";
            } else if ($consolidado == 1) {
                $campos = "
                          cod_presi,
                          cod_entidad,
                          cod_tipo_inst,
                          cod_inst,
                          ano,
                          cod_sector,
                          cod_programa,
                          numero_escala,
                          SUM(numero_cargo_anterior)   as  numero_cargo_anterior,
                          SUM(salario_anterior)         as  salario_anterior,
                          SUM(compensaciones_anterior) as  compensaciones_anterior,
                          SUM(primas_anterior)         as  primas_anterior,
                          SUM(numero_cargo_actual)   as  numero_cargo_actual,
                          SUM(salario_actual)         as  salario_actual,
                          SUM(compensaciones_actual) as  compensaciones_actual,
                          SUM(primas_actual)         as  primas_actual
                        ";
                $agrupar = 'GROUP BY   cod_presi,
                                              cod_entidad,
                                              cod_tipo_inst,
                                              cod_inst,
                                              ano,
                                              cod_sector,
                                              cod_programa,
                                              numero_escala';
                $adep_sql = "   ";
                $adep_sql2 = "  ";
                $bdep_sql2 = "  ";
            }//fin if
            $ano3 = $ano2 - 1;
            $cnmd04_ocupacion = $this->cnmd04_ocupacion->findAll();
            $cnmd04_tipo = $this->cnmd04_tipo->findAll();

            $random = rand() . "_" . $this->Session->read('SScodinst') . "_" . $this->Session->read('SScoddep');

            $this->cnmd05_clasificacion->execute("

        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . " AS

                              select
                                      aa.cod_presi,
                                      aa.cod_entidad,
                                      aa.cod_tipo_inst,
                                      aa.cod_inst,
                                      aa.cod_dep,
                                      " . $ano2 . " as ano,
                                      aa.cod_sector,
                                      aa.cod_programa,
                                      aa.cod_subprograma,
                                      aa.numero_escala,
                                      aa.numero_cargo_actual   as numero_cargo_anterior,
                                      aa.salario_actual        as salario_anterior,
                                      aa.compensaciones_actual as compensaciones_anterior,
                                      aa.primas_actual         as primas_anterior,
                                       (select numero_cargo_actual from cnmd05_escala_salario b where
                                              b.cod_presi        =  aa.cod_presi        and
                                              b.cod_entidad      =  aa.cod_entidad      and
                                              b.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              b.cod_inst         =  aa.cod_inst         and
                                              b.cod_dep          =  aa.cod_dep          and
                                              b.cod_sector       =  aa.cod_sector       and
                                              b.cod_programa     =  aa.cod_programa     and
                                              b.cod_subprograma  =  aa.cod_subprograma  and
                                              b.numero_escala    =  aa.numero_escala    and
                                              b.ano              =  " . $ano2 . " ) as numero_cargo_actual,
                                      (select salario_actual from cnmd05_escala_salario c where
                                              c.cod_presi        =  aa.cod_presi        and
                                              c.cod_entidad      =  aa.cod_entidad      and
                                              c.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              c.cod_inst         =  aa.cod_inst         and
                                              c.cod_dep          =  aa.cod_dep          and
                                              c.cod_sector       =  aa.cod_sector       and
                                              c.cod_programa     =  aa.cod_programa     and
                                              c.cod_subprograma  =  aa.cod_subprograma  and
                                              c.numero_escala    =  aa.numero_escala    and
                                              c.ano              =  " . $ano2 . " ) as salario_actual,
                                        (select compensaciones_actual from cnmd05_escala_salario d where
                                              d.cod_presi        =  aa.cod_presi        and
                                              d.cod_entidad      =  aa.cod_entidad      and
                                              d.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              d.cod_inst         =  aa.cod_inst         and
                                              d.cod_dep          =  aa.cod_dep          and
                                              d.cod_sector       =  aa.cod_sector       and
                                              d.cod_programa     =  aa.cod_programa     and
                                              d.cod_subprograma  =  aa.cod_subprograma  and
                                              d.numero_escala    =  aa.numero_escala    and
                                              d.ano              =  " . $ano2 . " ) as compensaciones_actual,
                                         (select primas_actual from cnmd05_escala_salario e where
                                              e.cod_presi        =  aa.cod_presi        and
                                              e.cod_entidad      =  aa.cod_entidad      and
                                              e.cod_tipo_inst    =  aa.cod_tipo_inst    and
                                              e.cod_inst         =  aa.cod_inst         and
                                              e.cod_dep          =  aa.cod_dep          and
                                              e.cod_sector       =  aa.cod_sector       and
                                              e.cod_programa     =  aa.cod_programa     and
                                              e.cod_subprograma  =  aa.cod_subprograma  and
                                              e.numero_escala    =  aa.numero_escala  and
                                              e.ano              =  " . $ano2 . " ) as primas_actual
                                from
                                      cnmd05_escala_salario aa
                                where
                                      aa.cod_presi     = " . $cod_presi . "     and
                                      aa.cod_entidad   = " . $cod_entidad . "   and
                                      aa.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      aa.cod_inst      = " . $cod_inst . "      and " . $adep_sql2 . "
                                      aa.ano           = " . $ano3 . ";

        ALTER TABLE v_cnmd05_anterior_actual_year_anterior_" . $random . " OWNER TO sisap;



        CREATE OR REPLACE VIEW v_cnmd05_anterior_actual_" . $random . " AS

                    select
                                      a.cod_presi,
                                      a.cod_entidad,
                                      a.cod_tipo_inst,
                                      a.cod_inst,
                                      a.cod_dep,
                                      a.ano,
                                      a.cod_sector,
                                      a.cod_programa,
                                      a.cod_subprograma,
                                      a.numero_escala,
                                      (select numero_cargo_actual from cnmd05_escala_salario b where
                                              b.cod_presi        =  a.cod_presi        and
                                              b.cod_entidad      =  a.cod_entidad      and
                                              b.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              b.cod_inst         =  a.cod_inst         and
                                              b.cod_dep          =  a.cod_dep          and
                                              b.cod_sector       =  a.cod_sector       and
                                              b.cod_programa     =  a.cod_programa     and
                                              b.cod_subprograma  =  a.cod_subprograma  and
                                              b.numero_escala    =  a.numero_escala    and
                                              b.ano              =  " . $ano3 . " ) as numero_cargo_anterior,
                                      (select salario_actual from cnmd05_escala_salario c where
                                              c.cod_presi        =  a.cod_presi        and
                                              c.cod_entidad      =  a.cod_entidad      and
                                              c.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              c.cod_inst         =  a.cod_inst         and
                                              c.cod_dep          =  a.cod_dep          and
                                              c.cod_sector       =  a.cod_sector       and
                                              c.cod_programa     =  a.cod_programa     and
                                              c.cod_subprograma  =  a.cod_subprograma  and
                                              c.numero_escala    =  a.numero_escala    and
                                              c.ano              =  " . $ano3 . " ) as salario_anterior,
                                        (select compensaciones_actual from cnmd05_escala_salario d where
                                              d.cod_presi        =  a.cod_presi        and
                                              d.cod_entidad      =  a.cod_entidad      and
                                              d.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              d.cod_inst         =  a.cod_inst         and
                                              d.cod_dep          =  a.cod_dep          and
                                              d.cod_sector       =  a.cod_sector       and
                                              d.cod_programa     =  a.cod_programa     and
                                              d.cod_subprograma  =  a.cod_subprograma  and
                                              d.numero_escala    =  a.numero_escala    and
                                              d.ano              =  " . $ano3 . " ) as compensaciones_anterior,
                                         (select primas_actual from cnmd05_escala_salario e where
                                              e.cod_presi        =  a.cod_presi        and
                                              e.cod_entidad      =  a.cod_entidad      and
                                              e.cod_tipo_inst    =  a.cod_tipo_inst    and
                                              e.cod_inst         =  a.cod_inst         and
                                              e.cod_dep          =  a.cod_dep          and
                                              e.cod_sector       =  a.cod_sector       and
                                              e.cod_programa     =  a.cod_programa     and
                                              e.cod_subprograma  =  a.cod_subprograma  and
                                              e.numero_escala    =  a.numero_escala    and
                                              e.ano              =  " . $ano3 . " ) as primas_anterior,
                                      a.numero_cargo_actual,
                                      a.salario_actual,
                                      a.compensaciones_actual,
                                      a.primas_actual
                                    from
                                          cnmd05_escala_salario a
                                    where
                                      a.cod_presi     = " . $cod_presi . "     and
                                      a.cod_entidad   = " . $cod_entidad . "   and
                                      a.cod_tipo_inst = " . $cod_tipo_inst . " and
                                      a.cod_inst      = " . $cod_inst . "      and " . $adep_sql . "
                                      a.ano           = " . $ano2 . "
                 UNION

                               select
                                    *
                              from
                                    v_cnmd05_anterior_actual_year_anterior_" . $random . " aa
                               where
                                    aa.numero_cargo_actual is null or aa.numero_cargo_actual=0;

                        ALTER TABLE v_cnmd05_anterior_actual_" . $random . " OWNER TO sisap; ");

            $DATOS_res = $this->cnmd05_clasificacion->execute("select * from v_cnmd05_anterior_actual_" . $random . "  order by  cod_sector, cod_programa, cod_subprograma, numero_escala  ASC;");
            $this->cnmd05_clasificacion->execute("DROP VIEW v_cnmd05_anterior_actual_" . $random . "; DROP VIEW v_cnmd05_anterior_actual_year_anterior_" . $random . ";");
            $this->set('datos', $DATOS_res);


            $this->set('titulo_a', $titulo_a);
            $this->set('cnmd04_tipo', $cnmd04_tipo);
            $this->set('cnmd04_ocupacion', $cnmd04_ocupacion);
            $this->set('sector', $this->cfpd02_sector->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprog', $this->cfpd02_sub_prog->findAll($this->condicionNDEP() . " and ano='" . $this->data['cnmp05']['ano'] . "' ", null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
        }//fin else
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2016_sub_prog

    function reporte_cfpd05_2017($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidado);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
//  $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $ejercicio = $ano;



            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst." and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }
            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_sector, cod_programa, cod_partida ASC', null, null);
            $this->set('datos', $DATOS_res);

            $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
            $programa = $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC');
            $this->set('sector', $sector);
            $this->set('programa', $programa);

            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function reporte_cfpd05_2017

    function reporte_cfpd05_2017_sub_prog($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }
            $sql = $this->SQLCA_consolidado($consolidado);




            if (isset($this->data['cfpp05']['consolidacion'])) {
                if ($this->data['cfpp05']['consolidacion'] == 2) {
                    $titulo_a = $_SESSION["dependencia_reporte_consolidado"];
                } else if ($this->data['cfpp05']['consolidacion'] == 1) {
                    $titulo_a = $this->Session->read('dependencia');
                }
            } else {
                $titulo_a = $this->Session->read('dependencia');
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
//  $cod_dep = $this->Session->read('SScoddep');
            $cod_dep = $_SESSION['cod_dep_reporte_consolidado'];
            $ejercicio = $ano;



            if ($consolidado == 2) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst."and cod_dep = ".$cod_dep;
//            $titulo_a = $this->Session->read('dependencia');
            } else if ($consolidado == 1) {
//              $sql = "cod_presi = ".$cod_presi." and cod_entidad = ".$cod_entidad." and cod_tipo_inst = ".$cod_tipo_inst." and cod_inst = ".$cod_inst;
//            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";
            }


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog,  cod_partida ASC', null, null);
            $this->set('datos', $DATOS_res);

            $sector = $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC');
            $programa = $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC');
            $this->set('sub_prog', $this->cfpd02_sub_prog->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
            $this->set('sector', $sector);
            $this->set('programa', $programa);

            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function reporte_cfpd05_sub_prog

    function forma_2013($year = null) {
        set_time_limit(0);
        $sql = '';

        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $campos = 'cod_presi ,
        cod_entidad,
        cod_tipo_inst,
        cod_inst,
        ano,
        cod_sector,
        cod_programa,
        cod_sub_prog,
        cod_proyecto,
        cod_activ_obra,
        SUM(asignacion_anual) as "asignacion_anual" ';

            $agrupar = 'GROUP BY cod_presi,
        cod_entidad,
        cod_tipo_inst,
        cod_inst,
        ano ,
        cod_sector ,
        cod_programa ,
        cod_sub_prog,
        cod_proyecto,
        cod_activ_obra';

            if ($ano != '') {
                $condicion_vision = $sql . " and ano=" . $ano . " and asignacion_anual!=0";
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion_vision = $sql . " and asignacion_anual!=0";
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion_vision . $agrupar, $campos, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra ASC', null, null);

            $this->set('datos', $DATOS_res);
            $this->set('sector', $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC', null, null, null));
            $this->set('programa', $this->cfpd02_programa->findAll($condicion, null, 'cod_sector, cod_programa ASC', null, null, null));
            $this->set('subprog', $this->cfpd02_sub_prog->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog ASC', null, null, null));
            $this->set('proyecto', $this->cfpd02_proyecto->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto ASC', null, null, null));
            $this->set('activ_obra', $this->cfpd02_activ_obra->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra  ASC', null, null, null));
            $this->set('cfpd09_metas_actividad', $this->cfpd09_metas_actividad->findAll($condicion, null, 'cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra  ASC', null, null, null));
            $this->set('titulo_a', $titulo_a);
        }

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2013

    function forma_2033($year = null) {


        set_time_limit(0);
        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            //$this->set('tipo', $tipo);

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            }
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = " where L.cod_presi = " . $cod_presi . " and L.cod_entidad = " . $cod_entidad . " and L.cod_tipo_inst = " . $cod_tipo_inst . " and L.cod_inst = " . $cod_inst . "and L.cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "where L.cod_presi = " . $cod_presi . " and L.cod_entidad = " . $cod_entidad . " and L.cod_tipo_inst = " . $cod_tipo_inst . " and L.cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            if ($ano != '') {
                $condicion = $sql . " and L.ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            //echo "SELECT *  FROM reporte_forma_2033 L  $condicion ORDER BY cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec ASC";
            $xx = $this->cfpd05->execute("SELECT *  FROM reporte_forma_2033 L  $condicion ORDER BY cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec ASC");
            $this->set('datos', $xx);
            $this->set('ejercicio', $ano);
            $this->set('titulo_a', $titulo_a);
        }//fin else


        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2010($year = null) {
        set_time_limit(0);
        $sql = '';

        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            //$this->set('tipo', $tipo);
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            $consolidado = 2;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            } else {
                $consolidado = 2;
            }

            if ($consolidado == 2) {
                $sql = " where L.cod_presi = " . $cod_presi . " and L.cod_entidad = " . $cod_entidad . " and L.cod_tipo_inst = " . $cod_tipo_inst . " and L.cod_inst = " . $cod_inst . " and L.cod_dep = " . $_SESSION['cod_dep_reporte_consolidado'];
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
                $modo_reporte = 2;
            } else if ($consolidado == 1) {
                $sql = "where L.cod_presi = " . $cod_presi . " and L.cod_entidad = " . $cod_entidad . " and L.cod_tipo_inst = " . $cod_tipo_inst . " and L.cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
                $modo_reporte = 1;
            }

            if ($ano != '') {
                $condicion = $sql . " and L.ano=" . $ano;
            } else {
                $condicion = $sql;
            }


            if ($modo_reporte == 1) {

                $xx = $this->cfpd05->execute("


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,
       L.ano,
       L.cod_partida,
       0 as cod_generica,
       0 as cod_especifica,
       0 as cod_sub_espec, 1 as tipo_fila,
       (select SUM(asignacion_anual) from cfpd05 where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst and ano=L.ano and cod_partida=L.cod_partida   and cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select denominacion from cfpd01_ano_2_partida where cfpd01_ano_2_partida.ejercicio=L.ano and cfpd01_ano_2_partida.cod_grupo=4 and cfpd01_ano_2_partida.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int limit 1) as denominacion
      FROM cfpd05 L, cfpd01_ano_2_partida " . $condicion . " and cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.ano,L.cod_partida


union



SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       0 as cod_especifica,
       0 as cod_sub_espec, 2 as tipo_fila,
       (select SUM(asignacion_anual) from cfpd05 where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst and ano=L.ano and cod_partida=L.cod_partida and cod_generica=L.cod_generica   and cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select denominacion from cfpd01_ano_3_generica where cfpd01_ano_3_generica.ejercicio=L.ano and cfpd01_ano_3_generica.cod_grupo=4 and cfpd01_ano_3_generica.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and cfpd01_ano_3_generica.cod_generica=L.cod_generica limit 1) as denominacion
      FROM cfpd05 L, cfpd01_ano_3_generica  " . $condicion . " and cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.ano,L.cod_partida,L.cod_generica


union


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       L.cod_especifica,
       0 as cod_sub_espec, 3 as tipo_fila,
       (select SUM(asignacion_anual) from cfpd05 where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst and ano=L.ano and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica    and cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select denominacion from cfpd01_ano_4_especifica where cfpd01_ano_4_especifica.ejercicio=L.ano and cfpd01_ano_4_especifica.cod_grupo=4 and cfpd01_ano_4_especifica.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and cfpd01_ano_4_especifica.cod_generica=L.cod_generica and cfpd01_ano_4_especifica.cod_especifica=L.cod_especifica limit 1) as denominacion
        FROM cfpd05 L, cfpd01_ano_4_especifica  " . $condicion . " and cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.ano,L.cod_partida,L.cod_generica,L.cod_especifica


union


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       L.cod_especifica,
       L.cod_sub_espec, 4 as tipo_fila,
       (select SUM(asignacion_anual) from cfpd05 where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst and ano=L.ano  and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec  and cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select denominacion from cfpd01_ano_5_sub_espec where cfpd01_ano_5_sub_espec.ejercicio=L.ano and cfpd01_ano_5_sub_espec.cod_grupo=4 and cfpd01_ano_5_sub_espec.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and cfpd01_ano_5_sub_espec.cod_generica=L.cod_generica and cfpd01_ano_5_sub_espec.cod_especifica=L.cod_especifica and cfpd01_ano_5_sub_espec.cod_sub_espec=L.cod_sub_espec limit 1) as denominacion
         FROM cfpd05 L, cfpd01_ano_5_sub_espec  " . $condicion . " and cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.ano,L.cod_partida,L.cod_generica,L.cod_especifica,L.cod_sub_espec order by 1,2,3,4,5,6,7,8,9



");
            } else {

                $xx = $this->cfpd05->execute("


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,L.cod_dep,
       L.ano,
       L.cod_partida,
       0 as cod_generica,
       0 as cod_especifica,
       0 as cod_sub_espec, 1 as tipo_fila,
       (select SUM(x.asignacion_anual) from cfpd05 x where x.cod_presi=L.cod_presi and x.cod_entidad=L.cod_entidad and x.cod_tipo_inst=L.cod_tipo_inst and x.cod_inst=L.cod_inst and x.cod_dep=L.cod_dep and x.ano=L.ano and x.cod_partida=L.cod_partida  and x.cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select x.denominacion from cfpd01_ano_2_partida x where x.ejercicio=L.ano and x.cod_grupo=4 and x.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int limit 1) as denominacion
      FROM cfpd05 L " . $condicion . " and L.cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.cod_dep,L.ano,L.cod_partida


union



SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,L.cod_dep,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       0 as cod_especifica,
       0 as cod_sub_espec, 2 as tipo_fila,
       (select SUM(x.asignacion_anual) from cfpd05 x where x.cod_presi=L.cod_presi and x.cod_entidad=L.cod_entidad and x.cod_tipo_inst=L.cod_tipo_inst and x.cod_inst=L.cod_inst and x.cod_dep=L.cod_dep and x.ano=L.ano and x.cod_partida=L.cod_partida and x.cod_generica=L.cod_generica  and x.cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select x.denominacion from cfpd01_ano_3_generica x where x.ejercicio=L.ano and x.cod_grupo=4 and x.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and x.cod_generica=L.cod_generica limit 1) as denominacion
      FROM cfpd05 L  " . $condicion . " and L.cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.cod_dep,L.ano,L.cod_partida,L.cod_generica


union


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,L.cod_dep,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       L.cod_especifica,
       0 as cod_sub_espec, 3 as tipo_fila,
       (select SUM(x.asignacion_anual) from cfpd05 x where x.cod_presi=L.cod_presi and x.cod_entidad=L.cod_entidad and x.cod_tipo_inst=L.cod_tipo_inst and x.cod_inst=L.cod_inst and cod_dep=L.cod_dep and ano=L.ano and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica   and x.cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select x.denominacion from cfpd01_ano_4_especifica x where x.ejercicio=L.ano and x.cod_grupo=4 and x.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and x.cod_generica=L.cod_generica and x.cod_especifica=L.cod_especifica limit 1) as denominacion
        FROM cfpd05 L  " . $condicion . " and L.cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.cod_dep,L.ano,L.cod_partida,L.cod_generica,L.cod_especifica


union


SELECT L.cod_presi,
       L.cod_entidad,
       L.cod_tipo_inst,
       L.cod_inst,L.cod_dep,
       L.ano,
       L.cod_partida,
       L.cod_generica,
       L.cod_especifica,
       L.cod_sub_espec, 4 as tipo_fila,
       (select SUM(asignacion_anual) from cfpd05 where cod_presi=L.cod_presi and cod_entidad=L.cod_entidad and cod_tipo_inst=L.cod_tipo_inst and cod_inst=L.cod_inst and cod_dep=L.cod_dep and ano=L.ano  and cod_partida=L.cod_partida and cod_generica=L.cod_generica and cod_especifica=L.cod_especifica and cod_sub_espec=L.cod_sub_espec  and cod_tipo_gasto=2) as asignacion_presupuestaria,
       (select denominacion from cfpd01_ano_5_sub_espec where cfpd01_ano_5_sub_espec.ejercicio=L.ano and cfpd01_ano_5_sub_espec.cod_grupo=4 and cfpd01_ano_5_sub_espec.cod_partida=substr(CAST (L.cod_partida AS text),2,2)::int and cfpd01_ano_5_sub_espec.cod_generica=L.cod_generica and cfpd01_ano_5_sub_espec.cod_especifica=L.cod_especifica and cfpd01_ano_5_sub_espec.cod_sub_espec=L.cod_sub_espec limit 1) as denominacion
         FROM cfpd05 L  " . $condicion . " and L.cod_tipo_gasto=2 and L.asignacion_anual!=0 group by L.cod_presi,L.cod_entidad,L.cod_tipo_inst,L.cod_inst,L.cod_dep,L.ano,L.cod_partida,L.cod_generica,L.cod_especifica,L.cod_sub_espec order by 1,2,3,4,5,6,7,8,9



");
            }

            $this->set('datos', $xx);
            $this->set('ejercicio', $ano);
            $this->set('titulo_a', $titulo_a);
        }//fin else

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2010

    function plan_inversion($year = null) {



        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');
            //$this->set('tipo', $tipo);

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
            }


            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $ejercicio = $ano;



            $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
            $titulo_a = "DIRECCIÓN ESTADAL DE PRESUPUESTO";


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('datos', $this->cfpd07_plan_inversion->findAll('cod_presi=' . $cod_presi . ' and cod_entidad=' . $cod_entidad . ' and cod_tipo_inst=' . $cod_tipo_inst . ' and cod_inst=' . $cod_inst . ' and ano_recurso=' . $ano, null, 'tipo_recurso, clasificacion_recurso ASC', null, null, null));
            $this->set('datos2', $this->cfpd07_clasificacion_recurso->findAll('cod_presi=' . $cod_presi . ' and cod_entidad=' . $cod_entidad . ' and cod_tipo_inst=' . $cod_tipo_inst . ' and cod_inst=' . $cod_inst . '', null, 'tipo_recurso, clasificacion_recurso ASC', null, null, null));


            $this->set('titulo_a', $titulo_a);
        }//fin else

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2009($year = null) {
        set_time_limit(0);
        $sql = '';

        if (!$year) {
            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;

            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {
                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {

            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 2;
            if (isset($this->data['cfpp05']['consolidacion'])) {
                $consolidado = $this->data['cfpp05']['consolidacion'];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $campos = 'cod_presi ,
                    cod_entidad,
                    cod_tipo_inst,
                    cod_inst,
                    ano,
                    cod_sector,
                    SUM(asignacion_anual) as "asignacion_anual" ';
            $agrupar = 'GROUP BY cod_presi,
                    cod_entidad,
                    cod_tipo_inst,
                    cod_inst,
                    ano ,
                    cod_sector';

            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('partida', $this->cfpd01_ano_partida->findAll('ejercicio=' . $ejercicio, null, 'cod_grupo, cod_partida ASC', null, null, null));

            $DATOS_res = $this->cfpd05->findAll($condicion . $agrupar, $campos, ' cod_sector ASC', null, null);
            $this->set('datos', $DATOS_res);
            $this->set('sector', $this->cfpd02_sector->findAll($condicion, null, 'cod_sector ASC', null, null, null));
            $this->set('cfpd09_metas_sector', $this->cfpd09_metas_sector->findAll($condicion, null, 'cod_sector  ASC', null, null, null));
            $this->set('titulo_a', $titulo_a);
        }

        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function forma_2009

    function forma_2027($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 1;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }


            $campos = ' cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano,
SUM(asignacion_anual) as "asignacion_anual" ';
            $agrupar = ' GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano';


            if ($ano != '') {
                $ano_aux = $ano - 3;
                $condicion = $sql . " and ano>=" . $ano_aux;
            } else {
                $condicion = $sql;
            }

            $DATOS_res = $this->cfpd05->findAll($condicion . $agrupar, $campos, ' cod_dep ASC', null, null);

            $this->set('datos', $DATOS_res);
            $this->set('arrd05', $this->arrd05->findAll($sql . ' and cod_dep>=1000 and cod_dep<=2000', null, 'cod_presi, cod_entidad, cod_tipo_inst, denominacion ASC', null, null, null));
            $this->set('titulo_a', $titulo_a);
            $this->set('ejercicio', $ano);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function forma_2025($year = null) {

        $sql = '';

        if (!$year) {

            $this->layout = "ajax";
            $this->limpia_menu();
            $this->set('ir', 'no');

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('SScoddep');
            $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;


            $year = $this->cfpd01_formulacion->findAll($condicion, null, 'ano_formular ASC', null);
            $dato = null;
            foreach ($year as $year) {
                $dato = $year['cfpd01_formulacion']['ano_formular'];
            }

            if (!empty($dato)) {

                $this->set('year', $dato);
            } else {
                $this->set('year', '');
            }
        } else {


            $this->layout = "pdf";
            $ano = '';
            $ano = $this->data['cfpp05']['ano'];
            $consolidado = 1;
            if (isset($this->data["cfpp05"]["consolidacion"])) {
                $consolidado = $this->data["cfpp05"]["consolidacion"];
            }

            $cod_presi = $this->Session->read('SScodpresi');
            $cod_entidad = $this->Session->read('SScodentidad');
            $cod_tipo_inst = $this->Session->read('SScodtipoinst');
            $cod_inst = $this->Session->read('SScodinst');
            $cod_dep = $this->Session->read('cod_dep_reporte_consolidado');
            $ejercicio = $ano;

            if ($consolidado == 2) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . "and cod_dep = " . $cod_dep;
                $titulo_a = $this->Session->read('dependencia_reporte_consolidado');
            } else if ($consolidado == 1) {
                $sql = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst;
                $titulo_a = $this->Session->read('dependencia');
            }

            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst,
ano,
cod_sector, cod_programa, cod_sub_prog, cod_partida, cod_generica, cod_especifica,
SUM(asignacion_anual) as "asignacion_anual" ';
            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst,
ano ,
cod_sector, cod_programa, cod_sub_prog, cod_partida, cod_generica, cod_especifica';


            if ($ano != '') {
                $condicion = $sql . " and ano=" . $ano;
            } else {
                $condicion = $sql;
            }

            $this->set('especifica', $this->cfpd01_ano_especifica->findAll('ejercicio=' . $ejercicio . ' and cod_grupo=4 and cod_partida=7 and (cod_generica=1 or cod_generica=2) and cod_especifica=2', null, 'cod_grupo, cod_partida, cod_generica, cod_especifica  ASC', null, null, null));

            // and cod_generica=1 and cod_generica=2 and cod_especifica=2

            $DATOS_res = $this->cfpd05->findAll($condicion . ' and cod_partida=407 and (cod_generica=1 or cod_generica=2) and cod_especifica=2' . $agrupar, $campos, ' cod_sector, cod_programa, cod_sub_prog, cod_partida, cod_generica, cod_especifica ASC', null, null);

            $this->set('datos', $DATOS_res);
            $this->set('titulo_a', $titulo_a);
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//fin function

    function envia_form_firmas($num_tipo_doc = null, $cant_firmas = 8) {
        // $this->layout="ajax";

        if ($num_tipo_doc != null) {

            $firmantes = $this->cugd99_firmas_responsabilidad->findAll($this->SQLCA() . " and cod_tipo_documento=" . $num_tipo_doc, null, null, 1, 1, null);

            if ($firmantes != null) {
                $this->set('firma_existe', 'si');
                $this->set('b_readonly', 'readonly');
                $this->set('tipo_documento', $firmantes[0]['cugd99_firmas_responsabilidad']['cod_tipo_documento']);

                switch ((int) $cant_firmas) {
                    case 1:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);
                        break;


                    case 2:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);
                        break;


                    case 3:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);
                        break;


                    case 4:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);
                        break;


                    case 5:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);
                        break;


                    case 6:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);
                        break;


                    case 7:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);
                        break;


                    case 8:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);

                        $this->set('responsa_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_octava_firma']);
                        $this->set('funcionario_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_octava_firma']);
                        $this->set('cargo_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_octava_firma']);
                        $this->set('cedula_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_octava_firma']);
                        break;

                    default:
                        $this->set('responsa_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);

                        $this->set('responsa_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_octava_firma']);
                        $this->set('funcionario_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_octava_firma']);
                        $this->set('cargo_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_octava_firma']);
                        $this->set('cedula_octava_firma', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_octava_firma']);
                        break;
                }
            } else {
                $this->set('Message_existe2', 'POR FAVOR, INGRESE LOS NOMBRES Y CARGO DE LOS FIRMANTES');
                $this->set('firma_existe', 'no');
                $this->set('b_readonly', '');
                $this->set('tipo_documento', $num_tipo_doc);

                $this->set('responsa_primera_firma', '');
                $this->set('funcionario_primera_firma', '');
                $this->set('cargo_primera_firma', '');
                $this->set('cedula_primera_firma', '');

                $this->set('responsa_segunda_firma', '');
                $this->set('funcionario_segunda_firma', '');
                $this->set('cargo_segunda_firma', '');
                $this->set('cedula_segunda_firma', '');

                $this->set('responsa_tercera_firma', '');
                $this->set('funcionario_tercera_firma', '');
                $this->set('cargo_tercera_firma', '');
                $this->set('cedula_tercera_firma', '');

                $this->set('responsa_cuarta_firma', '');
                $this->set('funcionario_cuarta_firma', '');
                $this->set('cargo_cuarta_firma', '');
                $this->set('cedula_cuarta_firma', '');

                $this->set('responsa_quinta_firma', '');
                $this->set('funcionario_quinta_firma', '');
                $this->set('cargo_quinta_firma', '');
                $this->set('cedula_quinta_firma', '');

                $this->set('responsa_sexta_firma', '');
                $this->set('funcionario_sexta_firma', '');
                $this->set('cargo_sexta_firma', '');
                $this->set('cedula_sexta_firma', '');

                $this->set('responsa_septima_firma', '');
                $this->set('funcionario_septima_firma', '');
                $this->set('cargo_septima_firma', '');
                $this->set('cedula_septima_firma', '');

                $this->set('responsa_octava_firma', '');
                $this->set('funcionario_octava_firma', '');
                $this->set('cargo_octava_firma', '');
                $this->set('cedula_octava_firma', '');
            }
        } else {
            $this->set('errorMessage2', 'Disculpe, No llego el C&oacute;digo del Tipo de Documento para realizar el proceso de firmas');
        } // fin else num_tipo_doc dif. null
    }

    
   function envia_form_firmas1($num_tipo_doc = null, $cant_firmas = null) {
        // $this->layout="ajax";

        if ($num_tipo_doc != null) {

            $firmantes = $this->cugd99_firmas_responsabilidad->findAll($this->SQLCA() . " and cod_tipo_documento=" . $num_tipo_doc, null, null, 1, 1, null);

            if ($firmantes != null) {
                $this->set('firma_existe1', 'si');
                $this->set('b_readonly1', 'readonly');
                $this->set('tipo_documento1', $firmantes[0]['cugd99_firmas_responsabilidad']['cod_tipo_documento']);

                switch ((int) $cant_firmas) {
                    case 1:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);
                        break;


                    case 2:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);
                        break;


                    case 3:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);
                        break;


                    case 4:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);
                        break;


                    case 5:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);
                        break;


                    case 6:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);
                        break;


                    case 7:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);
                        break;


                    case 8:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);

                        $this->set('responsa_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_octava_firma']);
                        $this->set('funcionario_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_octava_firma']);
                        $this->set('cargo_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_octava_firma']);
                        $this->set('cedula_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_octava_firma']);
                        break;

                    default:
                        $this->set('responsa_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_primera_firma']);
                        $this->set('funcionario_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_primera_firma']);
                        $this->set('cargo_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_primera_firma']);
                        $this->set('cedula_primera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_primera_firma']);

                        $this->set('responsa_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_segunda_firma']);
                        $this->set('funcionario_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_segunda_firma']);
                        $this->set('cargo_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_segunda_firma']);
                        $this->set('cedula_segunda_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_segunda_firma']);

                        $this->set('responsa_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_tercera_firma']);
                        $this->set('funcionario_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_tercera_firma']);
                        $this->set('cargo_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_tercera_firma']);
                        $this->set('cedula_tercera_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_tercera_firma']);

                        $this->set('responsa_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_cuarta_firma']);
                        $this->set('funcionario_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_cuarta_firma']);
                        $this->set('cargo_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_cuarta_firma']);
                        $this->set('cedula_cuarta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_cuarta_firma']);

                        $this->set('responsa_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_quinta_firma']);
                        $this->set('funcionario_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_quinta_firma']);
                        $this->set('cargo_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_quinta_firma']);
                        $this->set('cedula_quinta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_quinta_firma']);

                        $this->set('responsa_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_sexta_firma']);
                        $this->set('funcionario_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_sexta_firma']);
                        $this->set('cargo_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_sexta_firma']);
                        $this->set('cedula_sexta_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_sexta_firma']);

                        $this->set('responsa_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_septima_firma']);
                        $this->set('funcionario_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_septima_firma']);
                        $this->set('cargo_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_septima_firma']);
                        $this->set('cedula_septima_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_septima_firma']);

                        $this->set('responsa_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['responsa_octava_firma']);
                        $this->set('funcionario_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['funcionario_octava_firma']);
                        $this->set('cargo_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cargo_octava_firma']);
                        $this->set('cedula_octava_firma1', $firmantes[0]['cugd99_firmas_responsabilidad']['cedula_octava_firma']);
                        break;
                }
            } else {
                $this->set('Message_existe2', 'POR FAVOR, INGRESE LOS NOMBRES Y CARGO DE LOS FIRMANTES');
                $this->set('firma_existe1', 'no');
                $this->set('b_readonly1', '');
                $this->set('tipo_documento1', $num_tipo_doc);

                $this->set('responsa_primera_firma1', '');
                $this->set('funcionario_primera_firma1', '');
                $this->set('cargo_primera_firma1', '');
                $this->set('cedula_primera_firma1', '');

                $this->set('responsa_segunda_firma1', '');
                $this->set('funcionario_segunda_firma1', '');
                $this->set('cargo_segunda_firma1', '');
                $this->set('cedula_segunda_firma1', '');

                $this->set('responsa_tercera_firma1', '');
                $this->set('funcionario_tercera_firma1', '');
                $this->set('cargo_tercera_firma1', '');
                $this->set('cedula_tercera_firma1', '');

                $this->set('responsa_cuarta_firma1', '');
                $this->set('funcionario_cuarta_firma1', '');
                $this->set('cargo_cuarta_firma1', '');
                $this->set('cedula_cuarta_firma1', '');

                $this->set('responsa_quinta_firma1', '');
                $this->set('funcionario_quinta_firma1', '');
                $this->set('cargo_quinta_firma1', '');
                $this->set('cedula_quinta_firma1', '');

                $this->set('responsa_sexta_firma1', '');
                $this->set('funcionario_sexta_firma1', '');
                $this->set('cargo_sexta_firma1', '');
                $this->set('cedula_sexta_firma1', '');

                $this->set('responsa_septima_firma1', '');
                $this->set('funcionario_septima_firma1', '');
                $this->set('cargo_septima_firma1', '');
                $this->set('cedula_septima_firma1', '');

                $this->set('responsa_octava_firma1', '');
                $this->set('funcionario_octava_firma1', '');
                $this->set('cargo_octava_firma1', '');
                $this->set('cedula_octava_firma1', '');
            }
        } else {
            $this->set('errorMessage2', 'Disculpe, No llego el C&oacute;digo del Tipo de Documento para realizar el proceso de firmas');
        } // fin else num_tipo_doc dif. null
    }
  
    
    
// fin funcion envia_form_firmas

    function guardar_editar_firmas($varf = null, $cantf = null) {
        $this->layout = "ajax";

        $cp = $this->Session->read('SScodpresi');
        $ce = $this->Session->read('SScodentidad');
        $cti = $this->Session->read('SScodtipoinst');
        $ci = $this->Session->read('SScodinst');
        $cd = $this->Session->read('SScoddep');

        if ($varf == 'no') {
            $this->set('varf', '' . $varf);
            $this->set('cantf', '' . $cantf);
            echo "<script>document.getElementById('link_limpiaf').style.display= 'block';</script>";
            $this->set('Message_existe', 'Puede modificar los datos de los firmantes...');
        } else if ($varf == 'si') {

            $modelo = 'reporte';

            $tipo_doc = $this->data[$modelo]['cod_tipo_documento'];
            $r1 = isset($this->data[$modelo]['responsa_primera_firma']) ? $this->data[$modelo]['responsa_primera_firma'] : '';
            $f1 = isset($this->data[$modelo]['funcionario_primera_firma']) ? $this->data[$modelo]['funcionario_primera_firma'] : '';
            $ca1 = isset($this->data[$modelo]['cargo_primera_firma']) ? $this->data[$modelo]['cargo_primera_firma'] : '';
            $ce1 = isset($this->data[$modelo]['cedula_primera_firma']) ? $this->data[$modelo]['cedula_primera_firma'] : '';

            $r2 = isset($this->data[$modelo]['responsa_segunda_firma']) ? $this->data[$modelo]['responsa_segunda_firma'] : '';
            $f2 = isset($this->data[$modelo]['funcionario_segunda_firma']) ? $this->data[$modelo]['funcionario_segunda_firma'] : '';
            $ca2 = isset($this->data[$modelo]['cargo_segunda_firma']) ? $this->data[$modelo]['cargo_segunda_firma'] : '';
            $ce2 = isset($this->data[$modelo]['cedula_segunda_firma']) ? $this->data[$modelo]['cedula_segunda_firma'] : '';

            $r3 = isset($this->data[$modelo]['responsa_tercera_firma']) ? $this->data[$modelo]['responsa_tercera_firma'] : '';
            $f3 = isset($this->data[$modelo]['funcionario_tercera_firma']) ? $this->data[$modelo]['funcionario_tercera_firma'] : '';
            $ca3 = isset($this->data[$modelo]['cargo_tercera_firma']) ? $this->data[$modelo]['cargo_tercera_firma'] : '';
            $ce3 = isset($this->data[$modelo]['cedula_tercera_firma']) ? $this->data[$modelo]['cedula_tercera_firma'] : '';

            $r4 = isset($this->data[$modelo]['responsa_cuarta_firma']) ? $this->data[$modelo]['responsa_cuarta_firma'] : '';
            $f4 = isset($this->data[$modelo]['funcionario_cuarta_firma']) ? $this->data[$modelo]['funcionario_cuarta_firma'] : '';
            $ca4 = isset($this->data[$modelo]['cargo_cuarta_firma']) ? $this->data[$modelo]['cargo_cuarta_firma'] : '';
            $ce4 = isset($this->data[$modelo]['cedula_cuarta_firma']) ? $this->data[$modelo]['cedula_cuarta_firma'] : '';

            $r5 = isset($this->data[$modelo]['responsa_quinta_firma']) ? $this->data[$modelo]['responsa_quinta_firma'] : '';
            $f5 = isset($this->data[$modelo]['funcionario_quinta_firma']) ? $this->data[$modelo]['funcionario_quinta_firma'] : '';
            $ca5 = isset($this->data[$modelo]['cargo_quinta_firma']) ? $this->data[$modelo]['cargo_quinta_firma'] : '';
            $ce5 = isset($this->data[$modelo]['cedula_quinta_firma']) ? $this->data[$modelo]['cedula_quinta_firma'] : '';

            $r6 = isset($this->data[$modelo]['responsa_sexta_firma']) ? $this->data[$modelo]['responsa_sexta_firma'] : '';
            $f6 = isset($this->data[$modelo]['funcionario_sexta_firma']) ? $this->data[$modelo]['funcionario_sexta_firma'] : '';
            $ca6 = isset($this->data[$modelo]['cargo_sexta_firma']) ? $this->data[$modelo]['cargo_sexta_firma'] : '';
            $ce6 = isset($this->data[$modelo]['cedula_sexta_firma']) ? $this->data[$modelo]['cedula_sexta_firma'] : '';

            $r7 = isset($this->data[$modelo]['responsa_septima_firma']) ? $this->data[$modelo]['responsa_septima_firma'] : '';
            $f7 = isset($this->data[$modelo]['funcionario_septima_firma']) ? $this->data[$modelo]['funcionario_septima_firma'] : '';
            $ca7 = isset($this->data[$modelo]['cargo_septima_firma']) ? $this->data[$modelo]['cargo_septima_firma'] : '';
            $ce7 = isset($this->data[$modelo]['cedula_septima_firma']) ? $this->data[$modelo]['cedula_septima_firma'] : '';

            $r8 = isset($this->data[$modelo]['responsa_octava_firma']) ? $this->data[$modelo]['responsa_octava_firma'] : '';
            $f8 = isset($this->data[$modelo]['funcionario_octava_firma']) ? $this->data[$modelo]['funcionario_octava_firma'] : '';
            $ca8 = isset($this->data[$modelo]['cargo_octava_firma']) ? $this->data[$modelo]['cargo_octava_firma'] : '';
            $ce8 = isset($this->data[$modelo]['cedula_octava_firma']) ? $this->data[$modelo]['cedula_octava_firma'] : '';

            $enc_td_firma = $this->cugd99_firmas_responsabilidad->findCount($this->SQLCA() . " and cod_tipo_documento=$tipo_doc");

            if ($enc_td_firma == 0) {
                $muestr_accion = 'Registradas';
                $sql_ejecutar = "INSERT INTO cugd99_firmas_responsabilidad VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc, '$r1', '$f1', '$ca1', '$ce1','$r2', '$f2', '$ca2', '$ce2', '$r3', '$f3', '$ca3', '$ce3', '$r4', '$f4', '$ca4', '$ce4', '$r5', '$f5', '$ca5', '$ce5', '$r6', '$f6', '$ca6', '$ce6', '$r7', '$f7', '$ca7', '$ce7', '$r8', '$f8', '$ca8', '$ce8');";
            } else {
                $muestr_accion = 'Modificadas';
                $sql_ejecutar = "UPDATE cugd99_firmas_responsabilidad SET responsa_primera_firma='$r1', funcionario_primera_firma='$f1', cargo_primera_firma='$ca1', cedula_primera_firma='$ce1', responsa_segunda_firma='$r2', funcionario_segunda_firma='$f2', cargo_segunda_firma='$ca2', cedula_segunda_firma='$ce2', responsa_tercera_firma='$r3', funcionario_tercera_firma='$f3', cargo_tercera_firma='$ca3', cedula_tercera_firma='$ce3', responsa_cuarta_firma='$r4', funcionario_cuarta_firma='$f4', cargo_cuarta_firma='$ca4', cedula_cuarta_firma='$ce4', responsa_quinta_firma='$r5', funcionario_quinta_firma='$f5', cargo_quinta_firma='$ca5', cedula_quinta_firma='$ce5', responsa_sexta_firma='$r6', funcionario_sexta_firma='$f6', cargo_sexta_firma='$ca6', cedula_sexta_firma='$ce6', responsa_septima_firma='$r7', funcionario_septima_firma='$f7', cargo_septima_firma='$ca7', cedula_septima_firma='$ce7', responsa_octava_firma='$r8', funcionario_octava_firma='$f8', cargo_octava_firma='$ca8', cedula_octava_firma='$ce8' WHERE " . $this->SQLCA() . " and cod_tipo_documento=" . $tipo_doc;
            }

            $swi = $this->cugd99_firmas_responsabilidad->execute($sql_ejecutar);

            $this->set('varf', '' . $varf);
            $this->set('cantf', '' . $cantf);

            if ($swi > 1) {
                if ($muestr_accion == 'Modificadas') {
                    echo "<script>document.getElementById('link_limpiaf').style.display= 'none';</script>";
                }
                $this->set('Message_existe', 'Las firmas fuer&oacute;n ' . $muestr_accion . ' correctamente');
            } else {
                $this->set('errorMessage', 'Las firmas no fuer&oacute;n ' . $muestr_accion . '');
            }
        } else {
            $this->set('errorMessage', 'Lo siento la informaci&oacute;n no puede ser procesada...');
        }
    }

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
     function guardar_editar_firmas1($varf = null, $cantf = null) {
        $this->layout = "ajax";

        $cp = $this->Session->read('SScodpresi');
        $ce = $this->Session->read('SScodentidad');
        $cti = $this->Session->read('SScodtipoinst');
        $ci = $this->Session->read('SScodinst');
        $cd = $this->Session->read('SScoddep');

        if ($varf == 'no') {
            $this->set('varf', '' . $varf);
            $this->set('cantf', '' . $cantf);
            echo "<script>document.getElementById('link_limpiaf1').style.display= 'block';</script>";
            $this->set('Message_existe', 'Puede modificar los datos de los firmantes...');
        } else if ($varf == 'si') {

            $modelo = 'reporte';

            $tipo_doc = $this->data[$modelo]['cod_tipo_documento1'];
            $r1 = isset($this->data[$modelo]['responsa_primera_firma1']) ? $this->data[$modelo]['responsa_primera_firma1'] : '';
            $f1 = isset($this->data[$modelo]['funcionario_primera_firma1']) ? $this->data[$modelo]['funcionario_primera_firma1'] : '';
            $ca1 = isset($this->data[$modelo]['cargo_primera_firma1']) ? $this->data[$modelo]['cargo_primera_firma1'] : '';
            $ce1 = isset($this->data[$modelo]['cedula_primera_firma1']) ? $this->data[$modelo]['cedula_primera_firma1'] : '';

            $r2 = isset($this->data[$modelo]['responsa_segunda_firma1']) ? $this->data[$modelo]['responsa_segunda_firma1'] : '';
            $f2 = isset($this->data[$modelo]['funcionario_segunda_firma1']) ? $this->data[$modelo]['funcionario_segunda_firma1'] : '';
            $ca2 = isset($this->data[$modelo]['cargo_segunda_firma1']) ? $this->data[$modelo]['cargo_segunda_firma1'] : '';
            $ce2 = isset($this->data[$modelo]['cedula_segunda_firma1']) ? $this->data[$modelo]['cedula_segunda_firma1'] : '';

            $r3 = isset($this->data[$modelo]['responsa_tercera_firma1']) ? $this->data[$modelo]['responsa_tercera_firma1'] : '';
            $f3 = isset($this->data[$modelo]['funcionario_tercera_firma1']) ? $this->data[$modelo]['funcionario_tercera_firma1'] : '';
            $ca3 = isset($this->data[$modelo]['cargo_tercera_firma1']) ? $this->data[$modelo]['cargo_tercera_firma1'] : '';
            $ce3 = isset($this->data[$modelo]['cedula_tercera_firma1']) ? $this->data[$modelo]['cedula_tercera_firma1'] : '';

            $r4 = isset($this->data[$modelo]['responsa_cuarta_firma1']) ? $this->data[$modelo]['responsa_cuarta_firma1'] : '';
            $f4 = isset($this->data[$modelo]['funcionario_cuarta_firma1']) ? $this->data[$modelo]['funcionario_cuarta_firma1'] : '';
            $ca4 = isset($this->data[$modelo]['cargo_cuarta_firma1']) ? $this->data[$modelo]['cargo_cuarta_firma1'] : '';
            $ce4 = isset($this->data[$modelo]['cedula_cuarta_firma1']) ? $this->data[$modelo]['cedula_cuarta_firma1'] : '';

            $r5 = isset($this->data[$modelo]['responsa_quinta_firma1']) ? $this->data[$modelo]['responsa_quinta_firma1'] : '';
            $f5 = isset($this->data[$modelo]['funcionario_quinta_firma1']) ? $this->data[$modelo]['funcionario_quinta_firma1'] : '';
            $ca5 = isset($this->data[$modelo]['cargo_quinta_firma1']) ? $this->data[$modelo]['cargo_quinta_firma1'] : '';
            $ce5 = isset($this->data[$modelo]['cedula_quinta_firma1']) ? $this->data[$modelo]['cedula_quinta_firma1'] : '';

            $r6 = isset($this->data[$modelo]['responsa_sexta_firma1']) ? $this->data[$modelo]['responsa_sexta_firma1'] : '';
            $f6 = isset($this->data[$modelo]['funcionario_sexta_firma1']) ? $this->data[$modelo]['funcionario_sexta_firma1'] : '';
            $ca6 = isset($this->data[$modelo]['cargo_sexta_firma1']) ? $this->data[$modelo]['cargo_sexta_firma1'] : '';
            $ce6 = isset($this->data[$modelo]['cedula_sexta_firma1']) ? $this->data[$modelo]['cedula_sexta_firma1'] : '';

            $r7 = isset($this->data[$modelo]['responsa_septima_firma1']) ? $this->data[$modelo]['responsa_septima_firma1'] : '';
            $f7 = isset($this->data[$modelo]['funcionario_septima_firma1']) ? $this->data[$modelo]['funcionario_septima_firma1'] : '';
            $ca7 = isset($this->data[$modelo]['cargo_septima_firma1']) ? $this->data[$modelo]['cargo_septima_firma1'] : '';
            $ce7 = isset($this->data[$modelo]['cedula_septima_firma1']) ? $this->data[$modelo]['cedula_septima_firma1'] : '';

            $r8 = isset($this->data[$modelo]['responsa_octava_firma1']) ? $this->data[$modelo]['responsa_octava_firma1'] : '';
            $f8 = isset($this->data[$modelo]['funcionario_octava_firma1']) ? $this->data[$modelo]['funcionario_octava_firma1'] : '';
            $ca8 = isset($this->data[$modelo]['cargo_octava_firma1']) ? $this->data[$modelo]['cargo_octava_firm1'] : '';
            $ce8 = isset($this->data[$modelo]['cedula_octava_firma1']) ? $this->data[$modelo]['cedula_octava_firma1'] : '';

            $enc_td_firma = $this->cugd99_firmas_responsabilidad->findCount($this->SQLCA() . " and cod_tipo_documento=$tipo_doc");

            if ($enc_td_firma == 0) {
                $muestr_accion = 'Registradas';
                $sql_ejecutar = "INSERT INTO cugd99_firmas_responsabilidad VALUES ($cp, $ce, $cti, $ci, $cd, $tipo_doc, '$r1', '$f1', '$ca1', '$ce1','$r2', '$f2', '$ca2', '$ce2', '$r3', '$f3', '$ca3', '$ce3', '$r4', '$f4', '$ca4', '$ce4', '$r5', '$f5', '$ca5', '$ce5', '$r6', '$f6', '$ca6', '$ce6', '$r7', '$f7', '$ca7', '$ce7', '$r8', '$f8', '$ca8', '$ce8');";
            } else {
                $muestr_accion = 'Modificadas';
                $sql_ejecutar = "UPDATE cugd99_firmas_responsabilidad SET responsa_primera_firma='$r1', funcionario_primera_firma='$f1', cargo_primera_firma='$ca1', cedula_primera_firma='$ce1', responsa_segunda_firma='$r2', funcionario_segunda_firma='$f2', cargo_segunda_firma='$ca2', cedula_segunda_firma='$ce2', responsa_tercera_firma='$r3', funcionario_tercera_firma='$f3', cargo_tercera_firma='$ca3', cedula_tercera_firma='$ce3', responsa_cuarta_firma='$r4', funcionario_cuarta_firma='$f4', cargo_cuarta_firma='$ca4', cedula_cuarta_firma='$ce4', responsa_quinta_firma='$r5', funcionario_quinta_firma='$f5', cargo_quinta_firma='$ca5', cedula_quinta_firma='$ce5', responsa_sexta_firma='$r6', funcionario_sexta_firma='$f6', cargo_sexta_firma='$ca6', cedula_sexta_firma='$ce6', responsa_septima_firma='$r7', funcionario_septima_firma='$f7', cargo_septima_firma='$ca7', cedula_septima_firma='$ce7', responsa_octava_firma='$r8', funcionario_octava_firma='$f8', cargo_octava_firma='$ca8', cedula_octava_firma='$ce8' WHERE " . $this->SQLCA() . " and cod_tipo_documento=" . $tipo_doc;
            }

            $swi = $this->cugd99_firmas_responsabilidad->execute($sql_ejecutar);

            $this->set('varf', '' . $varf);
            $this->set('cantf', '' . $cantf);

            if ($swi > 1) {
                if ($muestr_accion == 'Modificadas') {
                    echo "<script>document.getElementById('link_limpiaf1').style.display= 'none';</script>";
                }
                $this->set('Message_existe', 'Las firmas fuer&oacute;n ' . $muestr_accion . ' correctamente');
            } else {
                $this->set('errorMessage', 'Las firmas no fuer&oacute;n ' . $muestr_accion . '');
            }
        } else {
            $this->set('errorMessage', 'Lo siento la informaci&oacute;n no puede ser procesada...');
        }
    }

    
// fin funcion guardar_editar_firmas

    function borrar_firmas($cantf = null) {
        $this->layout = "ajax";
        $this->set('cantf', '' . $cantf);
    }

     function borrar_firmas1($cantf = null) {
        $this->layout = "ajax";
        $this->set('cantf1', '' . $cantf);
    }
    
////////////////////////////////------INICIO REPORTES COMPRAS-----------------///////////////////////////

    function cscp04_ordencompra_bienes($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $sql_para_por_emitir = "";

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_compra_bienes_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {

            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');
               
                $this->envia_form_firmas(1, 5); // 1: Doc. Ordenes de compra 1, con 5 firmas...
                $this->envia_form_firmas1(8, 5); // 1: Doc. Ordenes de compra 2 , con 5 firmas...
               
                $ano = $this->ano_ejecucion();
                $dato = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }


                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);


                $datos_cscd04_ordencompra_poremitir_bienes = $this->cscd04_ordencompra_poremitir_bienes->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                $this->set('datos_cscd04_ordencompra_poremitir_bienes', $datos_cscd04_ordencompra_poremitir_bienes);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_compra_a = "";
                $numero_orden_compra_b = "";


                if (isset($this->data['cscp04_ordencompra_bienes']['radio'])) {
                    $radio = $this->data['cscp04_ordencompra_bienes']['radio'];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''])) {
                    $ano_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''])) {
                    $numero_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_b'])) {
                    $numero_orden_compra_b = $this->data['cscp04_ordencompra_bienes']['numero_b'];
                }

                
               
                
                
                
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }

               
                

                if ($radio == "3" && $numero_orden_compra_a != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a'  and  tipo_orden=1 and condicion_actividad=1", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . "       and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a' ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and numero='$numero_orden_compra_a'";

                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                        $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra . "' and  numero_orden_compra='" . $numero_orden_compra . "' and situacion='2'  ");


                        $sql_rif_a = "asdasd";
                    }//fin
//echo $condicion." and rif='".$rif."' and ano_cotizacion='".$ano_cotizacion."' and numero_cotizacion='".$numero_cotizacion."'  ";


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . "     and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . "          and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "' and numero_ordencompra='$numero_orden_compra' and ano_ordencompra='$ano_orden_compra'", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");



                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra . "'  and numero='" . $numero_orden_compra . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra . "', '" . $numero_orden_compra . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin


                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $ano_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];
                        }//fin

                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud='" . $ano_solicitud . "' and numero_solicitud='" . $numero_solicitud . "'  ");

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $cod_dir_superior = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];
                        }//fin

                        $sql_cugd02_direccion = " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior . " ";
                        $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion . " and  cod_secretaria=" . $cod_secretaria . " and cod_direccion=" . $cod_direccion . " ";
                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin de script
                } else if ($radio == "2" && $numero_orden_compra_a != "" && $numero_orden_compra_b != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a' and numero_orden_compra<='$numero_orden_compra_b')   and  tipo_orden=1   and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a'  and numero_orden_compra<='$numero_orden_compra_b')  ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and (numero>='$numero_orden_compra_a' and numero<='$numero_orden_compra_b')";


                    $i = 0;
                    $sql = "";
                    $sql_rif = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $i++;
                        $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                        if ($sql == "") {
                            $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                        } else {
                            $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                        }


                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $rif[$i] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                        }


                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                    }//fin


                    if ($sql_rif == "") {


                        echo'<script>history.back(1);</script>';
                    } else {



//echo $sql.'<br>';

                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);





                        $i = 0;
                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= "  cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin
//echo $sql_cugd02_direccion;

                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin para el script
                } else if ($radio == "1") {




                    $datos_cscd04_ordencompra_poremitir_bienes = $this->cscd04_ordencompra_poremitir_bienes->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd04_ordencompra_poremitir_bienes as $aux_cscd04_ordencompra_poremitir_bienes) {
                        $ii++;

                        $ano_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['ano_orden_compra'];
                        $numero_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['numero_orden_compra'];


                        if ($sql_1 == "") {
                            $sql_1 .= "    ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "')  ";
                        }
                    }//fin or



                    if ($sql_1 == "") {

                        echo'<script>history.back(1);</script>';
                    } else {

//echo $sql_1;

                        $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and (" . $sql_1 . ") and  tipo_orden=1 and username_registro='" . $this->Session->read('nom_usuario') . "' and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                        $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and (" . $sql_1 . ")");

///print_r($ordencompra_encabezado);


                        $i = 0;
                        $sql = "";
                        $sql_rif = "";

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                            if ($sql == "") {
                                $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                                $sql_para_por_emitir .= "   and     ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "'  ";
                            } else {
                                $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                                $sql_para_por_emitir .= " or  (ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "')  ";
                            }


                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $rif[$i] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                            }

                            $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                        }//fin


                        if ($sql == "") {

                            echo'<script>history.back(1);</script>';
                        } else {


//echo $sql.'<br>';

                            $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                            $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);


                            $i = 0;

                            foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                                $i++;
                                $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                                $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                                $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                                $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                                $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                                $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                                foreach ($datos_cpcd02 as $aux_cpcd02) {
                                    if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                        }//fin if
                                        break;
                                    }//fin
                                }//fin foreach
                            }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                            $sql_2 = "";
                            $j = 0;

                            foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                                $j++;
                                $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                                $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                                $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                                if ($sql_2 == "") {
                                    $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                                } else {
                                    $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                                }//fin else
                            }//fin


                            $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                            $sql_cugd02_direccion = "";
                            $x = 0;

                            foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                                $x++;

                                $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                                $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                                $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                                $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                                $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                                $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                                $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                                if ($sql_cugd02_direccion == "") {
                                    $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                                } else {

                                    $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                                }//fin else
                            }//fin



                            $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);


                            $sql = "delete from cscd04_ordencompra_poremitir_bienes  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                            $this->cscd04_ordencompra_poremitir_bienes->execute($sql);
                        }//fin else
                    }//fin else
                }//fin else



                if ($ordencompra_encabezado != "") {
                    $this->set('lista_cscd02_solicitud_cuerpo', $lista);
                    $this->set('datos_cscd03_cotizacion_encabezado', $datos_cscd03_cotizacion_encabezado);
                    $this->set('datos_cpcd02', $datos_cpcd02);
                    $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);
                    $this->set('datos_cscd03_cotizacion_cuerpo', $datos_cscd03_cotizacion_cuerpo);
                    $this->set('datos_cugd02_direccion', $datos_cugd02_direccion);
                    $this->set('ordencompra_partidas', $ordencompra_partidas);
                    $this->set('ordencompra_encabezado', $ordencompra_encabezado);
                }//fin if



                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));


                if ($datos_cugd02_direccion != "") {
                    $this->layout = "pdf";
                } else {
                    $this->layout = "ajax";
                    $this->set('errorMessage', "No existe alguna de la orden seleccionada");
                }
            }//fin else


 //------------------------------------AQUI TIPO DE FIRMANTES.////
                $unidad_triburtaria= $data_unidad_tributaria[0][0]['unidad_tributaria'];
                $tope=($unidad_triburtaria*5000);
                
                if ($monto_orden > $tope){ // si es superior a 500 U.T.
                   $this->envia_form_firmas(8, 5);  // 1: Doc. Ordenes de compra Formato 1, con 5 firmas... 
                }else{ // si es inferior a 500 U.T.
                    $this->envia_form_firmas(1, 5); // 8: Doc. Ordenes de compra Formato 2, con 5 firmas...
                }
//----------------------------------------------------------------//////

                
            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin function

    function cscp04_ordencompra_ambas($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $sql_para_por_emitir = "";

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_compra_ambas_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {

            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');
               
                $this->envia_form_firmas(1, 5); // 1: Doc. Ordenes de compra 1, con 5 firmas...
                $this->envia_form_firmas1(8, 5); // 1: Doc. Ordenes de compra 2 , con 5 firmas...
               
                $ano = $this->ano_ejecucion();
                $dato = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }


                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);


                $datos_cscd04_ordencompra_poremitir_ambas = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                $this->set('datos_cscd04_ordencompra_poremitir_ambas', $datos_cscd04_ordencompra_poremitir_ambas);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_compra_a = "";
                $numero_orden_compra_b = "";


                if (isset($this->data['cscp04_ordencompra_bienes']['radio'])) {
                    $radio = $this->data['cscp04_ordencompra_bienes']['radio'];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''])) {
                    $ano_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''])) {
                    $numero_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_b'])) {
                    $numero_orden_compra_b = $this->data['cscp04_ordencompra_bienes']['numero_b'];
                }

                
               
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }

               
                

                if ($radio == "3" && $numero_orden_compra_a != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a'  and  tipo_orden=3 and condicion_actividad=1", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . "       and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a' ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and numero='$numero_orden_compra_a'";

                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                        $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra . "' and  numero_orden_compra='" . $numero_orden_compra . "' and situacion='2'  ");


                        $sql_rif_a = "asdasd";
                    }//fin
            //echo $condicion." and rif='".$rif."' and ano_cotizacion='".$ano_cotizacion."' and numero_cotizacion='".$numero_cotizacion."'  ";


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . "     and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . "          and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "' and numero_ordencompra='$numero_orden_compra' and ano_ordencompra='$ano_orden_compra'", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");



                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra . "'  and numero='" . $numero_orden_compra . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra . "', '" . $numero_orden_compra . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin


                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $ano_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];
                        }//fin

                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud='" . $ano_solicitud . "' and numero_solicitud='" . $numero_solicitud . "'  ");

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $cod_dir_superior = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];
                        }//fin

                        $sql_cugd02_direccion = " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior . " ";
                        $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion . " and  cod_secretaria=" . $cod_secretaria . " and cod_direccion=" . $cod_direccion . " ";
                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin de script
                } else if ($radio == "2" && $numero_orden_compra_a != "" && $numero_orden_compra_b != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a' and numero_orden_compra<='$numero_orden_compra_b')   and  tipo_orden=3   and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a'  and numero_orden_compra<='$numero_orden_compra_b')  ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and (numero>='$numero_orden_compra_a' and numero<='$numero_orden_compra_b')";


                    $i = 0;
                    $sql = "";
                    $sql_rif = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $i++;
                        $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                        if ($sql == "") {
                            $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                        } else {
                            $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                        }


                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $rif[$i] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                        }


                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                    }//fin


                    if ($sql_rif == "") {


                        echo'<script>history.back(1);</script>';
                    } else {



                //echo $sql.'<br>';

                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);





                        $i = 0;
                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
            //echo'<pre>';
            //print_r($lista);
            //echo'</pre>';
            //print_r($datos_cpcd02);

                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= "  cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin
            //echo $sql_cugd02_direccion;

                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin para el script
                } else if ($radio == "1") {




                    $datos_cscd04_ordencompra_poremitir_ambas = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd04_ordencompra_poremitir_ambas as $aux_cscd04_ordencompra_poremitir_bienes) {
                        $ii++;

                        $ano_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['ano_orden_compra'];
                        $numero_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['numero_orden_compra'];


                        if ($sql_1 == "") {
                            $sql_1 .= "    ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "')  ";
                        }
                    }//fin or



                    if ($sql_1 == "") {

                        echo'<script>history.back(1);</script>';
                    } else {

                //echo $sql_1;

                        $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and (" . $sql_1 . ") and  tipo_orden=3 and username_registro='" . $this->Session->read('nom_usuario') . "' and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                        $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and (" . $sql_1 . ")");

                        ///print_r($ordencompra_encabezado);


                        $i = 0;
                        $sql = "";
                        $sql_rif = "";

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                            if ($sql == "") {
                                $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                                $sql_para_por_emitir .= "   and     ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "'  ";
                            } else {
                                $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                                $sql_para_por_emitir .= " or  (ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "')  ";
                            }


                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $rif[$i] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                            }

                            $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                        }//fin


                        if ($sql == "") {

                            echo'<script>history.back(1);</script>';
                        } else {


                        //echo $sql.'<br>';

                            $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                            $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);


                            $i = 0;

                            foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                                $i++;
                                $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                                $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                                $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                                $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                                $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                                $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                                foreach ($datos_cpcd02 as $aux_cpcd02) {
                                    if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                        }//fin if
                                        break;
                                    }//fin
                                }//fin foreach
                            }//fin
                        //echo'<pre>';
                        //print_r($lista);
                        //echo'</pre>';
                        //print_r($datos_cpcd02);

                            $sql_2 = "";
                            $j = 0;

                            foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                                $j++;
                                $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                                $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                                $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                                if ($sql_2 == "") {
                                    $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                                } else {
                                    $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                                }//fin else
                            }//fin


                            $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                            $sql_cugd02_direccion = "";
                            $x = 0;

                            foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                                $x++;

                                $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                                $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                                $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                                $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                                $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                                $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                                $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                                if ($sql_cugd02_direccion == "") {
                                    $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                                } else {

                                    $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                                }//fin else
                            }//fin



                            $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);


                            $sql = "delete from cscd04_ordencompra_poremitir_servicio  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                            $this->cscd04_ordencompra_poremitir_servicio->execute($sql);
                        }//fin else
                    }//fin else
                }//fin else



                if ($ordencompra_encabezado != "") {
                    $this->set('lista_cscd02_solicitud_cuerpo', $lista);
                    $this->set('datos_cscd03_cotizacion_encabezado', $datos_cscd03_cotizacion_encabezado);
                    $this->set('datos_cpcd02', $datos_cpcd02);
                    $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);
                    $this->set('datos_cscd03_cotizacion_cuerpo', $datos_cscd03_cotizacion_cuerpo);
                    $this->set('datos_cugd02_direccion', $datos_cugd02_direccion);
                    $this->set('ordencompra_partidas', $ordencompra_partidas);
                    $this->set('ordencompra_encabezado', $ordencompra_encabezado);
                }//fin if



                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));


                if ($datos_cugd02_direccion != "") {
                    $this->layout = "pdf";
                } else {
                    $this->layout = "ajax";
                    $this->set('errorMessage', "No existe alguna de la orden seleccionada");
                }
            }//fin else


                //------------------------------------AQUI TIPO DE FIRMANTES.////
                $unidad_triburtaria= $data_unidad_tributaria[0][0]['unidad_tributaria'];
                $tope=($unidad_triburtaria*5000);
                
                if ($monto_orden > $tope){ // si es superior a 500 U.T.
                   $this->envia_form_firmas(8, 5);  // 1: Doc. Ordenes de compra Formato 1, con 5 firmas... 
                }else{ // si es inferior a 500 U.T.
                    $this->envia_form_firmas(1, 5); // 8: Doc. Ordenes de compra Formato 2, con 5 firmas...
                }
                //----------------------------------------------------------------//////

                
            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

    function cscp04_ordencompra_servicio($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $sql_para_por_emitir = "";

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);


            $url = "/select_ventana_generar_reporte/v_reporte_emision_compra_servicio_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {




            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');

                $this->envia_form_firmas(1, 5); // 1: Doc. Ordenes de compra Formato 1, con 5 firmas...
                $this->envia_form_firmas1(8, 5); // 1: Doc. Ordenes de compra Formato 2, con 5 firmas...
                

                $ano = $this->ano_ejecucion();
                $dato = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }



                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);



                $datos_cscd04_ordencompra_poremitir_servicio = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cscd04_ordencompra_poremitir_servicio', $datos_cscd04_ordencompra_poremitir_servicio);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_compra_a = "";
                $numero_orden_compra_b = "";


                if (isset($this->data['cscp04_ordencompra_servicio']['radio'])) {
                    $radio = $this->data['cscp04_ordencompra_servicio']['radio'];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['ano' . $cont . ''])) {
                    $ano_orden_compra_a = $this->data['cscp04_ordencompra_servicio']['ano' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['numero_a' . $cont . ''])) {
                    $numero_orden_compra_a = $this->data['cscp04_ordencompra_servicio']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['numero_b'])) {
                    $numero_orden_compra_b = $this->data['cscp04_ordencompra_servicio']['numero_b'];
                }

                $this->envia_form_firmas(1, 5); // 1: Doc. Ordenes de compra, con 5 firmas...
//montar direccion en el footer de la orden de pago - alcaldia san fernando
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }



                if ($radio == "3" && $numero_orden_compra_a != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a'  and  tipo_orden=2   and  condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a' ");


                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and numero='$numero_orden_compra_a'";

                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];

                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra . "' and  numero_orden_compra='" . $numero_orden_compra . "' and situacion='2'  ");

                        $sql_rif_a = "asd";
                    }//fin




                    if ($sql_rif_a == "") {

                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . "     and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . "          and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");



                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra . "'  and numero='" . $numero_orden_compra . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra . "', '" . $numero_orden_compra . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin
                                    break;
                                }//fin if
                            }//fin foreach
                        }//fin



                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $ano_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];
                        }//fin



                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud='" . $ano_solicitud . "' and numero_solicitud='" . $numero_solicitud . "'  ");



                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $cod_dir_superior = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];
                        }//fin



                        $sql_cugd02_direccion = " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior . " ";
                        $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion . " and  cod_secretaria=" . $cod_secretaria . " and cod_direccion=" . $cod_direccion . " ";



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin script
                } else if ($radio == "2" && $numero_orden_compra_a != "" && $numero_orden_compra_b != "") {






                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a' and numero_orden_compra<='$numero_orden_compra_b')   and  tipo_orden=2  and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a'  and numero_orden_compra<='$numero_orden_compra_b')  ");


                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and (numero>='$numero_orden_compra_a' and numero<='$numero_orden_compra_b')";

                    $i = 0;
                    $sql = "";
                    $sql_rif = "";
                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $i++;
                        $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                        if ($sql == "") {
                            $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                        } else {
                            $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                        }


                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $rif[$i] . "'  ";
                        } else {
                            $sql_rif .= " or (rif='" . $rif[$i] . "')  ";
                        }


                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");

                        $sql_rif_a = "asdasd";
                    }//fin


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {



                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);





                        $i = 0;

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin script
                } else if ($radio == "1") {




                    $datos_cscd04_ordencompra_poremitir_servicio = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd04_ordencompra_poremitir_servicio as $aux_cscd04_ordencompra_poremitir_servicio) {
                        $ii++;

                        $ano_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_servicio['cscd04_ordencompra_poremitir_servicio']['ano_orden_compra'];
                        $numero_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_servicio['cscd04_ordencompra_poremitir_servicio']['numero_orden_compra'];



                        if ($sql_1 == "") {
                            $sql_1 .= "    ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "')  ";
                        }
                    }//fin or
//echo $sql_1;


                    if ($sql_1 == "") {


                        echo'<script>history.back(1);</script>';
                    } else {

                        $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and (" . $sql_1 . ") and  tipo_orden=2 and username_registro='" . $this->Session->read('nom_usuario') . "' and condicion_actividad=1   ", null, 'numero_orden_compra ASC');
                        $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and (" . $sql_1 . ")");

///print_r($ordencompra_encabezado);


                        $i = 0;
                        $sql = "";
                        $sql_rif = "";

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                            if ($sql == "") {
                                $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'   ";
                                $sql_para_por_emitir .= "   and     ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "'  ";
                            } else {
                                $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                                $sql_para_por_emitir .= " or  (ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "')  ";
                            }


                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $rif[$i] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                            }


                            $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET  situacion = '3' WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                        }//fin
//echo $sql.'<br>';

                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);




                        $i = 0;

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin




                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);


                        $sql = "delete from cscd04_ordencompra_poremitir_servicio  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cscd04_ordencompra_poremitir_servicio->execute($sql);
                    }//fin else
                }//fin else


                if ($ordencompra_encabezado != "") {
                    $this->set('lista_cscd02_solicitud_cuerpo', $lista);
                    $this->set('datos_cscd03_cotizacion_encabezado', $datos_cscd03_cotizacion_encabezado);
                    $this->set('datos_cpcd02', $datos_cpcd02);
                    $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);
                    $this->set('datos_cscd03_cotizacion_cuerpo', $datos_cscd03_cotizacion_cuerpo);
                    $this->set('datos_cugd02_direccion', $datos_cugd02_direccion);
                    $this->set('ordencompra_partidas', $ordencompra_partidas);
                    $this->set('ordencompra_encabezado', $ordencompra_encabezado);
                }//fin if


                if ($datos_cugd02_direccion != "") {
                    $this->layout = "pdf";
                } else {
                    $this->layout = "ajax";
                    $this->set('errorMessage', "No existe alguna de la orden selecionada");
                }


                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else


//------------------------------------AQUI TIPO DE FIRMANTES.////
                $unidad_triburtaria= $data_unidad_tributaria[0][0]['unidad_tributaria'];
                $tope=($unidad_triburtaria*5000);
                
                if ($monto_orden > $tope){ // si es superior a 500 U.T.
                   $this->envia_form_firmas(8, 5);  // 1: Doc. Ordenes de compra Formato 1, con 5 firmas... 
                }else{ // si es inferior a 500 U.T.
                    $this->envia_form_firmas(1, 5); // 8: Doc. Ordenes de compra Formato 2, con 5 firmas...
                }
//----------------------------------------------------------------//////


            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin function

    function cepp03_ordenpago_libre($year = null, $opcion = null, $cont = null) {
        $this->layout = "ajax";
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

        if ($year == "vista") {
            $ano = $this->ano_ejecucion();
            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_op_libre_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>\n";
                echo"codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"\n</script>\n";
            } else {
                echo"<script>\n";
                echo"Windows.close(document.getElementById('capa_ventana').value)";
                echo"\n</script>\n";
            }//fin else
        } else {
            if (!$year) {
                $this->limpia_menu();
                $this->set('ir', 'no');

                $this->envia_form_firmas(2, 5); // 2: Doc. Ordenes de Pago, con 5 firmas...

                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {
                    $this->set('year', $dato);
                } else {
                
                    $this->set('year', '');
                }
                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);

                $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd03_ordenpago_poremitir', $datos_cepd03_ordenpago_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {
                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_pago_a = "";
                $numero_orden_pago_b = "";

                if (isset($this->data['cepp03_ordenpago']['radio'])) {
                    $radio = $this->data['cepp03_ordenpago']['radio'];
                }
                if (isset($this->data['cepp03_ordenpago']['ano' . $cont . ''])) {
                    $ano_orden_pago_a = $this->data['cepp03_ordenpago']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_a' . $cont . ''])) {
                    $numero_orden_pago_a = $this->data['cepp03_ordenpago']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_b'])) {
                    $numero_orden_pago_b = $this->data['cepp03_ordenpago']['numero_b'];
                }

                $this->envia_form_firmas(2, 5); // 2: Doc. Ordenes de Pago, con 5 firmas...

                $partidacorriente = 407120;
                $partidacapital = 407220;

                //montar direccion en el footer de la orden de pago - alcaldia san fernando
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }





                if ($radio == "3" && $numero_orden_pago_a != "") {////////////////////////////////////////////////OPCION 1
                    
                    $verifiacion_nomina= $this->cepd03_ordenpago_cuerpo->execute("SELECT numero_orden_pago_secuencia
                    FROM cepd03_ordenpago_cuerpo where $condicion and condicion_actividad=1 and ano_orden_pago=$ano_orden_pago_a and numero_orden_pago=$numero_orden_pago_a;");
                    
                    if($verifiacion_nomina[0][0]['numero_orden_pago_secuencia']=='0'){
                        // ORDEN DE PAGO SIMPLE
                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');
                        $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";

                        $aux = 0;
                        $sql_rif_a = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                            /*
                             * Buscamos las facturas de esa orden de pago.
                             */
                            $facturas[$aux] = $this->cepd03_ordenpago_facturas->findAll($condicion . " AND ano_orden_pago='$ano_orden_pago' AND numero_orden_pago='$numero_orden_pago'");


                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4 ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//

                            $sql_rif_a = "jhgvbadsf";
                        }//fin for each

                        if ($sql_rif_a == "") {


                            echo'<script>history.back(1);</script>';
                        } else {


                            $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                        }//fin script

                        $isNomina = 'no';
                        $this->set('isNomina', $isNomina);
                        
                        // FIN ORDEN DE PAGO SIMPLE

                    }else{
                        // ORDEN DE PAGO NOMINA
                        $isNomina = 'si';
                        $cod_tipo_nomina = $this->Cnmd01->execute("select cod_tipo_nomina, numero_nomina from cnmd99_orden_pago_prenomina_perma where ".$this->SQLCA()." and numero_orden_pago=".$numero_orden_pago_a." and ano_orden_pago =".$ano_orden_pago_a." limit 1");
                        
                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' and numero_orden_pago::TEXT=numero_orden_pago_secuencia::TEXT", null, ' numero_orden_pago ASC', 1);

                        $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  and cod_dependencia='". $this->Session->read('SScoddep')."'");
                        
                        $beneficiario_orden_pago = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago=$numero_orden_pago_a", null, 'rif DESC, autorizado ASC', 1);
                        $this->set('beneficiario_rif',$beneficiario_orden_pago);
                        $this->set('beneficiario_dep',$this->Session->read('SScoddep'));
                        

                        /*
                         * CONDICIONAL QUE REGULA LA BUSQUEDA DE LAS ORDENES DE PAGO DE LAS NOMINAS
                         *  SI ESTAN DENTRO CERRADAS O NO (BUSQUEDA EN TRANSACCIONES ACTUALES O PERMANENTES)
                         */

                        $validacion_cierre = $this->Cnmd01->execute("
                            SELECT numero_nomina 
                            FROM v_distribucion_asignacion_deduccion_historico
                            WHERE ".$this->SQLCA()." AND cod_tipo_nomina=".$cod_tipo_nomina[0][0]['cod_tipo_nomina']." AND numero_nomina=".$cod_tipo_nomina[0][0]['numero_nomina']);
                        
                        if(empty($validacion_cierre)){//la nomina no ha sigo cerrada
                            $vista_busqueda='v_distribucion_asignacion_deduccion';
                            $condicion_busqueda='a.cod_tipo_nomina='.$cod_tipo_nomina[0][0]['cod_tipo_nomina'];

                            $sql_partidas="SELECT SUM(a.monto_asignacion) AS monto, a.cod_tipo_transaccion, a.cod_transaccion, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar, e.ano
                            FROM $vista_busqueda AS a 
                            INNER JOIN cnmd01 AS c ON c.cod_dep=a.cod_dep AND c.cod_tipo_nomina=a.cod_tipo_nomina 
                            INNER JOIN (SELECT d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano FROM cnmd03_conexion_transacciones AS d GROUP BY d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano) AS e ON e.cod_dep=a.cod_dep AND e.cod_tipo_nomina=a.cod_tipo_nomina AND e.cod_tipo_transaccion=a.cod_tipo_transaccion AND e.cod_transaccion=a.cod_transaccion 
                            WHERE a.cod_dep=".$cod_dep." AND ".$condicion_busqueda." AND e.ano=".$ano_orden_pago_a." AND a.cod_tipo_transaccion=1 AND a.uso_transaccion NOT IN (6) GROUP BY a.cod_tipo_transaccion, a.cod_transaccion, e.ano, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar ORDER BY e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar";

                            $sql_aportes = "SELECT SUM(a.monto_deduccion) as monto, a.cod_tipo_transaccion, a.cod_transaccion, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar, e.ano 
                                FROM $vista_busqueda as a 
                                INNER JOIN cnmd01 as c on c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina 
                                INNER JOIN (select d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano from cnmd03_conexion_transacciones as d group by d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano) as e on e.cod_dep=a.cod_dep and e.cod_tipo_nomina=a.cod_tipo_nomina and e.cod_tipo_transaccion=a.cod_tipo_transaccion and e.cod_transaccion=a.cod_transaccion 
                                WHERE a.cod_dep=".$cod_dep." and ".$condicion_busqueda." and e.ano=".$ano_orden_pago_a." and a.cod_tipo_transaccion=2 and a.uso_transaccion=6 GROUP BY a.cod_tipo_transaccion, a.cod_transaccion, e.ano, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar ORDER BY e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar";

                        }else{//la nomina ya fue cerrada
                            $vista_busqueda='v_distribucion_asignacion_deduccion_historico';
                            $condicion_busqueda='a.cod_tipo_nomina='.$cod_tipo_nomina[0][0]['cod_tipo_nomina'].' AND a.numero_nomina='.$cod_tipo_nomina[0][0]['numero_nomina'];

                            $sql_partidas="SELECT SUM(a.monto_asignacion) AS monto, a.cod_tipo_transac, a.cod_transaccion, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar, e.ano
                            FROM $vista_busqueda AS a 
                            INNER JOIN cnmd01 AS c ON c.cod_dep=a.cod_dep AND c.cod_tipo_nomina=a.cod_tipo_nomina 
                            INNER JOIN cnmd03_partidas AS b ON b.cod_tipo_transaccion=a.cod_tipo_transac AND b.cod_transaccion=a.cod_transaccion AND b.clasificacion_personal=c.clasificacion_personal 
                            INNER JOIN (SELECT d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano FROM cnmd03_conexion_transacciones AS d GROUP BY d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano) AS e ON e.cod_dep=a.cod_dep AND e.cod_tipo_nomina=a.cod_tipo_nomina AND e.cod_tipo_transaccion=a.cod_tipo_transac AND e.cod_transaccion=a.cod_transaccion 
                            WHERE a.cod_dep=".$cod_dep." AND ".$condicion_busqueda." AND a.cod_tipo_transac=1 AND a.uso_transaccion NOT IN (6) GROUP BY a.cod_tipo_transac, a.cod_transaccion, e.ano, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar ORDER BY e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar";

                            $sql_aportes = "SELECT SUM(a.monto_deduccion) as monto, a.cod_tipo_transac, a.cod_transaccion, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar, e.ano 
                                FROM $vista_busqueda as a 
                                INNER JOIN cnmd01 as c on c.cod_dep=a.cod_dep and c.cod_tipo_nomina=a.cod_tipo_nomina 
                                INNER JOIN cnmd03_partidas as b on b.cod_tipo_transaccion=a.cod_tipo_transac and b.cod_transaccion=a.cod_transaccion and b.clasificacion_personal=c.clasificacion_personal 
                                INNER JOIN (select d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano from cnmd03_conexion_transacciones as d group by d.cod_dep, d.cod_tipo_nomina, d.cod_tipo_transaccion, d.cod_transaccion, d.cod_sector, d.cod_programa, d.cod_sub_prog, d.cod_proyecto, d.cod_activ_obra, d.cod_partida, d.cod_generica, d.cod_especifica, d.cod_sub_espec, d.cod_auxiliar, d.ano) as e on e.cod_dep=a.cod_dep and e.cod_tipo_nomina=a.cod_tipo_nomina and e.cod_tipo_transaccion=a.cod_tipo_transac and e.cod_transaccion=a.cod_transaccion 
                                WHERE a.cod_dep=".$cod_dep." and ".$condicion_busqueda." and a.cod_tipo_transac=2 and a.uso_transaccion=6 GROUP BY a.cod_tipo_transac, a.cod_transaccion, e.ano, e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar ORDER BY e.cod_sector, e.cod_programa, e.cod_sub_prog, e.cod_proyecto, e.cod_activ_obra, e.cod_partida, e.cod_generica, e.cod_especifica, e.cod_sub_espec, e.cod_auxiliar";
                        }

                        /*
                         * FIN CONDICION REGULADORA
                         */
                        
                        $datos_cepd03_ordenpago_partidas = $this->Cnmd01->execute($sql_partidas);

                        /* $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' GROUP BY ano_orden_pago, numero_orden_pago, ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar",'ano_orden_pago, numero_orden_pago, ano, cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar, SUM(monto) as monto', ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');*/

                        $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";


                        /**
                        * Información relacionada al detalle de deducciones y aportes patronales
                        */
                            
                            

                            $condicion1 = $this->SQLCA()." and cod_tipo_nomina=".$cod_tipo_nomina[0][0]['cod_tipo_nomina']." and ano=".$ano_orden_pago_a." and numero_nomina=".$cod_tipo_nomina[0][0]['numero_nomina'];

                            $condicion2 = $this->SQLCA()." and cod_tipo_nomina=".$cod_tipo_nomina[0][0]['cod_tipo_nomina'];

                            $nomina = $this->v_cnmd08_historia_transacciones->findAll($condicion1," DISTINCT numero_nomina, frecuencia_pago, periodo_desde, periodo_hasta, correspondiente", ' numero_nomina ASC');
                            
                            $datos = $this->v_distribucion_asignacion_deduccion->findAll($condicion2, null, "cod_tipo_nomina, cod_tipo_transaccion, cod_transaccion ASC");

                            $denominacion_nomina = $this->Cnmd01->findAll($this->SQLCA()." and cod_tipo_nomina=".$cod_tipo_nomina[0][0]['cod_tipo_nomina'], 'cod_tipo_nomina, denominacion', 'cod_tipo_nomina ASC');

                            $aportes_patronales = $this->Cnmd01->execute($sql_aportes);

                            $this->set("aportes_patronales", $aportes_patronales);
                            $this->set("cod_tipo_nomina_reporte", $denominacion_nomina[0]['Cnmd01']['cod_tipo_nomina']);
                            $this->set("denominacion_nomina_reporte", $denominacion_nomina[0]['Cnmd01']['denominacion']);
                            $this->set("nomina", $nomina);
                            $this->set('data',$datos);
                            //--------- Fin de Deducciones y aportes patronales relacionada a la orden de pago de la Nomina seleccionada ------//


                        $aux = 0;
                        $sql_rif_a = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                           
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                               
                                $sql = $condicion . " and ano=" . $partidas[0]['ano'] . " and cod_sector=" . $partidas[0]['cod_sector'] . " and cod_programa=" . $partidas[0]['cod_programa'] . " and cod_sub_prog=" . $partidas[0]['cod_sub_prog'] . " and cod_proyecto=" . $partidas[0]['cod_proyecto'] . " and cod_activ_obra=" . $partidas[0]['cod_activ_obra'] . " and cod_partida=" . $partidas[0]['cod_partida'] . " and cod_generica=" . $partidas[0]['cod_generica'] . " and cod_especifica=" . $partidas[0]['cod_especifica'] . " and cod_sub_espec=" . $partidas[0]['cod_sub_espec'] . " and cod_auxiliar=" . $partidas[0]['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas[0]['cod_partida'] . $partidas[0]['cod_generica'] . $partidas[0]['cod_especifica'] . $partidas[0]['cod_sub_espec'] . $partidas[0]['cod_auxiliar'];
                                $evalpartcapital = $partidas[0]['cod_partida'] . $partidas[0]['cod_generica'] . $partidas[0]['cod_especifica'] . $partidas[0]['cod_sub_espec'] . $partidas[0]['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                            /*
                             * Buscamos las facturas de esa orden de pago.
                             */
                            $facturas[$aux] = $this->cepd03_ordenpago_facturas->findAll($condicion . " AND ano_orden_pago='$ano_orden_pago' AND numero_orden_pago='$numero_orden_pago'");


                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4 ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//

                            $sql_rif_a = "jhgvbadsf";
                        }//fin for each


                        if ($sql_rif_a == "") {
                            echo'<script>history.back(1);</script>';
                        } else {
                            $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                        }//fin script
                        $this->set('isNomina', $isNomina);
                        // FIN ORDEN DE PAGO NOMINA
                        
                    }// FIN ELSE VALIDACION DE NOMINA


                } else if ($radio == "2" && $numero_orden_pago_a != "" && $numero_orden_pago_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";

                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;

                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        $facturas[$aux] = $this->cepd03_ordenpago_facturas->findAll($condicion . " AND ano_orden_pago='$ano_orden_pago' AND numero_orden_pago='$numero_orden_pago'");

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "mhjbasdas";
                    }//fin for each


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin script

                    /*
                      $i = 0;
                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                      $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      break;
                      }//fin
                      }//fin foreach
                      }//fin
                     */
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cepd03_ordenpago_poremitir as $aux_cepd03_ordenpago_poremitir) {
                        $ii++;

                        $ano_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['ano_orden_pago'];
                        $numero_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['numero_orden_pago'];


                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "'  ";
                            $sql_para_por_emitir = " and ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "')  ";
                        }
                    }//fin for


                    if ($sql_1 == "") {



                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }
                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            }


                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            $facturas[$aux] = $this->cepd03_ordenpago_facturas->findAll($condicion . " AND ano_orden_pago='$ano_orden_pago' AND numero_orden_pago='$numero_orden_pago'");

                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]          =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin
                         */



                        $sql = "delete from cepd03_ordenpago_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd03_ordenpago_poremitir->execute($sql);
                    }//fin else
                }//fin else

                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);
                $this->set('datos_cepd03_ordenpago_partidas', $datos_cepd03_ordenpago_partidas);
                $this->set('tipodocu', $tipodocu);
                $this->set('ordenpago_tipopago', $ordenpago_tipopago);
                $this->set('facturas', $facturas);

                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else

            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin functonon

    function cepp03_ordenpago_libre_2($year = null, $opcion = null, $cont = null) {
        $this->layout = "ajax";
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');

        if ($year == "vista") {
            $ano = $this->ano_ejecucion();
            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_op_libre_11";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>\n";
                echo"codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"\n</script>\n";
            } else {
                echo"<script>\n";
                echo"Windows.close(document.getElementById('capa_ventana').value)";
                echo"\n</script>\n";
            }//fin else
        } else {
            if (!$year) {
                $this->limpia_menu();
                $this->set('ir', 'no');
                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {
                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }
                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);

                $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd03_ordenpago_poremitir', $datos_cepd03_ordenpago_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {
                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_pago_a = "";
                $numero_orden_pago_b = "";

                if (isset($this->data['cepp03_ordenpago']['radio'])) {
                    $radio = $this->data['cepp03_ordenpago']['radio'];
                }
                if (isset($this->data['cepp03_ordenpago']['ano' . $cont . ''])) {
                    $ano_orden_pago_a = $this->data['cepp03_ordenpago']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_a' . $cont . ''])) {
                    $numero_orden_pago_a = $this->data['cepp03_ordenpago']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_b'])) {
                    $numero_orden_pago_b = $this->data['cepp03_ordenpago']['numero_b'];
                }

                $partidacorriente = 407120;
                $partidacapital = 407220;

//montar direccion en el footer de la orden de pago - alcaldia san fernando
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }





                if ($radio == "3" && $numero_orden_pago_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');
                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";

                    $aux = 0;
                    $sql_rif_a = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                            if ($busqueda != null) {
                                if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                    $ordinario[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                    $coordinado[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                    $fci[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                    $mpps[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                    $ingresosextra[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                    $ingresospropios[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                    $laee[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                    $fides[$aux] = 1;
                                }
                                if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                    $capital[$aux] = 1;
                                } else {
                                    $corriente[$aux] = 1;
                                }
                            }//fin if
                            $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                            //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];



                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4 ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "jhgvbadsf";
                    }//fin for each

                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                    }//fin script
                } else if ($radio == "2" && $numero_orden_pago_a != "" && $numero_orden_pago_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";


                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "mhjbasdas";
                    }//fin for each


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin script

                    /*
                      $i = 0;
                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                      $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      break;
                      }//fin
                      }//fin foreach
                      }//fin
                     */
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cepd03_ordenpago_poremitir as $aux_cepd03_ordenpago_poremitir) {
                        $ii++;

                        $ano_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['ano_orden_pago'];
                        $numero_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['numero_orden_pago'];


                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "'  ";
                            $sql_para_por_emitir = " and ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "')  ";
                        }
                    }//fin for


                    if ($sql_1 == "") {



                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }
                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            }


                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]          =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin
                         */



                        $sql = "delete from cepd03_ordenpago_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd03_ordenpago_poremitir->execute($sql);
                    }//fin else
                }//fin else
//echo'<pre>';
                // print_r($ordenpago_tipopago);
//echo'</pre>';


                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);
                $this->set('datos_cepd03_ordenpago_partidas', $datos_cepd03_ordenpago_partidas);
                $this->set('tipodocu', $tipodocu);
                $this->set('ordenpago_tipopago', $ordenpago_tipopago);

                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin functonon

    function cepp03_ordenpago_libre_memoria($year = null, $opcion = null, $cont = null) {
        $this->layout = "ajax";
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');

        if ($year == "vista") {
            $ano = $this->ano_ejecucion();
            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_op_libre_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>\n";
                echo"codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"\n</script>\n";
            } else {
                echo"<script>\n";
                echo"Windows.close(document.getElementById('capa_ventana').value)";
                echo"\n</script>\n";
            }//fin else
        } else {
            if (!$year) {
                $this->limpia_menu();
                $this->set('ir', 'no');
                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {
                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }
                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);

                $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd03_ordenpago_poremitir', $datos_cepd03_ordenpago_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {
                set_time_limit(0);
                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_pago_a = "";
                $numero_orden_pago_b = "";

                if (isset($this->data['cepp03_ordenpago']['radio1'])) {
                    $radio1 = $this->data['cepp03_ordenpago']['radio1'];
                }
                if (isset($this->data['cepp03_ordenpago']['radio'])) {
                    $radio = $this->data['cepp03_ordenpago']['radio'];
                }
                if (isset($this->data['cepp03_ordenpago']['ano' . $cont . ''])) {
                    $ano_orden_pago_a = $this->data['cepp03_ordenpago']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_a' . $cont . ''])) {
                    $numero_orden_pago_a = $this->data['cepp03_ordenpago']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_b'])) {
                    $numero_orden_pago_b = $this->data['cepp03_ordenpago']['numero_b'];
                }

                $partidacorriente = 407120;
                $partidacapital = 407220;

//montar direccion en el footer de la orden de pago - alcaldia san fernando
                $sql_direccion_pie_pagina = "SELECT direccion FROM cugd02_dependencias WHERE cod_tipo_institucion=$cod_tipo_inst AND cod_institucion=$cod_inst AND cod_dependencia=$cod_dep";
                $data_direccion_pie_pagina = $this->cepd03_ordenpago_cuerpo->execute($sql_direccion_pie_pagina);
                $this->set('direccion_pie_pagina', $data_direccion_pie_pagina[0][0]['direccion']);

                $sql_unidad_tributaria = "SELECT unidad_tributaria FROM cscd04_ordencompra_parametros WHERE " . $this->SQLCA();
                $data_unidad_tributaria = $this->cepd03_ordenpago_cuerpo->execute($sql_unidad_tributaria);
                if (count($data_unidad_tributaria) > 0) {
                    $this->set('unidad_tributaria_pie', $data_unidad_tributaria[0][0]['unidad_tributaria']);
                } else {
                    $this->set('unidad_tributaria_pie', 0);
                }

                if ($radio1 == '1') {//con cheque
                    $sql_extra_cheque = " and numero_cheque != 0 ";
                } else {
                    $sql_extra_cheque = " and numero_cheque = 0 ";
                }



                if ($radio == "3" && $numero_orden_pago_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' " . $sql_extra_cheque, null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');
                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";
                    
                    $aux = 0;
                    $sql_rif_a = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                            if ($busqueda != null) {
                                if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                    $ordinario[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                    $coordinado[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                    $fci[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                    $mpps[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                    $ingresosextra[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                    $ingresospropios[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                    $laee[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                    $fides[$aux] = 1;
                                }

                                if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                    $capital[$aux] = 1;
                                } else {
                                    $corriente[$aux] = 1;
                                }
                            }//fin if
                            $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                            //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];



                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4 ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "jhgvbadsf";
                    }//fin for each

                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                    }//fin script
                } else if ($radio == "2" && $numero_orden_pago_a != "" && $numero_orden_pago_b != "") {///////////////////////////////////////OPCION 2
//echo "".$condicion." and condicion_actividad=1 and ano_orden_pago=".$ano_orden_pago_a."  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ".$sql_extra_cheque;
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  " . $sql_extra_cheque, null, ' numero_orden_pago ASC');
                    //pr($datos_cepd03_ordenpago_cuerpo);
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";


                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }


                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "mhjbasdas";
                    }//fin for each


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin script

                    /*
                      $i = 0;
                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                      $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      break;
                      }//fin
                      }//fin foreach
                      }//fin
                     */
                } else if ($radio == "4") {///////////////////////////////////////OPCION 2
//echo "".$condicion." and condicion_actividad=1 and ano_orden_pago=".$ano_orden_pago_a."  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ".$sql_extra_cheque;
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  " . $sql_extra_cheque, null, ' numero_orden_pago ASC');
                    //pr($datos_cepd03_ordenpago_cuerpo);
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";


                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "mhjbasdas";
                    }//fin for each


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin script

                    /*
                      $i = 0;
                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                      $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      break;
                      }//fin
                      }//fin foreach
                      }//fin
                     */
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cepd03_ordenpago_poremitir as $aux_cepd03_ordenpago_poremitir) {
                        $ii++;

                        $ano_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['ano_orden_pago'];
                        $numero_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['numero_orden_pago'];


                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "'  ";
                            $sql_para_por_emitir = " and ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "')  ";
                        }
                    }//fin for


                    if ($sql_1 == "") {



                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }
                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            }


                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]          =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin
                         */



                        $sql = "delete from cepd03_ordenpago_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd03_ordenpago_poremitir->execute($sql);
                    }//fin else
                }//fin else
//echo'<pre>';
                // print_r($ordenpago_tipopago);
//echo'</pre>';


                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);
                $this->set('datos_cepd03_ordenpago_partidas', $datos_cepd03_ordenpago_partidas);
                $this->set('tipodocu', $tipodocu);
                $this->set('ordenpago_tipopago', $ordenpago_tipopago);

                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));

//$this->render('hola');
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin orden pago memoria

    function cepp03_ordenpago_pre_impreso($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();



            $this->set('year', $ano);
            $this->set('vista', $opcion);


            $this->set('year', $ano);
            $this->set('vista', $opcion);



            $url = "/select_ventana_generar_reporte/v_reporte_emision_op_generico_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {



            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');



                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }



                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);



                $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd03_ordenpago_poremitir', $datos_cepd03_ordenpago_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_pago_a = "";
                $numero_orden_pago_b = "";


                if (isset($this->data['cepp03_ordenpago']['radio'])) {
                    $radio = $this->data['cepp03_ordenpago']['radio'];
                }
                if (isset($this->data['cepp03_ordenpago']['ano' . $cont . ''])) {
                    $ano_orden_pago_a = $this->data['cepp03_ordenpago']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_a' . $cont . ''])) {
                    $numero_orden_pago_a = $this->data['cepp03_ordenpago']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_b'])) {
                    $numero_orden_pago_b = $this->data['cepp03_ordenpago']['numero_b'];
                }


                $partidacorriente = 407120;
                $partidacapital = 407220;


                if ($radio == "3" && $numero_orden_pago_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";


                    $aux = 0;
                    $sql_rif_a = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                            if ($busqueda != null) {
                                if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                    $ordinario[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                    $coordinado[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                    $fci[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                    $mpps[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                    $ingresosextra[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                    $ingresospropios[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                    $laee[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                    $fides[$aux] = 1;
                                }

                                if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                    $capital[$aux] = 1;
                                } else {
                                    $corriente[$aux] = 1;
                                }
                            }//fin if
                            $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                            //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//fin if

                        $sql_rif_a = "kjbasbdas";
                    }//fin for each


                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                    }//fin script


                    /*

                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){
                      $ano_orden_pago     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($rif == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago."', '".$numero_orden_pago."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      }//fin
                      }//fin foreach
                      }//fin

                     * */
                } else if ($radio == "2" && $numero_orden_pago_a != "" && $numero_orden_pago_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";

                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//fin if

                        $sql_rif_a = "kjbasdfads";
                    }//fin for each


                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin */
                    }//fin script
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cepd03_ordenpago_poremitir as $aux_cepd03_ordenpago_poremitir) {
                        $ii++;

                        $ano_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['ano_orden_pago'];
                        $numero_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['numero_orden_pago'];




                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "'  ";
                            $sql_para_por_emitir = " and  ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "')  ";
                        }
                    }//fin for

                    if ($sql_1 == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }
                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            }


                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//fin if
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]          =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin */




                        $sql = "delete from cepd03_ordenpago_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd03_ordenpago_poremitir->execute($sql);
                    }//fin else
                }//fin else
//echo'<pre>';
                // print_r($ordenpago_tipopago);
//echo'</pre>';


                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);
                $this->set('datos_cepd03_ordenpago_partidas', $datos_cepd03_ordenpago_partidas);
                $this->set('tipodocu', $tipodocu);
                $this->set('ordenpago_tipopago', $ordenpago_tipopago);


                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin functonon

    function reporte_registro_compromiso($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;

        $this->Session->delete('FIN');

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);


        $partidacorriente = 407120;
        $partidacapital = 407220;

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);


            $url = "/select_ventana_generar_reporte/v_reporte_emision_rc_generico_1";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {



            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');

                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {
                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }


                $this->envia_form_firmas(7, 5); // 7: Doc. Otros Compromisos, con 5 firmas...



                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=3  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);

                $datos_cepd01_compromiso_poremitir = $this->cepd01_compromiso_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd01_compromiso_poremitir', $datos_cepd01_compromiso_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $numero_compromiso_a = "";
                $numero_compromiso_b = "";


                if (isset($this->data['cepp01_compromiso']['radio'])) {
                    $radio = $this->data['cepp01_compromiso']['radio'];
                }
                if (isset($this->data['cepp01_compromiso']['ano' . $cont . ''])) {
                    $ano_compromiso_a = $this->data['cepp01_compromiso']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp01_compromiso']['numero_a' . $cont . ''])) {
                    $numero_compromiso_a = $this->data['cepp01_compromiso']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp01_compromiso']['numero_b'])) {
                    $numero_compromiso_b = $this->data['cepp01_compromiso']['numero_b'];
                }

                $this->envia_form_firmas(7, 5); // 7: Doc. Otros Compromisos, con 5 firmas...


                if ($radio == "3" && $numero_compromiso_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cepd01_compromiso_cuerpo = $this->cepd01_compromiso_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_documento=" . $ano_compromiso_a . "  and numero_documento='$numero_compromiso_a' ", null, ' numero_documento ASC');
                    $datos_cepd01_compromiso_partidas = $this->cepd01_compromiso_partidas->findAll($condicion . " and ano_documento=" . $ano_compromiso_a . "  and numero_documento='$numero_compromiso_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');

                    $sql_para_por_emitir = " and ano=" . $ano_compromiso_a . "  and numero='$numero_compromiso_a' ";


                    $sql_rif_a = "";

                    $aux = 0;
                    foreach ($datos_cepd01_compromiso_cuerpo as $aux_cepd01_compromiso_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd01_tipo_compromiso->findAll('cod_tipo_compromiso=' . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_compromiso']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;

                        foreach ($datos_cepd01_compromiso_partidas as $partidas) {
                            $sql = $condicion . " and ano=" . $partidas['cepd01_compromiso_partidas']['ano_documento'] . " and cod_sector=" . $partidas['cepd01_compromiso_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd01_compromiso_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd01_compromiso_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd01_compromiso_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd01_compromiso_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd01_compromiso_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd01_compromiso_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                            $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                            if ($busqueda != null) {
                                if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                    $ordinario[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                    $coordinado[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                    $fci[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                    $mpps[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                    $ingresosextra[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                    $ingresospropios[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                    $laee[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                    $fides[$aux] = 1;
                                }
                                if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                    $capital[$aux] = 1;
                                } else {
                                    $corriente[$aux] = 1;
                                }
                            }//fin if
                            $evalpartcorriente = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                            $evalpartcapital = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                            //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                            //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                        }//fin for

                        $resultado = $this->cepd01_compromiso_numero->execute("UPDATE cepd01_compromiso_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'] . "' and  numero_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'] . "' and situacion='2'  ");
                        $rif = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'];

                        $cugd02_direccionsup = $this->cugd02_direccionsuperior->findAll("cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'], array('denominacion'));
                        $cugd02_coordinacion = $this->cugd02_coordinacion->findAll("     cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . "  and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'], array('denominacion'));
                        $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'], array('denominacion'));
                        $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'] . " and cod_direccion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_direccion'], array('denominacion'));
                        $direccionsup[$aux] = $cugd02_direccionsup[0]['cugd02_direccionsuperior']['denominacion'];
                        $coordinacion[$aux] = $cugd02_coordinacion[0]['cugd02_coordinacion']['denominacion'];
                        $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                        $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];
                        $ano_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'];
                        $numero_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'];
                        $monto = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['monto'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=3  and ano='" . $ano_documento . "'  and numero='" . $numero_documento . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '3', '" . $ano_documento . "', '" . $numero_documento . "', '" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['beneficiario'] . "', '" . $monto . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//fin if
                        $sql_rif_a = "asdsad";
                    }//fin foreach de cuerpo


                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                    }//fin fopr
                } else if ($radio == "2" && $numero_compromiso_a != "" && $numero_compromiso_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cepd01_compromiso_cuerpo = $this->cepd01_compromiso_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_documento=" . $ano_compromiso_a . "  and (numero_documento>='$numero_compromiso_a'  and numero_documento<='$numero_compromiso_b') ", null, ' numero_documento ASC');
                    $datos_cepd01_compromiso_partidas = $this->cepd01_compromiso_partidas->findAll($condicion . " and ano_documento=" . $ano_compromiso_a . "  and (numero_documento>='$numero_compromiso_a'  and numero_documento<='$numero_compromiso_b') ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');

                    $sql_para_por_emitir = " and ano=" . $ano_compromiso_a . "  and (numero>='$numero_compromiso_a'  and numero<='$numero_compromiso_a')  ";

                    $sql_rif_a = "";

                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd01_compromiso_cuerpo as $aux_cepd01_compromiso_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd01_tipo_compromiso->findAll('cod_tipo_compromiso=' . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_compromiso']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd01_compromiso_partidas as $partidas) {
                            if ($partidas['cepd01_compromiso_partidas']['ano_documento'] == $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'] && $partidas['cepd01_compromiso_partidas']['numero_documento'] == $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd01_compromiso_partidas']['ano_documento'] . " and cod_sector=" . $partidas['cepd01_compromiso_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd01_compromiso_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd01_compromiso_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd01_compromiso_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd01_compromiso_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd01_compromiso_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd01_compromiso_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd01_compromiso_numero->execute("UPDATE cepd01_compromiso_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'] . "' and  numero_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'] . "' and situacion='2'  ");
                        $rif = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'];



                        $cugd02_direccionsup = $this->cugd02_direccionsuperior->findAll("cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'], array('denominacion'));
                        $cugd02_coordinacion = $this->cugd02_coordinacion->findAll("     cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . "  and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'], array('denominacion'));
                        $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'], array('denominacion'));
                        $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'] . " and cod_direccion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_direccion'], array('denominacion'));

                        $direccionsup[$aux] = $cugd02_direccionsup[0]['cugd02_direccionsuperior']['denominacion'];
                        $coordinacion[$aux] = $cugd02_coordinacion[0]['cugd02_coordinacion']['denominacion'];
                        $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                        $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'] . "'  ";
                        }


                        $ano_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'];
                        $numero_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'];
                        $monto = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['monto'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=3  and ano='" . $ano_documento . "'  and numero='" . $numero_documento . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '3', '" . $ano_documento . "', '" . $numero_documento . "', '" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['beneficiario'] . "', '" . $monto . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//fin if

                        $sql_rif_a = "asdasd";
                    }//fin for each

                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin for
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd01_compromiso_poremitir = $this->cepd01_compromiso_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";
                    $sql_para_por_emitir = "";
                    foreach ($datos_cepd01_compromiso_poremitir as $aux_cepd01_compromiso_poremitir) {
                        $ii++;

                        $ano_documento_1[$ii] = $aux_cepd01_compromiso_poremitir['cepd01_compromiso_poremitir']['ano_documento'];
                        $numero_documento_1[$ii] = $aux_cepd01_compromiso_poremitir['cepd01_compromiso_poremitir']['numero_documento'];


                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_documento='" . $ano_documento_1[$ii] . "' and  numero_documento='" . $numero_documento_1[$ii] . "'  ";
                            $sql_para_por_emitir .= "    and   ano='" . $ano_documento_1[$ii] . "' and  numero='" . $numero_documento_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_documento='" . $ano_documento_1[$ii] . "' and  numero_documento='" . $numero_documento_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_documento_1[$ii] . "' and  numero='" . $numero_documento_1[$ii] . "')  ";
                        }
                    }//fin for


                    if ($sql_1 == "") {

                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cepd01_compromiso_cuerpo = $this->cepd01_compromiso_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_documento ASC');
                        $datos_cepd01_compromiso_partidas = $this->cepd01_compromiso_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd01_compromiso_cuerpo as $aux_cepd01_compromiso_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd01_tipo_compromiso->findAll('cod_tipo_compromiso=' . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_compromiso']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;

                            foreach ($datos_cepd01_compromiso_partidas as $partidas) {
                                if ($partidas['cepd01_compromiso_partidas']['ano_documento'] == $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'] && $partidas['cepd01_compromiso_partidas']['numero_documento'] == $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd01_compromiso_partidas']['ano_documento'] . " and cod_sector=" . $partidas['cepd01_compromiso_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd01_compromiso_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd01_compromiso_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd01_compromiso_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd01_compromiso_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd01_compromiso_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd01_compromiso_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }

                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd01_compromiso_partidas']['cod_partida'] . $partidas['cepd01_compromiso_partidas']['cod_generica'] . $partidas['cepd01_compromiso_partidas']['cod_especifica'] . $partidas['cepd01_compromiso_partidas']['cod_sub_espec'] . $partidas['cepd01_compromiso_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin if
                            }//fin for
                            $resultado = $this->cepd01_compromiso_numero->execute("UPDATE cepd01_compromiso_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'] . "' and  numero_compromiso='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'] . "' and situacion='2'  ");
                            $rif = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'];
                            $cugd02_direccionsup = $this->cugd02_direccionsuperior->findAll("cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'], array('denominacion'));
                            $cugd02_coordinacion = $this->cugd02_coordinacion->findAll("     cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . "  and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'], array('denominacion'));
                            $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'], array('denominacion'));
                            $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_inst'] . " and cod_dependencia=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dep'] . " and cod_dir_superior=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_secretaria'] . " and cod_direccion=" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['cod_direccion'], array('denominacion'));
                            $direccionsup[$aux] = $cugd02_direccionsup[0]['cugd02_direccionsuperior']['denominacion'];
                            $coordinacion[$aux] = $cugd02_coordinacion[0]['cugd02_coordinacion']['denominacion'];
                            $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                            $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['rif'] . "'  ";
                            }
                            $ano_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['ano_documento'];
                            $numero_documento = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['numero_documento'];
                            $monto = $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['monto'];
                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=3  and ano='" . $ano_documento . "'  and numero='" . $numero_documento . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '3', '" . $ano_documento . "', '" . $numero_documento . "', '" . $aux_cepd01_compromiso_cuerpo['cepd01_compromiso_cuerpo']['beneficiario'] . "', '" . $monto . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//fin if
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);


                        $sql = "delete from cepd01_compromiso_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd01_compromiso_poremitir->execute($sql);
                    }//fin else
                }//fin else

                $this->set('direccionsup', $direccionsup);
                $this->set('coordinacion', $coordinacion);
                $this->set('secretaria', $secretaria);
                $this->set('direccion', $direccion);

                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('tipodocu', $tipodocu);
                $this->set('datos_cepd01_compromiso_cuerpo', $datos_cepd01_compromiso_cuerpo);
                $this->set('datos_cepd01_compromiso_partidas', $datos_cepd01_compromiso_partidas);
                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=3  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin else
    }

//fin funtion

    function cscp02_solicitud_cotizacion($year = null, $opcion = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->set('cod_dep', $cod_dep);

        $this->Session->delete('FIN');

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);


        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);
        } else {



            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');



                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }




                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=5  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);



                $datos_cscd02_solicitud_numero_poremitir = $this->cscd02_solicitud_numero_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cscd02_solicitud_numero_poremitir', $datos_cscd02_solicitud_numero_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $numero_solicitud_a = "";
                $numero_solicitud_b = "";


                if (isset($this->data['cscp02_solicitud_cotizacion']['radio'])) {
                    $radio = $this->data['cscp02_solicitud_cotizacion']['radio'];
                }
                if (isset($this->data['cscp02_solicitud_cotizacion']['ano'])) {
                    $ano_solicitudo_a = $this->data['cscp02_solicitud_cotizacion']['ano'];
                }
                if (isset($this->data['cscp02_solicitud_cotizacion']['numero_a'])) {
                    $numero_solicitud_a = $this->data['cscp02_solicitud_cotizacion']['numero_a'];
                }
                if (isset($this->data['cscp02_solicitud_cotizacion']['numero_b'])) {
                    $numero_solicitud_b = $this->data['cscp02_solicitud_cotizacion']['numero_b'];
                }






                if ($radio == "3" && $numero_solicitud_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cscd02_solicitud_cuerpo = $this->cscd02_solicitud_cuerpo->findAll($condicion . " and ano_solicitud=" . $ano_solicitudo_a . "  and numero_solicitud='$numero_solicitud_a' ", null, 'codigo_prod_serv DESC');
                    $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud=" . $ano_solicitudo_a . "  and numero_solicitud='$numero_solicitud_a' ");

                    $sql_rif_a = "";

                    $aux = 0;
                    foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                        $aux++;
                        $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'], array('denominacion'));
                        $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'] . " and cod_direccion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'], array('denominacion'));
                        $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                        $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];
                    }//fin foreach


                    $sql_1 = "";
                    $ii = 0;
                    foreach ($datos_cscd02_solicitud_cuerpo as $aux_cscd02_solicitud_cuerpo) {
                        $ii++;
                        $ano_solicitudo_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['ano_solicitud'];
                        $numero_solicitud_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['numero_solicitud'];
                        $cod_medida[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['cod_medida'];

                        if ($sql_1 == "") {
                            $sql_1 .= "cod_medida='" . $cod_medida[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or cod_medida='" . $cod_medida[$ii] . "'  ";
                        }

                        $sql_rif_a = "kjabsdvas";
                    }//fin for

                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {


                        $y = $this->cscd01_unidad_medida->findAll($sql_1);
                    }//fin script
                } else if ($radio == "2" && $numero_solicitud_a != "" && $numero_solicitud_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cscd02_solicitud_cuerpo = $this->cscd02_solicitud_cuerpo->findAll($condicion . " and ano_solicitud=" . $ano_solicitudo_a . "  and (numero_solicitud>='$numero_solicitud_a'  and  numero_solicitud<='$numero_solicitud_b') ", null, 'codigo_prod_serv DESC');
                    $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud=" . $ano_solicitudo_a . "  and (numero_solicitud>='$numero_solicitud_a'  and  numero_solicitud<='$numero_solicitud_b') ");

                    $sql_rif_a = "";


                    $aux = 0;
                    foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                        $aux++;
                        $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'], array('denominacion'));
                        $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'] . " and cod_direccion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'], array('denominacion'));
                        $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                        $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];
                    }//fin foreach



                    $sql_1 = "";
                    $ii = 0;
                    foreach ($datos_cscd02_solicitud_cuerpo as $aux_cscd02_solicitud_cuerpo) {
                        $ii++;
                        $ano_solicitudo_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['ano_solicitud'];
                        $numero_solicitud_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['numero_solicitud'];
                        $cod_medida[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['cod_medida'];

                        if ($sql_1 == "") {
                            $sql_1 .= "cod_medida='" . $cod_medida[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or cod_medida='" . $cod_medida[$ii] . "'  ";
                        }


                        $sql_rif_a = "jbadfa";
                    }//fin for


                    if ($sql_rif_a == "") {
                        echo'<script>history.back(1);</script>';
                    } else {
                        $y = $this->cscd01_unidad_medida->findAll($sql_1);
                    }//finscript
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cscd02_solicitud_numero_poremitir = $this->cscd02_solicitud_numero_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd02_solicitud_numero_poremitir as $aux_cscd02_solicitud_numero_poremitir) {
                        $ii++;

                        $ano_solicitudo_1[$ii] = $aux_cscd02_solicitud_numero_poremitir['cscd02_solicitud_numero_poremitir']['ano_solicitud'];
                        $numero_solicitud_1[$ii] = $aux_cscd02_solicitud_numero_poremitir['cscd02_solicitud_numero_poremitir']['numero_solicitud'];


                        if ($sql_1 == "") {
                            $sql_1 .= "   ano_solicitud='" . $ano_solicitudo_1[$ii] . "' and  numero_solicitud='" . $numero_solicitud_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_solicitud='" . $ano_solicitudo_1[$ii] . "' and  numero_solicitud='" . $numero_solicitud_1[$ii] . "')  ";
                        }
                    }//fin for



                    if ($sql_1 == "") {


                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cscd02_solicitud_cuerpo = $this->cscd02_solicitud_cuerpo->findAll($condicion . " and (" . $sql_1 . ") ", null, 'codigo_prod_serv DESC');
                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_1 . ")");


                        $aux = 0;
                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $aux++;
                            $cugd02_secretaria = $this->cugd02_secretaria->findAll("       cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'], array('denominacion'));
                            $cugd02_direccion = $this->cugd02_direccion->findAll("        cod_tipo_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_tipo_inst'] . " and cod_institucion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_inst'] . " and cod_dependencia=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dep'] . " and cod_dir_superior=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'] . " and cod_coordinacion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'] . " and cod_secretaria=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'] . " and cod_direccion=" . $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'], array('denominacion'));
                            $secretaria[$aux] = $cugd02_secretaria[0]['cugd02_secretaria']['denominacion'];
                            $direccion[$aux] = $cugd02_direccion[0]['cugd02_direccion']['denominacion'];
                        }//fin foreach



                        $sql_1 = "";
                        $ii = 0;
                        foreach ($datos_cscd02_solicitud_cuerpo as $aux_cscd02_solicitud_cuerpo) {
                            $ii++;
                            $ano_solicitudo_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['ano_solicitud'];
                            $numero_solicitud_1[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['numero_solicitud'];
                            $cod_medida[$ii] = $aux_cscd02_solicitud_cuerpo['cscd02_solicitud_cuerpo']['cod_medida'];

                            if ($sql_1 == "") {
                                $sql_1 .= "cod_medida='" . $cod_medida[$ii] . "'  ";
                            } else {
                                $sql_1 .= " or cod_medida='" . $cod_medida[$ii] . "'  ";
                            }
                        }//fin for

                        $y = $this->cscd01_unidad_medida->findAll($sql_1);



                        $sql = "delete from cscd02_solicitud_numero_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cscd02_solicitud_numero_poremitir->execute($sql);
                    }//fin else
                }//fin else



                $this->set('secretaria', $secretaria);
                $this->set('direccion', $direccion);
                $this->set('unidad_medida', $y);
                $this->set('datos_cscd02_solicitud_cuerpo', $datos_cscd02_solicitud_cuerpo);
                $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);

                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=5  ";
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin else
    }

//fin funtion

    function cheque_formato_preimpreso($year = null) {
        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');
        $contador = 0;
        $borrar = "no";



        if (isset($this->data['radio']['opcion'])) {
            $opcion = $this->data['radio']['opcion'];
        } else {
            $opcion = 1;
            $borrar = "si";
        }
        $this->set('opcion', $opcion);

        if (!$year) {



            $this->set('ir', 'no');
            $ano = $this->ano_ejecucion();
            if (!empty($ano)) {
                $this->set('year', $ano);
            } else {
                $this->set('year', '');
            }




            $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
            $this->set('datos_cstd03_cheque_poremitir', $datos_cstd03_cheque_poremitir);

            $this->set('usuario', $this->Session->read('nom_usuario'));



//if($this->cstd06_comprobante_poremitir_egreso->findCount($condicion." and username='".$this->Session->read('nom_usuario')."' ")!=0){$contador++;}
            if ($this->cstd06_comprobante_poremitir_municipal->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }
            if ($this->cstd06_comprobante_poremitir_timbre->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }
            if ($this->cstd06_comprobante_poremitir_islr->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }
            if ($this->cstd06_comprobante_poremitir_iva->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }
            if ($this->cstd06_comprobante_poremitir_multa->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }
            if ($this->cstd06_comprobante_poremitir_responsabilidad->findCount($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ") != 0) {
                $contador++;
            }

            $this->set('contador', $contador);
        } else if ($opcion == 1) {


            $this->layout = "pdf";


            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ", null, 'numero_comprobante_egreso ASC');

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];



//if($sql_1==""){$sql_1   .= "  numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."' ";
//         }else{$sql_1   .= " or  (numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."'  )  ";    }

                if ($sql_1 == "") {
                    $sql_1 = "        ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                } else {
                    $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                }




                if ($sql_2 == "") {
                    $sql_2 = "   ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for




            if ($sql_1 == "") {
                echo'<script>history.back(1);</script>';
            } else {

                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")", null, 'numero_comprobante_egreso ASC');
                $aux2 = 0;
                $sql_3 = "";
                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;
                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];
                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR
//echo $condicion.$sql_1." and username_registro='".$this->Session->read('nom_usuario')."'   ";
                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");





                $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . ' ' . " and (" . $sql_1 . ")");
                $aux = 0;
                $tipodocu = $this->cepd03_tipo_documento->findAll();
                $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
                $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");




                $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "'   ");
                foreach ($datos_cstd03_cheque_poremitir as $ve12) {
                    $cod_presi22 = $ve12['cstd03_cheque_poremitir']['cod_presi'];
                    $cod_entidad22 = $ve12['cstd03_cheque_poremitir']['cod_entidad'];
                    $cod_tipo_inst22 = $ve12['cstd03_cheque_poremitir']['cod_tipo_inst'];
                    $cod_inst22 = $ve12['cstd03_cheque_poremitir']['cod_inst'];
                    $cod_dep22 = $ve12['cstd03_cheque_poremitir']['cod_dep'];
                    $username22 = $ve12['cstd03_cheque_poremitir']['username'];
                    $ano_movimiento22 = $ve12['cstd03_cheque_poremitir']['ano_movimiento'];
                    $cod_entidad_bancaria22 = $ve12['cstd03_cheque_poremitir']['cod_entidad_bancaria'];
                    $cod_sucursal22 = $ve12['cstd03_cheque_poremitir']['cod_sucursal'];
                    $cuenta_bancaria22 = $ve12['cstd03_cheque_poremitir']['cuenta_bancaria'];
                    $numero_cheque22 = $ve12['cstd03_cheque_poremitir']['numero_cheque'];
                    $sqldc = " UPDATE cstd03_cheque_cuerpo SET status_cheque=2 WHERE cod_presi='" . $cod_presi22 . "' and cod_entidad='" . $cod_entidad22 . "' and  cod_tipo_inst='" . $cod_tipo_inst22 . "' and  cod_inst='" . $cod_inst22 . "' and cod_dep='" . $cod_dep22 . "' and username_registro ='" . $username22 . "' and ano_movimiento='" . $ano_movimiento22 . "' and cod_entidad_bancaria = '" . $cod_entidad_bancaria22 . "' and   cod_sucursal='" . $cod_sucursal22 . "' and  cuenta_bancaria='" . $cuenta_bancaria22 . "'  and numero_cheque='" . $numero_cheque22 . "' ";
                    $this->cstd03_cheque_poremitir->execute($sqldc);
                }//fin foeach
//solo el de egreso


                /*

                  $sql = "delete from cstd03_cheque_poremitir  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd03_cheque_poremitir->execute($sql); */
                /*
                  $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd06_comprobante_poremitir_egreso->execute($sql);
                 */
                /*
                  $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd06_comprobante_poremitir_municipal->execute($sql);

                  $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd06_comprobante_poremitir_timbre->execute($sql);

                  $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd06_comprobante_poremitir_islr->execute($sql);

                  $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=".$this->Session->read('SScodpresi')." and cod_entidad=".$this->Session->read('SScodentidad')." and cod_tipo_inst=".$this->Session->read('SScodtipoinst')." and cod_inst=".$this->Session->read('SScodinst')." and cod_dep=".$this->Session->read('SScoddep')." and username='".$this->Session->read('nom_usuario')."' ";
                  $this->cstd06_comprobante_poremitir_iva->execute($sql);
                 */
            }//fin else








            $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);
            $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
            $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);





            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
            $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);

            $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);


            $this->set('tipodocu', $tipodocu);



            if ($borrar == "si") {

                $sql = "delete from cstd03_cheque_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd03_cheque_poremitir->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_egreso->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_municipal->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_timbre->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_islr->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_iva->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_multa->execute($sql);

                $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);
            }//fin if
        } else if ($opcion == 2) {



            $this->layout = "pdf";



            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];


//if($sql_1==""){$sql_1   .= "  numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."' ";
//         }else{$sql_1   .= " or  (numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."'  )  ";    }

                if ($sql_1 == "") {
                    $sql_1 = "       ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                } else {
                    $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                }



                if ($sql_2 == "") {
                    $sql_2 = "   ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for





            if ($sql_1 == "") {

                echo'<script>history.back(1);</script>';
            } else {






                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")");


                $aux2 = 0;
                $sql_3 = "";

                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;

                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];


                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR
//echo $condicion." and (".$sql_1.") and username_registro='".$this->Session->read('nom_usuario')."'   ";

                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");
                $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and (" . $sql_1 . ")   ");

                $aux = 0;
                $tipodocu = $this->cepd03_tipo_documento->findAll();








                $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
                $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");







                $datos_cstd06_comprobante_poremitir_islr = $this->cstd06_comprobante_poremitir_islr->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_islr', $datos_cstd06_comprobante_poremitir_islr);



                $datos_cstd06_comprobante_poremitir_municipal = $this->cstd06_comprobante_poremitir_municipal->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_municipal', $datos_cstd06_comprobante_poremitir_municipal);




                $datos_cstd06_comprobante_poremitir_timbre = $this->cstd06_comprobante_poremitir_timbre->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_timbre', $datos_cstd06_comprobante_poremitir_timbre);


                $datos_cstd06_comprobante_poremitir_multa = $this->cstd06_comprobante_poremitir_multa->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_multa', $datos_cstd06_comprobante_poremitir_multa);


                $datos_cstd06_comprobante_poremitir_responsabilidad = $this->cstd06_comprobante_poremitir_responsabilidad->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_responsabilidad', $datos_cstd06_comprobante_poremitir_responsabilidad);
            }//fin else







            $resul = $this->cugd02_institucion->findAll("cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " ");



            $this->set('agente_retencion_institucion', $resul[0]['cugd02_institucion']['agente_retencion']);
            $this->set('rif_institucion', $resul[0]['cugd02_institucion']['rif']);
            $this->set('denominacion_institucion', $resul[0]['cugd02_institucion']['denominacion']);


            $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);
            $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
            $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);





            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($condicion));
            $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);
            $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);


            $this->set('tipodocu', $tipodocu);


////borra todo



            $sql = "delete from cstd03_cheque_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd03_cheque_poremitir->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_egreso->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_municipal->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_timbre->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_islr->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_iva->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_multa->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);
        }//fin else





        $this->set('cod_entidad_bancaria', $this->cstd01_entidades_bancarias->findAll());
        $this->set('cod_sucursal', $this->cstd01_sucursales_bancarias->findAll());
        $this->set('cuenta_bancaria', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//generar_cheque

    function ventana_pdf_impresion_cheque() {
        $this->layout = "ajax";
    }

    function orientacion_cheque($var_orientacion = null) {
        $this->layout = "ajax";
        $this->set('var_orientacion', $var_orientacion);
        echo "<script>document.getElementById('forma_orientacion').value = '$var_orientacion';</script>";
    }

    function generar_cheque_formato_libre($year = null) {

        $this->layout = "ajax";



        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');

        $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

        $borrar = "no";
        $contador = 0;


        if (isset($this->data['radio']['opcion'])) {
            $opcion = $this->data['radio']['opcion'];
        } else {
            $opcion = 1;
        }
        $this->set('opcion', $opcion);

        if (!$year) {

            $this->set('ir', 'no');
            $ano = $this->ano_ejecucion();
            if (!empty($ano)) {
                $this->set('year', $ano);
            } else {
                $this->set('year', '');
            }

            $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
            $this->set('datos_cstd03_cheque_poremitir', $datos_cstd03_cheque_poremitir);

            $this->set('usuario', $this->Session->read('nom_usuario'));
        } else if ($opcion == 1) {


            $this->layout = "pdf";

            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];
                $tipo_pago = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['tipo_pago'];



                if ($tipo_pago == 10 || $tipo_pago == 11 || $tipo_pago == 12 || $tipo_pago == 13 || $tipo_pago == 14 || $tipo_pago == 15) {
                    if ($sql_1 == "") {
                        $sql_1 = "        ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                    } else {
                        $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                    }
                } else {
                    if ($sql_1 == "") {
                        $sql_1 = "  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                    } else {
                        $sql_1 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                    }
                }



                if ($sql_2 == "") {
                    $sql_2 .= "   ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for



            if ($sql_1 == "") {
                echo'<script>history.back(1);</script>';
            } else {


                if (isset($this->data['radio']['forma_orientacion'])) {
                    $this->set('forma_orientacion', $this->data['radio']['forma_orientacion']);
                }


                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")");
                $aux2 = 0;
                $sql_3 = "";
                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;
                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];
                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR

                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, "cod_entidad_bancaria, cod_sucursal, cuenta_bancaria, numero_cheque ASC");


                $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "'   ");
                foreach ($datos_cstd03_cheque_poremitir as $ve12) {
                    $cod_presi22 = $ve12['cstd03_cheque_poremitir']['cod_presi'];
                    $cod_entidad22 = $ve12['cstd03_cheque_poremitir']['cod_entidad'];
                    $cod_tipo_inst22 = $ve12['cstd03_cheque_poremitir']['cod_tipo_inst'];
                    $cod_inst22 = $ve12['cstd03_cheque_poremitir']['cod_inst'];
                    $cod_dep22 = $ve12['cstd03_cheque_poremitir']['cod_dep'];
                    $username22 = $ve12['cstd03_cheque_poremitir']['username'];
                    $ano_movimiento22 = $ve12['cstd03_cheque_poremitir']['ano_movimiento'];
                    $cod_entidad_bancaria22 = $ve12['cstd03_cheque_poremitir']['cod_entidad_bancaria'];
                    $cod_sucursal22 = $ve12['cstd03_cheque_poremitir']['cod_sucursal'];
                    $cuenta_bancaria22 = $ve12['cstd03_cheque_poremitir']['cuenta_bancaria'];
                    $numero_cheque22 = $ve12['cstd03_cheque_poremitir']['numero_cheque'];
                    $sqldc = " UPDATE cstd03_cheque_cuerpo SET status_cheque=2 WHERE cod_presi='" . $cod_presi22 . "' and cod_entidad='" . $cod_entidad22 . "' and  cod_tipo_inst='" . $cod_tipo_inst22 . "' and  cod_inst='" . $cod_inst22 . "' and cod_dep='" . $cod_dep22 . "' and username_registro ='" . $username22 . "' and ano_movimiento='" . $ano_movimiento22 . "' and cod_entidad_bancaria = '" . $cod_entidad_bancaria22 . "' and   cod_sucursal='" . $cod_sucursal22 . "' and  cuenta_bancaria='" . $cuenta_bancaria22 . "'  and numero_cheque='" . $numero_cheque22 . "' ";
                    $this->cstd03_cheque_poremitir->execute($sqldc);
                }//fin foeach

            }//fin else



            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
        } else if ($opcion == 2) {



            $this->layout = "pdf";


            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

            if($datos_cstd06_comprobante_poremitir_egreso == null || empty($datos_cstd06_comprobante_poremitir_egreso) || $datos_cstd06_comprobante_poremitir_egreso < 1){
                $this->set('errorMessage', 'El comprobante de egreso ya fúe generado.');
            
            }

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];
                $tipo_pago = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['tipo_pago'];

 

                if ($tipo_pago == 10 || $tipo_pago == 11 || $tipo_pago == 12 || $tipo_pago == 13 || $tipo_pago == 14 || $tipo_pago == 15) {
                    if ($sql_1 == "") {
                        $sql_1 = "        ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                    } else {
                        $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                    }
                } else if($tipo_pago == 8 || $tipo_pago == 9){
                    if ($sql_1 == "") {
                        $sql_1 = "  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'";
                    } else {
                        $sql_1 .= " or  ( ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "')  ";
                    }
                }else{
                    if ($sql_1 == "") {
                        $sql_1 = "  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                    } else {
                        $sql_1 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                    }
                }

                if ($sql_2 == "") {
                    $sql_2 .= "  ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for


            if ($sql_1 == "") {


                echo'<script>history.back(1);</script>';
            } else {


                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")");


                $aux2 = 0;
                $sql_3 = "";

                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;

                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];


                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR



                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");
                $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and (" . $sql_1 . ")   ");

                $aux = 0;
                $tipodocu = $this->cepd03_tipo_documento->findAll();



                $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
                $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");


                $datos_cstd06_comprobante_poremitir_islr = $this->cstd06_comprobante_poremitir_islr->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_islr', $datos_cstd06_comprobante_poremitir_islr);


                $datos_cstd06_comprobante_poremitir_municipal = $this->cstd06_comprobante_poremitir_municipal->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_municipal', $datos_cstd06_comprobante_poremitir_municipal);


                $datos_cstd06_comprobante_poremitir_timbre = $this->cstd06_comprobante_poremitir_timbre->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_timbre', $datos_cstd06_comprobante_poremitir_timbre);


                $datos_cstd06_comprobante_poremitir_multa = $this->cstd06_comprobante_poremitir_multa->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_multa', $datos_cstd06_comprobante_poremitir_multa);

                $datos_cstd06_comprobante_poremitir_responsabilidad = $this->cstd06_comprobante_poremitir_responsabilidad->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_responsabilidad', $datos_cstd06_comprobante_poremitir_responsabilidad);
            }//fin else


            $resul = $this->cugd02_institucion->findAll("cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " ");



            $this->set('agente_retencion_institucion', $resul[0]['cugd02_institucion']['agente_retencion']);
            $this->set('rif_institucion', $resul[0]['cugd02_institucion']['rif']);
            $this->set('denominacion_institucion', $resul[0]['cugd02_institucion']['denominacion']);


            $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);



            $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
            $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);





            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($condicion));
            $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);

            $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);

            $this->set('tipodocu', $tipodocu);


///borra todo

            $sql = "delete from cstd03_cheque_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd03_cheque_poremitir->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_egreso->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_municipal->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_timbre->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_islr->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_iva->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_multa->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);
        }//fin else





        $this->set('cod_entidad_bancaria', $this->cstd01_entidades_bancarias->findAll());
        $this->set('cod_sucursal', $this->cstd01_sucursales_bancarias->findAll());
        $this->set('cuenta_bancaria', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));

    }

//fin function

    function generar_comprobante_retencion_debito($numero_comprobante) {

      $this->layout = "pdf";

      $this->set('opcion', 2);

      $cod_presi = $this->Session->read('SScodpresi');
      $cod_entidad = $this->Session->read('SScodentidad');
      $cod_tipo_inst = $this->Session->read('SScodtipoinst');
      $cod_inst = $this->Session->read('SScodinst');
      $cod_dep = $this->Session->read('SScoddep');
      $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
      $this->Session->delete('FIN');

      $sql_estado = "SELECT denominacion FROM cugd01_estados WHERE cod_republica=$cod_presi AND cod_estado=$cod_entidad";
        $data_estado = $this->cepd03_ordenpago_cuerpo->execute($sql_estado);
        $estado = "ESTADO " . $data_estado[0][0]['denominacion'];
        $this->set('estado', $estado);

      $ano = $this->ano_ejecucion();

      $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and numero_comprobante_egreso=".$numero_comprobante . " and ano_comprobante_egreso=".$ano);
     
      if($datos_cstd06_comprobante_poremitir_egreso == null || empty($datos_cstd06_comprobante_poremitir_egreso) || $datos_cstd06_comprobante_poremitir_egreso < 1)
      {
         $this->set('errorMessage', 'El comprobante de egreso ya fúe generado.');
      }

      $ii = 0;
      $sql_1 = "";
      $sql_2 = "";

      foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_comprobante_poremitir_egreso)
      {
         $ii++;

         $ano_comprobante_egreso[$ii] = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["ano_comprobante_egreso"];
         $numero_comprobante_egreso[$ii] = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["numero_comprobante_egreso"];
         $ano_orden_pago[$ii] = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["ano_orden_pago"];
         $clase_orden[$ii] = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["clase_orden"];
         $numero_orden_pago[$ii] = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["numero_orden_pago"];
         $tipo_pago = $aux_comprobante_poremitir_egreso["cstd06_comprobante_poremitir_egreso"]["tipo_pago"];

         if ($tipo_pago == 10 || $tipo_pago == 11 || $tipo_pago == 12 || $tipo_pago == 13 || $tipo_pago == 14 || $tipo_pago == 15)
        {
            if ($sql_1 == "")
            {
               $sql_1 = " ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
            } 
            else 
            {
               $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
            }
        } 
         else if($tipo_pago == 8 || $tipo_pago == 9)
        {
            if ($sql_1 == "")
            {
               $sql_1 = "  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'";
            }
            else 
            {
               $sql_1 .= " or  ( ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "')  ";
            }
        }
         else
        {
            if ($sql_1 == "")
            {
               $sql_1 = "  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
            } 
            else 
            {
               $sql_1 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
            }
        }

        if ($sql_2 == "") {
          $sql_2 .= "  ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
        } else {
          $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
        }
      }//fin for

      if ($sql_1 == "") 
      {
         echo'<script>history.back(1);</script>';
      } 
      else 
      {
         $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")");
         $aux2 = 0;
         $sql_3 = "";

         foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso)
         {
           $aux2++;

           $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
           $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
           $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
           $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
           $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
           $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
           $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];

            if ($sql_3 == "")
            {
               $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_debito='" . $numero_cheque[$aux2] . "'    ";
            } 
            else 
            {
               $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_debito='" . $numero_cheque[$aux2] . "')  ";
            }
         }//FIN FOR

         $datos_cstd09_notadebito_cuerpo = $this->cstd09_notadebito_cuerpo_pago->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");
         $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and (" . $sql_1 . ")   ");

         $aux = 0;
         $tipodocu = $this->cepd03_tipo_documento->findAll();

         $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
         $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");

         $datos_cstd06_comprobante_poremitir_islr = $this->cstd06_comprobante_poremitir_islr->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $this->set('datos_cstd06_comprobante_poremitir_islr', $datos_cstd06_comprobante_poremitir_islr);

         $datos_cstd06_comprobante_poremitir_municipal = $this->cstd06_comprobante_poremitir_municipal->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $this->set('datos_cstd06_comprobante_poremitir_municipal', $datos_cstd06_comprobante_poremitir_municipal);

         $datos_cstd06_comprobante_poremitir_timbre = $this->cstd06_comprobante_poremitir_timbre->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $this->set('datos_cstd06_comprobante_poremitir_timbre', $datos_cstd06_comprobante_poremitir_timbre);

         $datos_cstd06_comprobante_poremitir_multa = $this->cstd06_comprobante_poremitir_multa->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $this->set('datos_cstd06_comprobante_poremitir_multa', $datos_cstd06_comprobante_poremitir_multa);

         $datos_cstd06_comprobante_poremitir_responsabilidad = $this->cstd06_comprobante_poremitir_responsabilidad->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
         $this->set('datos_cstd06_comprobante_poremitir_responsabilidad', $datos_cstd06_comprobante_poremitir_responsabilidad);
      }//fin else

      $resul = $this->cugd02_institucion->findAll("cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " ");

      $this->set('agente_retencion_institucion', $resul[0]['cugd02_institucion']['agente_retencion']);
      $this->set('rif_institucion', $resul[0]['cugd02_institucion']['rif']);
      $this->set('denominacion_institucion', $resul[0]['cugd02_institucion']['denominacion']);

      $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);

      $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
      $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);

      $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
      $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
      $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($condicion));
      $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);

      $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
      $this->set('datos_cstd09_notadebito_cuerpo', $datos_cstd09_notadebito_cuerpo);
      $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);

      $this->set('tipodocu', $tipodocu);

      ///borra todo

      $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_egreso->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_municipal->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_timbre->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_islr->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_iva->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_multa->execute($sql);

      $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
      $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);

     $this->set('cod_entidad_bancaria', $this->cstd01_entidades_bancarias->findAll());
     $this->set('cod_sucursal', $this->cstd01_sucursales_bancarias->findAll());
     $this->set('cuenta_bancaria', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
     $this->set('titulo_a', $this->Session->read('dependencia'));
     $this->set('entidad_federal', $this->Session->read('entidad_federal'));

     
   }
   //fin funtion

    function cheque_formato_libre($year = null) {
        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');




        if (!$year) {



            $this->set('ir', 'no');
            $ano = $this->ano_ejecucion();
            if (!empty($ano)) {
                $this->set('year', $ano);
            } else {
                $this->set('year', '');
            }




            $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
            $this->set('datos_cstd03_cheque_poremitir', $datos_cstd03_cheque_poremitir);

            $this->set('usuario', $this->Session->read('nom_usuario'));
        } else {


            $this->layout = "pdf";



            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ", null, 'numero_comprobante_egreso ASC');

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];


//if($sql_1==""){$sql_1   .= "  numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."' ";
//         }else{$sql_1   .= " or  (numero_comprobante_egreso='".$numero_comprobante_egreso[$ii]."'   and  ano_orden_pago='".$ano_orden_pago[$ii]."'    and  numero_orden_pago='".$numero_orden_pago[$ii]."'  )  ";}


                if ($sql_1 == "") {
                    $sql_1 = "        ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                } else {
                    $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "'  and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                }




                if ($sql_2 == "") {
                    $sql_2 .= "  ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for






            if ($sql_1 == "") {


                echo'<script>history.back(1);</script>';
            } else {








                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")", null, 'numero_comprobante_egreso ASC');


                $aux2 = 0;
                $sql_3 = "";

                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;

                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];


                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR



                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");
                $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and (" . $sql_1 . ") ");

                $aux = 0;
                $tipodocu = $this->cepd03_tipo_documento->findAll();



                $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "'   ");
                foreach ($datos_cstd03_cheque_poremitir as $ve12) {
                    $cod_presi22 = $ve12['cstd03_cheque_poremitir']['cod_presi'];
                    $cod_entidad22 = $ve12['cstd03_cheque_poremitir']['cod_entidad'];
                    $cod_tipo_inst22 = $ve12['cstd03_cheque_poremitir']['cod_tipo_inst'];
                    $cod_inst22 = $ve12['cstd03_cheque_poremitir']['cod_inst'];
                    $cod_dep22 = $ve12['cstd03_cheque_poremitir']['cod_dep'];
                    $username22 = $ve12['cstd03_cheque_poremitir']['username'];
                    $ano_movimiento22 = $ve12['cstd03_cheque_poremitir']['ano_movimiento'];
                    $cod_entidad_bancaria22 = $ve12['cstd03_cheque_poremitir']['cod_entidad_bancaria'];
                    $cod_sucursal22 = $ve12['cstd03_cheque_poremitir']['cod_sucursal'];
                    $cuenta_bancaria22 = $ve12['cstd03_cheque_poremitir']['cuenta_bancaria'];
                    $numero_cheque22 = $ve12['cstd03_cheque_poremitir']['numero_cheque'];
                    $sqldc = " UPDATE cstd03_cheque_cuerpo SET status_cheque=2 WHERE cod_presi='" . $cod_presi22 . "' and cod_entidad='" . $cod_entidad22 . "' and  cod_tipo_inst='" . $cod_tipo_inst22 . "' and  cod_inst='" . $cod_inst22 . "' and cod_dep='" . $cod_dep22 . "' and username_registro ='" . $username22 . "' and ano_movimiento='" . $ano_movimiento22 . "' and cod_entidad_bancaria = '" . $cod_entidad_bancaria22 . "' and   cod_sucursal='" . $cod_sucursal22 . "' and  cuenta_bancaria='" . $cuenta_bancaria22 . "'  and numero_cheque='" . $numero_cheque22 . "' ";
                    $this->cstd03_cheque_poremitir->execute($sqldc);
                }//fin foeach




                $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
                $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");







                $datos_cstd06_comprobante_poremitir_islr = $this->cstd06_comprobante_poremitir_islr->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_islr', $datos_cstd06_comprobante_poremitir_islr);



                $datos_cstd06_comprobante_poremitir_municipal = $this->cstd06_comprobante_poremitir_municipal->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_municipal', $datos_cstd06_comprobante_poremitir_municipal);




                $datos_cstd06_comprobante_poremitir_timbre = $this->cstd06_comprobante_poremitir_timbre->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_timbre', $datos_cstd06_comprobante_poremitir_timbre);




                $datos_cstd06_comprobante_poremitir_multa = $this->cstd06_comprobante_poremitir_multa->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_multa', $datos_cstd06_comprobante_poremitir_multa);


                $datos_cstd06_comprobante_poremitir_responsabilidad = $this->cstd06_comprobante_poremitir_responsabilidad->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_responsabilidad', $datos_cstd06_comprobante_poremitir_responsabilidad);
            }//fin else





            $resul = $this->cugd02_institucion->findAll("cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " ");



            $this->set('agente_retencion_institucion', $resul[0]['cugd02_institucion']['agente_retencion']);
            $this->set('rif_institucion', $resul[0]['cugd02_institucion']['rif']);
            $this->set('denominacion_institucion', $resul[0]['cugd02_institucion']['denominacion']);


            $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);



            $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
            $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);





            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($condicion));
            $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);

            $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);


            $this->set('tipodocu', $tipodocu);


///borra todo

            $sql = "delete from cstd03_cheque_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd03_cheque_poremitir->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_egreso->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_municipal->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_timbre->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_islr->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_iva->execute($sql);


            $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_multa->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);
        }//fin else



        /*switch ($datos_cepd03_ordenpago_cuerpo[0]["cepd03_ordenpago_cuerpo"]["numero_orden_pago_secuencia"]) {
            case 'ret-lab':
                    $this->Session->write('ano_orden_pago', $datos_cepd03_ordenpago_cuerpo[0]["cepd03_ordenpago_cuerpo"]["ano_orden_pago"]);
                    $this->Session->write('numero_orden_pago', $datos_cepd03_ordenpago_cuerpo[0]["cepd03_ordenpago_cuerpo"]["numero_orden_pago"]);
                    $this->requestAction('/reposicion/comprobante_lab/si/0');
                break;
            
            case 'ret-fc':
                    $this->Session->write('ano_orden_pago', $datos_cepd03_ordenpago_cuerpo[0]["cepd03_ordenpago_cuerpo"]["ano_orden_pago"]);
                    $this->Session->write('numero_orden_pago', $datos_cepd03_ordenpago_cuerpo[0]["cepd03_ordenpago_cuerpo"]["numero_orden_pago"]);
                    $this->requestAction('/reposicion/comprobante_fc/si/0');
                break;
        }*/

        $this->set('cod_entidad_bancaria', $this->cstd01_entidades_bancarias->findAll());
        $this->set('cod_sucursal', $this->cstd01_sucursales_bancarias->findAll());
        $this->set('cuenta_bancaria', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//generar_cheque

    function imprimir_retenciones($year = null) {
        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $this->Session->delete('FIN');




        if (!$year) {



            $this->set('ir', 'no');
            $ano = $this->ano_ejecucion();
            if (!empty($ano)) {
                $this->set('year', $ano);
            } else {
                $this->set('year', '');
            }




            $datos_cstd03_cheque_poremitir = $this->cstd03_cheque_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
            $this->set('datos_cstd03_cheque_poremitir', $datos_cstd03_cheque_poremitir);

            $this->set('usuario', $this->Session->read('nom_usuario'));
        } else {


            $this->layout = "pdf";



            $datos_cstd06_comprobante_poremitir_egreso = $this->cstd06_comprobante_poremitir_egreso->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

            $ii = 0;
            $sql_1 = "";
            $sql_2 = "";

            foreach ($datos_cstd06_comprobante_poremitir_egreso as $aux_cstd06_comprobante_poremitir_egreso) {
                $ii++;

                $ano_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_comprobante_egreso'];
                $numero_comprobante_egreso[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_comprobante_egreso'];
                $ano_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['ano_orden_pago'];
                $clase_orden[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['clase_orden'];
                $numero_orden_pago[$ii] = $aux_cstd06_comprobante_poremitir_egreso['cstd06_comprobante_poremitir_egreso']['numero_orden_pago'];


                if ($sql_1 == "") {
                    $sql_1 .= "      numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "' and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "' ";
                } else {
                    $sql_1 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   and ano_movimiento='" . $ano_comprobante_egreso[$ii] . "' and  ano_orden_pago='" . $ano_orden_pago[$ii] . "'    and  numero_orden_pago='" . $numero_orden_pago[$ii] . "'  )  ";
                }


                if ($sql_2 == "") {
                    $sql_2 .= "   ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'   ";
                } else {
                    $sql_2 .= " or  (ano_comprobante_egreso='" . $ano_comprobante_egreso[$ii] . "'  and  numero_comprobante_egreso='" . $numero_comprobante_egreso[$ii] . "'     )  ";
                }
            }//fin for






            if ($sql_1 == "") {


                echo'<script>history.back(1);</script>';
            } else {






                $datos_cstd06_comprobante_cuerpo_egreso = $this->cstd06_comprobante_cuerpo_egreso->findAll($condicion . " and (" . $sql_2 . ")");


                $aux2 = 0;
                $sql_3 = "";

                foreach ($datos_cstd06_comprobante_cuerpo_egreso as $aux_cstd06_comprobante_cuerpo_egreso) {
                    $aux2++;

                    $ano_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_comprobante_egreso'];
                    $numero_comprobante_egreso[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_comprobante_egreso'];
                    $ano_movimiento[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['ano_movimiento'];
                    $cod_entidad_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_entidad_bancaria'];
                    $cod_sucursal[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cod_sucursal'];
                    $cuenta_bancaria[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['cuenta_bancaria'];
                    $numero_cheque[$aux2] = $aux_cstd06_comprobante_cuerpo_egreso['cstd06_comprobante_cuerpo_egreso']['numero_cheque'];


                    if ($sql_3 == "") {
                        $sql_3 .= "   numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'   and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "' and  cod_sucursal='" . $cod_sucursal[$aux2] . "'    and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "'    ";
                    } else {
                        $sql_3 .= " or  (numero_comprobante_egreso='" . $numero_comprobante_egreso[$aux2] . "'    and  ano_movimiento='" . $ano_movimiento[$aux2] . "'  and  cod_entidad_bancaria='" . $cod_entidad_bancaria[$aux2] . "'  and  cod_sucursal='" . $cod_sucursal[$aux2] . "'  and  cuenta_bancaria='" . $cuenta_bancaria[$aux2] . "'  and  numero_cheque='" . $numero_cheque[$aux2] . "')  ";
                    }
                }//FIN FOR



                $datos_cstd03_cheque_cuerpo = $this->cstd03_cheque_cuerpo->findAll($condicion . " and (" . $sql_3 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ");
                $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and (" . $sql_1 . ")  ");

                $aux = 0;
                $tipodocu = $this->cepd03_tipo_documento->findAll();








                $datos_cstd06_comprobante_poremitir_iva = $this->cstd06_comprobante_poremitir_iva->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $datos_cepd03_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($condicion);
                $datos_cugd02_dependencias = $this->cugd02_dependencia->findAll("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'  ");







                $datos_cstd06_comprobante_poremitir_islr = $this->cstd06_comprobante_poremitir_islr->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_islr', $datos_cstd06_comprobante_poremitir_islr);



                $datos_cstd06_comprobante_poremitir_municipal = $this->cstd06_comprobante_poremitir_municipal->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_municipal', $datos_cstd06_comprobante_poremitir_municipal);




                $datos_cstd06_comprobante_poremitir_timbre = $this->cstd06_comprobante_poremitir_timbre->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_timbre', $datos_cstd06_comprobante_poremitir_timbre);


                $datos_cstd06_comprobante_poremitir_multa = $this->cstd06_comprobante_poremitir_multa->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_multa', $datos_cstd06_comprobante_poremitir_multa);


                $datos_cstd06_comprobante_poremitir_responsabilidad = $this->cstd06_comprobante_poremitir_responsabilidad->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cstd06_comprobante_poremitir_responsabilidad', $datos_cstd06_comprobante_poremitir_responsabilidad);
            }//fin else





            $resul = $this->cugd02_institucion->findAll("cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " ");



            $this->set('agente_retencion_institucion', $resul[0]['cugd02_institucion']['agente_retencion']);
            $this->set('rif_institucion', $resul[0]['cugd02_institucion']['rif']);
            $this->set('denominacion_institucion', $resul[0]['cugd02_institucion']['denominacion']);


            $this->set('datos_cstd06_comprobante_poremitir_iva', $datos_cstd06_comprobante_poremitir_iva);



            $this->set('datos_cstd06_comprobante_poremitir_egreso', $datos_cstd06_comprobante_poremitir_egreso);
            $this->set('datos_cstd06_comprobante_cuerpo_egreso', $datos_cstd06_comprobante_cuerpo_egreso);





            $this->set('cod_entidad_bancaria22', $this->cstd01_entidades_bancarias->findAll());
            $this->set('cod_sucursal22', $this->cstd01_sucursales_bancarias->findAll());
            $this->set('cuenta_bancaria22', $this->cstd02_cuentas_bancarias->findAll($condicion));
            $this->set('datos_cugd02_dependencias', $datos_cugd02_dependencias);

            $this->set('datos_cepd03_ordenpago_facturas', $datos_cepd03_ordenpago_facturas);
            $this->set('datos_cstd03_cheque_cuerpo', $datos_cstd03_cheque_cuerpo);
            $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);


            $this->set('tipodocu', $tipodocu);


////borra todo



            $sql = "delete from cstd03_cheque_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd03_cheque_poremitir->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_egreso  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_egreso->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_municipal  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_municipal->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_timbre  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_timbre->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_islr  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_islr->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_iva  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_iva->execute($sql);


            $sql = "delete from cstd06_comprobante_poremitir_multa  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_multa->execute($sql);

            $sql = "delete from cstd06_comprobante_poremitir_responsabilidad  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
            $this->cstd06_comprobante_poremitir_responsabilidad->execute($sql);
        }//fin else





        $this->set('cod_entidad_bancaria', $this->cstd01_entidades_bancarias->findAll());
        $this->set('cod_sucursal', $this->cstd01_sucursales_bancarias->findAll());
        $this->set('cuenta_bancaria', $this->cstd02_cuentas_bancarias->findAll($this->condicion()));
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

//generar_cheque

    function reporte_cscp01_catalogo() {
        $this->layout = "pdf";
        if (!empty($this->data['cscp01_catalogo'])) {
            $tipo = $this->data['cscp01_catalogo']['tipo'];
            $orden = $this->data['cscp01_catalogo']['orden'];
            switch ($tipo) {
                case 1:
                    $cond = null;
                    break;
                case 2:
                    $cond = "cod_tipo='1'";
                    break;
                case 3:
                    $cond = "cod_tipo='2'";
                    break;
                case 4:
                    $cond = "cod_tipo='3'";
                    break;

                default:
                    break;
            }

            switch ($orden) {
                case 1:
                    $order = "cod_snc ASC";
                    break;
                case 2:
                    $order = "denominacion ASC";
                    break;
                case 3:
                    $order = "cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC";
                    break;
                default:
                    $order = "cod_snc ASC";
                    break;
            }

            $catalogo = $this->cscd01_catalogo->findAll($conditions = $cond, $fields = null, $order, $limit = null, $page = null, $recursive = null);
            $this->set('catalogo', $catalogo);
            $unidad = $this->cscd01_unidad_medida->findAll($conditions = null, $fields = null, $order = null, $limit = null, $page = null, $recursive = null);
            $this->set('unidad', $unidad);
        }
    }

////////////////////////////////------------FIN REPORTES COMPRAS-----------------////////////////////////















    function reporte_pago_transferencias($ano = null) {
        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;

        if (!$ano) {
            $this->layout = "ajax";
            $this->set('ir', 'no');
            $ano2 = $this->ano_ejecucion();

            if (!empty($ano2)) {
                $this->set('year', $ano2);
            } else {
                $this->set('year', '');
            }

            $select_solicitud = $this->csrd01_solicitud_recurso_cuerpo->generateList($this->SQLCA(), 'numero_solicitud ASC', null, '{n}.csrd01_solicitud_recurso_cuerpo.numero_solicitud', '{n}.csrd01_solicitud_recurso_cuerpo.numero_solicitud');
            $this->set('select_solicitud', $select_solicitud);
        } else {
            $this->layout = "pdf";
            //valido que los datos no esten vacios
            if ($this->data['csrd01_solicitud_r_partidas']['ano'] != null && $this->data['csrd01_solicitud_r_partidas']['cod_solicitud'] != null) {
                $ano_solicitud = $this->data['csrd01_solicitud_r_partidas']['ano'];
                $num_solicitud = $this->data['csrd01_solicitud_r_partidas']['cod_solicitud'];
                $cond = $this->SQLCA() . " and ano_solicitud='$ano_solicitud' and numero_solicitud='$num_solicitud'";
                if ($solicitud_cuerpo = $this->csrd01_solicitud_recurso_cuerpo->findAll($cond)) {
                    $solicitud_partidas = $this->csrd01_solicitud_recurso_partidas->findAll($cond);
                    $tipo_solicitud = $this->csrd01_tipo_solicitud->findAll("cod_tipo_solicitud=" . $solicitud_cuerpo[0]['csrd01_solicitud_recurso_cuerpo']['tipo_solicitud_recurso']);
                    $this->set('datos_cuerpo', $solicitud_cuerpo);
                    $this->set('datos_partidas', $solicitud_partidas);
                    $this->set('tipo_solicitud', $tipo_solicitud[0]['csrd01_tipo_solicitud']['denominacion']);
                    $this->set('titulo_a', $this->Session->read('dependencia'));
                } else {
                    $this->set('datos_cuerpo', '');
                    $this->set('tipo_solicitud', 0);
                    $this->set('titulo_a', $this->Session->read('dependencia'));
                    $this->set('mensaje', 'NO SE ENCONTRARON DATOS DISPONIBLES PARA LA INFORMACION SUMISTRADA');
                }
            } else {
                $this->set('datos_cuerpo', '');
                $this->set('datos_partidas', '');
                $this->set('titulo_a', '');
                $this->set('mensaje', 'NO LLEGARON COMPLETOS LOS DATOS DEL FORMULARIO');
            }
        }
    }

//fin reporte_pago_transferencia

    function reporte_cugp02_direccion() {
        $this->layout = "pdf";
        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $datos = $this->cugd02_direccion->findAll("cod_tipo_institucion='$cod_tipo_inst' and cod_institucion='$cod_inst' and cod_dependencia='$cod_dep'", null, 'cod_tipo_institucion, cod_institucion, cod_dependencia, cod_dir_superior , cod_coordinacion, cod_secretaria, cod_direccion ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
    }

    function reporte_arrd05_usuarios_($var = null) {

        $this->verifica_entrada('12');

        $this->layout = "ajax";
        $_SESSION["TOP_MODULO_REPORTE"] = 1;
        if (isset($this->data['administradors']['opcion_busqueda'])) {
            $opcion_busqueda = $this->data['administradors']['opcion_busqueda'];
            if ($opcion_busqueda == 2) {
                $opcion_busqueda2 = $this->data['administradors']['cod_modulo'];
                $_SESSION["TOP_MODULO_REPORTE"] = 2;
            }
        }
        if ($var == "si") {
            $this->layout = "pdf";
            $this->set('validado', true);
            $this->reporte_arrd05_usuarios("user_valido", $opcion_busqueda2);
            $this->render("reporte_arrd05_usuarios");
        }
    }

    function reporte_arrd05_usuarios_2() {
        $this->layout = "ajax";
    }

    function reporte_arrd05_usuarios_modulos($var = null) {
        $this->layout = "ajax";
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $sql = " cod_tipo_inst = '" . $cod_tipo_inst . "'  and  cod_inst='" . $cod_inst . "' and cod_dep='" . $cod_dep . "' ";
        $datos = $this->Modulos->generateList($sql, 'denominacion ASC', null, '{n}.modulos.cod_modulo', '{n}.modulos.denominacion');
        $this->set('optionElements_22', $datos);
        $this->set('opcion', $var);
    }

    function reporte_arrd05_usuarios($var = null, $var2 = null) {
        $this->layout = "pdf";
        if ($var == "user_valido") {

            if ($var2 != null) {
                $cod_tipo_inst = $this->Session->read('SScodtipoinst');
                $cod_inst = $this->Session->read('SScodinst');
                $cod_dep = $this->Session->read('SScoddep');
                $sql = " and upper(modulo) like upper('%" . $var2 . "%')  ";
                $sql2 = " cod_tipo_inst = '" . $cod_tipo_inst . "'  and  cod_inst='" . $cod_inst . "' and cod_dep='" . $cod_dep . "' and cod_modulo='" . $var2 . "' ";
                $datos_modulos = $this->Modulos->findAll($sql2);
                $this->set('datos_modulos', $datos_modulos);
            } else {
                $sql = "";
            }
            $datos = $this->arrd05->findAll($this->SQLCA_report($this->verifica_SS(5)), null, ' cod_dep ASC');
            $user_arrd05 = $this->Usuario->findAll($this->condicionNDEP() . " and NOT(modulo='0' and cod_dep='1') " . $sql, null, ' cod_dep ASC');
            $this->set('datos', $datos);
            $this->set('user', $user_arrd05);
            $this->set('titulo_a', $this->Session->read('dependencia'));
        } else {
            $this->set('validado', false);
        }
    }

    function reporte_unidad_medida($var = null) {
        $this->layout = "ajax";

        if ($var != null && $var == 'si') {
            $this->set('ir', 'si');
        } else {
            $this->layout = "pdf";
            $this->set('ir', 'no');
            if ($this->data['cscp01_unidad_medida']['ordenacion'] == 1) {
                $datos = $this->cscd01_unidad_medida->findAll(null, null, 'cod_medida ASC');
            } elseif ($this->data['cscp01_unidad_medida']['ordenacion'] == 2) {
                $datos = $this->cscd01_unidad_medida->findAll(null, null, 'expresion ASC');
            } elseif ($this->data['cscp01_unidad_medida']['ordenacion'] == 3) {
                $datos = $this->cscd01_unidad_medida->findAll(null, null, 'denominacion ASC');
            }
            $this->set('datos', $datos);
        }
    }

    function reporte_tipo_restricciones() {
        $this->layout = "pdf";
        $datos = $this->cugd05_restriccion_tipo->findAll(null, null, 'cod_tipo ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function reporte_tipo_reformulacion() {
        $this->layout = "pdf";
        $datos = $this->cfpd10_reformulacion_tipo->findAll(null, null, 'cod_tipo ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function reporte_ordenpago_tipopago() {
        $this->layout = "pdf";
        $datos = $this->cepd03_ordenpago_tipopago->findAll(null, null, 'cod_tipo_pago ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function reporte_tipo_compromiso() {
        $this->layout = "pdf";
        $datos = $this->cepd01_tipo_compromiso->findAll(null, null, 'cod_tipo_compromiso ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function reporte_tipo_documento() {
        $this->layout = "pdf";
        $datos = $this->cepd03_tipo_documento->findAll(null, null, 'cod_tipo_documento ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function reporte_usuarios_autorizados_progrestric($var = null) {
        $this->layout = "pdf";
        if ($var == "user_valido") {
            $this->layout = "pdf";
            $datos_user = $this->cugd05_restriccion_clave->findAll(null, null, 'cod_presi, cod_entidad, cod_tipo_inst, cod_inst, cod_dep ASC');
            $datos_restric = $this->cugd05_restriccion_tipo->findAll(null, null, 'cod_tipo ASC');
            $this->set('datos_user', $datos_user);
            $this->set('datos_restric', $datos_restric);
            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
        } else {
            $this->set('validado', false);
        }
    }

    function reporte_usuarios_autorizados_progrestric_() {
        $this->layout = "ajax";
        if (isset($this->data['restriccion_clave']['login']) && isset($this->data['restriccion_clave']['password'])) {
            $l = "PROYECTO";
            $c = "JJJSAE";
            $user = addslashes($this->data['restriccion_clave']['login']);
            $paswd = addslashes($this->data['restriccion_clave']['password']);
            $cond = $this->SQLCA() . " and username='" . $user . "' and cod_tipo=16 and clave='" . $paswd . "'";
            if ($user == $l && $paswd == $c) {
                $this->layout = "pdf";
                $this->set('validado', true);
                $this->reporte_usuarios_autorizados_progrestric("user_valido");
                $this->render("reporte_usuarios_autorizados_progrestric");
            } elseif ($this->cugd05_restriccion_clave->findCount($cond) != 0) {
                $this->layout = "pdf";
                $this->set('validado', true);
                $this->reporte_usuarios_autorizados_progrestric("user_valido");
                $this->render("reporte_usuarios_autorizados_progrestric");
            } else {
                echo '<script>history.back(1);</script>';
            }
        }
    }

    function frm_reportes_retenciones_acumuladas($var = null) {
        $this->layout = "ajax";
        $this->set('impuesto', $var);
        $this->set('year', $this->ano_ejecucion());
    }

//Vista de los formularios de los Reportes de Retenciones (iva, islr, timbre, imp. municipal).

    function reporte_retencion_islr_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_islr_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_isrl = $this->cstd07_retenciones_cuerpo_islr->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_isrl)) {
                foreach ($datos_cuerpo_isrl as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_islr']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_islr']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_islr']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');

            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);


            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_isrl', $datos_cuerpo_isrl);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_islr_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DEL I.S.L.R. PENDIENTE');
            } elseif ($this->data['retencion_islr_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DEL I.S.L.R.');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_islr_acumulado_pend

    function reporte_retencion_multa_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_multa_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_multa = $this->cstd07_retenciones_cuerpo_multa->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_multa)) {
                foreach ($datos_cuerpo_multa as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_multa']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_multa']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_multa']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');

            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);


            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_multa', $datos_cuerpo_multa);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_multa_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DE Responsabilidad Civil PENDIENTE');
            } elseif ($this->data['retencion_multa_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DE Responsabilidad Civil');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_multa_acumulado_pend

    function reporte_retencion_responsabilidad_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_responsabilidad_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_responsabilidad = $this->cstd07_retenciones_cuerpo_responsabilidad->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_responsabilidad)) {
                foreach ($datos_cuerpo_responsabilidad as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_responsabilidad']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_responsabilidad']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_responsabilidad']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');

            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);


            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_responsabilidad', $datos_cuerpo_responsabilidad);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_responsabilidad_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DE RESPONSABILIDAD Social PENDIENTE');
            } elseif ($this->data['retencion_responsabilidad_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DE RESPONSABILIDAD Social');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_responsabilidad_acumulado_pend

    function reporte_retencion_iva_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_iva_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_iva = $this->cstd07_retenciones_cuerpo_iva->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_iva)) {
                foreach ($datos_cuerpo_iva as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_iva']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_iva']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_iva']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');

            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);

            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_iva', $datos_cuerpo_iva);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_iva_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DEL I.V.A. PENDIENTE');
            } elseif ($this->data['retencion_iva_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DEL I.V.A.');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_iva_acumulado_pend

    function reporte_retencion_timbrefiscal_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_timbrefiscal_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_timbre = $this->cstd07_retenciones_cuerpo_timbre->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_timbre)) {
                foreach ($datos_cuerpo_timbre as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_timbre']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_timbre']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_timbre']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');



            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);


            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_timbre', $datos_cuerpo_timbre);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_timbrefiscal_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DEL TIMBRE FISCAL PENDIENTE');
            } elseif ($this->data['retencion_timbrefiscal_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DEL TIMBRE FISCAL');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_timbrefiscal_acumulado_pend

    function reporte_retencion_impmunicipal_acumulado_pend() {
        $this->layout = "pdf";
        $cond = $this->SQLCA();
        $condstatus = "";
        $condstatus = $cond . " and status=" . $this->data['retencion_impmunicipal_acumulado']['status'] . " and ano_orden_pago=" . $this->data['retencion_year']['year']; // status=1 :Por Emitir / status=3 :Por Restaurar
        if ($datos_cuerpo_impmunicipal = $this->cstd07_retenciones_cuerpo_municipal->findAll($condstatus, array('clase_orden', 'ano_orden_pago', 'numero_orden_pago', 'monto', 'fecha_proceso_registro'), 'numero_orden_pago DESC')) {
            $sql = "";
            if (is_array($datos_cuerpo_impmunicipal)) {
                foreach ($datos_cuerpo_impmunicipal as $ve_aux) {
                    $ano_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_municipal']['ano_orden_pago'];
                    $clase_orden = $ve_aux['cstd07_retenciones_cuerpo_municipal']['clase_orden'];
                    $numero_orden_pago = $ve_aux['cstd07_retenciones_cuerpo_municipal']['numero_orden_pago'];
                    if ($sql == "") {
                        $sql = " and (ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "' ";
                    } else {
                        $sql .= " or  ano_orden_pago='" . $ano_orden_pago . "'    and  numero_orden_pago='" . $numero_orden_pago . "'    ";
                    }
                }//fin fore
                if ($sql != "") {
                    $sql .=" )";
                }
            }//fin
            $datos_ordenpago = $this->cepd03_ordenpago_cuerpo->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql, null, 'cuenta_bancaria, numero_orden_pago, beneficiario DESC');


            $campos = 'cod_presi ,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago,
numero_orden_pago,
SUM(monto_sub_total) as "monto_sub_total" ';


            $agrupar = 'GROUP BY cod_presi,
cod_entidad,
cod_tipo_inst,
cod_inst, cod_dep,
ano_orden_pago ,
numero_orden_pago';

            $datos_ordenpago_facturas = $this->cepd03_ordenpago_facturas->findAll($cond . " and ano_orden_pago=" . $this->data['retencion_year']['year'] . " " . $sql . $agrupar, $campos, 'numero_orden_pago DESC');
            $this->set('datos_ordenpago_facturas', $datos_ordenpago_facturas);



            $this->set('datos_ordenpago', $datos_ordenpago);
            $this->set('datos_cuerpo_impmunicipal', $datos_cuerpo_impmunicipal);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            if ($this->data['retencion_impmunicipal_acumulado']['status'] == 1) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LA RETENCIÓN DEL IMPUESTO MUNICIPAL PENDIENTE');
            } elseif ($this->data['retencion_impmunicipal_acumulado']['status'] == 3) {
                $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS POR RESTAURAR EN LA RETENCIÓN DEL IMPUESTO MUNICIPAL');
            }
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

//reporte_retencion_impmunicipal_acumulado_pend

    function reporte_parametros_calculos() {
        $this->layout = "pdf";
        if ($parametros = $this->cscd04_ordencompra_parametros->findAll($this->SQLCA())) {
            $this->set('parametros', $parametros);
            $this->set('vacio', 'no');
        } else {
            $this->set('vacio', 'si');
            $this->set('mensaje', 'NO SE ENCONTRARÓN DATOS EN LOS PARAMETROS PARA CALCULOS');
        }
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', 'GOBERNACIÓN DEL ESTADO FALCÓN');
    }

    function frm_reporte_proveedores_cpcd02() {
        $this->layout = "ajax";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
    }

    function reporte_proveedores_contratistas() {
        $this->layout = "ajax";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $this->set('titulo_inst', $this->Session->read('entidad_federal'));
        $this->set('titulo_a', $this->Session->read('dependencia'));

        $tipo_proveedores = $this->data['cpcd02_proveedores']['tipo_proveedores']; //Indica que tipo de proveedor es, 1:proveedores 2:contratistas 3:Cooperativa 4:Personas natural 5:Todos
        $reporte_ordenado_por = $this->data['cpcd02_proveedores']['ordenados_por'];
        $por_fecha = $this->data['cpcd02_proveedores']['por_fecha'];

        if ($por_fecha == 2) {
            $fecha_inicial = $this->data['cpcd02_proveedores']['fecha_inicial'];
            $fecha_final = $this->data['cpcd02_proveedores']['fecha_final'];
            $condicion_fecha = " and fecha_inscripcion BETWEEN '$fecha_inicial' and '$fecha_final'";
        } else {
            $condicion_fecha = " ";
        }

        if ($tipo_proveedores == 5) {//el reporte es de todos los registros de la tabla por: prob, contra, coop, pers_nat.
            switch ($reporte_ordenado_por) {
                case '1':$ordenby = "rif, fecha_inscripcion";
                    break;
                case '2':$ordenby = "ramo_comercial, fecha_inscripcion";
                    break;
                case '3':$ordenby = "denominacion, fecha_inscripcion";
                    break;
                case '4':$ordenby = "fecha_inscripcion, denominacion";
                    break;
            }
            $datos_prov = $this->cpcd02->findAll('objeto=1' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), $ordenby . ' ASC');
            $datos_cont = $this->cpcd02->findAll('objeto=2' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), $ordenby . ' ASC');
            $datos_coop = $this->cpcd02->findAll('objeto=3' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), $ordenby . ' ASC');
            $datos_pers = $this->cpcd02->findAll('objeto=4' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), $ordenby . ' ASC');
            $this->set('datos_prov', $datos_prov);
            $this->set('datos_cont', $datos_cont);
            $this->set('datos_coop', $datos_coop);
            $this->set('datos_pers', $datos_pers);
        } else {
            switch ($reporte_ordenado_por) {
                case '1'://se buscan los proveedores por rif
                    $datos = $this->cpcd02->findAll('objeto=' . $tipo_proveedores . ' ' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), 'rif, fecha_inscripcion ASC');
                    if ($datos == '') {
                        $this->set('datos', '');
                        $this->set('mensaje', 'LO SIENTO, NO SE ENCONTRO INFORMACIÓN REGISTRADA');
                    } else {
                        $this->set('datos', $datos);
                    }
                    break;
                case '2'://se buscan los proveedores por ramo comercial
                    $datos = $this->cpcd02->findAll('objeto=' . $tipo_proveedores . ' ' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), 'ramo_comercial, fecha_inscripcion ASC');
                    if ($datos == '') {
                        $this->set('datos', '');
                        $this->set('mensaje', 'LO SIENTO, NO SE ENCONTRO INFORMACIÓN REGISTRADA');
                    } else {
                        $this->set('datos', $datos);
                    }
                    break;
                case '3'://se buscan los proveedores ordenados alfabeticamente
                    $datos = $this->cpcd02->findAll('objeto=' . $tipo_proveedores . ' ' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), 'denominacion, fecha_inscripcion ASC');
                    if ($datos == '') {
                        $this->set('datos', '');
                        $this->set('mensaje', 'LO SIENTO, NO SE ENCONTRO INFORMACIÓN REGISTRADA');
                    } else {
                        $this->set('datos', $datos);
                    }
                    break;
                case '4'://se buscan los proveedores ordenados por fecha inscripcion
                    $datos = $this->cpcd02->findAll('objeto=' . $tipo_proveedores . ' ' . $condicion_fecha, array('rif', 'denominacion', 'direccion_comercial', 'codigo_area_empresa', 'telefonos', 'correo_electronico_empresa', 'representante_legal', 'fecha_inscripcion'), 'fecha_inscripcion, denominacion ASC');
                    if ($datos == '') {
                        $this->set('datos', '');
                        $this->set('mensaje', 'LO SIENTO, NO SE ENCONTRO INFORMACIÓN REGISTRADA');
                    } else {
                        $this->set('datos', $datos);
                    }
                    break;
            }
        }
        $this->set('tipo_proveedor', $tipo_proveedores);
    }

//fin reporte_proveedores_contratistas

    function constancia_proveedores_cont($rif = null) {
        $this->layout = "ajax";




        $firmantes = $this->cugd07_firmas_oficio_anulacion->findAll($this->SQLCA() . ' and tipo_documento=300', array('nombre_primera_firma', 'cargo_primera_firma', 'nombre_segunda_firma', 'cargo_segunda_firma', 'ubicacion_compras'), null);
        if ($firmantes != null) {
            $this->set('firmante', $firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_primera_firma']);
            $this->set('cargo_firmante', $firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_primera_firma']);
            $this->set('revisado', $firmantes[0]['cugd07_firmas_oficio_anulacion']['nombre_segunda_firma']);
            $this->set('cargo_revisado', $firmantes[0]['cugd07_firmas_oficio_anulacion']['cargo_segunda_firma']);
            $this->set('ubicacion_compras', $firmantes[0]['cugd07_firmas_oficio_anulacion']['ubicacion_compras']);
        } else {
            $this->set('firmante', '');
            $this->set('cargo_firmante', '');
            $this->set('revisado', '');
            $this->set('cargo_revisado', '');
            $this->set('ubicacion_compras', '');
        }
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $this->set('rif', $rif);
        $this->set('titulo_inst', $this->Session->read('entidad_federal'));
        $this->set('titulo_a', $this->Session->read('dependencia'));
    }

//constancia_proveedores_cont

    function constancia_proveedores_cont2($rif = null) {
        $this->layout = "pdf";
        $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        $this->set('titulo_inst', $this->Session->read('entidad_federal'));
        $this->set('titulo_a', $this->Session->read('dependencia'));

        $tipoconst = $this->data['cpcp02']['tipo_constancia'];
        $firmante = $this->data['cpcp02']['firmante'];
        $cargo = $this->data['cpcp02']['cargo_firmante'];
        $firmas_modificadas = $this->data['cpcp02']['firmas_modificadas'];
        $revisado = $this->data['cpcp02']['revisado'];
        $ubicacion_compras = $this->data['cpcp02']['ubicacion_compras'];
        $cargo_revisado = $this->data['cpcp02']['cargo_revisado'];


        $tipoconst == 1 ? $tipoconst = "INSCRIPCIÓN" : $tipoconst = "ACTUALIZACIÓN";

        $cont = $this->cugd07_firmas_oficio_anulacion->findCount($this->SQLCA() . " and tipo_documento=300");
        if ($cont == 0) {
            $cp = $this->Session->read('SScodpresi');
            $ce = $this->Session->read('SScodentidad');
            $cti = $this->Session->read('SScodtipoinst');
            $ci = $this->Session->read('SScodinst');
            $cd = $this->Session->read('SScoddep');
            $insert = "INSERT INTO cugd07_firmas_oficio_anulacion VALUES ('$cp', '$ce', '$cti', '$ci', '$cd', '300', '$firmante', '$cargo', '$revisado', '$cargo_revisado', '-', '-', '-', '-', '-', '-', '-', '-', '-', '-','" . $ubicacion_compras . "')";
            $this->cugd07_firmas_oficio_anulacion->execute($insert);
        } else {
            $this->cugd07_firmas_oficio_anulacion->execute("UPDATE cugd07_firmas_oficio_anulacion SET nombre_primera_firma='$firmante', cargo_primera_firma='$cargo', nombre_segunda_firma='$revisado', cargo_segunda_firma='$cargo_revisado', ubicacion_compras='" . $ubicacion_compras . "' WHERE " . $this->SQLCA() . " and tipo_documento=300");
        }


        $datacpcp01 = $this->cpcd02->findAll("rif='$rif'", null, 'numero_expediente ASC', 1, null, null);

        $this->set('fech_inscrip', $datacpcp01[0]['cpcd02']['fecha_inscripcion']);
        $this->set('fech_actuali', $datacpcp01[0]['cpcd02']['fecha_actualizacion']);
        $this->set('numero_expediente', $datacpcp01[0]['cpcd02']['numero_expediente']);
        $this->set('representante', $datacpcp01[0]['cpcd02']['representante_legal']);
        $this->set('cedula', $datacpcp01[0]['cpcd02']['cedula_identidad']);
        $this->set('denominacion', $datacpcp01[0]['cpcd02']['denominacion']);
        $this->set('objeto', $datacpcp01[0]['cpcd02']['objeto']); //proveedor contratista cooperativa pers natural
        $this->set('rif', $datacpcp01[0]['cpcd02']['rif']);
        $this->set('observacion', $datacpcp01[0]['cpcd02']['observacion']);
        $this->set('direccion', $datacpcp01[0]['cpcd02']['direccion_comercial']);
        $this->set('cod_area', $datacpcp01[0]['cpcd02']['codigo_area_empresa']);
        $this->set('telefono', $datacpcp01[0]['cpcd02']['telefonos']);
        $this->set('ubicacion_compras', $ubicacion_compras);

        $this->set('firmante', $firmante);
        $this->set('cargo', $cargo);
        $this->set('revisado', $revisado);
        $this->set('cargo_revisado', $cargo_revisado);
        $this->set('tipoconst', $tipoconst);

        $objeto2 = "cero";
        switch ($datacpcp01[0]['cpcd02']['objeto']) {
            case '1':$objeto2 = "PROVEEDOR";
                $this->set('objeto2', $objeto2);
                break;
            case '2':$objeto2 = "CONTRATISTA";
                $this->set('objeto2', $objeto2);
                break;
            case '3':$objeto2 = "COOPERATIVA";
                $this->set('objeto2', $objeto2);
                break;
            case '4':$objeto2 = "PERSONA NATURAL";
                $this->set('objeto2', $objeto2);
                break;
        }
        $this->set('objeto2', $objeto2); //proveedor, contratista, cooperativa, pers natural
    }

//constancia_proveedores_cont2

    function reporte_mov_generales() {
        $this->layout = "ajax";

        echo "EN CONSTRUCCION";
    }

    function cobd01_saldo_contrato_reporte($ir = null) {
        if (isset($ir) && $ir == "si") {

            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "pdf";
            $this->set('ir', 'no');
            $ano = $this->data["cobd01_saldo_contrato"]["ano"];
            if (isset($this->data["cobd01_saldo_contrato"]["consolidacion"])) {
                $consolidacion = $this->data["cobd01_saldo_contrato"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);
                $sql = "";

                if ($consolidacion != 1) {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . ' and cod_dep_original=' . $this->cod_dep_consolidado() . ' ';
                } else {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . '  ';
                }//fin if

                $data1 = $this->v_cobp01_cfpd07_cuerpo->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);
                $data2 = $this->v_cobp01_cfpd07_partidas->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);

                if ($data1) {
                    $this->set('datos', $data1);
                    $this->set('datos2', $data2);
                } else {
                    $this->set('vacio', '');
                }
            } else {
                echo ""; //revisar este codigo
            }
        }
    }

//fin cobd01_saldo_contrato_reporte

    function cobd01_saldo_contrato_reporte_xml($ir = null) {
        if (isset($ir) && $ir == "si") {

            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "ajax";
            $this->set('ir', 'no');
            $ano = $this->data["cobd01_saldo_contrato"]["ano"];
            if (isset($this->data["cobd01_saldo_contrato"]["consolidacion"])) {
                $consolidacion = $this->data["cobd01_saldo_contrato"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);
                $sql = "";

                if ($consolidacion != 1) {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . ' and cod_dep_original=' . $this->cod_dep_consolidado() . ' ';
                } else {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . '  ';
                }//fin if

                $data1 = $this->v_cobp01_cfpd07_cuerpo->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);
                $data2 = $this->v_cobp01_cfpd07_partidas->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);

                if ($data1) {
                    $this->set('datos', $data1);
                    $this->set('datos2', $data2);
                } else {
                    $this->set('vacio', '');
                }
            } else {
                echo ""; //revisar este codigo
            }
            //$_SESSION["nombre_ods"] ='cobd01_saldo_contrato_reporte_ods'.date('His').".ods";
            //$this->render('cobd01_saldo_contrato_reporte_ods');
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->render('cobd01_saldo_contrato_reporte_excel');
        }
    }

//fin cobd01_saldo_contrato_reporte_xml

    function cobd01_resumen_contrato_reporte($ir = null) {
        if (isset($ir) && $ir == "si") {
            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
            //$data=$this->cobd01_contratoobras_cuerpo->findAll($this->SQLCA()." and ano_contrato_obra=".$this->ano_ejecucion(),null,'numero_contrato_obra ASC',null,null,null);
            //print_r($data);
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "pdf";
            $this->set('ir', 'no');

            $ano = $this->data["cobd01_resumen_contrato"]["ano"];

            if (isset($this->data["cobd01_resumen_contrato"]["consolidacion"])) {
                $consolidacion = $this->data["cobd01_resumen_contrato"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);
                $sql = "";

                if ($consolidacion != 1) {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . ' and cod_dep_original=' . $this->cod_dep_consolidado() . ' ';
                } else {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . '  ';
                }//fin if

                $data1 = $this->v_cobp01_cfpd07_cuerpo->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);

                if ($data1) {
                    $this->set('datos', $data1);
                } else {
                    $this->set('vacio', '');
                }



                $data2 = $this->cpcd02->findAll();
                $this->set('deno', $data2);
            } else {
                echo ""; //revisar este codigo
            }
        }
    }

//fin cobd01_saldo_contrato_reporte

    function cobd01_resumen_contrato_reporte_xml($ir = null) {
        if (isset($ir) && $ir == "si") {
            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
            //$data=$this->cobd01_contratoobras_cuerpo->findAll($this->SQLCA()." and ano_contrato_obra=".$this->ano_ejecucion(),null,'numero_contrato_obra ASC',null,null,null);
            //print_r($data);
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "ajax";
            $this->set('ir', 'no');

            $ano = $this->data["cobd01_resumen_contrato"]["ano"];

            if (isset($this->data["cobd01_resumen_contrato"]["consolidacion"])) {
                $consolidacion = $this->data["cobd01_resumen_contrato"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);
                $sql = "";

                if ($consolidacion != 1) {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . ' and cod_dep_original=' . $this->cod_dep_consolidado() . ' ';
                } else {
                    $sql2 = 'cod_presi=' . $this->Session->read('SScodpresi') . '  and  cod_entidad=' . $this->Session->read('SScodentidad') . ' and cod_tipo_inst=' . $this->Session->read('SScodtipoinst') . ' and  cod_inst=' . $this->Session->read('SScodinst') . '  ';
                }//fin if

                $data1 = $this->v_cobp01_cfpd07_cuerpo->findAll($sql2 . ' and ano_contrato_obra=' . $ano . '  and condicion_actividad=1 ', null, 'cod_inst, cod_dep, ano_contrato_obra, numero_contrato_obra ASC', null, null, null);

                if ($data1) {
                    $this->set('datos', $data1);
                } else {
                    $this->set('vacio', '');
                }



                $data2 = $this->cpcd02->findAll();
                $this->set('deno', $data2);
            } else {
                echo ""; //revisar este codigo
            }
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->render('cobd01_resumen_contrato_reporte_excel');
        }
    }

//fin cobd01_resumen_contrato_reporte_xml

    function cepp02_saldo_contratoservicio_reporte($ir = null) {
        if (isset($ir) && $ir == "si") {
            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "pdf";
            $this->set('ir', 'no');

            $ano = $this->data["saldo_contratoservicio"]["ano"];

            if (isset($this->data["saldo_contratoservicio"]["consolidacion"])) {
                $consolidacion = $this->data["saldo_contratoservicio"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);

                if ($consolidacion != 1) {
                    $data1 = $this->cepd02_contratoservicio_cuerpo->findAll($this->SQLCA() . " and ano_contrato_servicio=" . $ano . ' and condicion_actividad=1 ', null, 'numero_contrato_servicio ASC', null, null, null);
                } else {
                    $data1 = $this->cepd02_contratoservicio_cuerpo->findAll("cod_presi=" . $this->verifica_SS(1) . " and cod_entidad=" . $this->verifica_SS(2) . " and cod_tipo_inst=" . $this->verifica_SS(3) . " and cod_inst=" . $this->verifica_SS(4) . " and ano_contrato_servicio=" . $ano . " and condicion_actividad=1", null, 'numero_contrato_servicio ASC', null, null, null);
                }

                if ($data1) {
                    $this->set('datos', $data1);
                } else {
                    $this->set('vacio', '');
                }

                $data2 = $this->cpcd02->findAll();
                $this->set('deno', $data2);
            } else {
                echo ""; //revisar este codigo
            }
        }
    }

//fin cepp02_saldo_contratoservicio_reporte

    function cepp02_resumen_contratoservicio_reporte($ir = null) {
        if (isset($ir) && $ir == "si") {
            $this->layout = "ajax";
            $this->set('ir', 'si');
            $this->set('ano', $this->ano_ejecucion());
            //$data=$this->cobd01_contratoobras_cuerpo->findAll($this->SQLCA()." and ano_contrato_obra=".$this->ano_ejecucion(),null,'numero_contrato_obra ASC',null,null,null);
            //$data1=$this->cepd02_contratoservicio_cuerpo->findAll($this->SQLCA().' and condicion_actividad=1 ',null,'numero_contrato_servicio ASC',null,null,null);
            //print_r($data1);
        } else if (isset($ir) && $ir == "no") {
            $this->layout = "pdf";
            $this->set('ir', 'no');

            $ano = $this->data["resumen_contratoservicio"]["ano"];

            if (isset($this->data["resumen_contratoservicio"]["consolidacion"])) {
                $consolidacion = $this->data["resumen_contratoservicio"]["consolidacion"];
            } else {
                $consolidacion = 2;
            }
            if ($ano != "") {
                $this->set('ano', $ano);

                if ($consolidacion != 1) {
                    $data1 = $this->cepd02_contratoservicio_cuerpo->findAll($this->SQLCA() . ' and condicion_actividad=1 ', null, 'numero_contrato_servicio ASC', null, null, null);
                } else {
                    $data1 = $this->cepd02_contratoservicio_cuerpo->findAll("cod_presi=" . $this->verifica_SS(1) . " and cod_entidad=" . $this->verifica_SS(2) . " and cod_tipo_inst=" . $this->verifica_SS(3) . " and cod_inst=" . $this->verifica_SS(4) . " and condicion_actividad=1", null, 'numero_contrato_servicio ASC', null, null, null);
                }
                //print_r($data1);
                if ($data1) {
                    $this->set('datos', $data1);
                } else {
                    $this->set('vacio', '');
                }

                $data2 = $this->cpcd02->findAll();
                $this->set('deno', $data2);
            } else {
                echo ""; //revisar este codigo
            }
        }
    }

//fin cepp02_resumeno_contratoservicio_reporte

    function reporte_dependencias() {
        $this->layout = "pdf";
        $datos = $this->arrd05->findAll($this->condicionNDEP(), null, ' cod_dep ASC');
        $this->set('datos', $datos);
        $this->set('titulo_a', $this->Session->read('dependencia'));
        $this->set('titulo_inst', $this->Session->read('entidad_federal'));
    }

    /*
     * Reporte de orden de compra formato actual, es decir, pre impreso.
     */

    function cscp04_ordencompra_bienes_formato_actual($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $sql_para_por_emitir = "";


        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);

            $url = "/select_ventana_generar_reporte/v_reporte_emision_compra_bienes_1_actual";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {

            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');



                $ano = $this->ano_ejecucion();
                $dato = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }




                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);


                $datos_cscd04_ordencompra_poremitir_bienes = $this->cscd04_ordencompra_poremitir_bienes->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                $this->set('datos_cscd04_ordencompra_poremitir_bienes', $datos_cscd04_ordencompra_poremitir_bienes);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_compra_a = "";
                $numero_orden_compra_b = "";


                if (isset($this->data['cscp04_ordencompra_bienes']['radio'])) {
                    $radio = $this->data['cscp04_ordencompra_bienes']['radio'];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''])) {
                    $ano_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['ano' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''])) {
                    $numero_orden_compra_a = $this->data['cscp04_ordencompra_bienes']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_bienes']['numero_b'])) {
                    $numero_orden_compra_b = $this->data['cscp04_ordencompra_bienes']['numero_b'];
                }


                if ($radio == "3" && $numero_orden_compra_a != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a'  and  tipo_orden=1 and condicion_actividad=1", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . "       and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a' ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and numero='$numero_orden_compra_a'";

                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                        $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra . "' and  numero_orden_compra='" . $numero_orden_compra . "' and situacion='2'  ");


                        $sql_rif_a = "asdasd";
                    }//fin
//echo $condicion." and rif='".$rif."' and ano_cotizacion='".$ano_cotizacion."' and numero_cotizacion='".$numero_cotizacion."'  ";


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {




                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . "     and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . "          and rif='" . $rif . "' and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "' and numero_ordencompra='$numero_orden_compra' and ano_ordencompra='$ano_orden_compra'", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");







                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra . "'  and numero='" . $numero_orden_compra . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra . "', '" . $numero_orden_compra . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin







                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $ano_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];
                        }//fin



                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud='" . $ano_solicitud . "' and numero_solicitud='" . $numero_solicitud . "'  ");

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $cod_dir_superior = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];
                        }//fin

                        $sql_cugd02_direccion = " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior . " ";
                        $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion . " and  cod_secretaria=" . $cod_secretaria . " and cod_direccion=" . $cod_direccion . " ";
                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin de script
                } else if ($radio == "2" && $numero_orden_compra_a != "" && $numero_orden_compra_b != "") {






                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a' and numero_orden_compra<='$numero_orden_compra_b')   and  tipo_orden=1   and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a'  and numero_orden_compra<='$numero_orden_compra_b')  ");

                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and (numero>='$numero_orden_compra_a' and numero<='$numero_orden_compra_b')";


                    $i = 0;
                    $sql = "";
                    $sql_rif = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $i++;
                        $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                        if ($sql == "") {
                            $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                        } else {
                            $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                        }


                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $rif[$i] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                        }


                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                    }//fin


                    if ($sql_rif == "") {


                        echo'<script>history.back(1);</script>';
                    } else {



//echo $sql.'<br>';

                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);





                        $i = 0;
                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= "  cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin
//echo $sql_cugd02_direccion;

                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin para el script
                } else if ($radio == "1") {




                    $datos_cscd04_ordencompra_poremitir_bienes = $this->cscd04_ordencompra_poremitir_bienes->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd04_ordencompra_poremitir_bienes as $aux_cscd04_ordencompra_poremitir_bienes) {
                        $ii++;

                        $ano_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['ano_orden_compra'];
                        $numero_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_bienes['cscd04_ordencompra_poremitir_bienes']['numero_orden_compra'];


                        if ($sql_1 == "") {
                            $sql_1 .= "    ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "')  ";
                        }
                    }//fin or



                    if ($sql_1 == "") {

                        echo'<script>history.back(1);</script>';
                    } else {

//echo $sql_1;

                        $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and (" . $sql_1 . ") and  tipo_orden=1 and username_registro='" . $this->Session->read('nom_usuario') . "' and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                        $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and (" . $sql_1 . ")");

///print_r($ordencompra_encabezado);


                        $i = 0;
                        $sql = "";
                        $sql_rif = "";

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                            if ($sql == "") {
                                $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                                $sql_para_por_emitir .= "   and     ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "'  ";
                            } else {
                                $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                                $sql_para_por_emitir .= " or  (ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "')  ";
                            }


                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $rif[$i] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                            }

                            $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                        }//fin


                        if ($sql == "") {

                            echo'<script>history.back(1);</script>';
                        } else {


//echo $sql.'<br>';

                            $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                            $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                            $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);


                            $i = 0;

                            foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                                $i++;
                                $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                                $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                                $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                                $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                                $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                                $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                                foreach ($datos_cpcd02 as $aux_cpcd02) {
                                    if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '1', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                        }//fin if
                                        break;
                                    }//fin
                                }//fin foreach
                            }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                            $sql_2 = "";
                            $j = 0;

                            foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                                $j++;
                                $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                                $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                                $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                                $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                                if ($sql_2 == "") {
                                    $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                                } else {
                                    $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                                }//fin else
                            }//fin


                            $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                            $sql_cugd02_direccion = "";
                            $x = 0;

                            foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                                $x++;

                                $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                                $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                                $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                                $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                                $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                                $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                                $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                                if ($sql_cugd02_direccion == "") {
                                    $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                                } else {

                                    $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                    $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                                }//fin else
                            }//fin



                            $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);


                            $sql = "delete from cscd04_ordencompra_poremitir_bienes  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                            $this->cscd04_ordencompra_poremitir_bienes->execute($sql);
                        }//fin else
                    }//fin else
                }//fin else





                if ($ordencompra_encabezado != "") {
                    $this->set('lista_cscd02_solicitud_cuerpo', $lista);
                    $this->set('datos_cscd03_cotizacion_encabezado', $datos_cscd03_cotizacion_encabezado);
                    $this->set('datos_cpcd02', $datos_cpcd02);
                    $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);
                    $this->set('datos_cscd03_cotizacion_cuerpo', $datos_cscd03_cotizacion_cuerpo);
                    $this->set('datos_cugd02_direccion', $datos_cugd02_direccion);
                    $this->set('ordencompra_partidas', $ordencompra_partidas);
                    $this->set('ordencompra_encabezado', $ordencompra_encabezado);
                }//fin if



                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=1  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));


                if ($datos_cugd02_direccion != "") {
                    $this->layout = "pdf";
                } else {
                    $this->layout = "ajax";
                    $this->set('errorMessage', "No existe alguna de la orden selecionada");
                }
            }//fin else



            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
        //Solo para Apure.
        //if($_SESSION['SScodpresi']==1 && $_SESSION['SScodentidad']==4 && $_SESSION['SScodtipoinst']==30 && $_SESSION['SScodinst']==4){
        if ($_SESSION['SScodpresi'] == 1 && $_SESSION['SScodentidad'] == 11 && $_SESSION['SScodtipoinst'] == 30 && $_SESSION['SScodinst'] == 11) {
            $this->render('cscp04_ordencompra_bienes_formato_actual_apure');
        }
    }

//fin function






    /*
     * Reporte de orden de servivio formato actual, es decir, formato preimpreso.
     */

    function cscp04_ordencompra_servicio_formato_actual($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;
        $sql_para_por_emitir = "";

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);


            $url = "/select_ventana_generar_reporte/v_reporte_emision_compra_servicio_1_actual";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {




            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');



                $ano = $this->ano_ejecucion();
                $dato = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }



                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);



                $datos_cscd04_ordencompra_poremitir_servicio = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cscd04_ordencompra_poremitir_servicio', $datos_cscd04_ordencompra_poremitir_servicio);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_compra_a = "";
                $numero_orden_compra_b = "";


                if (isset($this->data['cscp04_ordencompra_servicio']['radio'])) {
                    $radio = $this->data['cscp04_ordencompra_servicio']['radio'];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['ano' . $cont . ''])) {
                    $ano_orden_compra_a = $this->data['cscp04_ordencompra_servicio']['ano' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['numero_a' . $cont . ''])) {
                    $numero_orden_compra_a = $this->data['cscp04_ordencompra_servicio']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cscp04_ordencompra_servicio']['numero_b'])) {
                    $numero_orden_compra_b = $this->data['cscp04_ordencompra_servicio']['numero_b'];
                }




                if ($radio == "3" && $numero_orden_compra_a != "") {


                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a'  and  tipo_orden=2   and  condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and numero_orden_compra='$numero_orden_compra_a' ");


                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and numero='$numero_orden_compra_a'";

                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];

                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra . "' and  numero_orden_compra='" . $numero_orden_compra . "' and situacion='2'  ");

                        $sql_rif_a = "asd";
                    }//fin




                    if ($sql_rif_a == "") {

                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . "     and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . "          and rif='" . $rif . "'  and ano_cotizacion='" . $ano_cotizacion . "' and numero_cotizacion='" . $numero_cotizacion . "'  ", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");



                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $ano_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];



                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra . "'  and numero='" . $numero_orden_compra . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra . "', '" . $numero_orden_compra . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin
                                    break;
                                }//fin if
                            }//fin foreach
                        }//fin



                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $ano_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];
                        }//fin



                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and ano_solicitud='" . $ano_solicitud . "' and numero_solicitud='" . $numero_solicitud . "'  ");



                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $cod_dir_superior = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];
                        }//fin



                        $sql_cugd02_direccion = " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior . " ";
                        $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion . " and  cod_secretaria=" . $cod_secretaria . " and cod_direccion=" . $cod_direccion . " ";



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin script
                } else if ($radio == "2" && $numero_orden_compra_a != "" && $numero_orden_compra_b != "") {






                    $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a' and numero_orden_compra<='$numero_orden_compra_b')   and  tipo_orden=2  and condicion_actividad=1 ", null, 'numero_orden_compra ASC');
                    $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and ano_orden_compra=" . $ano_orden_compra_a . "  and (numero_orden_compra>='$numero_orden_compra_a'  and numero_orden_compra<='$numero_orden_compra_b')  ");


                    $sql_para_por_emitir = " and ano=" . $ano_orden_compra_a . "  and (numero>='$numero_orden_compra_a' and numero<='$numero_orden_compra_b')";

                    $i = 0;
                    $sql = "";
                    $sql_rif = "";
                    $sql_rif_a = "";

                    foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                        $i++;
                        $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                        $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                        $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                        $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                        $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                        $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                        if ($sql == "") {
                            $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'  ";
                        } else {
                            $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                        }


                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $rif[$i] . "'  ";
                        } else {
                            $sql_rif .= " or (rif='" . $rif[$i] . "')  ";
                        }


                        $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");

                        $sql_rif_a = "asdasd";
                    }//fin


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {



                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);





                        $i = 0;

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin if
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);

                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);
                    }//fin script
                } else if ($radio == "1") {




                    $datos_cscd04_ordencompra_poremitir_servicio = $this->cscd04_ordencompra_poremitir_servicio->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cscd04_ordencompra_poremitir_servicio as $aux_cscd04_ordencompra_poremitir_servicio) {
                        $ii++;

                        $ano_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_servicio['cscd04_ordencompra_poremitir_servicio']['ano_orden_compra'];
                        $numero_orden_compra_1[$ii] = $aux_cscd04_ordencompra_poremitir_servicio['cscd04_ordencompra_poremitir_servicio']['numero_orden_compra'];



                        if ($sql_1 == "") {
                            $sql_1 .= "    ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_compra='" . $ano_orden_compra_1[$ii] . "' and  numero_orden_compra='" . $numero_orden_compra_1[$ii] . "')  ";
                        }
                    }//fin or
//echo $sql_1;


                    if ($sql_1 == "") {


                        echo'<script>history.back(1);</script>';
                    } else {

                        $ordencompra_encabezado = $this->cscd04_ordencompra_encabezado->findAll($condicion . " and (" . $sql_1 . ") and  tipo_orden=2 and username_registro='" . $this->Session->read('nom_usuario') . "' and condicion_actividad=1   ", null, 'numero_orden_compra ASC');
                        $ordencompra_partidas = $this->cscd04_ordencompra_partidas->findAll($condicion . " and (" . $sql_1 . ")");

///print_r($ordencompra_encabezado);


                        $i = 0;
                        $sql = "";
                        $sql_rif = "";

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];


                            if ($sql == "") {
                                $sql .= "    ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "'   ";
                                $sql_para_por_emitir .= "   and     ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "'  ";
                            } else {
                                $sql .= " or  (ano_cotizacion='" . $ano_cotizacion[$i] . "' and  numero_cotizacion='" . $numero_cotizacion[$i] . "')  ";
                                $sql_para_por_emitir .= " or  (ano='" . $ano_orden_compra[$i] . "' and  numero='" . $numero_orden_compra[$i] . "')  ";
                            }


                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $rif[$i] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $rif[$i] . "'  ";
                            }


                            $resultado = $this->cscd04_ordencompra_numero->execute("UPDATE cscd04_ordencompra_numero SET  situacion = '3' WHERE " . $condicion . " and ano_orden_compra='" . $ano_orden_compra[$i] . "' and  numero_orden_compra='" . $numero_orden_compra[$i] . "' and situacion='2'  ");
                        }//fin
//echo $sql.'<br>';

                        $datos_cscd03_cotizacion_encabezado = $this->cscd03_cotizacion_encabezado->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")");
                        $datos_cscd03_cotizacion_cuerpo = $this->cscd03_cotizacion_cuerpo->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $lista = $this->v_cscd03_cotizacion->findAll($condicion . " and (" . $sql_rif . ") and (" . $sql . ")", null, 'codigo_prod_serv DESC');
                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);




                        $i = 0;

                        foreach ($ordencompra_encabezado as $aux_cscd04_ordencompra_encabezado) {
                            $i++;
                            $ano_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_orden_compra'];
                            $numero_orden_compra[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_orden_compra'];
                            $tipo_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['tipo_orden'];
                            $rif[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['rif'];
                            $ano_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['numero_cotizacion'];
                            $monto_orden[$i] = $aux_cscd04_ordencompra_encabezado['cscd04_ordencompra_encabezado']['monto_orden'];

                            foreach ($datos_cpcd02 as $aux_cpcd02) {
                                if ($rif[$i] == $aux_cpcd02['cpcd02']['rif']) {
                                    if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  and ano='" . $ano_orden_compra[$i] . "'  and numero='" . $numero_orden_compra[$i] . "' ") == 0) {
                                        $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                        $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '2', '" . $ano_orden_compra[$i] . "', '" . $numero_orden_compra[$i] . "', '" . $aux_cpcd02['cpcd02']['denominacion'] . "', '" . $monto_orden[$i] . "')";
                                        $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                                    }//fin
                                    break;
                                }//fin
                            }//fin foreach
                        }//fin
//echo'<pre>';
//print_r($lista);
//echo'</pre>';
//print_r($datos_cpcd02);


                        $sql_2 = "";
                        $j = 0;

                        foreach ($datos_cscd03_cotizacion_encabezado as $aux_cscd03_cotizacion_encabezado) {
                            $j++;
                            $ano_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_cotizacion'];
                            $numero_cotizacion[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_cotizacion'];
                            $ano_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['ano_solicitud'];
                            $numero_solicitud[$j] = $aux_cscd03_cotizacion_encabezado['cscd03_cotizacion_encabezado']['numero_solicitud'];

                            if ($sql_2 == "") {
                                $sql_2 .= "   ano_solicitud='" . $ano_solicitud[$j] . "' and numero_solicitud='" . $numero_solicitud[$j] . "'  ";
                            } else {
                                $sql_2 .= "  or (ano_solicitud='" . $ano_solicitud[$j] . "' and  numero_solicitud='" . $numero_solicitud[$j] . "')  ";
                            }//fin else
                        }//fin


                        $datos_cscd02_solicitud_encabezado = $this->cscd02_solicitud_encabezado->findAll($condicion . " and (" . $sql_2 . ")");

                        $sql_cugd02_direccion = "";
                        $x = 0;

                        foreach ($datos_cscd02_solicitud_encabezado as $aux_cscd02_solicitud_encabezado) {
                            $x++;

                            $cod_dir_superior[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_dir_superior'];
                            $cod_coordinacion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_coordinacion'];
                            $cod_secretaria[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_secretaria'];
                            $cod_direccion[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_direccion'];
                            $cod_division[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_division'];
                            $cod_departamento[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_departamento'];
                            $cod_oficina[$x] = $aux_cscd02_solicitud_encabezado['cscd02_solicitud_encabezado']['cod_oficina'];


                            if ($sql_cugd02_direccion == "") {
                                $sql_cugd02_direccion .= " cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . " ";
                            } else {

                                $sql_cugd02_direccion .= " or (cod_tipo_institucion = " . $cod_tipo_inst . " and cod_institucion = " . $cod_inst . " and cod_dependencia = " . $cod_dep . " and cod_dir_superior = " . $cod_dir_superior[$x] . " ";
                                $sql_cugd02_direccion .= " and  cod_coordinacion=" . $cod_coordinacion[$x] . " and  cod_secretaria=" . $cod_secretaria[$x] . " and cod_direccion=" . $cod_direccion[$x] . ") ";
                            }//fin else
                        }//fin



                        $datos_cugd02_direccion = $this->cugd02_direccion->findAll($sql_cugd02_direccion);


                        $sql = "delete from cscd04_ordencompra_poremitir_servicio  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cscd04_ordencompra_poremitir_servicio->execute($sql);
                    }//fin else
                }//fin else


                if ($ordencompra_encabezado != "") {
                    $this->set('lista_cscd02_solicitud_cuerpo', $lista);
                    $this->set('datos_cscd03_cotizacion_encabezado', $datos_cscd03_cotizacion_encabezado);
                    $this->set('datos_cpcd02', $datos_cpcd02);
                    $this->set('datos_cscd02_solicitud_encabezado', $datos_cscd02_solicitud_encabezado);
                    $this->set('datos_cscd03_cotizacion_cuerpo', $datos_cscd03_cotizacion_cuerpo);
                    $this->set('datos_cugd02_direccion', $datos_cugd02_direccion);
                    $this->set('ordencompra_partidas', $ordencompra_partidas);
                    $this->set('ordencompra_encabezado', $ordencompra_encabezado);
                }//fin if


                if ($datos_cugd02_direccion != "") {
                    $this->layout = "pdf";
                } else {
                    $this->layout = "ajax";
                    $this->set('errorMessage', "No existe alguna de la orden selecionada");
                }


                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=2  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
        //Solo para Apure.
        if ($_SESSION['SScodpresi'] == 1 && $_SESSION['SScodentidad'] == 4 && $_SESSION['SScodtipoinst'] == 30 && $_SESSION['SScodinst'] == 4) {
            $this->render('cscp04_ordencompra_servicio_formato_actual_apure');
        }
    }

//fin function

    function cepp03_ordenpago_libre_actual($year = null, $opcion = null, $cont = null) {

        $this->layout = "ajax";

        $cod_presi = $this->Session->read('SScodpresi');
        $cod_entidad = $this->Session->read('SScodentidad');
        $cod_tipo_inst = $this->Session->read('SScodtipoinst');
        $cod_inst = $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');
        $condicion = "cod_presi = " . $cod_presi . " and cod_entidad = " . $cod_entidad . " and cod_tipo_inst = " . $cod_tipo_inst . " and cod_inst = " . $cod_inst . " and cod_dep=" . $cod_dep;

        $this->Session->delete('FIN');

        if ($year == "vista") {

            $ano = $this->ano_ejecucion();


            $this->set('year', $ano);
            $this->set('vista', $opcion);



            $url = "/select_ventana_generar_reporte/v_reporte_emision_op_libre_1_actual";
            $width_aux = "750px";
            $height_aux = "400px";
            $title_aux = "Buscar";
            $resizable_aux = false;
            $maximizable_aux = false;
            $minimizable_aux = false;
            $closable_aux = false;

            if ($opcion == 3) {
                echo"<script>";
                echo "codigo_ventana('" . $url . "', '" . $width_aux . "', '" . $height_aux . "', '" . $title_aux . "', '" . $resizable_aux . "', '" . $maximizable_aux . "', '" . $minimizable_aux . "', '" . $closable_aux . "')";
                echo"</script>";
            } else {
                echo"<script>";
                echo " Windows.close(document.getElementById('capa_ventana').value)";
                echo"</script>";
            }//fin else
        } else {



            if (!$year) {


                $this->limpia_menu();
                $this->set('ir', 'no');



                $ano = $this->ano_ejecucion();

                if (!empty($dato)) {

                    $this->set('year', $dato);
                } else {
                    $this->set('year', '');
                }



                $sql = "delete from cugd06_oficios_poremitir_comun  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  ";
                $this->cugd06_oficios_poremitir_comun->execute($sql);



                $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");
                $this->set('datos_cepd03_ordenpago_poremitir', $datos_cepd03_ordenpago_poremitir);
                $this->set('usuario', $this->Session->read('nom_usuario'));
            } else {


                $this->layout = "pdf";
                $radio = 1;
                $ordencompra_encabezado = "";
                $datos_cugd02_direccion = "";
                $numero_orden_pago_a = "";
                $numero_orden_pago_b = "";


                if (isset($this->data['cepp03_ordenpago']['radio'])) {
                    $radio = $this->data['cepp03_ordenpago']['radio'];
                }
                if (isset($this->data['cepp03_ordenpago']['ano' . $cont . ''])) {
                    $ano_orden_pago_a = $this->data['cepp03_ordenpago']['ano' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_a' . $cont . ''])) {
                    $numero_orden_pago_a = $this->data['cepp03_ordenpago']['numero_a' . $cont . ''];
                }
                if (isset($this->data['cepp03_ordenpago']['numero_b'])) {
                    $numero_orden_pago_b = $this->data['cepp03_ordenpago']['numero_b'];
                }


                $partidacorriente = 407120;
                $partidacapital = 407220;


                if ($radio == "3" && $numero_orden_pago_a != "") {////////////////////////////////////////////////OPCION 1
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and numero_orden_pago='$numero_orden_pago_a' ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and numero='$numero_orden_pago_a' ";

                    $aux = 0;
                    $sql_rif_a = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                            if ($busqueda != null) {
                                if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                    $ordinario[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                    $coordinado[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                    $fci[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                    $mpps[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                    $ingresosextra[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                    $ingresospropios[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                    $laee[$aux] = 1;
                                } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                    $fides[$aux] = 1;
                                }
                                if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                    $capital[$aux] = 1;
                                } else {
                                    $corriente[$aux] = 1;
                                }
                            }//fin if
                            $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                            //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                            //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion='3'  WHERE  " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];



                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4 ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "jhgvbadsf";
                    }//fin for each

                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll(" rif='" . $rif . "' ");
                    }//fin script
                } else if ($radio == "2" && $numero_orden_pago_a != "" && $numero_orden_pago_b != "") {///////////////////////////////////////OPCION 2
                    $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' numero_orden_pago ASC');
                    $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and ano_orden_pago=" . $ano_orden_pago_a . "  and (numero_orden_pago>='$numero_orden_pago_a'  and numero_orden_pago<='$numero_orden_pago_b')  ", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');


                    $sql_para_por_emitir = " and ano=" . $ano_orden_pago_a . "  and (numero>='$numero_orden_pago_a'  and numero<='$numero_orden_pago_b')  ";


                    $sql_rif_a = "";
                    $aux = 0;
                    $sql_rif = "";
                    foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                        $aux++;
                        $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                        $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                        $corriente[$aux] = 0;
                        $capital[$aux] = 0;
                        $ordinario[$aux] = 0;
                        $coordinado[$aux] = 0;
                        $fci[$aux] = 0;
                        $mpps[$aux] = 0;
                        $ingresosextra[$aux] = 0;
                        $ingresospropios[$aux] = 0;
                        $laee[$aux] = 0;
                        $fides[$aux] = 0;
                        foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                            if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                if ($busqueda != null) {
                                    if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                        $ordinario[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                        $coordinado[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                        $fci[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                        $mpps[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                        $ingresosextra[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                        $ingresospropios[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                        $laee[$aux] = 1;
                                    } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                        $fides[$aux] = 1;
                                    }
                                    if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                        $capital[$aux] = 1;
                                    } else {
                                        $corriente[$aux] = 1;
                                    }
                                }//fin if
                                $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                            }//fin if
                        }//fin for

                        $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero  SET  situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");

                        if ($sql_rif == "") {
                            $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        } else {
                            $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                        }


                        $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                        $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                        $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                        $rif = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'];

                        if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                            $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                            $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                            $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                        }//

                        $sql_rif_a = "mhjbasdas";
                    }//fin for each


                    if ($sql_rif_a == "") {


                        echo'<script>history.back(1);</script>';
                    } else {


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif);
                    }//fin script

                    /*
                      $i = 0;
                      foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                      $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                      $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                      $monto_orden[$i]        =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                      foreach($datos_cpcd02 as $aux_cpcd02){
                      if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                      $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                      $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                      $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                      break;
                      }//fin
                      }//fin foreach
                      }//fin
                     */
                } else if ($radio == "1") {//////////////////////////////////////////////////////////////////////////////////OPCIOPN 3
                    $datos_cepd03_ordenpago_poremitir = $this->cepd03_ordenpago_poremitir->findAll($condicion . " and username='" . $this->Session->read('nom_usuario') . "' ");

                    $ii = 0;
                    $sql_1 = "";

                    foreach ($datos_cepd03_ordenpago_poremitir as $aux_cepd03_ordenpago_poremitir) {
                        $ii++;

                        $ano_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['ano_orden_pago'];
                        $numero_orden_pago_1[$ii] = $aux_cepd03_ordenpago_poremitir['cepd03_ordenpago_poremitir']['numero_orden_pago'];


                        if ($sql_1 == "") {
                            $sql_1 .= "  ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "'  ";
                            $sql_para_por_emitir = " and ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "'  ";
                        } else {
                            $sql_1 .= " or  (ano_orden_pago='" . $ano_orden_pago_1[$ii] . "' and  numero_orden_pago='" . $numero_orden_pago_1[$ii] . "')  ";
                            $sql_para_por_emitir .= " or  (ano='" . $ano_orden_pago_1[$ii] . "' and  numero='" . $numero_orden_pago_1[$ii] . "')  ";
                        }
                    }//fin for


                    if ($sql_1 == "") {



                        echo'<script>history.back(1);</script>';
                    } else {

                        $datos_cepd03_ordenpago_cuerpo = $this->cepd03_ordenpago_cuerpo->findAll($condicion . " and condicion_actividad=1 and (" . $sql_1 . ") and username_registro='" . $this->Session->read('nom_usuario') . "'   ", null, 'numero_orden_pago ASC');
                        $datos_cepd03_ordenpago_partidas = $this->cepd03_ordenpago_partidas->findAll($condicion . " and (" . $sql_1 . ")", null, ' cod_sector, cod_programa, cod_sub_prog, cod_proyecto, cod_activ_obra, cod_partida, cod_generica, cod_especifica, cod_sub_espec, cod_auxiliar ASC');



                        $aux = 0;
                        $sql_rif = "";
                        foreach ($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo) {
                            $aux++;
                            $tipodocu[$aux] = $this->cepd03_tipo_documento->findAll('cod_tipo_documento=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_documento']);
                            $ordenpago_tipopago[$aux] = $this->cepd03_ordenpago_tipopago->findAll('cod_tipo_pago=' . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['cod_tipo_pago']);
                            $corriente[$aux] = 0;
                            $capital[$aux] = 0;
                            $ordinario[$aux] = 0;
                            $coordinado[$aux] = 0;
                            $fci[$aux] = 0;
                            $mpps[$aux] = 0;
                            $ingresosextra[$aux] = 0;
                            $ingresospropios[$aux] = 0;
                            $laee[$aux] = 0;
                            $fides[$aux] = 0;
                            foreach ($datos_cepd03_ordenpago_partidas as $partidas) {
                                if ($partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] && $partidas['cepd03_ordenpago_partidas']['numero_orden_pago'] == $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago']) {
                                    $sql = $condicion . " and ano=" . $partidas['cepd03_ordenpago_partidas']['ano_orden_pago'] . " and cod_sector=" . $partidas['cepd03_ordenpago_partidas']['cod_sector'] . " and cod_programa=" . $partidas['cepd03_ordenpago_partidas']['cod_programa'] . " and cod_sub_prog=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_prog'] . " and cod_proyecto=" . $partidas['cepd03_ordenpago_partidas']['cod_proyecto'] . " and cod_activ_obra=" . $partidas['cepd03_ordenpago_partidas']['cod_activ_obra'] . " and cod_partida=" . $partidas['cepd03_ordenpago_partidas']['cod_partida'] . " and cod_generica=" . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . " and cod_especifica=" . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . " and cod_sub_espec=" . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . " and cod_auxiliar=" . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $busqueda = $this->cfpd05->findAll($sql, array('tipo_presupuesto', 'cod_tipo_gasto'));
                                    if ($busqueda != null) {
                                        if ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 1) {
                                            $ordinario[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 2) {
                                            $coordinado[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 3) {
                                            $fci[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 4) {
                                            $mpps[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 5) {
                                            $ingresosextra[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 6) {
                                            $ingresospropios[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 7) {
                                            $laee[$aux] = 1;
                                        } elseif ($busqueda[0]['cfpd05']['tipo_presupuesto'] == 8) {
                                            $fides[$aux] = 1;
                                        }
                                        if ($busqueda[0]['cfpd05']['cod_tipo_gasto'] == 2) {
                                            $capital[$aux] = 1;
                                        } else {
                                            $corriente[$aux] = 1;
                                        }
                                    }//fin if
                                    $evalpartcorriente = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    $evalpartcapital = $partidas['cepd03_ordenpago_partidas']['cod_partida'] . $partidas['cepd03_ordenpago_partidas']['cod_generica'] . $partidas['cepd03_ordenpago_partidas']['cod_especifica'] . $partidas['cepd03_ordenpago_partidas']['cod_sub_espec'] . $partidas['cepd03_ordenpago_partidas']['cod_auxiliar'];
                                    //if($evalpartcorriente==$partidacorriente){$corriente[$aux]=1;}
                                    //if($evalpartcapital==$partidacapital){$capital[$aux]=1;}
                                }//fin
                            }//fin for

                            $resultado = $this->cepd03_ordenpago_numero->execute("UPDATE cepd03_ordenpago_numero SET situacion = '3'  WHERE " . $condicion . " and ano_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'] . "' and  numero_orden_pago='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'] . "' and situacion='2'  ");
                            if ($sql_rif == "") {
                                $sql_rif .= "rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            } else {
                                $sql_rif .= " or rif='" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] . "'  ";
                            }


                            $ano_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                            $numero_orden_pago = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                            $monto_orden = $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];

                            if ($this->cugd06_oficios_poremitir_comun->findCount($sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  and ano='" . $ano_orden_pago . "'  and numero='" . $numero_orden_pago . "' ") == 0) {
                                $sql_por_emiter = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                                $sql_por_emiter .= " VALUES ('" . $cod_presi . "', '" . $cod_entidad . "', '" . $cod_tipo_inst . "', '" . $cod_inst . "', '" . $cod_dep . "', '" . $this->Session->read('nom_usuario') . "', '4', '" . $ano_orden_pago . "', '" . $numero_orden_pago . "', '" . $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['beneficiario'] . "', '" . $monto_orden . "')";
                                $R3 = $this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                            }//
                        }//fin for each


                        $datos_cpcd02 = $this->cpcd02->findAll($sql_rif); /*
                          $i = 0;
                          foreach($datos_cepd03_ordenpago_cuerpo as $aux_cepd03_ordenpago_cuerpo){$i++;
                          $ano_orden_pago[$i]     =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['ano_orden_pago'];
                          $numero_orden_pago[$i]  =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['numero_orden_pago'];
                          $monto_orden[$i]          =   $aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['monto_orden_pago'];
                          foreach($datos_cpcd02 as $aux_cpcd02){
                          if($aux_cepd03_ordenpago_cuerpo['cepd03_ordenpago_cuerpo']['rif'] == $aux_cpcd02['cpcd02']['rif']){
                          $sql_por_emiter  = "INSERT INTO cugd06_oficios_poremitir_comun (cod_presi, cod_entidad , cod_tipo_inst, cod_inst, cod_dep, username, documento, ano, numero, beneficiario, monto)";
                          $sql_por_emiter .= " VALUES ('".$cod_presi."', '".$cod_entidad."', '".$cod_tipo_inst."', '".$cod_inst."', '".$cod_dep."', '".$this->Session->read('nom_usuario')."', '4', '".$ano_orden_pago[$i]."', '".$numero_orden_pago[$i]."', '".$aux_cpcd02['cpcd02']['denominacion']."', '".$monto_orden[$i]."')";
                          $R3=$this->cugd06_oficios_poremitir_comun->execute($sql_por_emiter);
                          break;
                          }//fin
                          }//fin foreach
                          }//fin
                         */



                        $sql = "delete from cepd03_ordenpago_poremitir  where cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' ";
                        $this->cepd03_ordenpago_poremitir->execute($sql);
                    }//fin else
                }//fin else
//echo'<pre>';
                // print_r($ordenpago_tipopago);
//echo'</pre>';


                $this->set('corriente', $corriente);
                $this->set('capital', $capital);
                $this->set('ordinario', $ordinario);
                $this->set('coordinado', $coordinado);
                $this->set('fci', $fci);
                $this->set('mpps', $mpps);
                $this->set('ingresosextra', $ingresosextra);
                $this->set('ingresospropios', $ingresospropios);
                $this->set('laee', $laee);
                $this->set('fides', $fides);
                $this->set('datos_cepd03_ordenpago_cuerpo', $datos_cepd03_ordenpago_cuerpo);
                $this->set('datos_cepd03_ordenpago_partidas', $datos_cepd03_ordenpago_partidas);
                $this->set('tipodocu', $tipodocu);
                $this->set('ordenpago_tipopago', $ordenpago_tipopago);

                $sql = "cod_presi=" . $this->Session->read('SScodpresi') . " and cod_entidad=" . $this->Session->read('SScodentidad') . " and cod_tipo_inst=" . $this->Session->read('SScodtipoinst') . " and cod_inst=" . $this->Session->read('SScodinst') . " and cod_dep=" . $this->Session->read('SScoddep') . " and username='" . $this->Session->read('nom_usuario') . "' and documento=4  " . $sql_para_por_emitir;
                $this->set('cugd06_oficios_poremitir_comun', $this->cugd06_oficios_poremitir_comun->findAll($sql, null, 'numero ASC'));
            }//fin else





            $this->set('titulo_a', $this->Session->read('dependencia'));
            $this->set('entidad_federal', $this->Session->read('entidad_federal'));
        }//fin opcion vista
    }

//fin function

    function ubicacion_geografica($var1 = null) {

        set_time_limit(0);

        if ($var1 == 1) {
            $this->layout = "ajax";
        } else if ($var1 == 2) {
            $this->layout = "pdf";

            $sql_1 = "";
            $sql_2 = "";

            if (!empty($this->data['reporte']['pais'])) {
                $sql_1 .= "   cod_republica='" . $this->data['reporte']['pais'] . "' ";
                $sql_2 .= "  (cod_republica='" . $this->data['reporte']['pais'] . "' and cod_estado=0 and cod_municipio=0 and cod_parroquia=0 and cod_centro=0 and cod_vialidad=0 and cod_vereda=0) ";
            }
            if (!empty($this->data['reporte']['estado'])) {
                $sql_1 .= " and cod_estado='" . $this->data['reporte']['estado'] . "' ";
                $sql_2 .= " or (cod_republica='" . $this->data['reporte']['pais'] . "' and cod_estado='" . $this->data['reporte']['estado'] . "' and cod_municipio=0 and cod_parroquia=0 and cod_centro=0 and cod_vialidad=0 and cod_vereda=0)";
            }
            if (!empty($this->data['reporte']['municipio'])) {
                $sql_1 .= " and  cod_municipio='" . $this->data['reporte']['municipio'] . "' ";
                $sql_2 .= " or (cod_republica='" . $this->data['reporte']['pais'] . "' and cod_estado='" . $this->data['reporte']['estado'] . "'  and  cod_municipio='" . $this->data['reporte']['municipio'] . "' and cod_parroquia=0 and cod_centro=0 and cod_vialidad=0 and cod_vereda=0)";
            }
            if (!empty($this->data['reporte']['parroquia'])) {
                $sql_1 .= " and cod_parroquia='" . $this->data['reporte']['parroquia'] . "' ";
                $sql_2 .= " or (cod_republica='" . $this->data['reporte']['pais'] . "' and cod_estado='" . $this->data['reporte']['estado'] . "'  and  cod_municipio='" . $this->data['reporte']['municipio'] . "' and cod_parroquia='" . $this->data['reporte']['parroquia'] . "' and cod_centro=0 and cod_vialidad=0 and cod_vereda=0)";
            }
            if (!empty($this->data['reporte']['centro_poblado'])) {
                $sql_1 .= " and  cod_centro='" . $this->data['reporte']['centro_poblado'] . "' ";
                $sql_2 .= " or (cod_republica='" . $this->data['reporte']['pais'] . "' and cod_estado='" . $this->data['reporte']['estado'] . "'  and  cod_municipio='" . $this->data['reporte']['municipio'] . "' and cod_parroquia='" . $this->data['reporte']['parroquia'] . "' and cod_centro='" . $this->data['reporte']['centro_poblado'] . "' and cod_vialidad=0 and cod_vereda=0)";
            }

            if ($sql_1 != "") {
                $sql_1 = " WHERE " . $sql_1 . " or (" . $sql_2 . ") ";
            }

            $sql1 = ("select * from v_relacion_zonageografica  " . $sql_1 . "   ORDER BY cod_republica,  cod_estado, cod_municipio, cod_parroquia,  cod_centro,  cod_vialidad, cod_vereda ASC " );
            $ejecuta = $this->v_relacion_zonageografica->execute($sql1);
            $this->set("datos", $ejecuta);
        }//fin else


        $this->set("opcion1", $var1);
    }

//fin function

    function select_busqueda($var1 = null) {
        $this->layout = "ajax";
        $lista_republicas = $this->cugd01_republica->generateList(null, 'denominacion ASC', null, '{n}.cugd01_republica.cod_republica', '{n}.cugd01_republica.denominacion');
        $this->set('lista_1', $lista_republicas);
        $this->set("lista_1_selectd", $this->Session->read('SScodpresi'));
        $estado_var = $this->cugd01_estados->generateList("cod_republica='" . $this->Session->read('SScodpresi') . "'", 'denominacion ASC', null, '{n}.cugd01_estados.cod_estado', '{n}.cugd01_estados.denominacion');
        $this->set('lista_2', $estado_var);
        $this->set("opcion", $var1);
    }

//fin funtion

    function select_busqueda_1($var1 = null, $var2 = null, $var3 = null, $var4 = null) {
        $this->layout = "ajax";
        if ($var4 != null) {
            $this->set("opcion", 4);

            $sql = "cod_republica=" . $var1 . " and cod_estado=" . $var2 . " and cod_municipio=" . $var3 . " and cod_parroquia=" . $var4 . "";
            $consulta = $this->cugd01_centropoblados->generateList($sql, 'denominacion ASC', null, '{n}.cugd01_centropoblados.cod_centro', '{n}.cugd01_centropoblados.denominacion');
            $this->set('listado', $consulta);
        } else if ($var3 != null) {
            $this->set("opcion", 3);

            $sql = "cod_republica=" . $var1 . " and cod_estado=" . $var2 . " and cod_municipio=" . $var3 . " ";
            $consulta = $this->cugd01_parroquias->generateList($sql, 'denominacion ASC', null, '{n}.cugd01_parroquias.cod_parroquia', '{n}.cugd01_parroquias.denominacion');
            $this->set('listado', $consulta);
        } else if ($var2 != null) {
            $this->set("opcion", 2);

            $sql = "cod_republica=" . $var1 . " and cod_estado=" . $var2 . " ";
            $consulta = $this->cugd01_municipios->generateList($sql, 'denominacion ASC', null, '{n}.cugd01_municipios.cod_municipio', '{n}.cugd01_municipios.denominacion');
            $this->set('listado', $consulta);
        } else if ($var1 != null) {
            $this->set("opcion", 1);

            $sql = "cod_republica=" . $var1 . " ";
            $consulta = $this->cugd01_estados->generateList($sql, 'denominacion ASC', null, '{n}.cugd01_estados.cod_estado', '{n}.cugd01_estados.denominacion');
            $this->set('listado', $consulta);
        }//fin else

        $this->set("opcion1", $var1);
        $this->set("opcion2", $var2);
        $this->set("opcion3", $var3);
        $this->set("opcion4", $var4);
    }

//fin funtion

    function ubicacion_administrativa($var1 = null) {
        set_time_limit(0);

        if ($var1 == 1) {
            $this->layout = "ajax";
        } else if ($var1 == 2) {
            $this->layout = "pdf";

            $sql_1 = "";
            $sql_2 = "";

            //cod_dependencia
            //cod_dir_superior
            //cod_coordinacion
            //cod_secretaria
            //cod_direccion
            //cod_division
            //cod_departamento
            //cod_oficina

            if (!empty($this->data['reporte']['dependencia'])) {
                $sql_1 .= "   cod_dependencia='" . $this->data['reporte']['dependencia'] . "' ";
                $sql_2 .= "  (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior=0 and cod_coordinacion=0 and cod_secretaria=0 and cod_direccion=0 and cod_division=0 and cod_departamento=0 and cod_oficina=0) ";
            }
            if (!empty($this->data['reporte']['direccion_superior'])) {
                $sql_1 .= " and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "' and cod_coordinacion=0 and cod_secretaria=0 and cod_direccion=0 and cod_division=0 and cod_departamento=0 and cod_oficina=0)";
            }
            if (!empty($this->data['reporte']['cod_coordinacion'])) {
                $sql_1 .= " and  cod_coordinacion='" . $this->data['reporte']['direccion_superior'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria=0 and cod_direccion=0 and cod_division=0 and cod_departamento=0 and cod_oficina=0)";
            }
            if (!empty($this->data['reporte']['secretaria'])) {
                $sql_1 .= " and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' and cod_direccion=0 and cod_division=0 and cod_departamento=0 and cod_oficina=0)";
            }
            if (!empty($this->data['reporte']['direccion'])) {
                $sql_1 .= " and  cod_direccion='" . $this->data['reporte']['direccion'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' and cod_direccion='" . $this->data['reporte']['direccion'] . "' and cod_division=0 and cod_departamento=0 and cod_oficina=0)";
            }

            if (!empty($this->data['reporte']['division'])) {
                $sql_1 .= " and  cod_division='" . $this->data['reporte']['division'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' and cod_direccion='" . $this->data['reporte']['direccion'] . "' and cod_division='" . $this->data['reporte']['division'] . "' and cod_departamento=0 and cod_oficina=0)";
            }
            if (!empty($this->data['reporte']['departamento'])) {
                $sql_1 .= " and  cod_departamento='" . $this->data['reporte']['departamento'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' and cod_direccion='" . $this->data['reporte']['direccion'] . "' and cod_division='" . $this->data['reporte']['division'] . "' and cod_departamento='" . $this->data['reporte']['departamento'] . "' and cod_oficina=0)";
            }
            if (!empty($this->data['reporte']['oficina'])) {
                $sql_1 .= " and  cod_oficina='" . $this->data['reporte']['oficina'] . "' ";
                $sql_2 .= " or (cod_dependencia='" . $this->data['reporte']['dependencia'] . "' and cod_dir_superior='" . $this->data['reporte']['direccion_superior'] . "'  and  cod_coordinacion='" . $this->data['reporte']['coordinacion'] . "' and cod_secretaria='" . $this->data['reporte']['secretaria'] . "' and cod_direccion='" . $this->data['reporte']['direccion'] . "' and cod_division='" . $this->data['reporte']['division'] . "' and cod_departamento='" . $this->data['reporte']['departamento'] . "' and cod_oficina='" . $this->data['reporte']['oficina'] . "')";
            }

            if ($sql_1 != "") {
                $sql_1 = " WHERE " . $sql_1 . " or (" . $sql_2 . ") ";
            } else {
                if ($this->Session->read('SScoddep') != 1) {
                    $sql_1 = " WHERE cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "' and cod_dependencia='" . $this->Session->read('SScoddep') . "'";
                }
            }

            $sql1 = "select * from v_ubicacion_administrativa " . $sql_1 . " ORDER BY cod_dependencia, cod_dir_superior, cod_coordinacion, cod_secretaria, cod_direccion, cod_division, cod_departamento, cod_oficina ASC ";
            $ejecuta = $this->v_relacion_zonageografica->execute($sql1);
            $this->set("datos", $ejecuta);

            $array_dep = array();
            $dependencias = $this->arrd05->findAll("cod_presi='" . $this->Session->read('SScodpresi') . "' and cod_entidad='" . $this->Session->read('SScodentidad') . "' and cod_tipo_inst='" . $this->Session->read('SScodtipoinst') . "' and cod_inst='" . $this->Session->read('SScodinst') . "'");
            foreach ($dependencias as $dep) {
                $array_dep[$dep['arrd05']['cod_dep']] = $dep['arrd05']['denominacion'];
            }
            $this->set("array_dep", $array_dep);
        }//fin else

        $this->set("opcion1", $var1);
    }

//fin function

    function select_busqueda_administrativa($var1 = null) {
        $this->layout = "ajax";

        $this->Session->read('SScodpresi');
        $this->Session->read('SScodentidad');
        $this->Session->read('SScodtipoinst');
        $this->Session->read('SScodinst');
        $cod_dep = $this->Session->read('SScoddep');

        if ($cod_dep == 1) {
            $condicion = "cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "'";
        } else {
            $condicion = "cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "' and cod_dependencia='" . $this->Session->read('SScoddep') . "'";
        }

        $lista_republicas = $this->cugd02_dependencia->generateList($condicion, 'denominacion ASC', null, '{n}.cugd02_dependencia.cod_dependencia', '{n}.cugd02_dependencia.denominacion');
        $this->set('lista_1', $lista_republicas);
        $this->set("lista_1_selectd", $this->Session->read('SScoddep'));
        $estado_var = $this->cugd02_direccionsuperior->generateList("cod_tipo_institucion='" . $this->Session->read('SScodtipoinst') . "' and cod_institucion='" . $this->Session->read('SScodinst') . "' and cod_dependencia='" . $this->Session->read('SScoddep') . "'", 'denominacion ASC', null, '{n}.cugd02_direccionsuperior.cod_dir_superior', '{n}.cugd02_direccionsuperior.denominacion');
        $this->set('lista_2', $estado_var);
        $this->set("opcion", $var1);
    }

//fin funtion

    function select_busqueda_administrativa_1($var1 = null, $var2 = null, $var3 = null, $var4 = null, $var5 = null, $var6 = null, $var7 = null) {
        $this->layout = "ajax";
        if ($var7 != null) {
            $this->set("opcion", 7);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " and cod_coordinacion=" . $var3 . " and cod_secretaria=" . $var4 . " and cod_direccion=" . $var5 . " and cod_division=" . $var6 . " and cod_departamento=" . $var7 . "";
            $consulta = $this->cugd02_oficina->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_oficina.cod_oficina', '{n}.cugd02_oficina.denominacion');
            $this->set('listado', $consulta);
        } else if ($var6 != null) {
            $this->set("opcion", 6);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " and cod_coordinacion=" . $var3 . " and cod_secretaria=" . $var4 . " and cod_direccion=" . $var5 . " and cod_division=" . $var6 . "";
            $consulta = $this->cugd02_departamento->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_departamento.cod_departamento', '{n}.cugd02_departamento.denominacion');
            $this->set('listado', $consulta);
        } else if ($var5 != null) {
            $this->set("opcion", 5);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " and cod_coordinacion=" . $var3 . " and cod_secretaria=" . $var4 . " and cod_direccion=" . $var5 . "";
            $consulta = $this->cugd02_division->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_division.cod_division', '{n}.cugd02_division.denominacion');
            $this->set('listado', $consulta);
        } else if ($var4 != null) {
            $this->set("opcion", 4);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " and cod_coordinacion=" . $var3 . " and cod_secretaria=" . $var4 . "";
            $consulta = $this->cugd02_direccion->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_direccion.cod_direccion', '{n}.cugd02_direccion.denominacion');
            $this->set('listado', $consulta);
        } else if ($var3 != null) {
            $this->set("opcion", 3);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " and cod_coordinacion=" . $var3 . " ";
            $consulta = $this->cugd02_secretaria->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_secretaria.cod_secretaria', '{n}.cugd02_secretaria.denominacion');
            $this->set('listado', $consulta);
        } else if ($var2 != null) {
            $this->set("opcion", 2);

            $sql = "cod_dependencia=" . $var1 . " and cod_dir_superior=" . $var2 . " ";
            $consulta = $this->cugd02_coordinacion->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_coordinacion.cod_coordinacion', '{n}.cugd02_coordinacion.denominacion');
            $this->set('listado', $consulta);
        } else if ($var1 != null) {
            $this->set("opcion", 1);

            $sql = "cod_dependencia=" . $var1 . " ";
            $consulta = $this->cugd02_direccionsuperior->generateList($sql, 'denominacion ASC', null, '{n}.cugd02_direccionsuperior.cod_dir_superior', '{n}.cugd02_direccionsuperior.denominacion');
            $this->set('listado', $consulta);
        }//fin else

        $this->set("opcion1", $var1);
        $this->set("opcion2", $var2);
        $this->set("opcion3", $var3);
        $this->set("opcion4", $var4);
        $this->set("opcion5", $var5);
        $this->set("opcion6", $var6);
    }

//fin funtion

}

//fin class
?>